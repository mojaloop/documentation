<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2664px" preserveAspectRatio="none" style="width:2938px;height:2664px;background:#FFFFFF;" version="1.1" viewBox="0 0 2938 2664" width="2938px" zoomAndPan="magnify"><defs/><g><rect fill="#D3D3D3" height="2652.3438" style="stroke:#181818;stroke-width:0.5;" width="1106.5" x="982.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1444.75" y="28.8379">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="123" x="1444.75" y="56.5098">Payer DFSP</text><rect fill="#FFFFFF" height="1899.5781" style="stroke:#181818;stroke-width:1.0;" width="10" x="1966.5" y="571.0781"/><rect height="170.3594" style="stroke:#000000;stroke-width:1.5;fill:none;" width="596.5" x="746" y="332.375"/><rect height="556.4063" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1158.5" x="1763" y="586.0781"/><rect height="584.0781" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1117.5" x="1712" y="1202.1563"/><rect height="584.0781" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1099.5" x="1712" y="1845.9063"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="115" x2="115" y1="135.6875" y2="2585"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1043.5" x2="1043.5" y1="135.6875" y2="2585"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1971" x2="1971" y1="135.6875" y2="2585"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2434.5" x2="2434.5" y1="135.6875" y2="2585"/><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="12" y="122.8535">Core banking solution</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="5" y="2584"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="12" y="2613.8379">Core banking solution</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="986.5" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1019.5" y="95.1816">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="993.5" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="986.5" y="2584"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1019.5" y="2613.8379">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="993.5" y="2641.5098">Connector</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="1858" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="1865" y="122.8535">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="1858" y="2584"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="1865" y="2613.8379">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2382.5" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="2389.5" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="2403" y="122.8535">Switch</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2382.5" y="2584"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="2389.5" y="2613.8379">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="2403" y="2641.5098">Switch</text><rect fill="#FFFFFF" height="1899.5781" style="stroke:#181818;stroke-width:1.0;" width="10" x="1966.5" y="571.0781"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2931.5" x="0" y="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2931.5" y1="172.5234" y2="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2931.5" y1="175.5234" y2="175.5234"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="584" x="1173.75" y="155.6875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="564" x="1179.75" y="182.5254">Payer DFSP integration - 2 phase commit - single phase</text><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="157.5" y1="235.0313" y2="235.0313"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.5" x2="157.5" y1="235.0313" y2="248.0313"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="157.5" y1="248.0313" y2="248.0313"/><polygon fill="#181818" points="126.5,244.0313,116.5,248.0313,126.5,252.0313,122.5,248.0313" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="122.5" y="228.1973">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="139" x="152.5" y="228.1973">Reserve funds</text><polygon fill="#181818" points="1031.5,313.375,1041.5,317.375,1031.5,321.375,1035.5,317.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="1037.5" y1="317.375" y2="317.375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="122.5" y="296.7051">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="152.5" y="282.8691">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="175" x="220.5" y="282.8691">/bulkDisbursement</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="874" x="152.5" y="310.541">(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)</text><path d="M746,332.375 L835,332.375 L835,352.0469 L825,362.0469 L746,362.0469 L746,332.375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="170.3594" style="stroke:#000000;stroke-width:1.5;" width="596.5" x="746" y="332.375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="761" y="356.2129">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="210" x="850" y="357.2129">[n times  (in parallel)]</text><polygon fill="#FAFAFA" points="766,379.7188,1028,379.7188,1038,410.7188,1028,442.7188,766,442.7188,756,410.7188,766,379.7188" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="768" y="406.5566">For each individual transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="768" y="434.2285">in bulk message</text><line style="stroke:#181818;stroke-width:1.0;" x1="1043.5" x2="1085.5" y1="481.7344" y2="481.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1085.5" x2="1085.5" y1="481.7344" y2="494.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1044.5" x2="1085.5" y1="494.7344" y2="494.7344"/><polygon fill="#181818" points="1054.5,490.7344,1044.5,494.7344,1054.5,498.7344,1050.5,494.7344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1050.5" y="474.9004">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="250" x="1080.5" y="474.9004">validate MSISDN &amp; Prefix</text><polygon fill="#181818" points="1954.5,567.0781,1964.5,571.0781,1954.5,575.0781,1958.5,571.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1043.5" x2="1960.5" y1="571.0781" y2="571.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1050.5" y="550.4082">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1080.5" y="536.5723">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="135" x="1148.5" y="536.5723">/bulkTransfers</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="874" x="1080.5" y="564.2441">(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)</text><path d="M1763,586.0781 L1852,586.0781 L1852,605.75 L1842,615.75 L1763,615.75 L1763,586.0781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="556.4063" style="stroke:#000000;stroke-width:1.5;" width="1158.5" x="1763" y="586.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1778" y="609.916">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="545" x="1867" y="610.916">[N times &amp; within bulkExpiration timelimit  (in parallel)]</text><polygon fill="#FAFAFA" points="1783,633.4219,1951,633.4219,1961,664.4219,1951,696.4219,1783,696.4219,1773,664.4219,1783,633.4219" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="164" x="1785" y="660.2598">For each transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1785" y="687.9316">in bulk message</text><polygon fill="#181818" points="2422.5,731.4375,2432.5,735.4375,2422.5,739.4375,2426.5,735.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2428.5" y1="735.4375" y2="735.4375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1983.5" y="728.6035">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="2013.5" y="728.6035">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="2066.5" y="728.6035">/parties/{Type}/{ID}/{SubId}</text><polygon fill="#181818" points="1987.5,773.1094,1977.5,777.1094,1987.5,781.1094,1983.5,777.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1981.5" x2="2433.5" y1="777.1094" y2="777.1094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1993.5" y="770.2754">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2023.5" y="770.2754">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="818.7813" y2="818.7813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="818.7813" y2="831.7813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="831.7813" y2="831.7813"/><polygon fill="#181818" points="2445.5,827.7813,2435.5,831.7813,2445.5,835.7813,2441.5,831.7813" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2441.5" y="811.9473">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="353" x="2471.5" y="811.9473">Determine Payee DFSP using oracle</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="901.125" y2="901.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="901.125" y2="914.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="914.125" y2="914.125"/><polygon fill="#181818" points="2445.5,910.125,2435.5,914.125,2445.5,918.125,2441.5,914.125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2441.5" y="880.4551">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="438" x="2471.5" y="866.6191">Lookup Payee Information from Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2477.5" y="894.291">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="2533.5" y="894.291">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="71" x="2586.5" y="894.291">/parties</text><polygon fill="#181818" points="1987.5,951.7969,1977.5,955.7969,1987.5,959.7969,1983.5,955.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1981.5" x2="2433.5" y1="955.7969" y2="955.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1993.5" y="948.9629">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2023.5" y="948.9629">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="2075.5" y="948.9629">/parties/{Type}/{ID}/{SubId}</text><polygon fill="#181818" points="2422.5,993.4688,2432.5,997.4688,2422.5,1001.4688,2426.5,997.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1976.5" x2="2428.5" y1="997.4688" y2="997.4688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="990.6348">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2025.5" y="990.6348">HTTP 200 Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="1066.8125" y2="1066.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="1066.8125" y2="1079.8125"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="1079.8125" y2="1079.8125"/><polygon fill="#181818" points="1987.5,1075.8125,1977.5,1079.8125,1987.5,1083.8125,1983.5,1079.8125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1046.1426">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="285" x="2025.5" y="1032.3066">Update transaction status and</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="260" x="2031.5" y="1059.9785">attach get parties response</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="1121.4844" y2="1121.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="1121.4844" y2="1134.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="1134.4844" y2="1134.4844"/><polygon fill="#181818" points="1987.5,1130.4844,1977.5,1134.4844,1987.5,1138.4844,1983.5,1134.4844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1114.6504">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="302" x="2025.5" y="1114.6504">Add to next phase FSP bulk call</text><rect fill="#FAFAFA" height="35" style="stroke:#181818;stroke-width:0.5;" width="132" x="1829" y="1154.4844"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="124" x="1833" y="1181.3223">Accept Party</text><path d="M1712,1202.1563 L1801,1202.1563 L1801,1221.8281 L1791,1231.8281 L1712,1231.8281 L1712,1202.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="584.0781" style="stroke:#000000;stroke-width:1.5;" width="1117.5" x="1712" y="1202.1563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1727" y="1225.9941">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="729" x="1816" y="1226.9941">[Quote Processing (M times &amp; within bulkExpiration timelimit in parallel)]</text><polygon fill="#FAFAFA" points="1732,1249.5,1951,1249.5,1961,1280.5,1951,1312.5,1732,1312.5,1722,1280.5,1732,1249.5" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="215" x="1734" y="1276.3379">For each payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1734" y="1304.0098">in bulk message</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="1351.5156" y2="1351.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="1351.5156" y2="1364.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="1364.5156" y2="1364.5156"/><polygon fill="#181818" points="1987.5,1360.5156,1977.5,1364.5156,1987.5,1368.5156,1983.5,1364.5156" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1344.6816">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="199" x="2025.5" y="1344.6816">Check bulkExpiration</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="1406.1875" y2="1406.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="1406.1875" y2="1419.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="1419.1875" y2="1419.1875"/><polygon fill="#181818" points="1987.5,1415.1875,1977.5,1419.1875,1987.5,1423.1875,1983.5,1419.1875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1399.3535">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="239" x="2025.5" y="1399.3535">Create bulkTransactionId</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="1516.2031" y2="1516.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="1516.2031" y2="1529.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="1529.2031" y2="1529.2031"/><polygon fill="#181818" points="1987.5,1525.2031,1977.5,1529.2031,1987.5,1533.2031,1983.5,1529.2031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1481.6973">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="194" x="2025.5" y="1454.0254">Calculate bulk expiry</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="391" x="2025.5" y="1481.6973">based on both expirySeconds config and</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="133" x="2025.5" y="1509.3691">bulkExpiration</text><polygon fill="#181818" points="2422.5,1566.875,2432.5,1570.875,2422.5,1574.875,2426.5,1570.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2428.5" y1="1570.875" y2="1570.875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1564.041">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2025.5" y="1564.041">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="2093.5" y="1564.041">/bulkquotes</text><polygon fill="#181818" points="1987.5,1608.5469,1977.5,1612.5469,1987.5,1616.5469,1983.5,1612.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1981.5" x2="2433.5" y1="1612.5469" y2="1612.5469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1993.5" y="1605.7129">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2035.5" y="1605.7129">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="1681.8906" y2="1681.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="1681.8906" y2="1694.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="1694.8906" y2="1694.8906"/><polygon fill="#181818" points="2445.5,1690.8906,2435.5,1694.8906,2445.5,1698.8906,2441.5,1694.8906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2441.5" y="1661.2207">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="334" x="2483.5" y="1647.3848">Pass on bulkquote to Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2489.5" y="1675.0566">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2545.5" y="1675.0566">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="2613.5" y="1675.0566">/bulkquotes</text><polygon fill="#181818" points="1987.5,1732.5625,1977.5,1736.5625,1987.5,1740.5625,1983.5,1736.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1981.5" x2="2433.5" y1="1736.5625" y2="1736.5625"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1993.5" y="1729.7285">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2035.5" y="1729.7285">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="146" x="2087.5" y="1729.7285">/bulkquotes/{Id}</text><polygon fill="#181818" points="2422.5,1774.2344,2432.5,1778.2344,2422.5,1782.2344,2426.5,1778.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1976.5" x2="2428.5" y1="1778.2344" y2="1778.2344"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="1771.4004">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2025.5" y="1771.4004">HTTP 200 Response</text><rect fill="#FAFAFA" height="35" style="stroke:#181818;stroke-width:0.5;" width="140" x="1821" y="1798.2344"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="132" x="1825" y="1825.0723">Accept Quote</text><path d="M1712,1845.9063 L1801,1845.9063 L1801,1865.5781 L1791,1875.5781 L1712,1875.5781 L1712,1845.9063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="584.0781" style="stroke:#000000;stroke-width:1.5;" width="1099.5" x="1712" y="1845.9063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1727" y="1869.7441">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="760" x="1816" y="1870.7441">[Transfer Processing (M times &amp; within bulkExpiration timelimit  in parallel)]</text><polygon fill="#FAFAFA" points="1732,1893.25,1951,1893.25,1961,1924.25,1951,1956.25,1732,1956.25,1722,1924.25,1732,1893.25" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="215" x="1734" y="1920.0879">For each payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1734" y="1947.7598">in bulk message</text><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2018.5" y1="2050.6094" y2="2050.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2018.5" x2="2018.5" y1="2050.6094" y2="2063.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="1977.5" x2="2018.5" y1="2063.6094" y2="2063.6094"/><polygon fill="#181818" points="1987.5,2059.6094,1977.5,2063.6094,1987.5,2067.6094,1983.5,2063.6094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="2016.1035">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="374" x="2025.5" y="1988.4316">Confirm Fees meets auto accept levels</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="378" x="2031.5" y="2016.1035">and bulkExpiration timelimit not reached</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="250" x="2025.5" y="2043.7754">-&gt; Update Transfer Status</text><polygon fill="#181818" points="2422.5,2101.2813,2432.5,2105.2813,2422.5,2109.2813,2426.5,2105.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1976.5" x2="2428.5" y1="2105.2813" y2="2105.2813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="2098.4473">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2025.5" y="2098.4473">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="2093.5" y="2098.4473">/bulktransfers</text><polygon fill="#181818" points="1987.5,2142.9531,1977.5,2146.9531,1987.5,2150.9531,1983.5,2146.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1981.5" x2="2433.5" y1="2146.9531" y2="2146.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1993.5" y="2140.1191">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2035.5" y="2140.1191">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="2188.625" y2="2188.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="2188.625" y2="2201.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="2201.625" y2="2201.625"/><polygon fill="#181818" points="2445.5,2197.625,2435.5,2201.625,2445.5,2205.625,2441.5,2201.625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2441.5" y="2181.791">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="267" x="2483.5" y="2181.791">Reserve Payer DFSP funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="2270.9688" y2="2270.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="2270.9688" y2="2283.9688"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="2283.9688" y2="2283.9688"/><polygon fill="#181818" points="2445.5,2279.9688,2435.5,2283.9688,2445.5,2287.9688,2441.5,2283.9688" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2441.5" y="2250.2988">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="316" x="2483.5" y="2236.4629">Pass on transfer to Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2489.5" y="2264.1348">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2545.5" y="2264.1348">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="2613.5" y="2264.1348">/bulktransfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="2434.5" x2="2476.5" y1="2325.6406" y2="2325.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="2476.5" x2="2476.5" y1="2325.6406" y2="2338.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="2435.5" x2="2476.5" y1="2338.6406" y2="2338.6406"/><polygon fill="#181818" points="2445.5,2334.6406,2435.5,2338.6406,2445.5,2342.6406,2441.5,2338.6406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2441.5" y="2318.8066">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="262" x="2483.5" y="2318.8066">Commit Payer DFSP funds</text><polygon fill="#181818" points="1987.5,2376.3125,1977.5,2380.3125,1987.5,2384.3125,1983.5,2380.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1981.5" x2="2433.5" y1="2380.3125" y2="2380.3125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1993.5" y="2373.4785">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2035.5" y="2373.4785">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="165" x="2087.5" y="2373.4785">/bulktransfers/{Id}</text><polygon fill="#181818" points="2422.5,2417.9844,2432.5,2421.9844,2422.5,2425.9844,2426.5,2421.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1976.5" x2="2428.5" y1="2421.9844" y2="2421.9844"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1983.5" y="2415.1504">[28]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2025.5" y="2415.1504">HTTP 200 Response</text><polygon fill="#181818" points="1054.5,2466.6563,1044.5,2470.6563,1054.5,2474.6563,1050.5,2470.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1048.5" x2="1970.5" y1="2470.6563" y2="2470.6563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1060.5" y="2463.8223">[29]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="1102.5" y="2463.8223">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="165" x="1154.5" y="2463.8223">/bulktransfers/{Id}</text><polygon fill="#181818" points="126.5,2508.3281,116.5,2512.3281,126.5,2516.3281,122.5,2512.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="120.5" x2="1042.5" y1="2512.3281" y2="2512.3281"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="132.5" y="2505.4941">[30]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="174.5" y="2505.4941">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="209" x="226.5" y="2505.4941">/bulkdisbursement/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="157.5" y1="2554" y2="2554"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.5" x2="157.5" y1="2554" y2="2567"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="157.5" y1="2567" y2="2567"/><polygon fill="#181818" points="126.5,2563,116.5,2567,126.5,2571,122.5,2567" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="122.5" y="2547.166">[31]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="134" x="164.5" y="2547.166">Commit funds</text><!--MD5=[18b4a19decf9aac61d33548e3a0d62d8]
@startuml PayerDFSPBulkSinglePhasePattern
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title PayerDFSPBulkSinglePhasePattern
' declare actors
participant "Core banking solution" as CBS
box "Payment Manager\nPayer DFSP" #LightGrey
participant "Core\nConnector" as CC 
participant "SDK Scheme Adapter" as MC 
end box
participant "Mojaloop\nSwitch" as Switch
autonumber 1 1 "<b>[0]"

== Payer DFSP integration - 2 phase commit - single phase ==

CBS->CBS: Reserve funds
CBS->CC: **POST** /bulkDisbursement \n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)
Loop n times  (in parallel)
    hnote left of CC
        For each individual transfer
        in bulk message
    end hnote
    CC -> CC: validate MSISDN & Prefix
end Loop
CC->MC: **POST** /bulkTransfers \n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)
activate MC
loop N times & within bulkExpiration timelimit  (in parallel)
hnote left of MC
        For each transfer
        in bulk message
end hnote
  MC->Switch: **GET** /parties/{Type}/{ID}/{SubId}
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Determine Payee DFSP using oracle
  Switch->Switch: Lookup Payee Information from Payee DFSP\n using **GET** /parties
  Switch->MC: **PUT** /parties/{Type}/{ID}/{SubId}
  MC- ->Switch: HTTP 200 Response
  MC -> MC: Update transaction status and\n attach get parties response
  MC -> MC: Add to next phase FSP bulk call
end Loop

rnote left MC
  Accept Party
endrnote

loop Quote Processing (M times & within bulkExpiration timelimit in parallel)
  hnote left of MC
          For each payee DFSP
          in bulk message
  end hnote
  MC->MC: Check bulkExpiration
  MC->MC: Create bulkTransactionId
  MC -> MC: Calculate bulk expiry \nbased on both expirySeconds config and \nbulkExpiration
  MC->Switch: **POST** /bulkquotes
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Pass on bulkquote to Payee DFSP\n using **POST** /bulkquotes
  Switch->MC: **PUT** /bulkquotes/{Id}
  MC- ->Switch: HTTP 200 Response
end loop

rnote left MC
  Accept Quote
endrnote
loop Transfer Processing (M times & within bulkExpiration timelimit  in parallel)
  hnote left of MC
        For each payee DFSP
        in bulk message
  end hnote
  MC -> MC: Confirm Fees meets auto accept levels\n and bulkExpiration timelimit not reached \n-> Update Transfer Status

  MC->Switch: **POST** /bulktransfers
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Reserve Payer DFSP funds
  Switch->Switch: Pass on transfer to Payee DFSP\n using **POST** /bulktransfers
  Switch->Switch: Commit Payer DFSP funds
  Switch->MC: **PUT** /bulktransfers/{Id}
  MC- ->Switch: HTTP 200 Response
end loop  

MC->CC: **PUT** /bulktransfers/{Id}

deactivate MC
CC->CBS: **PUT** /bulkdisbursement/{Id}
CBS->CBS: Commit funds

@enduml

@startuml PayerDFSPBulkSinglePhasePattern

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Core banking solution" as CBS
box "Payment Manager\nPayer DFSP" #LightGrey
participant "Core\nConnector" as CC 
participant "SDK Scheme Adapter" as MC 
end box
participant "Mojaloop\nSwitch" as Switch
autonumber 1 1 "<b>[0]"

== Payer DFSP integration - 2 phase commit - single phase ==

CBS->CBS: Reserve funds
CBS->CC: **POST** /bulkDisbursement \n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)
Loop n times  (in parallel)
    hnote left of CC
        For each individual transfer
        in bulk message
    end hnote
    CC -> CC: validate MSISDN & Prefix
end Loop
CC->MC: **POST** /bulkTransfers \n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = true, synchronous = false)
activate MC
loop N times & within bulkExpiration timelimit  (in parallel)
hnote left of MC
        For each transfer
        in bulk message
end hnote
  MC->Switch: **GET** /parties/{Type}/{ID}/{SubId}
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Determine Payee DFSP using oracle
  Switch->Switch: Lookup Payee Information from Payee DFSP\n using **GET** /parties
  Switch->MC: **PUT** /parties/{Type}/{ID}/{SubId}
  MC- ->Switch: HTTP 200 Response
  MC -> MC: Update transaction status and\n attach get parties response
  MC -> MC: Add to next phase FSP bulk call
end Loop

rnote left MC
  Accept Party
endrnote

loop Quote Processing (M times & within bulkExpiration timelimit in parallel)
  hnote left of MC
          For each payee DFSP
          in bulk message
  end hnote
  MC->MC: Check bulkExpiration
  MC->MC: Create bulkTransactionId
  MC -> MC: Calculate bulk expiry \nbased on both expirySeconds config and \nbulkExpiration
  MC->Switch: **POST** /bulkquotes
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Pass on bulkquote to Payee DFSP\n using **POST** /bulkquotes
  Switch->MC: **PUT** /bulkquotes/{Id}
  MC- ->Switch: HTTP 200 Response
end loop

rnote left MC
  Accept Quote
endrnote
loop Transfer Processing (M times & within bulkExpiration timelimit  in parallel)
  hnote left of MC
        For each payee DFSP
        in bulk message
  end hnote
  MC -> MC: Confirm Fees meets auto accept levels\n and bulkExpiration timelimit not reached \n-> Update Transfer Status

  MC->Switch: **POST** /bulktransfers
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Reserve Payer DFSP funds
  Switch->Switch: Pass on transfer to Payee DFSP\n using **POST** /bulktransfers
  Switch->Switch: Commit Payer DFSP funds
  Switch->MC: **PUT** /bulktransfers/{Id}
  MC- ->Switch: HTTP 200 Response
end loop  

MC->CC: **PUT** /bulktransfers/{Id}

deactivate MC
CC->CBS: **PUT** /bulkdisbursement/{Id}
CBS->CBS: Commit funds

@enduml

PlantUML version 1.2022.6(Tue Jun 21 18:34:49 BST 2022)
(GPLV2 source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>