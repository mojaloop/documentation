<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3791px" preserveAspectRatio="none" style="width:2198px;height:3791px;background:#FFFFFF;" version="1.1" viewBox="0 0 2198 3791" width="2198px" zoomAndPan="magnify">
  <title>1.3.1. Prepare Position Handler Consume</title>
  <defs/>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="325.8828" x="937.9946" y="27.9951">1.3.1. Prepare Position Handler Consume</text>
    <rect fill="#FFFFE0" height="3742.2344" style="stroke:#181818;stroke-width:0.5;" width="1897.6201" x="36" y="43.2969"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112.0361" x="928.792" y="55.3638">Central Service</text>
    <rect fill="#FFFFFF" height="3516.3203" style="stroke:#181818;stroke-width:1.0;" width="10" x="95.292" y="153.3203"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="431.437" y="2794.3906"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="431.437" y="3639.6406"/>
    <rect fill="#FFFFFF" height="2144.2188" style="stroke:#181818;stroke-width:1.0;" width="10" x="561.0347" y="198.5859"/>
    <rect fill="#FFFFFF" height="171.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1396.332" y="2942.7266"/>
    <rect fill="#FFFFFF" height="77.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="381.5156"/>
    <rect fill="#FFFFFF" height="62.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="842.5703"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="991.2344"/>
    <rect fill="#FFFFFF" height="107.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1098.6328"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1845.5469"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1968.0781"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="2243.5391"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="3022.125"/>
    <rect fill="none" height="3524.3203" style="stroke:#000000;stroke-width:1.5;" width="2182.8721" x="10" y="160.3203"/>
    <rect fill="none" height="2058.9531" style="stroke:#000000;stroke-width:1.5;" width="1675.9492" x="506.9229" y="255.7188"/>
    <rect fill="none" height="1319.8359" style="stroke:#000000;stroke-width:1.5;" width="1959.5225" x="20" y="2357.8047"/>
    <rect fill="none" height="233.0625" style="stroke:#000000;stroke-width:1.5;" width="1939.5225" x="30" y="2889.3281"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="100" x2="100" y1="143.3203" y2="3701.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="435.9512" x2="435.9512" y1="143.3203" y2="3701.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="565.9229" x2="565.9229" y1="143.3203" y2="3701.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1400.9141" x2="1400.9141" y1="143.3203" y2="3701.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1879.8838" x2="1879.8838" y1="143.3203" y2="3701.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.584" x="40" y="140.0186">Position Handler</text>
    <ellipse cx="100.292" cy="111.0234" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="96.292,99.0234,102.292,94.0234,100.292,99.0234,102.292,104.0234,96.292,99.0234" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.584" x="40" y="3713.6357">Position Handler</text>
    <ellipse cx="100.292" cy="3732.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="96.292,3720.9375,102.292,3715.9375,100.292,3720.9375,102.292,3725.9375,96.292,3720.9375" style="stroke:#181818;stroke-width:1.0;"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="136.9717" x="369.9512" y="108.0234"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="136.9717" x="365.9512" y="112.0234"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9717" x="372.9512" y="132.0186">Notification-Topic</text>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="136.9717" x="369.9512" y="3700.6406"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="136.9717" x="365.9512" y="3704.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9717" x="372.9512" y="3724.6357">Notification-Topic</text>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.0088" x="535.5303" y="107.4248">Position</text>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.2236" x="516.9229" y="123.7217">Management</text>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.4082" x="537.8306" y="140.0186">Facade</text>
    <ellipse cx="566.0347" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="554.0347" x2="578.0347" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.0088" x="535.5303" y="3713.6357">Position</text>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.2236" x="516.9229" y="3729.9326">Management</text>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50.4082" x="537.8306" y="3746.2295">Facade</text>
    <ellipse cx="566.0347" cy="3765.5313" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="554.0347" x2="578.0347" y1="3779.5313" y2="3779.5313"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8359" x="1352.9141" y="140.0186">Position DAO</text>
    <ellipse cx="1401.332" cy="111.0234" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1389.332" x2="1413.332" y1="125.0234" y2="125.0234"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.8359" x="1352.9141" y="3713.6357">Position DAO</text>
    <ellipse cx="1401.332" cy="3732.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1389.332" x2="1413.332" y1="3746.9375" y2="3746.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.7363" x="1830.8838" y="140.0186">Central Store</text>
    <path d="M1862.252,91.0234 C1862.252,81.0234 1880.252,81.0234 1880.252,81.0234 C1880.252,81.0234 1898.252,81.0234 1898.252,91.0234 L1898.252,117.0234 C1898.252,127.0234 1880.252,127.0234 1880.252,127.0234 C1880.252,127.0234 1862.252,127.0234 1862.252,117.0234 L1862.252,91.0234 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/>
    <path d="M1862.252,91.0234 C1862.252,101.0234 1880.252,101.0234 1880.252,101.0234 C1880.252,101.0234 1898.252,101.0234 1898.252,91.0234 " fill="none" style="stroke:#181818;stroke-width:1.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92.7363" x="1830.8838" y="3713.6357">Central Store</text>
    <path d="M1862.252,3726.9375 C1862.252,3716.9375 1880.252,3716.9375 1880.252,3716.9375 C1880.252,3716.9375 1898.252,3716.9375 1898.252,3726.9375 L1898.252,3752.9375 C1898.252,3762.9375 1880.252,3762.9375 1880.252,3762.9375 C1880.252,3762.9375 1862.252,3762.9375 1862.252,3752.9375 L1862.252,3726.9375 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/>
    <path d="M1862.252,3726.9375 C1862.252,3736.9375 1880.252,3736.9375 1880.252,3736.9375 C1880.252,3736.9375 1898.252,3736.9375 1898.252,3726.9375 " fill="none" style="stroke:#181818;stroke-width:1.5;"/>
    <rect fill="#FFFFFF" height="3516.3203" style="stroke:#181818;stroke-width:1.0;" width="10" x="95.292" y="153.3203"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="431.437" y="2794.3906"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="431.437" y="3639.6406"/>
    <rect fill="#FFFFFF" height="2144.2188" style="stroke:#181818;stroke-width:1.0;" width="10" x="561.0347" y="198.5859"/>
    <rect fill="#FFFFFF" height="171.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1396.332" y="2942.7266"/>
    <rect fill="#FFFFFF" height="77.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="381.5156"/>
    <rect fill="#FFFFFF" height="62.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="842.5703"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="991.2344"/>
    <rect fill="#FFFFFF" height="107.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1098.6328"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1845.5469"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="1968.0781"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="2243.5391"/>
    <rect fill="#FFFFFF" height="30" style="stroke:#181818;stroke-width:1.0;" width="10" x="1875.252" y="3022.125"/>
    <path d="M10,160.3203 L311.1279,160.3203 L311.1279,167.4531 L301.1279,177.4531 L10,177.4531 L10,160.3203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="3524.3203" style="stroke:#000000;stroke-width:1.5;" width="2182.8721" x="10" y="160.3203"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="256.1279" x="25" y="173.3872">Prepare Position Handler Consume</text>
    <polygon fill="#181818" points="549.0347,194.5859,559.0347,198.5859,549.0347,202.5859,553.0347,198.5859" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="105.292" x2="555.0347" y1="198.5859" y2="198.5859"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="112.292" y="193.52">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223.8247" x="125.3374" y="193.52">Request transfers to be processed</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="227.7188" y2="227.7188"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="227.7188" y2="240.7188"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="240.7188" y2="240.7188"/>
    <polygon fill="#181818" points="582.0347,236.7188,572.0347,240.7188,582.0347,244.7188,578.0347,240.7188" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="222.6528">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371.2554" x="591.0801" y="222.6528">Check 1st transfer to select the Participant and Currency</text>
    <path d="M506.9229,255.7188 L681.5674,255.7188 L681.5674,262.8516 L671.5674,272.8516 L506.9229,272.8516 L506.9229,255.7188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="2058.9531" style="stroke:#000000;stroke-width:1.5;" width="1675.9492" x="506.9229" y="255.7188"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129.6445" x="521.9229" y="268.7856">DB TRANSACTION</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="324.25" y2="324.25"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="324.25" y2="337.25"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="337.25" y2="337.25"/>
    <polygon fill="#181818" points="582.0347,333.25,572.0347,337.25,582.0347,341.25,578.0347,337.25" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="304.0513">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="544.4893" x="591.0801" y="288.9185">Loop through batch and build list of transferIds and calculate sumTransfersInBatch,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="419.0659" x="591.0801" y="304.0513">checking all in Batch are for the correct Paricipant and Currency</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="591.0801" y="319.1841">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.4326" x="676.7417" y="319.1841">2001, 3100</text>
    <polygon fill="#181818" points="1863.252,377.5156,1873.252,381.5156,1863.252,385.5156,1867.252,381.5156" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="381.5156" y2="381.5156"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="368.8833">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484.6626" x="591.0801" y="361.3169">Retrieve current state of all transfers in array from DB with select whereIn</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1272.1719" x="591.0801" y="376.4497">(FYI: The two DB transaction model needs to add a mini-state step here (RECEIVED_PREPARE =&gt; RECEIVDED_PREPARE_PROCESSING) so that the transfers are left alone if processing has started)</text>
    <polygon fill="#FFFFE0" points="1810,394.5156,1949,394.5156,1959,413.5156,1949,432.5156,1810,432.5156,1800,413.5156,1810,394.5156" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.5225" x="1812" y="410.5825">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.5132" x="1812" y="425.7153">transferParticipant</text>
    <polygon fill="#181818" points="582.0347,454.9141,572.0347,458.9141,582.0347,462.9141,578.0347,458.9141" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="576.0347" x2="1879.252" y1="458.9141" y2="458.9141"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="588.0347" y="453.8481">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347.5278" x="601.0801" y="453.8481">Return current state of all selected transfers from DB</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="518.3125" y2="518.3125"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="518.3125" y2="531.3125"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="531.3125" y2="531.3125"/>
    <polygon fill="#181818" points="581.0347,514.3125,571.0347,518.3125,581.0347,522.3125,577.0347,518.3125" style="stroke:#181818;stroke-width:1.0;"/>
    <polygon fill="#181818" points="582.0347,527.3125,572.0347,531.3125,582.0347,535.3125,578.0347,531.3125" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="498.1138">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="562.0215" x="591.0801" y="482.981">Validate current state (transferStateChange.transferStateId == &apos;RECEIVED_PREPARE&apos;)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="591.0801" y="498.1138">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.084" x="676.7417" y="498.1138">2001</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.1528" x="713.958" y="498.1138">against failing transfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.5576" x="591.0801" y="513.2466">Batch is not rejected as a whole.</text>
    <path d="M576,544.3125 L576,765.3125 L2125,765.3125 L2125,554.3125 L2115,544.3125 L576,544.3125 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M2115,544.3125 L2115,554.3125 L2125,554.3125 L2115,544.3125 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257.5752" x="582" y="561.3794">List of transfers used during processing</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="134.4561" x="582" y="576.5122">reservedTransfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302.9927" x="720.5884" y="576.5122">is list of transfers to be processed in the batch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.4229" x="582" y="591.645">abortedTransfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1244.5786" x="713.5552" y="591.645">is the list of transfers in the incorrect state going into the process. Currently the transferStateChange is set to ABORTED - this should only be done if not already in a final state (idempotency)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="144.4346" x="582" y="606.7778">processedTransfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1379.9043" x="730.5669" y="606.7778">is the list of transfers that have gone through the position management algorithm. Both successful and failed trasnfers appear here as the order and &quot;running position&quot; against each is necessary for reconciliation</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="582" y="621.9106"> </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310.4321" x="582" y="637.0435">Scalar intermidate values used in the algorithm</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116.5366" x="582" y="652.1763">transferAmount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.3032" x="702.6689" y="652.1763">= payload.amount.amount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="156.1523" x="582" y="667.3091">sumTransfersInBatch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300.9551" x="742.2847" y="667.3091">= SUM amount against each Transfer in batch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.5786" x="582" y="682.4419">currentPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.3315" x="699.7109" y="682.4419">= participantPosition.value</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124.2998" x="582" y="697.5747">reservedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300.0664" x="710.4321" y="697.5747">= participantPosition.{original}reservedValue</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124.1221" x="582" y="712.7075">effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.1538" x="710.2544" y="712.7075">= currentPosition + reservedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91.3428" x="582" y="727.8403">heldPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280.0332" x="677.4751" y="727.8403">= effectivePosition + sumTransfersInBatch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125.7915" x="582" y="742.9731">availablePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="711.9238" y="742.9731">=</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="297.2671" x="726.9487" y="742.9731">if settlement model delay is IMMEDIATE then:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="462.4839" x="1028.3481" y="742.9731">settlementBalance + participantLimit(NetDebitCap) - effectivePosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="68.0278" x="1494.9644" y="742.9731">otherwise:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316.7734" x="1567.1245" y="742.9731">participantLimit(NetDebitCap) - effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98.9282" x="582" y="758.106">sumReserved</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="398.1631" x="685.0605" y="758.106">= SUM of transfers that have met rule criteria and processed</text>
    <path d="M519,776.1719 L519,816.1719 L1926,816.1719 L1926,786.1719 L1916,776.1719 L519,776.1719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1916,776.1719 L1916,786.1719 L1926,786.1719 L1916,776.1719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="787.998" x="824.3496" y="793.2388">Going to reserve the sum of the valid transfers in the batch against the Participants Positon in the Currency of this batch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397.3823" x="824.3496" y="808.3716">and calculate the available position for the Participant to use</text>
    <polygon fill="#181818" points="1863.252,838.5703,1873.252,842.5703,1863.252,846.5703,1867.252,842.5703" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="842.5703" y2="842.5703"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="837.5044">7</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360.147" x="591.0801" y="837.5044">Select effectivePosition FOR UPDATE from DB for Payer</text>
    <polygon fill="#FFFFE0" points="1817,855.5703,1942,855.5703,1952,866.5703,1942,878.5703,1817,878.5703,1807,866.5703,1817,855.5703" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.6655" x="1819" y="871.6372">participantPosition</text>
    <polygon fill="#181818" points="582.0347,900.8359,572.0347,904.8359,582.0347,908.8359,578.0347,904.8359" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="576.0347" x2="1879.252" y1="904.8359" y2="904.8359"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="588.0347" y="899.77">8</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="530.5435" x="601.0801" y="899.77">Return effectivePosition (currentPosition and reservedPosition) from DB for Payer</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="949.1016" y2="949.1016"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="949.1016" y2="962.1016"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="962.1016" y2="962.1016"/>
    <polygon fill="#181818" points="582.0347,958.1016,572.0347,962.1016,582.0347,966.1016,578.0347,962.1016" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9.0454" x="578.0347" y="936.4692">9</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.3003" x="591.0801" y="928.9028">Increment reservedValue to heldPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389.124" x="591.0801" y="944.0356">(reservedValue = reservedPosition + sumTransfersInBatch)</text>
    <polygon fill="#181818" points="1863.252,987.2344,1873.252,991.2344,1863.252,995.2344,1867.252,991.2344" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="991.2344" y2="991.2344"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="986.1685">10</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6797" x="600.1255" y="986.1685">Persist reservedValue</text>
    <polygon fill="#FFFFE0" points="1732,1034.2344,2026,1034.2344,2036,1053.2344,2026,1072.2344,1732,1072.2344,1722,1053.2344,1732,1034.2344" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.4126" x="1734" y="1050.3013">UPDATE</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140.3784" x="1790.5449" y="1050.3013">participantPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.7734" x="1734" y="1065.4341">SET reservedValue += sumTransfersInBatch</text>
    <polygon fill="#181818" points="1863.252,1094.6328,1873.252,1098.6328,1863.252,1102.6328,1867.252,1098.6328" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="1098.6328" y2="1098.6328"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1093.5669">11</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.8032" x="600.1255" y="1093.5669">Request position limits for Payer Participant</text>
    <polygon fill="#FFFFE0" points="1680,1111.6328,2079,1111.6328,2089,1145.6328,2079,1179.6328,1680,1179.6328,1670,1145.6328,1680,1111.6328" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.959" x="1682" y="1127.6997">FROM</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="117.8252" x="1724.0913" y="1127.6997">participantLimit</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358.0269" x="1682" y="1142.8325">WHERE participantLimit.limitTypeId = &apos;NET-DEBIT-CAP&apos;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357.1191" x="1682" y="1157.9653">AND participantLimit.participantId = payload.payerFsp</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="395.3765" x="1682" y="1173.0981">AND participantLimit.currencyId = payload.amount.currency</text>
    <polygon fill="#181818" points="582.0347,1202.2969,572.0347,1206.2969,582.0347,1210.2969,578.0347,1206.2969" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="576.0347" x2="1879.252" y1="1206.2969" y2="1206.2969"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="588.0347" y="1201.231">12</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.0771" x="610.1255" y="1201.231">Return position limits</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="1295.9609" y2="1295.9609"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="1295.9609" y2="1308.9609"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="1308.9609" y2="1308.9609"/>
    <polygon fill="#181818" points="581.0347,1291.9609,571.0347,1295.9609,581.0347,1299.9609,577.0347,1295.9609" style="stroke:#181818;stroke-width:1.0;"/>
    <polygon fill="#181818" points="582.0347,1304.9609,572.0347,1308.9609,582.0347,1312.9609,578.0347,1308.9609" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1260.6294">13</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125.7915" x="600.1255" y="1230.3638">availablePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="10.8926" x="730.0493" y="1230.3638">=</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="297.2671" x="745.0742" y="1230.3638">if settlement model delay is IMMEDIATE then:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458.3516" x="604.2578" y="1245.4966">settlementBalance + participantLimit(NetDebitCap) - effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="600.1255" y="1260.6294"> </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="68.0278" x="604.2578" y="1260.6294">otherwise:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316.7734" x="604.2578" y="1275.7622">participantLimit(NetDebitCap) - effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="556.6768" x="600.1255" y="1290.895">(same as = (settlementBalance?) + netDebitCap - currentPosition - reservedPosition)</text>
    <path d="M519,1321.9609 L519,1361.9609 L1926,1361.9609 L1926,1331.9609 L1916,1321.9609 L519,1321.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1916,1321.9609 L1916,1331.9609 L1926,1331.9609 L1916,1321.9609 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="620.9722" x="907.8625" y="1339.0278">For each transfer in the batch, validate the availablility of position to meet the transfer amount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="390.8188" x="907.8625" y="1354.1606">this will be as per the position algorithm documented below</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="1403.4922" y2="1403.4922"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="1403.4922" y2="1416.4922"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="1416.4922" y2="1416.4922"/>
    <polygon fill="#181818" points="581.0347,1399.4922,571.0347,1403.4922,581.0347,1407.4922,577.0347,1403.4922" style="stroke:#181818;stroke-width:1.0;"/>
    <polygon fill="#181818" points="582.0347,1412.4922,572.0347,1416.4922,582.0347,1420.4922,578.0347,1416.4922" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1390.8599">14</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="426.7466" x="600.1255" y="1383.2935">Validate availablePosition for each tranfser (see algorithm below)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="600.1255" y="1398.4263">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.084" x="685.7871" y="1398.4263">4001</text>
    <path d="M576,1429.4922 L576,1696.4922 L2013,1696.4922 L2013,1439.4922 L2003,1429.4922 L576,1429.4922 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M2003,1429.4922 L2003,1439.4922 L2013,1439.4922 L2003,1429.4922 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="595.5054" x="582" y="1446.5591">01: sumReserved = 0 // Record the sum of the transfers we allow to progress to RESERVED</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="574.7676" x="582" y="1461.6919">02: sumProcessed =0 // Record the sum of the transfers already processed in this batch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1121.104" x="582" y="1476.8247">03: processedTransfers = {} // The list of processed transfers - so that we can store the additional information around the decision. Most importantly the &quot;running&quot; position</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268.2266" x="582" y="1491.9575">04: foreach transfer in reservedTransfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="438.2104" x="598.5293" y="1507.0903">05: sumProcessed += transfer.amount // the total processed so far</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204.001" x="1040.8721" y="1507.0903">(NEED TO UPDATE IN CODE)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.8135" x="598.5293" y="1522.2231">06: if availablePosition &gt;= transfer.amount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.4365" x="615.0586" y="1537.356">07: transfer.state = &quot;RESERVED&quot;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326.5425" x="615.0586" y="1552.4888">08: availablePosition -= preparedTransfer.amount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320.5249" x="615.0586" y="1567.6216">09: sumRESERVED += preparedTransfer.amount</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.4351" x="598.5293" y="1582.7544">10: else</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.0674" x="615.0586" y="1597.8872">11: preparedTransfer.state = &quot;ABORTED&quot;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="704.7549" x="615.0586" y="1613.02">12: preparedTransfer.reason = &quot;Net Debit Cap exceeded by this request at this time, please try again later&quot;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.8643" x="598.5293" y="1628.1528">13: end if</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1059.9761" x="598.5293" y="1643.2856">14: runningPosition = currentPosition + sumReserved // the initial value of the Participants position plus the total value that has been accepted in the batch so far</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="564.5986" x="598.5293" y="1658.4185">15: runningReservedValue = sumTransfersInBatch - sumProcessed + reservedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204.001" x="1167.2603" y="1658.4185">(NEED TO UPDATE IN CODE)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="495.2441" x="1375.3936" y="1658.4185">// the running down of the total reserved value at the begining of the batch.</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1399.9756" x="598.5293" y="1673.5513">16: Add transfer to the processedTransfer list recording the transfer state and running position and reserved values { transferState, transfer, rawMessage, transferAmount,  runningPosition, runningReservedValue }</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.9019" x="582" y="1688.6841">16: end foreach</text>
    <path d="M519,1706.75 L519,1761.75 L1926,1761.75 L1926,1716.75 L1916,1706.75 L519,1706.75 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1916,1706.75 L1916,1716.75 L1926,1716.75 L1916,1706.75 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="896.1177" x="606.5679" y="1723.8169">Once the outcome for all transfers is known,update the Participant&apos;s position and remove the reserved amount associated with the batch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="672.877" x="606.5679" y="1738.9497">(If there are any alarm limits, process those returning limits in which the threshold has been breached)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="1223.5615" x="606.5679" y="1754.0825">Do a bulk insert of the trasnferStateChanges associated with processing, using the result to complete the participantPositionChange and bulk insert of these to persist the running position</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="1803.4141" y2="1803.4141"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="1803.4141" y2="1816.4141"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="1816.4141" y2="1816.4141"/>
    <polygon fill="#181818" points="582.0347,1812.4141,572.0347,1816.4141,582.0347,1820.4141,578.0347,1816.4141" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1790.7817">15</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310.7114" x="600.1255" y="1783.2153">Assess any limit thresholds on the final position</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.271" x="600.1255" y="1798.3481">adding to alarm list if triggered</text>
    <polygon fill="#181818" points="1863.252,1841.5469,1873.252,1845.5469,1863.252,1849.5469,1867.252,1845.5469" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="1845.5469" y2="1845.5469"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1840.481">16</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.7373" x="600.1255" y="1840.481">Persist latest position</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39.7744" x="743.9951" y="1840.481">value</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.4575" x="787.9019" y="1840.481">and</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106.1519" x="816.4917" y="1840.481">reservedValue</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.0933" x="926.7759" y="1840.481">to DB for Payer</text>
    <polygon fill="#FFFFE0" points="1750,1888.5469,2010,1888.5469,2020,1914.5469,2010,1941.5469,1750,1941.5469,1740,1914.5469,1750,1888.5469" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.4126" x="1752" y="1904.6138">UPDATE</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="140.3784" x="1808.5449" y="1904.6138">participantPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.7681" x="1752" y="1919.7466">SET value += sumRESERVED,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.0327" x="1752" y="1934.8794">reservedValue -= sumTransfersInBatch</text>
    <polygon fill="#181818" points="1863.252,1964.0781,1873.252,1968.0781,1863.252,1972.0781,1867.252,1968.0781" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="1968.0781" y2="1968.0781"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="1963.0122">17</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="388.8447" x="600.1255" y="1963.0122">Bulk persist transferStateChange for all processedTransfers</text>
    <polygon fill="#FFFFE0" points="1596,2011.0781,2162,2011.0781,2172,2045.0781,2162,2079.0781,1596,2079.0781,1586,2045.0781,1596,2011.0781" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.8325" x="1598" y="2027.145">batch INSERT</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="153.6006" x="1689.9648" y="2027.145">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="562.8721" x="1598" y="2042.2778">select for update from transfer table where transferId in ([transferBatch.transferId,...])</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="345.7949" x="1598" y="2057.4106">build list of transferStateChanges from transferBatch</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1598" y="2072.5435"> </text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="613.0347" y1="2105.7422" y2="2105.7422"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="613.0347" x2="613.0347" y1="2105.7422" y2="2118.7422"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="572.0347" x2="613.0347" y1="2118.7422" y2="2118.7422"/>
    <polygon fill="#181818" points="582.0347,2114.7422,572.0347,2118.7422,582.0347,2122.7422,578.0347,2118.7422" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="2100.6763">18</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="779.2065" x="600.1255" y="2100.6763">Populate batchParticipantPositionChange from the resultant transferStateChange and the earlier processedTransfer list</text>
    <path d="M576,2131.7422 L576,2216.7422 L1085,2216.7422 L1085,2141.7422 L1075,2131.7422 L576,2131.7422 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1075,2131.7422 L1075,2141.7422 L1085,2141.7422 L1075,2131.7422 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.5981" x="582" y="2148.8091">Effectively:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="471.853" x="598.5293" y="2163.9419">SET transferStateChangeId = processedTransfer.transferStateChangeId,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408.5161" x="598.5293" y="2179.0747">participantPositionId = preparedTransfer.participantPositionId,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264.7227" x="598.5293" y="2194.2075">value = preparedTransfer.positionValue,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380.2817" x="598.5293" y="2209.3403">reservedValue = preparedTransfer.positionReservedValue</text>
    <polygon fill="#181818" points="1863.252,2239.5391,1873.252,2243.5391,1863.252,2247.5391,1867.252,2243.5391" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="571.0347" x2="1869.252" y1="2243.5391" y2="2243.5391"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="578.0347" y="2238.4731">19</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="456.9741" x="600.1255" y="2238.4731">Bulk persist the participant position change for all processedTransfers</text>
    <polygon fill="#FFFFE0" points="1734,2286.5391,2025,2286.5391,2035,2297.5391,2025,2309.5391,1734,2309.5391,1724,2297.5391,1734,2286.5391" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.8325" x="1736" y="2302.606">batch INSERT</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.3237" x="1827.9648" y="2302.606">participantPositionChange</text>
    <polygon fill="#181818" points="116.292,2338.8047,106.292,2342.8047,116.292,2346.8047,112.292,2342.8047" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.292" x2="565.0347" y1="2342.8047" y2="2342.8047"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="122.292" y="2337.7388">20</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389.4985" x="144.3828" y="2337.7388">Return a map of transferIds and their transferStateChanges</text>
    <path d="M20,2357.8047 L84.4429,2357.8047 L84.4429,2364.9375 L74.4429,2374.9375 L20,2374.9375 L20,2357.8047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1319.8359" style="stroke:#000000;stroke-width:1.5;" width="1959.5225" x="20" y="2357.8047"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="2370.8716">alt</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="348.1167" x="99.4429" y="2370.0151">[Calculate &amp; Validate Latest Position Prepare (success)]</text>
    <path d="M110,2379.9375 L110,2752.9375 L384,2752.9375 L384,2389.9375 L374,2379.9375 L110,2379.9375 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M374,2379.9375 L374,2389.9375 L384,2389.9375 L374,2379.9375 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.3564" x="116" y="2397.0044">Message:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="116" y="2412.1372">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.0356" x="132.5293" y="2427.27">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.1738" x="132.5293" y="2442.4028">from: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.3394" x="132.5293" y="2457.5356">to: &lt;transferMessage.payeeFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.2197" x="132.5293" y="2472.6685">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.5552" x="132.5293" y="2487.8013">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4482" x="149.0586" y="2502.9341">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.3091" x="149.0586" y="2518.0669">payload: &lt;transferMessage&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.4033" x="132.5293" y="2533.1997">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.79" x="132.5293" y="2548.3325">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.8091" x="149.0586" y="2563.4653">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6357" x="165.5879" y="2578.5981">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.9961" x="165.5879" y="2593.731">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.0249" x="165.5879" y="2608.8638">type: transfer,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.8159" x="165.5879" y="2623.9966">action: prepare,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3462" x="165.5879" y="2639.1294">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.7148" x="165.5879" y="2654.2622">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.4004" x="182.1172" y="2669.395">status: &quot;success&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48.1343" x="182.1172" y="2684.5278">code: 0</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="165.5879" y="2699.6606">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="149.0586" y="2714.7935">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="132.5293" y="2729.9263">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="116" y="2745.0591">}</text>
    <polygon fill="#181818" points="419.437,2790.3906,429.437,2794.3906,419.437,2798.3906,423.437,2794.3906" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="105.292" x2="425.437" y1="2794.3906" y2="2794.3906"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="112.292" y="2781.7583">21</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.4482" x="134.3828" y="2774.1919">Publish Notification event</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="134.3828" y="2789.3247">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.084" x="220.0444" y="2789.3247">2003</text>
    <line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1979.5225" y1="2833.3906" y2="2833.3906"/>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="340.6079" x="25" y="2843.6011">[Calculate &amp; Validate Latest Position Prepare (failure)]</text>
    <path d="M110,2852.1953 L110,2877.1953 L246,2877.1953 L246,2862.1953 L236,2852.1953 L110,2852.1953 " fill="#FF0000" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M236,2852.1953 L236,2862.1953 L246,2862.1953 L236,2852.1953 " fill="#FF0000" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.8955" x="116" y="2869.2622">Validation failure!</text>
    <path d="M30,2889.3281 L637.2563,2889.3281 L637.2563,2896.4609 L627.2563,2906.4609 L30,2906.4609 L30,2889.3281 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="233.0625" style="stroke:#000000;stroke-width:1.5;" width="1939.5225" x="30" y="2889.3281"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="562.2563" x="45" y="2902.395">Persist Transfer State (with transferState=&apos;ABORTED&apos; on position check fail)</text>
    <polygon fill="#181818" points="1384.332,2938.7266,1394.332,2942.7266,1384.332,2946.7266,1388.332,2942.7266" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="105.292" x2="1390.332" y1="2942.7266" y2="2942.7266"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="112.292" y="2930.0942">22</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.0273" x="134.3828" y="2922.5278">Request to persist transfer</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="134.3828" y="2937.6606">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.084" x="220.0444" y="2937.6606">2003</text>
    <path d="M110,2955.7266 L110,2995.7266 L832,2995.7266 L832,2965.7266 L822,2955.7266 L110,2955.7266 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M822,2955.7266 L822,2965.7266 L832,2965.7266 L822,2955.7266 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271.0767" x="116" y="2972.7935">transferStateChange.state = &quot;ABORTED&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="701.6318" x="116" y="2987.9263">transferStateChange.reason = &quot;Net Debit Cap exceeded by this request at this time, please try again later&quot;</text>
    <polygon fill="#181818" points="1863.252,3018.125,1873.252,3022.125,1863.252,3026.125,1867.252,3022.125" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="1406.332" x2="1869.252" y1="3022.125" y2="3022.125"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="1413.332" y="3017.0591">23</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.9731" x="1435.4229" y="3017.0591">Persist transfer state</text>
    <polygon fill="#FFFFE0" points="1810,3065.125,1949,3065.125,1959,3076.125,1949,3088.125,1810,3088.125,1800,3076.125,1810,3065.125" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.5225" x="1812" y="3081.1919">transferStateChange</text>
    <polygon fill="#181818" points="116.292,3110.3906,106.292,3114.3906,116.292,3118.3906,112.292,3114.3906" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.292" x2="1400.332" y1="3114.3906" y2="3114.3906"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="122.292" y="3109.3247">24</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.9346" x="144.3828" y="3109.3247">Return success</text>
    <path d="M110,3134.3906 L110,3597.3906 L536,3597.3906 L536,3144.3906 L526,3134.3906 L110,3134.3906 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M526,3134.3906 L526,3144.3906 L536,3144.3906 L526,3134.3906 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.3564" x="116" y="3151.4575">Message:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="116" y="3166.5903">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.0356" x="132.5293" y="3181.7231">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.7773" x="132.5293" y="3196.856">from: &lt;ledgerName&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.686" x="132.5293" y="3211.9888">to: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.2197" x="132.5293" y="3227.1216">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.5552" x="132.5293" y="3242.2544">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4482" x="149.0586" y="3257.3872">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4785" x="149.0586" y="3272.52">payload: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.208" x="165.5879" y="3287.6528">&quot;errorInformation&quot;: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9541" x="182.1172" y="3302.7856">&quot;errorCode&quot;: 4001,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339.0981" x="182.1172" y="3317.9185">&quot;errorDescription&quot;: &quot;Payer FSP insufficient liquidity&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327.3613" x="182.1172" y="3333.0513">&quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="149.0586" y="3348.1841">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.4033" x="132.5293" y="3363.3169">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.79" x="132.5293" y="3378.4497">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.8091" x="149.0586" y="3393.5825">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6357" x="165.5879" y="3408.7153">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.9961" x="165.5879" y="3423.8481">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.791" x="165.5879" y="3438.981">type: notification,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.8159" x="165.5879" y="3454.1138">action: prepare,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.3462" x="165.5879" y="3469.2466">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.7148" x="165.5879" y="3484.3794">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.7236" x="182.1172" y="3499.5122">status: &apos;error&apos;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.5132" x="182.1172" y="3514.645">code: &lt;errorInformation.errorCode&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320.2012" x="182.1172" y="3529.7778">description: &lt;errorInformation.errorDescription&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="165.5879" y="3544.9106">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="149.0586" y="3560.0435">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="132.5293" y="3575.1763">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="116" y="3590.3091">}</text>
    <polygon fill="#181818" points="419.437,3635.6406,429.437,3639.6406,419.437,3643.6406,423.437,3639.6406" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="105.292" x2="425.437" y1="3639.6406" y2="3639.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18.0908" x="112.292" y="3627.0083">25</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.0542" x="134.3828" y="3619.4419">Publish Notification (failure) event for Payer</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="81.5293" x="134.3828" y="3634.5747">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33.084" x="220.0444" y="3634.5747">2003</text>
  </g>
</svg>
