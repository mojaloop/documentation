<svg xmlns="http://www.w3.org/2000/svg" height="1304" preserveAspectRatio="none" style="width:1517px;height:1304px" width="1517">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="379" x="567.25" y="28.708">
    2.1.2. Settlement Model Handler Consume
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M26 40.953h1328v1257.508H26z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="634.5" y="53.02">
    Central Service
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M97.5 219.211h10v30h-10zM318.5 134.68h10v1086.188h-10zM892 583.672h10v561.258h-10zM1297 636.938h10v62.266h-10zM1297 791.602h10v62.266h-10zM1297 907.133h10v30h-10zM1297 1016.531h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 141.68h1493.5v1072.188H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M20 165.813h1473.5v1041.055H20z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M239.5 264.211h549v105.531h-549z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M249.5 288.344h529v74.398h-529zM249.5 383.742h589v156.664h-589zM808.5 598.672h675v518.125h-675z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M818.5 714.203h655v395.594h-655z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M828.5 868.867h635v233.93h-635z"/>
  <path fill="#FFF" d="M828.5 993.398h635v109.398h-635zM20 1152.93h1473.5v53.938H20z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M102 124.68v1106.187M323.5 124.68v1106.187M778.5 124.68v1106.187M896.5 124.68v1106.187M1302 124.68v1106.187"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M34 69.086h137v46.594H34z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M30 73.086h137v46.594H30z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="79" y="93.081">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="37" y="109.378">
    settlement-model
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M34 1229.867h137v46.594H34z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M30 1233.867h137v46.594H30z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="79" y="1253.862">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="37" y="1270.159">
    settlement-model
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="259.5" y="105.081">
    Settlement Model
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="294" y="121.378">
    Handler
  </text>
  <circle cx="323.5" cy="76.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M319.5 64.086l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="122" x="259.5" y="1242.862">
    Settlement Model
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="294" y="1259.159">
    Handler
  </text>
  <circle cx="323.5" cy="1278.461" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M319.5 1266.46l6-5-2 5 2 5-6-5z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M732.5 85.383h92v30.297h-92z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M728.5 89.383h92v30.297h-92z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="735.5" y="109.378">
    topic-event
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M732.5 1229.867h92v30.297h-92z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M728.5 1233.867h92v30.297h-92z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="735.5" y="1253.862">
    topic-event
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="838.5" y="121.378">
    Settlement DAO
  </text>
  <circle cx="897" cy="92.383" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M885 106.383h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="838.5" y="1242.862">
    Settlement DAO
  </text>
  <circle cx="897" cy="1262.164" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M885 1276.164h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1254" y="121.378">
    Central Store
  </text>
  <path d="M1284 72.383c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1284 72.383c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1254" y="1242.862">
    Central Store
  </text>
  <path d="M1284 1256.164c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1284 1256.164c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M97.5 219.211h10v30h-10zM318.5 134.68h10v1086.188h-10zM892 583.672h10v561.258h-10zM1297 636.938h10v62.266h-10zM1297 791.602h10v62.266h-10zM1297 907.133h10v30h-10zM1297 1016.531h10v30h-10z"/>
  <path d="M10 141.68h312v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 141.68h1493.5v1072.188H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="267" x="25" y="154.747">
    Settlement Model Handler Consume
  </text>
  <path d="M20 165.813h64v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 165.813h1473.5v1041.055H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="35" y="178.879">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="99" y="178.023">
    [Consume Single Message]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M118.5 215.21l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M112.5 219.211h205"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="206.579">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="137.5" y="199.012">
    Consume settlement model
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="137.5" y="214.145">
    event message
  </text>
  <path d="M239.5 264.21h88v7l-10 10h-78v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M239.5 264.211h549v105.531h-549z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="254.5" y="277.278">
    break
  </text>
  <path d="M249.5 288.344h152v7l-10 10h-142v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M249.5 288.344h529v74.398h-529z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="264.5" y="301.411">
    Validate Event
  </text>
  <path stroke="#a80036" d="M328.5 341.742h42M370.5 341.742v13M329.5 354.742h41"/>
  <path fill="#A80036" stroke="#a80036" d="M339.5 350.742l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="335.5" y="329.11">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="418" x="348.5" y="321.543">
    Validate event - Rule: type == &apos;setmodel&apos; &amp;&amp; action == &apos;commit&apos;
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="348.5" y="336.676">
    Error codes:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="442.5" y="336.676">
    2001
  </text>
  <path d="M249.5 383.742h232v7l-10 10h-222v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M249.5 383.742h589v156.664h-589z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="264.5" y="396.809">
    Persist Event Information
  </text>
  <path fill="#A80036" stroke="#a80036" d="M766.5 443.008l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M328.5 447.008h444"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="335.5" y="441.942">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="348.5" y="441.942">
    Publish event information
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M256.5 455.008h571v55.398h-571z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M256.5 455.008h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="269.5" y="469.075">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="466.5" y="488.075">
    Event Handler Consume
  </text>
  <path fill="#A80036" stroke="#a80036" d="M880 579.672l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M328.5 583.672H886"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="335.5" y="571.04">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="348.5" y="563.473">
    Assign transferParicipant state(s)
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="348.5" y="578.606">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="434.5" y="578.606">
    2003
  </text>
  <path d="M808.5 598.672h173v7l-10 10h-163v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M808.5 598.672h675v518.125h-675z"/>
  <text fill="#00F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="823.5" y="611.739">
    DB TRANSACTION
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1285 632.938l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M902 636.938h389"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="909" y="631.872">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="922" y="631.872">
    Fetch transfer participant entries
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1241 649.938h122l10 11-10 12h-122l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1243" y="666.004">
    transferParticipant
  </text>
  <path fill="#A80036" stroke="#a80036" d="M913 695.203l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M907 699.203h394"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="919" y="694.137">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="932" y="694.137">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="978" y="694.137">
    transferParticipantRecords
  </text>
  <path d="M818.5 714.203h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M818.5 714.203h655v395.594h-655z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="833.5" y="727.27">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="188" x="910.5" y="726.414">
    [for each transferParticipant]
  </text>
  <path d="M907 736.336v25h308v-15l-10-10H907" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1205 736.336v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="913" y="753.403">
    Settlement models caching to be considered
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1285 787.602l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M902 791.602h389"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="909" y="786.536">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="922" y="786.536">
    Get settlement model by currency and ledger entry
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1246 804.602h112l10 11-10 12h-112l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="1248" y="820.668">
    settlementModel
  </text>
  <path fill="#A80036" stroke="#a80036" d="M913 849.867l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M907 853.867h394"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="919" y="848.801">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="932" y="848.801">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="978" y="848.801">
    settlementModel
  </text>
  <path d="M828.5 868.867h70v7l-10 10h-60v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M828.5 868.867h635v233.93h-635z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="843.5" y="881.934">
    opt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="545" x="913.5" y="881.078">
    [settlementModel.delay == &apos;IMMEDIATE&apos; &amp;&amp; settlementModel.granularity == &apos;GROSS&apos;]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1285 903.133l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M902 907.133h389"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="909" y="902.067">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="922" y="902.067">
    Set states: CLOSED-&gt;PENDING_SETTLEMENT-&gt;SETTLED
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1199 950.133h206l10 19-10 19h-206l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="1201" y="966.2">
    transferParticipantStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1201" y="981.332">
    transferParticipant
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M828.5 994.398h635"/>
  <path fill="#A80036" stroke="#a80036" d="M1285 1012.531l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M902 1016.531h389"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="909" y="1011.465">
    10
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="931" y="1011.465">
    Set state: OPEN
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1199 1059.531h206l10 19-10 19h-206l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="1201" y="1075.598">
    transferParticipantStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1201" y="1090.731">
    transferParticipant
  </text>
  <path fill="#A80036" stroke="#a80036" d="M339.5 1140.93l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M333.5 1144.93H896"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="345.5" y="1139.864">
    11
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="367.5" y="1139.864">
    Return success
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M20 1153.93h1473.5"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="25" y="1164.14">
    [Consume Batch Messages]
  </text>
  <path d="M94 1172.734v25h215v-15l-10-10H94" fill="#ADD8E6" filter="url(#a)" stroke="#a80036"/>
  <path d="M299 1172.734v10h10l-10-10" fill="#ADD8E6" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="100" y="1189.801">
    To be delivered by future story
  </text>
</svg>
