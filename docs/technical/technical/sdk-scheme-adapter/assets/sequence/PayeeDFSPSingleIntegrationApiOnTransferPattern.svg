<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1694px" preserveAspectRatio="none" style="width:2455px;height:1694px;background:#FFFFFF;" version="1.1" viewBox="0 0 2455 1694" width="2455px" zoomAndPan="magnify"><defs/><g><rect fill="#D3D3D3" height="1682.875" style="stroke:#181818;stroke-width:0.5;" width="773.5" x="941.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1237.25" y="28.8379">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="127" x="1237.25" y="56.5098">Payee DFSP</text><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="1054" y="318.375"/><rect fill="#FFFFFF" height="179.6875" style="stroke:#181818;stroke-width:1.0;" width="10" x="1054" y="752.0938"/><rect height="500.7344" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2233" x="205" y="1097.7969"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="267" x2="267" y1="135.6875" y2="1615.5313"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1058.5" x2="1058.5" y1="135.6875" y2="1615.5313"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1654" x2="1654" y1="135.6875" y2="1615.5313"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2100.5" x2="2100.5" y1="135.6875" y2="1615.5313"/><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="122.8535">Switch</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="1614.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="1644.3691">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="1672.041">Switch</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="945.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="952.5" y="122.8535">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="945.5" y="1614.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="952.5" y="1644.3691">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1597" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1630" y="95.1816">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1604" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1597" y="1614.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1630" y="1644.3691">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1604" y="1672.041">Connector</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1990.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1997.5" y="122.8535">Core banking solution</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1990.5" y="1614.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1997.5" y="1644.3691">Core banking solution</text><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="1054" y="318.375"/><rect fill="#FFFFFF" height="179.6875" style="stroke:#181818;stroke-width:1.0;" width="10" x="1054" y="752.0938"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2448" x="0" y="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2448" y1="172.5234" y2="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2448" y1="175.5234" y2="175.5234"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="1007" x="720.5" y="155.6875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="987" x="726.5" y="182.5254">Payee DFSP integration - Quote and Transfer - single AML check &amp; transfer during POST transfer</text><polygon fill="#181818" points="1047,231.0313,1057,235.0313,1047,239.0313,1051,235.0313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="1053" y1="235.0313" y2="235.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="228.1973">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="304" y="228.1973">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="71" x="372" y="228.1973">/quotes</text><polygon fill="#181818" points="278,272.7031,268,276.7031,278,280.7031,274,276.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="1058" y1="276.7031" y2="276.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="269.8691">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="314" y="269.8691">HTTP 202 Response</text><polygon fill="#181818" points="1642,314.375,1652,318.375,1642,322.375,1646,318.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1064" x2="1648" y1="318.375" y2="318.375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1071" y="311.541">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1101" y="311.541">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="131" x="1169" y="311.541">/quoterequest</text><line style="stroke:#181818;stroke-width:1.0;" x1="1654" x2="1696" y1="360.0469" y2="360.0469"/><line style="stroke:#181818;stroke-width:1.0;" x1="1696" x2="1696" y1="360.0469" y2="373.0469"/><line style="stroke:#181818;stroke-width:1.0;" x1="1655" x2="1696" y1="373.0469" y2="373.0469"/><polygon fill="#181818" points="1665,369.0469,1655,373.0469,1665,377.0469,1661,373.0469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1661" y="353.2129">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="104" x="1691" y="353.2129">Do nothing</text><polygon fill="#181818" points="1070,410.7188,1060,414.7188,1070,418.7188,1066,414.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1064" x2="1653" y1="414.7188" y2="414.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1076" y="407.8848">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1106" y="407.8848">Response</text><polygon fill="#181818" points="278,452.3906,268,456.3906,278,460.3906,274,456.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="1058" y1="456.3906" y2="456.3906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="449.5566">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="314" y="449.5566">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="109" x="366" y="449.5566">/quotes/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="522.2344" y2="522.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="522.2344" y2="535.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="535.2344" y2="535.2344"/><polygon fill="#181818" points="278,531.2344,268,535.2344,278,539.2344,274,535.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="515.4004">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="202" x="304" y="515.4004">Pass Quote to Payer</text><path d="M5,469.3906 L5,562.3906 L262,562.3906 L262,479.3906 L252,469.3906 L5,469.3906 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M252,469.3906 L252,479.3906 L262,479.3906 L252,469.3906 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="169" x="11" y="497.2285">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="236" x="11" y="524.9004">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="32" x="11" y="552.5723">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="49" y="552.5723">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="117" y="552.5723">/transfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="601.0781" y2="601.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="601.0781" y2="614.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="614.0781" y2="614.0781"/><polygon fill="#181818" points="278,610.0781,268,614.0781,278,618.0781,274,614.0781" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="594.2441">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="273" x="304" y="594.2441">Perform liquidity(NDC)check</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="655.75" y2="655.75"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="655.75" y2="668.75"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="668.75" y2="668.75"/><polygon fill="#181818" points="278,664.75,268,668.75,278,672.75,274,668.75" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="648.916">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="145" x="304" y="648.916">Reserve Funds</text><polygon fill="#181818" points="1047,706.4219,1057,710.4219,1047,714.4219,1051,710.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="1053" y1="710.4219" y2="710.4219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="703.5879">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="316" y="703.5879">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="384" y="703.5879">/transfers</text><polygon fill="#181818" points="1642,748.0938,1652,752.0938,1642,756.0938,1646,752.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1064" x2="1648" y1="752.0938" y2="752.0938"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1071" y="745.2598">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1113" y="745.2598">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="1181" y="745.2598">/transfers</text><polygon fill="#181818" points="2089,789.7656,2099,793.7656,2089,797.7656,2093,793.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1654" x2="2095" y1="793.7656" y2="793.7656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1661" y="786.9316">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="381" x="1703" y="786.9316">Perform AML checks and transfer funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="2101" x2="2143" y1="835.4375" y2="835.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="2143" x2="2143" y1="835.4375" y2="848.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="2102" x2="2143" y1="848.4375" y2="848.4375"/><polygon fill="#181818" points="2112,844.4375,2102,848.4375,2112,852.4375,2108,848.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2108" y="828.6035">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="256" x="2150" y="828.6035">Release of funds to Payee</text><polygon fill="#181818" points="1665,886.1094,1655,890.1094,1665,894.1094,1661,890.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1659" x2="2100" y1="890.1094" y2="890.1094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1671" y="883.2754">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="294" x="1713" y="883.2754">response (homeTransactionId)</text><polygon fill="#181818" points="1070,927.7813,1060,931.7813,1070,935.7813,1066,931.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1064" x2="1653" y1="931.7813" y2="931.7813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1076" y="924.9473">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="294" x="1118" y="924.9473">response (homeTransactionId)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1059" x2="1101" y1="973.4531" y2="973.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="1101" x2="1101" y1="973.4531" y2="986.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060" x2="1101" y1="986.4531" y2="986.4531"/><polygon fill="#181818" points="1070,982.4531,1060,986.4531,1070,990.4531,1066,986.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1066" y="966.6191">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="186" x="1108" y="966.6191">Generate Fulfilment</text><polygon fill="#181818" points="278,1024.125,268,1028.125,278,1032.125,274,1028.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="1058" y1="1028.125" y2="1028.125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="284" y="1021.291">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="326" y="1021.291">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="540" x="378" y="1021.291">/transfers/{id} (TransferStatus='RESERVED', fulfullment)</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="1069.7969" y2="1069.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="1069.7969" y2="1082.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="1082.7969" y2="1082.7969"/><polygon fill="#181818" points="278,1078.7969,268,1082.7969,278,1086.7969,274,1082.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1062.9629">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="297" x="316" y="1062.9629">Commit funds in DFSP ledgers</text><path d="M205,1097.7969 L274,1097.7969 L274,1117.4688 L264,1127.4688 L205,1127.4688 L205,1097.7969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="500.7344" style="stroke:#000000;stroke-width:1.5;" width="2233" x="205" y="1097.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="24" x="220" y="1121.6348">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="360" x="289" y="1122.6348">[if (Transfer status == 'ABORTED')]</text><polygon fill="#181818" points="1047,1169.8125,1057,1173.8125,1047,1177.8125,1051,1173.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="1053" y1="1173.8125" y2="1173.8125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1166.9785">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="316" y="1166.9785">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="615" x="399" y="1166.9785">/transfers/{id} (TransferStatus='ABORTED', homeTransactionId)</text><polygon fill="#181818" points="1642,1239.1563,1652,1243.1563,1642,1247.1563,1646,1243.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1059" x2="1648" y1="1243.1563" y2="1243.1563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1066" y="1222.4863">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="140" x="1108" y="1208.6504">Abort Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="6" x="1108" y="1236.3223"> </text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="1114" y="1236.3223">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="418" x="1197" y="1236.3223">/transfers/{id} (TransferStatus='ABORTED')</text><polygon fill="#181818" points="2089,1280.8281,2099,1284.8281,2089,1288.8281,2093,1284.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1654" x2="2095" y1="1284.8281" y2="1284.8281"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1661" y="1277.9941">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="140" x="1703" y="1277.9941">Abort Transfer</text><line style="stroke:#181818;stroke-width:1.0;" x1="2101" x2="2143" y1="1326.5" y2="1326.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="2143" x2="2143" y1="1326.5" y2="1339.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="2102" x2="2143" y1="1339.5" y2="1339.5"/><polygon fill="#181818" points="2112,1335.5,2102,1339.5,2112,1343.5,2108,1339.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2108" y="1319.666">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="276" x="2150" y="1319.666">Compensate action for abort</text><polygon fill="#181818" points="1665,1377.1719,1655,1381.1719,1665,1385.1719,1661,1381.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1659" x2="2100" y1="1381.1719" y2="1381.1719"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1671" y="1374.3379">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1713" y="1374.3379">response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="205" x2="2438" y1="1390.1719" y2="1390.1719"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="383" x="210" y="1413.0098">[if (Transfer status == 'COMMITTED')]</text><polygon fill="#181818" points="1047,1448.5156,1057,1452.5156,1047,1456.5156,1051,1452.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="1053" y1="1452.5156" y2="1452.5156"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1445.6816">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="316" y="1445.6816">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="643" x="399" y="1445.6816">/transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)</text><polygon fill="#181818" points="1642,1490.1875,1652,1494.1875,1642,1498.1875,1646,1494.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1059" x2="1648" y1="1494.1875" y2="1494.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1066" y="1487.3535">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="1108" y="1487.3535">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="446" x="1191" y="1487.3535">/transfers/{id} (TransferStatus='COMMITTED')</text><line style="stroke:#181818;stroke-width:1.0;" x1="1654" x2="1696" y1="1535.8594" y2="1535.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="1696" x2="1696" y1="1535.8594" y2="1548.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="1655" x2="1696" y1="1548.8594" y2="1548.8594"/><polygon fill="#181818" points="1665,1544.8594,1655,1548.8594,1665,1552.8594,1661,1548.8594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1661" y="1529.0254">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="104" x="1703" y="1529.0254">Do nothing</text><polygon fill="#181818" points="1070,1586.5313,1060,1590.5313,1070,1594.5313,1066,1590.5313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1064" x2="1653" y1="1590.5313" y2="1590.5313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1076" y="1583.6973">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1118" y="1583.6973">response</text><!--MD5=[ad2d07beb1574d43298e2edb601925c1]
@startuml PayeeDFSPSingleIntegrationApiOnTransferPattern
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title PayeeDFSPSingleIntegrationApiOnTransfer
' declare actors
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during POST transfer ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    CBS->CBS: Release of funds to Payee 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    alt if (Transfer status == 'ABORTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='ABORTED', homeTransactionId)
    MC->CC: Abort Transfer\n **PATCH** /transfers/{id} (TransferStatus='ABORTED')     
    CC->CBS: Abort Transfer
    CBS->CBS: Compensate action for abort
    CBS- ->CC: response
    else if (Transfer status == 'COMMITTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)
    MC->CC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    CC->CC: Do nothing
    CC- ->MC: response
    end


@enduml

@startuml PayeeDFSPSingleIntegrationApiOnTransferPattern

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during POST transfer ==

Switch->MC: **POST** /quotes
MC- ->Switch: HTTP 202 Response
MC->CC: **POST** /quoterequest
activate MC
CC->CC: Do nothing
CC- ->MC: Response
deactivate MC
MC- ->Switch: **PUT** /quotes/{Id} 

Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /transfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds
    Switch->MC: **POST** /transfers
    MC->CC: **POST** /transfers 
    activate MC
    CC->CBS: Perform AML checks and transfer funds
    CBS->CBS: Release of funds to Payee 
    CBS- ->CC: response (homeTransactionId)
    CC- ->MC: response (homeTransactionId)
    deactivate MC
    MC->MC: Generate Fulfilment
    MC- ->Switch: **PUT** /transfers/{id} (TransferStatus='RESERVED', fulfullment)
    Switch->Switch: Commit funds in DFSP ledgers
    alt if (Transfer status == 'ABORTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='ABORTED', homeTransactionId)
    MC->CC: Abort Transfer\n **PATCH** /transfers/{id} (TransferStatus='ABORTED')     
    CC->CBS: Abort Transfer
    CBS->CBS: Compensate action for abort
    CBS- ->CC: response
    else if (Transfer status == 'COMMITTED')
    Switch->MC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED', homeTransactionId)
    MC->CC: **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
    CC->CC: Do nothing
    CC- ->MC: response
    end


@enduml

PlantUML version 1.2022.6(Tue Jun 21 18:34:49 BST 2022)
(GPLV2 source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>