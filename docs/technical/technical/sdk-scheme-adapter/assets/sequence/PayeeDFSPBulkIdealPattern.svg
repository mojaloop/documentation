<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2392px" preserveAspectRatio="none" style="width:2199px;height:2392px;background:#FFFFFF;" version="1.1" viewBox="0 0 2199 2392" width="2199px" zoomAndPan="magnify"><defs/><g><rect fill="#D3D3D3" height="2380.3125" style="stroke:#181818;stroke-width:0.5;" width="754.5" x="837.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1123.75" y="28.8379">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="127" x="1123.75" y="56.5098">Payee DFSP</text><rect fill="#FFFFFF" height="125.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="318.375"/><rect fill="#FFFFFF" height="208.3594" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="842.7813"/><rect fill="#FFFFFF" height="125.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="1554.875"/><rect fill="#FFFFFF" height="179.6875" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="2108.2813"/><rect height="155.3594" style="stroke:#000000;stroke-width:1.5;fill:none;" width="873.5" x="205" y="458.3906"/><rect height="374.7188" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1180" x="831.5" y="766.7656"/><rect height="373.7188" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1180" x="831.5" y="1451.1875"/><rect height="319.0469" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1350.5" x="831.5" y="1976.9219"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="267" x2="267" y1="135.6875" y2="2312.9688"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="954.5" x2="954.5" y1="135.6875" y2="2312.9688"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1531" x2="1531" y1="135.6875" y2="2312.9688"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1890.5" x2="1890.5" y1="135.6875" y2="2312.9688"/><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="122.8535">Switch</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="2311.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="2341.8066">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="2369.4785">Switch</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="841.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="848.5" y="122.8535">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="841.5" y="2311.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="848.5" y="2341.8066">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1474" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1507" y="95.1816">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1481" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1474" y="2311.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1507" y="2341.8066">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1481" y="2369.4785">Connector</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1780.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1787.5" y="122.8535">Core banking solution</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1780.5" y="2311.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1787.5" y="2341.8066">Core banking solution</text><rect fill="#FFFFFF" height="125.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="318.375"/><rect fill="#FFFFFF" height="208.3594" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="842.7813"/><rect fill="#FFFFFF" height="125.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="1554.875"/><rect fill="#FFFFFF" height="179.6875" style="stroke:#181818;stroke-width:1.0;" width="10" x="950" y="2108.2813"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2192" x="0" y="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2192" y1="172.5234" y2="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2192" y1="175.5234" y2="175.5234"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="382" x="905" y="155.6875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="362" x="911" y="182.5254">Payee DFSP integration - Discovery</text><polygon fill="#181818" points="943,231.0313,953,235.0313,943,239.0313,947,235.0313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="949" y1="235.0313" y2="235.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="228.1973">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="304" y="228.1973">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="178" x="357" y="228.1973">/parties/{Type}/{Id}</text><polygon fill="#181818" points="278,272.7031,268,276.7031,278,280.7031,274,276.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="276.7031" y2="276.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="269.8691">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="314" y="269.8691">HTTP 202 Response</text><polygon fill="#181818" points="1519,314.375,1529,318.375,1519,322.375,1523,318.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="960" x2="1525" y1="318.375" y2="318.375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="967" y="311.541">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="997" y="311.541">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="178" x="1050" y="311.541">/parties/{Type}/{Id}</text><polygon fill="#181818" points="1879,356.0469,1889,360.0469,1879,364.0469,1883,360.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1531" x2="1885" y1="360.0469" y2="360.0469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1538" y="353.2129">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="1568" y="353.2129">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="156" x="1621" y="353.2129">[account lookup]</text><polygon fill="#181818" points="1542,397.7188,1532,401.7188,1542,405.7188,1538,401.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1536" x2="1890" y1="401.7188" y2="401.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1548" y="394.8848">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1578" y="394.8848">Response</text><polygon fill="#181818" points="966,439.3906,956,443.3906,966,447.3906,962,443.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960" x2="1530" y1="443.3906" y2="443.3906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="972" y="436.5566">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1002" y="436.5566">Response</text><path d="M205,458.3906 L274,458.3906 L274,478.0625 L264,488.0625 L205,488.0625 L205,458.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="155.3594" style="stroke:#000000;stroke-width:1.5;" width="873.5" x="205" y="458.3906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="24" x="220" y="482.2285">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="221" x="289" y="483.2285">[If Success response]</text><polygon fill="#181818" points="278,530.4063,268,534.4063,278,538.4063,274,534.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="534.4063" y2="534.4063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="527.5723">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="314" y="527.5723">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="478" x="366" y="527.5723">/parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="205" x2="1078.5" y1="543.4063" y2="543.4063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="185" x="210" y="566.2441">[if Error response]</text><polygon fill="#181818" points="278,601.75,268,605.75,278,609.75,274,605.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="605.75" y2="605.75"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="598.916">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="314" y="598.916">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="582" x="366" y="598.916">/parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2192" x="0" y="647.5859"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2192" y1="647.5859" y2="647.5859"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2192" y1="650.5859" y2="650.5859"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="880" x="656" y="630.75"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="860" x="662" y="657.5879">Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check</text><polygon fill="#181818" points="943,706.0938,953,710.0938,943,714.0938,947,710.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="949" y1="710.0938" y2="710.0938"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="703.2598">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="304" y="703.2598">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="372" y="703.2598">/bulkquotes</text><polygon fill="#181818" points="278,747.7656,268,751.7656,278,755.7656,274,751.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="751.7656" y2="751.7656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="284" y="744.9316">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="326" y="744.9316">HTTP 202 Response</text><path d="M831.5,766.7656 L920.5,766.7656 L920.5,786.4375 L910.5,796.4375 L831.5,796.4375 L831.5,766.7656 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="374.7188" style="stroke:#000000;stroke-width:1.5;" width="1180" x="831.5" y="766.7656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="846.5" y="790.6035">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="935.5" y="791.6035">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1519,838.7813,1529,842.7813,1519,846.7813,1523,842.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="960" x2="1525" y1="842.7813" y2="842.7813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="967" y="835.9473">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1009" y="835.9473">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="131" x="1077" y="835.9473">/quoterequest</text><polygon fill="#181818" points="1879,880.4531,1889,884.4531,1879,888.4531,1883,884.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1531" x2="1885" y1="884.4531" y2="884.4531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1538" y="877.6191">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="45" x="1580" y="877.6191">AML</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="66" x="1631" y="877.6191">checks</text><polygon fill="#181818" points="1542,922.125,1532,926.125,1542,930.125,1538,926.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1536" x2="1890" y1="926.125" y2="926.125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1548" y="919.291">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1590" y="919.291">Response</text><polygon fill="#181818" points="1879,963.7969,1889,967.7969,1879,971.7969,1883,967.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1531" x2="1885" y1="967.7969" y2="967.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1538" y="960.9629">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="149" x="1580" y="960.9629">Calculate Fees</text><polygon fill="#181818" points="1542,1005.4688,1532,1009.4688,1542,1013.4688,1538,1009.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1536" x2="1890" y1="1009.4688" y2="1009.4688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1548" y="1002.6348">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1590" y="1002.6348">Response</text><polygon fill="#181818" points="966,1047.1406,956,1051.1406,966,1055.1406,962,1051.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960" x2="1530" y1="1051.1406" y2="1051.1406"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="972" y="1044.3066">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="1014" y="1044.3066">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="955" x2="997" y1="1120.4844" y2="1120.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="997" x2="997" y1="1120.4844" y2="1133.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="956" x2="997" y1="1133.4844" y2="1133.4844"/><polygon fill="#181818" points="966,1129.4844,956,1133.4844,966,1137.4844,962,1133.4844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="962" y="1099.8145">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="244" x="1004" y="1085.9785">Update transaction status</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="254" x="1004" y="1113.6504">and attach quote response</text><polygon fill="#181818" points="278,1178.1563,268,1182.1563,278,1186.1563,274,1182.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="1182.1563" y2="1182.1563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="284" y="1175.3223">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="326" y="1175.3223">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="146" x="378" y="1175.3223">/bulkquotes/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="1248" y2="1248"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="1248" y2="1261"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="1261" y2="1261"/><polygon fill="#181818" points="278,1257,268,1261,278,1265,274,1261" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1241.166">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="202" x="316" y="1241.166">Pass Quote to Payer</text><path d="M5,1195.1563 L5,1288.1563 L262,1288.1563 L262,1205.1563 L252,1195.1563 L5,1195.1563 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M252,1195.1563 L252,1205.1563 L262,1205.1563 L252,1195.1563 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="169" x="11" y="1222.9941">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="236" x="11" y="1250.666">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="32" x="11" y="1278.3379">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="49" y="1278.3379">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="117" y="1278.3379">/bulktransfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="1326.8438" y2="1326.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="1326.8438" y2="1339.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="1339.8438" y2="1339.8438"/><polygon fill="#181818" points="278,1335.8438,268,1339.8438,278,1343.8438,274,1339.8438" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1320.0098">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="273" x="316" y="1320.0098">Perform liquidity(NDC)check</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="1381.5156" y2="1381.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="1381.5156" y2="1394.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="1394.5156" y2="1394.5156"/><polygon fill="#181818" points="278,1390.5156,268,1394.5156,278,1398.5156,274,1394.5156" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1374.6816">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="368" x="316" y="1374.6816">Reserve Funds at indivial transfer level</text><polygon fill="#181818" points="943,1432.1875,953,1436.1875,943,1440.1875,947,1436.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="949" y1="1436.1875" y2="1436.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1429.3535">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="316" y="1429.3535">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="384" y="1429.3535">/bulktransfers</text><path d="M831.5,1451.1875 L920.5,1451.1875 L920.5,1470.8594 L910.5,1480.8594 L831.5,1480.8594 L831.5,1451.1875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="373.7188" style="stroke:#000000;stroke-width:1.5;" width="1180" x="831.5" y="1451.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="846.5" y="1475.0254">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="935.5" y="1476.0254">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1519,1550.875,1529,1554.875,1519,1558.875,1523,1554.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="960" x2="1525" y1="1554.875" y2="1554.875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="967" y="1534.2051">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="260" x="1009" y="1520.3691">Create &amp; Reserve Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="6" x="1009" y="1548.041"> </text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1015" y="1548.041">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="1083" y="1548.041">/transfers</text><polygon fill="#181818" points="1879,1592.5469,1889,1596.5469,1879,1600.5469,1883,1596.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1531" x2="1885" y1="1596.5469" y2="1596.5469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1538" y="1589.7129">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="139" x="1580" y="1589.7129">Reserve funds</text><polygon fill="#181818" points="1542,1634.2188,1532,1638.2188,1542,1642.2188,1538,1638.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1536" x2="1890" y1="1638.2188" y2="1638.2188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1548" y="1631.3848">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="294" x="1590" y="1631.3848">response (homeTransactionId)</text><polygon fill="#181818" points="966,1675.8906,956,1679.8906,966,1683.8906,962,1679.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960" x2="1530" y1="1679.8906" y2="1679.8906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="972" y="1673.0566">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="294" x="1014" y="1673.0566">response (homeTransactionId)</text><line style="stroke:#181818;stroke-width:1.0;" x1="955" x2="997" y1="1721.5625" y2="1721.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="997" x2="997" y1="1721.5625" y2="1734.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="956" x2="997" y1="1734.5625" y2="1734.5625"/><polygon fill="#181818" points="966,1730.5625,956,1734.5625,966,1738.5625,962,1734.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="962" y="1714.7285">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="186" x="1004" y="1714.7285">Generate Fulfilment</text><line style="stroke:#181818;stroke-width:1.0;" x1="955" x2="997" y1="1803.9063" y2="1803.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="997" x2="997" y1="1803.9063" y2="1816.9063"/><line style="stroke:#181818;stroke-width:1.0;" x1="956" x2="997" y1="1816.9063" y2="1816.9063"/><polygon fill="#181818" points="966,1812.9063,956,1816.9063,966,1820.9063,962,1816.9063" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="962" y="1783.2363">[28]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="244" x="1004" y="1769.4004">Update transaction status</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="273" x="1004" y="1797.0723">and attach transfer response</text><polygon fill="#181818" points="278,1861.5781,268,1865.5781,278,1869.5781,274,1865.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="954" y1="1865.5781" y2="1865.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="284" y="1858.7441">[29]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="326" y="1858.7441">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="454" x="378" y="1858.7441">/bulktransfers/{id} (BulkStatus='PROCESSING')</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="267" x2="309" y1="1907.25" y2="1907.25"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="309" x2="309" y1="1907.25" y2="1920.25"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="268" x2="309" y1="1920.25" y2="1920.25"/><polygon fill="#181818" points="278,1916.25,268,1920.25,278,1924.25,274,1920.25" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1900.416">[30]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="520" x="316" y="1900.416">Commit funds at indivial transfer level in DFSP ledgers</text><polygon fill="#181818" points="943,1957.9219,953,1961.9219,943,1965.9219,947,1961.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="949" y1="1961.9219" y2="1961.9219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1955.0879">[31]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="316" y="1955.0879">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="445" x="399" y="1955.0879">/bulktransfers/{id} (BulkStatus='COMPLETED')</text><path d="M831.5,1976.9219 L920.5,1976.9219 L920.5,1996.5938 L910.5,2006.5938 L831.5,2006.5938 L831.5,1976.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="319.0469" style="stroke:#000000;stroke-width:1.5;" width="1350.5" x="831.5" y="1976.9219"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="846.5" y="2000.7598">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="935.5" y="2001.7598">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1519,2104.2813,1529,2108.2813,1519,2112.2813,1523,2108.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="960" x2="1525" y1="2108.2813" y2="2108.2813"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="967" y="2073.7754">[32]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="163" x="1009" y="2046.1035">Commit Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="6" x="1009" y="2073.7754"> </text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="1015" y="2073.7754">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="1098" y="2073.7754">/transfers/{id}</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="510" x="1009" y="2101.4473">(TransferStatus='COMMITTED', homeTransactionId)</text><polygon fill="#181818" points="1879,2145.9531,1889,2149.9531,1879,2153.9531,1883,2149.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1531" x2="1885" y1="2149.9531" y2="2149.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1538" y="2143.1191">[33]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="134" x="1580" y="2143.1191">Commit funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="1891" x2="1933" y1="2191.625" y2="2191.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1933" x2="1933" y1="2191.625" y2="2204.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1892" x2="1933" y1="2204.625" y2="2204.625"/><polygon fill="#181818" points="1902,2200.625,1892,2204.625,1902,2208.625,1898,2204.625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1898" y="2184.791">[34]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="230" x="1940" y="2184.791">Release funds to Payee</text><polygon fill="#181818" points="1542,2242.2969,1532,2246.2969,1542,2250.2969,1538,2246.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1536" x2="1890" y1="2246.2969" y2="2246.2969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1548" y="2239.4629">[35]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1590" y="2239.4629">response</text><polygon fill="#181818" points="966,2283.9688,956,2287.9688,966,2291.9688,962,2287.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960" x2="1530" y1="2287.9688" y2="2287.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="972" y="2281.1348">[36]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1014" y="2281.1348">response</text><!--MD5=[bcebffe8302a0b53658a27af0f92e8f7]
@startuml PayeeDFSPBulkIdealPattern
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title PayeeDFSPBulkIdealPattern
' declare actors
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Discovery ==

Switch->MC: **GET** /parties/{Type}/{Id}
MC- ->Switch: HTTP 202 Response
MC->CC: **GET** /parties/{Type}/{Id}
activate MC
CC->CBS: **GET** [account lookup]
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
alt If Success response
MC- ->Switch: **PUT** /parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})
else if Error response
MC- ->Switch: **PUT** /parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)
end

== Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check ==

Switch->MC: **POST** /bulkquotes
MC- ->Switch: HTTP 202 Response
loop X times for each transfer in bulk message
    MC->CC: **POST** /quoterequest
    activate MC
    CC->CBS: **AML** checks
    CBS- ->CC: Response
    CC->CBS: **Calculate Fees**
    CBS- ->CC: Response
    CC- ->MC: Response
    deactivate MC
  MC->MC: Update transaction status \nand attach quote response
end Loop
MC- ->Switch: **PUT** /bulkquotes/{Id} 
Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /bulktransfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds at indivial transfer level
    Switch->MC: **POST** /bulktransfers
    loop X times for each transfer in bulk message
        MC->CC: Create & Reserve Transfer\n **POST** /transfers 
        activate MC
        CC->CBS: Reserve funds 
        CBS- ->CC: response (homeTransactionId)
        CC- ->MC: response (homeTransactionId)
        deactivate MC
        MC->MC: Generate Fulfilment
        MC -> MC:Update transaction status \nand attach transfer response
    end Loop
    MC- ->Switch: **PUT** /bulktransfers/{id} (BulkStatus='PROCESSING') 
    Switch- ->Switch: Commit funds at indivial transfer level in DFSP ledgers
    Switch -> MC: **PATCH** /bulktransfers/{id} (BulkStatus='COMPLETED')
    loop X times for each transfer in bulk message
        MC->CC: Commit Transfer\n **PATCH** /transfers/{id} \n(TransferStatus='COMMITTED', homeTransactionId) 
        activate MC
        CC->CBS: Commit funds 
        CBS->CBS: Release funds to Payee 
        CBS- ->CC: response
        CC- ->MC: response
        deactivate MC
    end loop    



@enduml

@startuml PayeeDFSPBulkIdealPattern

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Discovery ==

Switch->MC: **GET** /parties/{Type}/{Id}
MC- ->Switch: HTTP 202 Response
MC->CC: **GET** /parties/{Type}/{Id}
activate MC
CC->CBS: **GET** [account lookup]
CBS- ->CC: Response
CC- ->MC: Response
deactivate MC
alt If Success response
MC- ->Switch: **PUT** /parties/{Type}/{Id} (or /parties/{Type}/{Id}/{SubId})
else if Error response
MC- ->Switch: **PUT** /parties/{Type}/{Id}/error (or /parties/{Type}/{Id}/{SubId}/error)
end

== Payee DFSP integration - Quote and Transfer - 2 phase commit with prior AML check ==

Switch->MC: **POST** /bulkquotes
MC- ->Switch: HTTP 202 Response
loop X times for each transfer in bulk message
    MC->CC: **POST** /quoterequest
    activate MC
    CC->CBS: **AML** checks
    CBS- ->CC: Response
    CC->CBS: **Calculate Fees**
    CBS- ->CC: Response
    CC- ->MC: Response
    deactivate MC
  MC->MC: Update transaction status \nand attach quote response
end Loop
MC- ->Switch: **PUT** /bulkquotes/{Id} 
Switch->Switch: Pass Quote to Payer
note left
Obtain consent to 
proceed with the transfer
Via **POST** /bulktransfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds at indivial transfer level
    Switch->MC: **POST** /bulktransfers
    loop X times for each transfer in bulk message
        MC->CC: Create & Reserve Transfer\n **POST** /transfers 
        activate MC
        CC->CBS: Reserve funds 
        CBS- ->CC: response (homeTransactionId)
        CC- ->MC: response (homeTransactionId)
        deactivate MC
        MC->MC: Generate Fulfilment
        MC -> MC:Update transaction status \nand attach transfer response
    end Loop
    MC- ->Switch: **PUT** /bulktransfers/{id} (BulkStatus='PROCESSING') 
    Switch- ->Switch: Commit funds at indivial transfer level in DFSP ledgers
    Switch -> MC: **PATCH** /bulktransfers/{id} (BulkStatus='COMPLETED')
    loop X times for each transfer in bulk message
        MC->CC: Commit Transfer\n **PATCH** /transfers/{id} \n(TransferStatus='COMMITTED', homeTransactionId) 
        activate MC
        CC->CBS: Commit funds 
        CBS->CBS: Release funds to Payee 
        CBS- ->CC: response
        CC- ->MC: response
        deactivate MC
    end loop    



@enduml

PlantUML version 1.2022.6(Tue Jun 21 18:34:49 BST 2022)
(GPLV2 source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>