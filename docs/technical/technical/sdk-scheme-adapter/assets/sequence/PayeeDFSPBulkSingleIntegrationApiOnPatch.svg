<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2212px" preserveAspectRatio="none" style="width:2373px;height:2212px;background:#FFFFFF;" version="1.1" viewBox="0 0 2373 2212" width="2373px" zoomAndPan="magnify"><defs/><g><rect fill="#D3D3D3" height="2200.2969" style="stroke:#181818;stroke-width:0.5;" width="779.5" x="743.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1042.25" y="28.8379">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="127" x="1042.25" y="56.5098">Payee DFSP</text><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="367.7188"/><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="940.125"/><rect fill="#FFFFFF" height="424.3906" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="1437.1875"/><rect height="262.7031" style="stroke:#000000;stroke-width:1.5;fill:none;" width="877.5" x="737.5" y="291.7031"/><rect height="317.375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="894.5" x="737.5" y="864.1094"/><rect height="782.4531" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2079" x="277" y="1333.5"/><rect height="615.0938" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2059" x="287" y="1493.8594"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="267" x2="267" y1="135.6875" y2="2132.9531"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="860.5" x2="860.5" y1="135.6875" y2="2132.9531"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1462" x2="1462" y1="135.6875" y2="2132.9531"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1919.5" x2="1919.5" y1="135.6875" y2="2132.9531"/><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="122.8535">Switch</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="215" y="2131.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="222" y="2161.791">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="235.5" y="2189.4629">Switch</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="747.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="754.5" y="122.8535">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="227" x="747.5" y="2131.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="213" x="754.5" y="2161.791">SDK Scheme Adapter</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1405" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1438" y="95.1816">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1412" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1405" y="2131.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1438" y="2161.791">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1412" y="2189.4629">Connector</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1809.5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1816.5" y="122.8535">Core banking solution</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="1809.5" y="2131.9531"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="1816.5" y="2161.791">Core banking solution</text><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="367.7188"/><rect fill="#FFFFFF" height="96.3438" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="940.125"/><rect fill="#FFFFFF" height="424.3906" style="stroke:#181818;stroke-width:1.0;" width="10" x="856" y="1437.1875"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2366" x="0" y="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2366" y1="172.5234" y2="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2366" y1="175.5234" y2="175.5234"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="937" x="714.5" y="155.6875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="917" x="720.5" y="182.5254">Payee DFSP integration - Quote and Transfer - single AML check &amp; transfer during PATCH</text><polygon fill="#181818" points="849,231.0313,859,235.0313,849,239.0313,853,235.0313" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="855" y1="235.0313" y2="235.0313"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="228.1973">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="304" y="228.1973">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="372" y="228.1973">/bulkquotes</text><polygon fill="#181818" points="278,272.7031,268,276.7031,278,280.7031,274,276.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="860" y1="276.7031" y2="276.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="269.8691">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="314" y="269.8691">HTTP 202 Response</text><path d="M737.5,291.7031 L826.5,291.7031 L826.5,311.375 L816.5,321.375 L737.5,321.375 L737.5,291.7031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="262.7031" style="stroke:#000000;stroke-width:1.5;" width="877.5" x="737.5" y="291.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="752.5" y="315.541">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="841.5" y="316.541">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1450,363.7188,1460,367.7188,1450,371.7188,1454,367.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="866" x2="1456" y1="367.7188" y2="367.7188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="873" y="360.8848">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="903" y="360.8848">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="131" x="971" y="360.8848">/quoterequest</text><line style="stroke:#181818;stroke-width:1.0;" x1="1462" x2="1504" y1="409.3906" y2="409.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="1504" x2="1504" y1="409.3906" y2="422.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="1463" x2="1504" y1="422.3906" y2="422.3906"/><polygon fill="#181818" points="1473,418.3906,1463,422.3906,1473,426.3906,1469,422.3906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1469" y="402.5566">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="104" x="1499" y="402.5566">Do nothing</text><polygon fill="#181818" points="872,460.0625,862,464.0625,872,468.0625,868,464.0625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="866" x2="1461" y1="464.0625" y2="464.0625"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="878" y="457.2285">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="98" x="908" y="457.2285">Response</text><line style="stroke:#181818;stroke-width:1.0;" x1="861" x2="903" y1="533.4063" y2="533.4063"/><line style="stroke:#181818;stroke-width:1.0;" x1="903" x2="903" y1="533.4063" y2="546.4063"/><line style="stroke:#181818;stroke-width:1.0;" x1="862" x2="903" y1="546.4063" y2="546.4063"/><polygon fill="#181818" points="872,542.4063,862,546.4063,872,550.4063,868,546.4063" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="868" y="512.7363">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="244" x="898" y="498.9004">Update transaction status</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="254" x="898" y="526.5723">and attach quote response</text><polygon fill="#181818" points="278,591.0781,268,595.0781,278,599.0781,274,595.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="860" y1="595.0781" y2="595.0781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="284" y="588.2441">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="314" y="588.2441">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="146" x="366" y="588.2441">/bulkquotes/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="660.9219" y2="660.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="660.9219" y2="673.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="673.9219" y2="673.9219"/><polygon fill="#181818" points="278,669.9219,268,673.9219,278,677.9219,274,673.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="654.0879">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="267" x="304" y="654.0879">Pass Quote to Payer DFSP</text><path d="M5,608.0781 L5,701.0781 L262,701.0781 L262,618.0781 L252,608.0781 L5,608.0781 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M252,608.0781 L252,618.0781 L262,618.0781 L252,608.0781 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="169" x="11" y="635.916">Obtain consent to</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="236" x="11" y="663.5879">proceed with the transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="32" x="11" y="691.2598">Via</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="49" y="691.2598">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="117" y="691.2598">/bulktransfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="739.7656" y2="739.7656"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="739.7656" y2="752.7656"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="752.7656" y2="752.7656"/><polygon fill="#181818" points="278,748.7656,268,752.7656,278,756.7656,274,752.7656" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="274" y="732.9316">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="273" x="304" y="732.9316">Perform liquidity(NDC)check</text><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="309" y1="794.4375" y2="794.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="309" y1="794.4375" y2="807.4375"/><line style="stroke:#181818;stroke-width:1.0;" x1="268" x2="309" y1="807.4375" y2="807.4375"/><polygon fill="#181818" points="278,803.4375,268,807.4375,278,811.4375,274,807.4375" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="787.6035">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="368" x="316" y="787.6035">Reserve Funds at indivial transfer level</text><polygon fill="#181818" points="849,845.1094,859,849.1094,849,853.1094,853,849.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="855" y1="849.1094" y2="849.1094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="842.2754">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="316" y="842.2754">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="384" y="842.2754">/bulktransfers</text><path d="M737.5,864.1094 L826.5,864.1094 L826.5,883.7813 L816.5,893.7813 L737.5,893.7813 L737.5,864.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="317.375" style="stroke:#000000;stroke-width:1.5;" width="894.5" x="737.5" y="864.1094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="752.5" y="887.9473">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="841.5" y="888.9473">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1450,936.125,1460,940.125,1450,944.125,1454,940.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="866" x2="1456" y1="940.125" y2="940.125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="873" y="933.291">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="915" y="933.291">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="983" y="933.291">/transfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="1462" x2="1504" y1="981.7969" y2="981.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="1504" x2="1504" y1="981.7969" y2="994.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="1463" x2="1504" y1="994.7969" y2="994.7969"/><polygon fill="#181818" points="1473,990.7969,1463,994.7969,1473,998.7969,1469,994.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1469" y="974.9629">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="109" x="1511" y="974.9629">Do Nothing</text><polygon fill="#181818" points="872,1032.4688,862,1036.4688,872,1040.4688,868,1036.4688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="866" x2="1461" y1="1036.4688" y2="1036.4688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="878" y="1029.6348">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="920" y="1029.6348">response</text><line style="stroke:#181818;stroke-width:1.0;" x1="861" x2="903" y1="1078.1406" y2="1078.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="903" x2="903" y1="1078.1406" y2="1091.1406"/><line style="stroke:#181818;stroke-width:1.0;" x1="862" x2="903" y1="1091.1406" y2="1091.1406"/><polygon fill="#181818" points="872,1087.1406,862,1091.1406,872,1095.1406,868,1091.1406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="868" y="1071.3066">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="186" x="910" y="1071.3066">Generate Fulfilment</text><line style="stroke:#181818;stroke-width:1.0;" x1="861" x2="903" y1="1160.4844" y2="1160.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="903" x2="903" y1="1160.4844" y2="1173.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="862" x2="903" y1="1173.4844" y2="1173.4844"/><polygon fill="#181818" points="872,1169.4844,862,1173.4844,872,1177.4844,868,1173.4844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="868" y="1139.8145">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="244" x="910" y="1125.9785">Update transaction status</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="273" x="910" y="1153.6504">and attach transfer response</text><polygon fill="#181818" points="278,1218.1563,268,1222.1563,278,1226.1563,274,1222.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272" x2="860" y1="1222.1563" y2="1222.1563"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="284" y="1215.3223">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="326" y="1215.3223">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="454" x="378" y="1215.3223">/bulktransfers/{id} (BulkStatus='PROCESSING')</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="267" x2="309" y1="1263.8281" y2="1263.8281"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="309" x2="309" y1="1263.8281" y2="1276.8281"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="268" x2="309" y1="1276.8281" y2="1276.8281"/><polygon fill="#181818" points="278,1272.8281,268,1276.8281,278,1280.8281,274,1276.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1256.9941">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="520" x="316" y="1256.9941">Commit funds at indivial transfer level in DFSP ledgers</text><polygon fill="#181818" points="849,1314.5,859,1318.5,849,1322.5,853,1318.5" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="267" x2="855" y1="1318.5" y2="1318.5"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="274" y="1311.666">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="316" y="1311.666">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="445" x="399" y="1311.666">/bulktransfers/{id} (BulkStatus='COMPLETED')</text><path d="M277,1333.5 L366,1333.5 L366,1353.1719 L356,1363.1719 L277,1363.1719 L277,1333.5 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="782.4531" style="stroke:#000000;stroke-width:1.5;" width="2079" x="277" y="1333.5"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="292" y="1357.3379">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="435" x="381" y="1358.3379">[X times for each transfer in bulk message]</text><polygon fill="#181818" points="1450,1433.1875,1460,1437.1875,1450,1441.1875,1454,1437.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="866" x2="1456" y1="1437.1875" y2="1437.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="873" y="1416.5176">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="163" x="915" y="1402.6816">Commit Transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="6" x="915" y="1430.3535"> </text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="77" x="921" y="1430.3535">PATCH</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="446" x="1004" y="1430.3535">/transfers/{id} (TransferStatus='COMMITTED')</text><polygon fill="#181818" points="1908,1474.8594,1918,1478.8594,1908,1482.8594,1912,1478.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1462" x2="1914" y1="1478.8594" y2="1478.8594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1469" y="1472.0254">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="392" x="1511" y="1472.0254">Performn AML checks and transfer funds</text><path d="M287,1493.8594 L356,1493.8594 L356,1513.5313 L346,1523.5313 L287,1523.5313 L287,1493.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="615.0938" style="stroke:#000000;stroke-width:1.5;" width="2059" x="287" y="1493.8594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="24" x="302" y="1517.6973">alt</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="225" x="371" y="1518.6973">[if (AML checks pass)]</text><line style="stroke:#181818;stroke-width:1.0;" x1="1920" x2="1962" y1="1569.875" y2="1569.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="1962" x2="1962" y1="1569.875" y2="1582.875"/><line style="stroke:#181818;stroke-width:1.0;" x1="1921" x2="1962" y1="1582.875" y2="1582.875"/><polygon fill="#181818" points="1931,1578.875,1921,1582.875,1931,1586.875,1927,1582.875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1927" y="1563.041">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="230" x="1969" y="1563.041">Release funds to Payee</text><polygon fill="#181818" points="1473,1620.5469,1463,1624.5469,1473,1628.5469,1469,1624.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1467" x2="1919" y1="1624.5469" y2="1624.5469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1479" y="1617.7129">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1521" y="1617.7129">response</text><polygon fill="#181818" points="877,1662.2188,867,1666.2188,877,1670.2188,873,1666.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="871" x2="1461" y1="1666.2188" y2="1666.2188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="883" y="1659.3848">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="925" y="1659.3848">response</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="287" x2="2346" y1="1675.2188" y2="1675.2188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="205" x="292" y="1698.0566">[if (AML checks fail)]</text><line style="stroke:#181818;stroke-width:1.0;" x1="1920" x2="1962" y1="1765.2344" y2="1765.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1962" x2="1962" y1="1765.2344" y2="1778.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="1921" x2="1962" y1="1778.2344" y2="1778.2344"/><polygon fill="#181818" points="1931,1774.2344,1921,1778.2344,1931,1782.2344,1927,1778.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1927" y="1744.5645">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="359" x="1969" y="1730.7285">Compensation action for AML failure.</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="216" x="1975" y="1758.4004">Return error response.</text><polygon fill="#181818" points="1473,1815.9063,1463,1819.9063,1473,1823.9063,1469,1819.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1467" x2="1919" y1="1819.9063" y2="1819.9063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1479" y="1813.0723">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="1521" y="1813.0723">response</text><polygon fill="#181818" points="872,1857.5781,862,1861.5781,872,1865.5781,868,1861.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="866" x2="1461" y1="1861.5781" y2="1861.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="878" y="1854.7441">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="89" x="920" y="1854.7441">response</text><rect fill="#FAFAFA" height="229" style="stroke:#181818;stroke-width:0.5;" width="559" x="297" y="1874.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="466" x="301" y="1901.416">Payee DFSP AML checks / other errors result in:</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="6" x="301" y="1929.0879"> </text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="201" x="301" y="1956.7598">Reconciliation Error</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="201" x="319" y="1984.4316">Payer has sent funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="266" x="319" y="2012.1035">Payer DFSP has sent funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="533" x="319" y="2039.7754">Hub considers that the Payee DFSP has received funds</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="395" x="319" y="2067.4473">Payee DFSP has rejected the transaction</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="284" x="319" y="2095.1191">Payee has not received funds</text><!--MD5=[5d918f14ed352a2185161c84bf4cbd91]
@startuml PayeeDFSPBulkSingleIntegrationApiOnPatch
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title PayeeDFSPBulkSingleIntegrationApiOnPatch
' declare actors
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during PATCH ==

Switch->MC: **POST** /bulkquotes
MC- ->Switch: HTTP 202 Response
loop X times for each transfer in bulk message
  MC->CC: **POST** /quoterequest
    activate MC
      CC->CC: Do nothing
      CC- ->MC: Response
    deactivate MC
  MC->MC: Update transaction status \nand attach quote response
end Loop
MC- ->Switch: **PUT** /bulkquotes/{Id} 

Switch->Switch: Pass Quote to Payer DFSP
note left
Obtain consent to 
proceed with the transfer
Via **POST** /bulktransfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds at indivial transfer level
    Switch->MC: **POST** /bulktransfers
    loop X times for each transfer in bulk message
        MC->CC: **POST** /transfers 
        activate MC
        CC->CC: Do Nothing 
        CC- ->MC: response
        deactivate MC
        MC->MC: Generate Fulfilment
        MC -> MC:Update transaction status \nand attach transfer response
    end Loop
    MC- ->Switch: **PUT** /bulktransfers/{id} (BulkStatus='PROCESSING') 
    Switch- ->Switch: Commit funds at indivial transfer level in DFSP ledgers
    Switch -> MC: **PATCH** /bulktransfers/{id} (BulkStatus='COMPLETED')
    loop X times for each transfer in bulk message
      MC->CC: Commit Transfer\n **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
      activate MC
      CC->CBS: Performn AML checks and transfer funds
      alt if (AML checks pass)
      CBS->CBS: Release funds to Payee 
      CBS- ->CC: response
      CC- ->MC: response
      else if (AML checks fail)
      CBS->CBS: Compensation action for AML failure. \n Return error response.
      CBS- ->CC: response
      CC- ->MC: response
      deactivate MC
        rnote left MC 
    Payee DFSP AML checks / other errors result in:
    
    **Reconciliation Error**
       Payer has sent funds
       Payer DFSP has sent funds
       Hub considers that the Payee DFSP has received funds
       Payee DFSP has rejected the transaction
       Payee has not received funds
        endrnote
      end
    end Loop
 
@enduml

@startuml PayeeDFSPBulkSingleIntegrationApiOnPatch

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Mojaloop\nSwitch" as Switch
box "Payment Manager\nPayee DFSP" #LightGrey
participant "SDK Scheme Adapter" as MC 
participant "Core\nConnector" as CC 
end box
participant "Core banking solution" as CBS
autonumber 1 1 "<b>[0]"

== Payee DFSP integration - Quote and Transfer - single AML check & transfer during PATCH ==

Switch->MC: **POST** /bulkquotes
MC- ->Switch: HTTP 202 Response
loop X times for each transfer in bulk message
  MC->CC: **POST** /quoterequest
    activate MC
      CC->CC: Do nothing
      CC- ->MC: Response
    deactivate MC
  MC->MC: Update transaction status \nand attach quote response
end Loop
MC- ->Switch: **PUT** /bulkquotes/{Id} 

Switch->Switch: Pass Quote to Payer DFSP
note left
Obtain consent to 
proceed with the transfer
Via **POST** /bulktransfers
end note
    Switch-> Switch: Perform liquidity(NDC)check
    Switch->Switch: Reserve Funds at indivial transfer level
    Switch->MC: **POST** /bulktransfers
    loop X times for each transfer in bulk message
        MC->CC: **POST** /transfers 
        activate MC
        CC->CC: Do Nothing 
        CC- ->MC: response
        deactivate MC
        MC->MC: Generate Fulfilment
        MC -> MC:Update transaction status \nand attach transfer response
    end Loop
    MC- ->Switch: **PUT** /bulktransfers/{id} (BulkStatus='PROCESSING') 
    Switch- ->Switch: Commit funds at indivial transfer level in DFSP ledgers
    Switch -> MC: **PATCH** /bulktransfers/{id} (BulkStatus='COMPLETED')
    loop X times for each transfer in bulk message
      MC->CC: Commit Transfer\n **PATCH** /transfers/{id} (TransferStatus='COMMITTED') 
      activate MC
      CC->CBS: Performn AML checks and transfer funds
      alt if (AML checks pass)
      CBS->CBS: Release funds to Payee 
      CBS- ->CC: response
      CC- ->MC: response
      else if (AML checks fail)
      CBS->CBS: Compensation action for AML failure. \n Return error response.
      CBS- ->CC: response
      CC- ->MC: response
      deactivate MC
        rnote left MC 
    Payee DFSP AML checks / other errors result in:
    
    **Reconciliation Error**
       Payer has sent funds
       Payer DFSP has sent funds
       Hub considers that the Payee DFSP has received funds
       Payee DFSP has rejected the transaction
       Payee has not received funds
        endrnote
      end
    end Loop
 
@enduml

PlantUML version 1.2022.6(Tue Jun 21 18:34:49 BST 2022)
(GPLV2 source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>