<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2593px" preserveAspectRatio="none" style="width:2967px;height:2593px;background:#FFFFFF;" version="1.1" viewBox="0 0 2967 2593" width="2967px" zoomAndPan="magnify"><defs/><g><rect fill="#D3D3D3" height="2581" style="stroke:#181818;stroke-width:0.5;" width="1062" x="994.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1434.5" y="28.8379">Payment Manager</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="123" x="1434.5" y="56.5098">Payer DFSP</text><rect fill="#FFFFFF" height="1988.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="516.4063"/><rect fill="#FFFFFF" height="1118.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="516.4063"/><rect fill="#FFFFFF" height="529.7344" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="1869.5781"/><rect height="170.3594" style="stroke:#000000;stroke-width:1.5;fill:none;" width="596.5" x="758" y="277.7031"/><rect height="419.3906" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1163.5" x="1787" y="531.4063"/><rect height="584.0781" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1085.5" x="1736" y="1010.4688"/><rect height="474.0625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1104.5" x="1736" y="1884.5781"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="115" x2="115" y1="135.6875" y2="2513.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1055.5" x2="1055.5" y1="135.6875" y2="2513.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1995.5" x2="1995.5" y1="135.6875" y2="2513.6563"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2463.5" x2="2463.5" y1="135.6875" y2="2513.6563"/><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="5" y="93.0156"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="12" y="122.8535">Core banking solution</text><rect fill="#E3E3E3" height="41.6719" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="5" y="2512.6563"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="207" x="12" y="2542.4941">Core banking solution</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="998.5" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1031.5" y="95.1816">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1005.5" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="998.5" y="2512.6563"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="48" x="1031.5" y="2542.4941">Core</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1005.5" y="2570.166">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1938.5" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="1950.5" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1945.5" y="122.8535">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="1938.5" y="2512.6563"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="1950.5" y="2542.4941">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="100" x="1945.5" y="2570.166">Connector</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2411.5" y="65.3438"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="2418.5" y="95.1816">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="2432" y="122.8535">Switch</text><rect fill="#E3E3E3" height="69.3438" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2411.5" y="2512.6563"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="90" x="2418.5" y="2542.4941">Mojaloop</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="63" x="2432" y="2570.166">Switch</text><rect fill="#FFFFFF" height="1988.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="516.4063"/><rect fill="#FFFFFF" height="1118.8125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="516.4063"/><rect fill="#FFFFFF" height="529.7344" style="stroke:#181818;stroke-width:1.0;" width="10" x="1995.5" y="1869.5781"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2960.5" x="0" y="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2960.5" y1="172.5234" y2="172.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2960.5" y1="175.5234" y2="175.5234"/><rect fill="#EEEEEE" height="35.6719" style="stroke:#000000;stroke-width:2.0;" width="684" x="1138.25" y="155.6875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="664" x="1144.25" y="182.5254">Payer DFSP integration - 2 phase commit - with user confirmation</text><polygon fill="#181818" points="1043.5,258.7031,1053.5,262.7031,1043.5,266.7031,1047.5,262.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="1049.5" y1="262.7031" y2="262.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="122.5" y="242.0332">[1]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="152.5" y="228.1973">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="167" x="220.5" y="228.1973">/bulkTransactions</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="621" x="152.5" y="255.8691">(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES =</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="48" x="779.5" y="255.8691">false</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="211" x="827.5" y="255.8691">, synchronous = false)</text><path d="M758,277.7031 L847,277.7031 L847,297.375 L837,307.375 L758,307.375 L758,277.7031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="170.3594" style="stroke:#000000;stroke-width:1.5;" width="596.5" x="758" y="277.7031"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="773" y="301.541">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="210" x="862" y="302.541">[n times  (in parallel)]</text><polygon fill="#FAFAFA" points="778,325.0469,1040,325.0469,1050,356.0469,1040,388.0469,778,388.0469,768,356.0469,778,325.0469" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="780" y="351.8848">For each individual transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="780" y="379.5566">in bulk message</text><line style="stroke:#181818;stroke-width:1.0;" x1="1055.5" x2="1097.5" y1="427.0625" y2="427.0625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1097.5" x2="1097.5" y1="427.0625" y2="440.0625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1056.5" x2="1097.5" y1="440.0625" y2="440.0625"/><polygon fill="#181818" points="1066.5,436.0625,1056.5,440.0625,1066.5,444.0625,1062.5,440.0625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1062.5" y="420.2285">[2]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="250" x="1092.5" y="420.2285">validate MSISDN &amp; Prefix</text><polygon fill="#181818" points="1983.5,512.4063,1993.5,516.4063,1983.5,520.4063,1987.5,516.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1055.5" x2="1989.5" y1="516.4063" y2="516.4063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="1062.5" y="495.7363">[3]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="1092.5" y="481.9004">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="167" x="1160.5" y="481.9004">/bulkTransactions</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="621" x="1092.5" y="509.5723">(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES =</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1719.5" y="509.5723">false</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="211" x="1767.5" y="509.5723">, synchronous = false)</text><path d="M1787,531.4063 L1876,531.4063 L1876,551.0781 L1866,561.0781 L1787,561.0781 L1787,531.4063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="419.3906" style="stroke:#000000;stroke-width:1.5;" width="1163.5" x="1787" y="531.4063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1802" y="555.2441">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="545" x="1891" y="556.2441">[N times &amp; within bulkExpiration timelimit  (in parallel)]</text><polygon fill="#FAFAFA" points="1807,578.75,1975,578.75,1985,609.75,1975,641.75,1807,641.75,1797,609.75,1807,578.75" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="164" x="1809" y="605.5879">For each transfer</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1809" y="633.2598">in bulk message</text><polygon fill="#181818" points="2451.5,676.7656,2461.5,680.7656,2451.5,684.7656,2455.5,680.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2457.5" y1="680.7656" y2="680.7656"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2012.5" y="673.9316">[4]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="2042.5" y="673.9316">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="2095.5" y="673.9316">/parties/{Type}/{ID}/{SubId}</text><polygon fill="#181818" points="2016.5,718.4375,2006.5,722.4375,2016.5,726.4375,2012.5,722.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2010.5" x2="2462.5" y1="722.4375" y2="722.4375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2022.5" y="715.6035">[5]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2052.5" y="715.6035">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="764.1094" y2="764.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="764.1094" y2="777.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="777.1094" y2="777.1094"/><polygon fill="#181818" points="2474.5,773.1094,2464.5,777.1094,2474.5,781.1094,2470.5,777.1094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2470.5" y="757.2754">[6]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="353" x="2500.5" y="757.2754">Determine Payee DFSP using oracle</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="846.4531" y2="846.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="846.4531" y2="859.4531"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="859.4531" y2="859.4531"/><polygon fill="#181818" points="2474.5,855.4531,2464.5,859.4531,2474.5,863.4531,2470.5,859.4531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2470.5" y="825.7832">[7]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="438" x="2500.5" y="811.9473">Lookup Payee Information from Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2506.5" y="839.6191">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="47" x="2562.5" y="839.6191">GET</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="71" x="2615.5" y="839.6191">/parties</text><polygon fill="#181818" points="2016.5,897.125,2006.5,901.125,2016.5,905.125,2012.5,901.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2010.5" x2="2462.5" y1="901.125" y2="901.125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2022.5" y="894.291">[8]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2052.5" y="894.291">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="258" x="2104.5" y="894.291">/parties/{Type}/{ID}/{SubId}</text><polygon fill="#181818" points="2451.5,938.7969,2461.5,942.7969,2451.5,946.7969,2455.5,942.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2005.5" x2="2457.5" y1="942.7969" y2="942.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="26" x="2012.5" y="935.9629">[9]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2042.5" y="935.9629">HTTP 200 Response</text><rect fill="#FAFAFA" height="35" style="stroke:#181818;stroke-width:0.5;" width="132" x="1853" y="962.7969"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="124" x="1857" y="989.6348">Accept Party</text><path d="M1736,1010.4688 L1825,1010.4688 L1825,1030.1406 L1815,1040.1406 L1736,1040.1406 L1736,1010.4688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="584.0781" style="stroke:#000000;stroke-width:1.5;" width="1085.5" x="1736" y="1010.4688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1751" y="1034.3066">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="729" x="1840" y="1035.3066">[Quote Processing (M times &amp; within bulkExpiration timelimit in parallel)]</text><polygon fill="#FAFAFA" points="1756,1057.8125,1975,1057.8125,1985,1088.8125,1975,1120.8125,1756,1120.8125,1746,1088.8125,1756,1057.8125" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="215" x="1758" y="1084.6504">For each payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1758" y="1112.3223">in bulk message</text><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2047.5" y1="1159.8281" y2="1159.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="2047.5" x2="2047.5" y1="1159.8281" y2="1172.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="2006.5" x2="2047.5" y1="1172.8281" y2="1172.8281"/><polygon fill="#181818" points="2016.5,1168.8281,2006.5,1172.8281,2016.5,1176.8281,2012.5,1172.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="1152.9941">[10]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="199" x="2054.5" y="1152.9941">Check bulkExpiration</text><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2047.5" y1="1214.5" y2="1214.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="2047.5" x2="2047.5" y1="1214.5" y2="1227.5"/><line style="stroke:#181818;stroke-width:1.0;" x1="2006.5" x2="2047.5" y1="1227.5" y2="1227.5"/><polygon fill="#181818" points="2016.5,1223.5,2006.5,1227.5,2016.5,1231.5,2012.5,1227.5" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="1207.666">[11]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="239" x="2054.5" y="1207.666">Create bulkTransactionId</text><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2047.5" y1="1324.5156" y2="1324.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="2047.5" x2="2047.5" y1="1324.5156" y2="1337.5156"/><line style="stroke:#181818;stroke-width:1.0;" x1="2006.5" x2="2047.5" y1="1337.5156" y2="1337.5156"/><polygon fill="#181818" points="2016.5,1333.5156,2006.5,1337.5156,2016.5,1341.5156,2012.5,1337.5156" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="1290.0098">[12]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="194" x="2054.5" y="1262.3379">Calculate bulk expiry</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="391" x="2054.5" y="1290.0098">based on both expirySeconds config and</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="133" x="2054.5" y="1317.6816">bulkExpiration</text><polygon fill="#181818" points="2451.5,1375.1875,2461.5,1379.1875,2451.5,1383.1875,2455.5,1379.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2457.5" y1="1379.1875" y2="1379.1875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="1372.3535">[13]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2054.5" y="1372.3535">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="2122.5" y="1372.3535">/bulkquotes</text><polygon fill="#181818" points="2016.5,1416.8594,2006.5,1420.8594,2016.5,1424.8594,2012.5,1420.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2010.5" x2="2462.5" y1="1420.8594" y2="1420.8594"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2022.5" y="1414.0254">[14]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2064.5" y="1414.0254">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="1490.2031" y2="1490.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="1490.2031" y2="1503.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="1503.2031" y2="1503.2031"/><polygon fill="#181818" points="2474.5,1499.2031,2464.5,1503.2031,2474.5,1507.2031,2470.5,1503.2031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2470.5" y="1469.5332">[15]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="297" x="2512.5" y="1455.6973">Pass on quote to Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2518.5" y="1483.3691">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2574.5" y="1483.3691">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="108" x="2642.5" y="1483.3691">/bulkquotes</text><polygon fill="#181818" points="2016.5,1540.875,2006.5,1544.875,2016.5,1548.875,2012.5,1544.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2010.5" x2="2462.5" y1="1544.875" y2="1544.875"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2022.5" y="1538.041">[16]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2064.5" y="1538.041">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="146" x="2116.5" y="1538.041">/bulkquotes/{Id}</text><polygon fill="#181818" points="2451.5,1582.5469,2461.5,1586.5469,2451.5,1590.5469,2455.5,1586.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2005.5" x2="2457.5" y1="1586.5469" y2="1586.5469"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="1579.7129">[17]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2054.5" y="1579.7129">HTTP 200 Response</text><polygon fill="#181818" points="1066.5,1631.2188,1056.5,1635.2188,1066.5,1639.2188,1062.5,1635.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.5" x2="1989.5" y1="1635.2188" y2="1635.2188"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1072.5" y="1628.3848">[18]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="1114.5" y="1628.3848">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="1166.5" y="1628.3848">/bulkTransactions/{Id}</text><polygon fill="#181818" points="126.5,1672.8906,116.5,1676.8906,126.5,1680.8906,122.5,1676.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="120.5" x2="1054.5" y1="1676.8906" y2="1676.8906"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="132.5" y="1670.0566">[19]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="174.5" y="1670.0566">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="226.5" y="1670.0566">/bulkTransactions/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="157.5" y1="1718.5625" y2="1718.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.5" x2="157.5" y1="1718.5625" y2="1731.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="157.5" y1="1731.5625" y2="1731.5625"/><polygon fill="#181818" points="126.5,1727.5625,116.5,1731.5625,126.5,1735.5625,122.5,1731.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="122.5" y="1711.7285">[20]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="494" x="164.5" y="1711.7285">Obtain concent from Payer on Fees and Payee Info</text><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="157.5" y1="1773.2344" y2="1773.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.5" x2="157.5" y1="1773.2344" y2="1786.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="157.5" y1="1786.2344" y2="1786.2344"/><polygon fill="#181818" points="126.5,1782.2344,116.5,1786.2344,126.5,1790.2344,122.5,1786.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="122.5" y="1766.4004">[21]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="139" x="164.5" y="1766.4004">Reserve funds</text><polygon fill="#181818" points="1043.5,1823.9063,1053.5,1827.9063,1043.5,1831.9063,1047.5,1827.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="1049.5" y1="1827.9063" y2="1827.9063"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="122.5" y="1821.0723">[22]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="164.5" y="1821.0723">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="369" x="216.5" y="1821.0723">/bulkTransactions/{bulkhometransferId}</text><polygon fill="#181818" points="1983.5,1865.5781,1993.5,1869.5781,1983.5,1873.5781,1987.5,1869.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1055.5" x2="1989.5" y1="1869.5781" y2="1869.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1062.5" y="1862.7441">[23]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="1104.5" y="1862.7441">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="347" x="1156.5" y="1862.7441">/bulkTransactions/{bulktransactionId}</text><path d="M1736,1884.5781 L1825,1884.5781 L1825,1904.25 L1815,1914.25 L1736,1914.25 L1736,1884.5781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="474.0625" style="stroke:#000000;stroke-width:1.5;" width="1104.5" x="1736" y="1884.5781"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1751" y="1908.416">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="760" x="1840" y="1909.416">[Transfer Processing (M times &amp; within bulkExpiration timelimit  in parallel)]</text><polygon fill="#FAFAFA" points="1756,1931.9219,1975,1931.9219,1985,1962.9219,1975,1994.9219,1756,1994.9219,1746,1962.9219,1756,1931.9219" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="215" x="1758" y="1958.7598">For each payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="153" x="1758" y="1986.4316">in bulk message</text><polygon fill="#181818" points="2451.5,2029.9375,2461.5,2033.9375,2451.5,2037.9375,2455.5,2033.9375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2005.5" x2="2457.5" y1="2033.9375" y2="2033.9375"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="2027.1035">[24]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2054.5" y="2027.1035">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="2122.5" y="2027.1035">/bulktransfers</text><polygon fill="#181818" points="2016.5,2071.6094,2006.5,2075.6094,2016.5,2079.6094,2012.5,2075.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2010.5" x2="2462.5" y1="2075.6094" y2="2075.6094"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2022.5" y="2068.7754">[25]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="196" x="2064.5" y="2068.7754">HTTP 202 response</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="2117.2813" y2="2117.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="2117.2813" y2="2130.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="2130.2813" y2="2130.2813"/><polygon fill="#181818" points="2474.5,2126.2813,2464.5,2130.2813,2474.5,2134.2813,2470.5,2130.2813" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2470.5" y="2110.4473">[26]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="267" x="2512.5" y="2110.4473">Reserve Payer DFSP funds</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="2199.625" y2="2199.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="2199.625" y2="2212.625"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="2212.625" y2="2212.625"/><polygon fill="#181818" points="2474.5,2208.625,2464.5,2212.625,2474.5,2216.625,2470.5,2212.625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2470.5" y="2178.9551">[27]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="316" x="2512.5" y="2165.1191">Pass on transfer to Payee DFSP</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="50" x="2518.5" y="2192.791">using</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="62" x="2574.5" y="2192.791">POST</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="127" x="2642.5" y="2192.791">/bulktransfers</text><line style="stroke:#181818;stroke-width:1.0;" x1="2463.5" x2="2505.5" y1="2254.2969" y2="2254.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="2505.5" x2="2505.5" y1="2254.2969" y2="2267.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="2464.5" x2="2505.5" y1="2267.2969" y2="2267.2969"/><polygon fill="#181818" points="2474.5,2263.2969,2464.5,2267.2969,2474.5,2271.2969,2470.5,2267.2969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2470.5" y="2247.4629">[28]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="262" x="2512.5" y="2247.4629">Commit Payer DFSP funds</text><polygon fill="#181818" points="2016.5,2304.9688,2006.5,2308.9688,2016.5,2312.9688,2012.5,2308.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2010.5" x2="2462.5" y1="2308.9688" y2="2308.9688"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2022.5" y="2302.1348">[29]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="2064.5" y="2302.1348">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="165" x="2116.5" y="2302.1348">/bulktransfers/{Id}</text><polygon fill="#181818" points="2451.5,2346.6406,2461.5,2350.6406,2451.5,2354.6406,2455.5,2350.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2005.5" x2="2457.5" y1="2350.6406" y2="2350.6406"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="2012.5" y="2343.8066">[30]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="2054.5" y="2343.8066">HTTP 200 Response</text><polygon fill="#181818" points="1066.5,2395.3125,1056.5,2399.3125,1066.5,2403.3125,1062.5,2399.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060.5" x2="1989.5" y1="2399.3125" y2="2399.3125"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="1072.5" y="2392.4785">[31]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="1114.5" y="2392.4785">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="1166.5" y="2392.4785">/bulkTransactions/{Id}</text><polygon fill="#181818" points="126.5,2436.9844,116.5,2440.9844,126.5,2444.9844,122.5,2440.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="120.5" x2="1054.5" y1="2440.9844" y2="2440.9844"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="132.5" y="2434.1504">[32]</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="46" x="174.5" y="2434.1504">PUT</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="205" x="226.5" y="2434.1504">/bulkTransactions/{Id}</text><line style="stroke:#181818;stroke-width:1.0;" x1="115.5" x2="157.5" y1="2482.6563" y2="2482.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="157.5" x2="157.5" y1="2482.6563" y2="2495.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="116.5" x2="157.5" y1="2495.6563" y2="2495.6563"/><polygon fill="#181818" points="126.5,2491.6563,116.5,2495.6563,126.5,2499.6563,122.5,2495.6563" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="38" x="122.5" y="2475.8223">[33]</text><text fill="#000000" font-family="sans-serif" font-size="22" lengthAdjust="spacing" textLength="134" x="164.5" y="2475.8223">Commit funds</text><!--MD5=[279ae4fb56d86eff55c2d470330ffc37]
@startuml PayerDFSPBulkDoubleIntegrationApiPattern
/'*****
- - - - - - - - - - - - - -
******'/

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
' declare title
' title PayerDFSPBulkDoubleIntegrationApi
' declare actors
participant "Core banking solution" as CBS
box "Payment Manager\nPayer DFSP" #LightGrey
participant "Core\nConnector" as CC 
participant "Mojaloop\nConnector" as MC 
end box
participant "Mojaloop\nSwitch" as Switch
autonumber 1 1 "<b>[0]"

== Payer DFSP integration - 2 phase commit - with user confirmation ==

CBS->CC: **POST** /bulkTransactions\n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = **false**, synchronous = false)
Loop n times  (in parallel)
    hnote left of CC
        For each individual transfer
        in bulk message
    end hnote
    CC -> CC: validate MSISDN & Prefix
end Loop
CC->MC: **POST** /bulkTransactions\n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = **false**, synchronous = false)
activate MC
loop N times & within bulkExpiration timelimit  (in parallel)
hnote left of MC
        For each transfer
        in bulk message
end hnote
  activate MC
  MC->Switch: **GET** /parties/{Type}/{ID}/{SubId}
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Determine Payee DFSP using oracle
  Switch->Switch: Lookup Payee Information from Payee DFSP\n using **GET** /parties
  Switch->MC: **PUT** /parties/{Type}/{ID}/{SubId}
  MC- ->Switch: HTTP 200 Response
end Loop

rnote left MC
  Accept Party
endrnote

loop Quote Processing (M times & within bulkExpiration timelimit in parallel)
  hnote left of MC
          For each payee DFSP
          in bulk message
  end hnote
  MC->MC: Check bulkExpiration
  MC->MC: Create bulkTransactionId
  MC -> MC: Calculate bulk expiry \nbased on both expirySeconds config and \nbulkExpiration
  MC->Switch: **POST** /bulkquotes
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Pass on quote to Payee DFSP\n using **POST** /bulkquotes
  Switch->MC: **PUT** /bulkquotes/{Id}
  MC- ->Switch: HTTP 200 Response
end loop
  MC->CC: **PUT** /bulkTransactions/{Id}

  deactivate MC
  CC->CBS: **PUT** /bulkTransactions/{Id}


CBS->CBS: Obtain concent from Payer on Fees and Payee Info
CBS->CBS: Reserve funds
CBS->CC: **PUT** /bulkTransactions/{bulkhometransferId}
CC->MC: **PUT** /bulkTransactions/{bulktransactionId}

loop Transfer Processing (M times & within bulkExpiration timelimit  in parallel)
  hnote left of MC
        For each payee DFSP
        in bulk message
  end hnote

  activate MC
  MC->Switch: **POST** /bulktransfers
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Reserve Payer DFSP funds
  Switch->Switch: Pass on transfer to Payee DFSP\n using **POST** /bulktransfers
  Switch->Switch: Commit Payer DFSP funds
  Switch->MC: **PUT** /bulktransfers/{Id}
  MC- ->Switch: HTTP 200 Response
end loop  

MC->CC: **PUT** /bulkTransactions/{Id}

deactivate MC
CC->CBS: **PUT** /bulkTransactions/{Id}
CBS->CBS: Commit funds

@enduml

@startuml PayerDFSPBulkDoubleIntegrationApiPattern

skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 22
skinparam defaultFontSize 22
skinparam noteFontSize 22
skinparam monochrome true
participant "Core banking solution" as CBS
box "Payment Manager\nPayer DFSP" #LightGrey
participant "Core\nConnector" as CC 
participant "Mojaloop\nConnector" as MC 
end box
participant "Mojaloop\nSwitch" as Switch
autonumber 1 1 "<b>[0]"

== Payer DFSP integration - 2 phase commit - with user confirmation ==

CBS->CC: **POST** /bulkTransactions\n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = **false**, synchronous = false)
Loop n times  (in parallel)
    hnote left of CC
        For each individual transfer
        in bulk message
    end hnote
    CC -> CC: validate MSISDN & Prefix
end Loop
CC->MC: **POST** /bulkTransactions\n(AUTO_ACCEPT_PARTY = true, AUTO_ACCEPT_QUOTES = **false**, synchronous = false)
activate MC
loop N times & within bulkExpiration timelimit  (in parallel)
hnote left of MC
        For each transfer
        in bulk message
end hnote
  activate MC
  MC->Switch: **GET** /parties/{Type}/{ID}/{SubId}
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Determine Payee DFSP using oracle
  Switch->Switch: Lookup Payee Information from Payee DFSP\n using **GET** /parties
  Switch->MC: **PUT** /parties/{Type}/{ID}/{SubId}
  MC- ->Switch: HTTP 200 Response
end Loop

rnote left MC
  Accept Party
endrnote

loop Quote Processing (M times & within bulkExpiration timelimit in parallel)
  hnote left of MC
          For each payee DFSP
          in bulk message
  end hnote
  MC->MC: Check bulkExpiration
  MC->MC: Create bulkTransactionId
  MC -> MC: Calculate bulk expiry \nbased on both expirySeconds config and \nbulkExpiration
  MC->Switch: **POST** /bulkquotes
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Pass on quote to Payee DFSP\n using **POST** /bulkquotes
  Switch->MC: **PUT** /bulkquotes/{Id}
  MC- ->Switch: HTTP 200 Response
end loop
  MC->CC: **PUT** /bulkTransactions/{Id}

  deactivate MC
  CC->CBS: **PUT** /bulkTransactions/{Id}


CBS->CBS: Obtain concent from Payer on Fees and Payee Info
CBS->CBS: Reserve funds
CBS->CC: **PUT** /bulkTransactions/{bulkhometransferId}
CC->MC: **PUT** /bulkTransactions/{bulktransactionId}

loop Transfer Processing (M times & within bulkExpiration timelimit  in parallel)
  hnote left of MC
        For each payee DFSP
        in bulk message
  end hnote

  activate MC
  MC->Switch: **POST** /bulktransfers
  Switch- ->MC: HTTP 202 response
  Switch->Switch: Reserve Payer DFSP funds
  Switch->Switch: Pass on transfer to Payee DFSP\n using **POST** /bulktransfers
  Switch->Switch: Commit Payer DFSP funds
  Switch->MC: **PUT** /bulktransfers/{Id}
  MC- ->Switch: HTTP 200 Response
end loop  

MC->CC: **PUT** /bulkTransactions/{Id}

deactivate MC
CC->CBS: **PUT** /bulkTransactions/{Id}
CBS->CBS: Commit funds

@enduml

PlantUML version 1.2022.6(Tue Jun 21 18:34:49 BST 2022)
(GPLV2 source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>