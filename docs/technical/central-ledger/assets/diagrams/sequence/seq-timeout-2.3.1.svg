<svg xmlns="http://www.w3.org/2000/svg" height="1356" preserveAspectRatio="none" style="width:944px;height:1356px" width="944">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="283" x="328.5" y="28.708">
    2.3.1. Timeout Prepare Handler
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M26 40.953h784v1309.094H26z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="362.5" y="53.02">
    Central Service
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M85.5 134.68h10v1130.773h-10zM268.5 1220.453h10v30h-10zM504 339.875h10v166.797h-10zM504 582.07h10v150.797h-10zM753 369.008h10v30h-10zM753 611.203h10v92.531h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 141.68h920v1123.773H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M20 165.813h440v106.664H20zM20 286.477h857v228.195H20zM20 528.672h900v212.195H20zM20 754.867h330v503.586H20z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M90 124.68v1157.773M273 124.68v1157.773M400 124.68v1157.773M509 124.68v1157.773M758 124.68v1157.773"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="30" y="105.081">
    Timeout Prepare
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="61" y="121.378">
    Handler
  </text>
  <circle cx="90.5" cy="76.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M86.5 64.086l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="30" y="1294.448">
    Timeout Prepare
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="61" y="1310.745">
    Handler
  </text>
  <circle cx="90.5" cy="1330.047" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M86.5 1318.047l6-5-2 5 2 5-6-5z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M211 69.086h125v46.594H211z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M207 73.086h125v46.594H207z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="250" y="93.081">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="214" y="109.378">
    transfer-timeout
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M211 1281.453h125v46.594H211z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M207 1285.453h125v46.594H207z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="250" y="1305.448">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="214" y="1321.745">
    transfer-timeout
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M354 85.383h92v30.297h-92z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M350 89.383h92v30.297h-92z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="357" y="109.378">
    topic-event
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M354 1281.453h92v30.297h-92z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M350 1285.453h92v30.297h-92z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="357" y="1305.448">
    topic-event
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="460" y="121.378">
    Timeout DAO
  </text>
  <circle cx="509" cy="92.383" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M497 106.383h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="460" y="1294.448">
    Timeout DAO
  </text>
  <circle cx="509" cy="1313.75" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M497 1327.75h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="710" y="121.378">
    Central Store
  </text>
  <path d="M740 72.383c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M740 72.383c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="710" y="1294.448">
    Central Store
  </text>
  <path d="M740 1307.75c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M740 1307.75c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M85.5 134.68h10v1130.773h-10zM268.5 1220.453h10v30h-10zM504 339.875h10v166.797h-10zM504 582.07h10v150.797h-10zM753 369.008h10v30h-10zM753 611.203h10v92.531h-10z"/>
  <path d="M10 141.68h231v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 141.68h920v1123.773H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="186" x="25" y="154.747">
    Timeout Prepare Handler
  </text>
  <path d="M20 165.813h232v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 165.813h440v106.664H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="35" y="178.879">
    Persist Event Information
  </text>
  <path fill="#A80036" stroke="#a80036" d="M388 200.078l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M95.5 204.078H394"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="102.5" y="199.012">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="115.5" y="199.012">
    Publish event information
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M27 212.078h422v55.398H27z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M27 212.078h66v7l-10 10H27v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="40" y="226.145">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="162.5" y="245.145">
    Event Handler Consume
  </text>
  <path d="M20 286.477h105v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 286.477h857v228.195H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="35" y="299.543">
    Cleanup
  </text>
  <path fill="#A80036" stroke="#a80036" d="M492 335.875l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M95.5 339.875H498"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="102.5" y="327.243">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="115.5" y="319.676">
    Cleanup Fulfilled Transfers
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="115.5" y="334.809">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="201.5" y="334.809">
    2003
  </text>
  <path fill="#A80036" stroke="#a80036" d="M741 365.008l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M514 369.008h233"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="521" y="363.942">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="534" y="363.942">
    Delete fuflfilled transfers records
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M658 412.008h199l10 34-10 34H658l-10-34 10-34z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="660" y="428.075">
    DELETE et
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="660" y="443.207">
    FROM
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="700" y="443.207">
    expiringTransfer
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="825" y="443.207">
    et
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="660" y="458.34">
    JOIN
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="690" y="458.34">
    transferFulfilment
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="827" y="458.34">
    tf
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="660" y="473.473">
    ON tf.transferId = et.transferId
  </text>
  <path fill="#A80036" stroke="#a80036" d="M106.5 502.672l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M100.5 506.672H508"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="112.5" y="501.606">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="125.5" y="501.606">
    Return success
  </text>
  <path d="M20 528.672h132v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 528.672h900v212.195H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="35" y="541.739">
    List Expired
  </text>
  <path fill="#A80036" stroke="#a80036" d="M492 578.07l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M95.5 582.07H498"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="102.5" y="569.438">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="115.5" y="561.872">
    Retrieve Expired Transfers
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="115.5" y="577.004">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="201.5" y="577.004">
    2003
  </text>
  <path fill="#A80036" stroke="#a80036" d="M741 607.203l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M514 611.203h233"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="521" y="606.137">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="534" y="606.137">
    Select using index
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M616 624.203h284l10 26-10 27H616l-10-27 10-26z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="618" y="640.27">
    SELECT *
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="618" y="655.403">
    FROM
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="658" y="655.403">
    expiringTransfer
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="618" y="670.536">
    WHERE expirationDate &lt; currentTimestamp
  </text>
  <path fill="#A80036" stroke="#a80036" d="M525 699.734l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M519 703.734h238"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="531" y="698.668">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="544" y="698.668">
    Return expired transfers
  </text>
  <path fill="#A80036" stroke="#a80036" d="M106.5 728.867l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M100.5 732.867H508"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="112.5" y="727.801">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="125.5" y="727.801">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="171.5" y="727.801">
    expiredTransfersList
  </text>
  <path d="M20 754.867h77v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 754.867h330v503.586H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="35" y="767.934">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="112" y="767.078">
    [for each transfer in the list]
  </text>
  <path d="M100 802v373h236V812l-10-10H100" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M326 802v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="106" y="819.067">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="106" y="834.2">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="122" y="849.332">
    id: &lt;uuid&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="122" y="864.465">
    from: &lt;switch&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="122" y="879.598">
    to: &lt;payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="122" y="894.731">
    type: application/json
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="122" y="909.864">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="138" y="924.997">
    headers: null,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="138" y="940.129">
    payload: &lt;transfer&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="122" y="955.262">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="122" y="970.395">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="138" y="985.528">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="154" y="1000.661">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="154" y="1015.793">
    responseTo: null,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="154" y="1030.926">
    type: transfer,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="154" y="1046.059">
    action: timeout,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="154" y="1061.192">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="154" y="1076.325">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="170" y="1091.457">
    status: &quot;success&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="170" y="1106.59">
    code: 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="154" y="1121.723">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="138" y="1136.856">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="122" y="1151.989">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="106" y="1167.122">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M256.5 1216.453l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M95.5 1220.453h167"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="102.5" y="1207.821">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="115.5" y="1200.254">
    Publish Timeout event
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="115.5" y="1215.387">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="201.5" y="1215.387">
    2003
  </text>
</svg>
