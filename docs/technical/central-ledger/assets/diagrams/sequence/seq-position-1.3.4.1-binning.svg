<?xml version="1.0" encoding="us-ascii" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1574px" preserveAspectRatio="none" style="width:1952px;height:1574px;background:#FFFFFF;" version="1.1" viewBox="0 0 1952 1574" width="1952px" zoomAndPan="magnify">
  <defs/>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="275" x="835.75" y="27.9951">1.3.4.1. Position Messages Binning</text>
    <rect fill="#FFFFE0" height="1525.6406" style="stroke:#181818;stroke-width:0.5;" width="1900.5" x="46" y="43.2969"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="940.75" y="55.3638">Central Service</text>
    <rect fill="#FFFFFF" height="1386.9141" style="stroke:#181818;stroke-width:1.0;" width="10" x="104" y="120.7266"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123" y="585.1172"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1229.5" y="693.6484"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1349.5" y="802.1797"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1478" y="910.7109"/>
    <rect fill="none" height="1372.9141" style="stroke:#000000;stroke-width:1.5;" width="1815.5" x="10" y="127.7266"/>
    <rect fill="none" height="116.5313" style="stroke:#000000;stroke-width:1.5;" width="625" x="40" y="209.125"/>
    <rect fill="none" height="1153.9844" style="stroke:#000000;stroke-width:1.5;" width="1795.5" x="20" y="339.6563"/>
    <rect fill="none" height="661.3203" style="stroke:#000000;stroke-width:1.5;" width="1230" x="575.5" y="466.3203"/>
    <rect fill="none" height="315.8672" style="stroke:#000000;stroke-width:1.5;" width="342" x="30" y="1170.7734"/>
    <rect fill="none" height="101.3984" style="stroke:#000000;stroke-width:1.5;" width="322" x="40" y="1279.1719"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="109" x2="109" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="664.5" x2="664.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1127.5" x2="1127.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1234.5" x2="1234.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1354.5" x2="1354.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1482.5" x2="1482.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1609.5" x2="1609.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1736.5" x2="1736.5" y1="110.7266" y2="1517.6406"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1873.5" x2="1873.5" y1="110.7266" y2="1517.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="50" y="107.4248">Position Handler</text>
    <ellipse cx="109" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="105,66.4297,111,61.4297,109,66.4297,111,71.4297,105,66.4297" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="50" y="1529.6357">Position Handler</text>
    <ellipse cx="109" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="105,1536.9375,111,1531.9375,109,1536.9375,111,1541.9375,105,1536.9375" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="585.5" y="107.4248">Domain Bin Processor</text>
    <ellipse cx="665" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="653" x2="677" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="585.5" y="1529.6357">Domain Bin Processor</text>
    <ellipse cx="665" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="653" x2="677" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="1081.5" y="107.4248">Fulfil Domain</text>
    <ellipse cx="1128" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1116" x2="1140" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="1081.5" y="1529.6357">Fulfil Domain</text>
    <ellipse cx="1128" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1116" x2="1140" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="1184.5" y="107.4248">Abort Domain</text>
    <ellipse cx="1234.5" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1222.5" x2="1246.5" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="1184.5" y="1529.6357">Abort Domain</text>
    <ellipse cx="1234.5" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1222.5" x2="1246.5" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1294.5" y="107.4248">Timeout Domain</text>
    <ellipse cx="1354.5" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1342.5" x2="1366.5" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1294.5" y="1529.6357">Timeout Domain</text>
    <ellipse cx="1354.5" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1342.5" x2="1366.5" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1424.5" y="107.4248">Prepare Domain</text>
    <ellipse cx="1483" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1471" x2="1495" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1424.5" y="1529.6357">Prepare Domain</text>
    <ellipse cx="1483" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1471" x2="1495" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1551.5" y="107.4248">Transfer Facade</text>
    <ellipse cx="1610" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1598" x2="1622" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1551.5" y="1529.6357">Transfer Facade</text>
    <ellipse cx="1610" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1598" x2="1622" y1="1562.9375" y2="1562.9375"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1678.5" y="107.4248">Account Facade</text>
    <ellipse cx="1737" cy="78.4297" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1725" x2="1749" y1="92.4297" y2="92.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="1678.5" y="1529.6357">Account Facade</text>
    <ellipse cx="1737" cy="1548.9375" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <line style="stroke:#181818;stroke-width:0.5;" x1="1725" x2="1749" y1="1562.9375" y2="1562.9375"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="133" x="1809.5" y="75.4297"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="133" x="1805.5" y="79.4297"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="1812.5" y="99.4248">Notification-Topic</text>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="133" x="1809.5" y="1516.6406"/>
    <rect fill="#E2E2F0" height="30.2969" style="stroke:#181818;stroke-width:0.5;" width="133" x="1805.5" y="1520.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="1812.5" y="1540.6357">Notification-Topic</text>
    <rect fill="#FFFFFF" height="1386.9141" style="stroke:#181818;stroke-width:1.0;" width="10" x="104" y="120.7266"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1123" y="585.1172"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1229.5" y="693.6484"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1349.5" y="802.1797"/>
    <rect fill="#FFFFFF" height="79.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="1478" y="910.7109"/>
    <path d="M10,127.7266 L250,127.7266 L250,134.8594 L240,144.8594 L10,144.8594 L10,127.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1372.9141" style="stroke:#000000;stroke-width:1.5;" width="1815.5" x="10" y="127.7266"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195" x="25" y="140.7935">Position Handler Consume</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="181.125" y2="181.125"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="181.125" y2="194.125"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="194.125" y2="194.125"/>
    <polygon fill="#181818" points="125,190.125,115,194.125,125,198.125,121,194.125" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="121" y="168.4927">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="134" y="160.9263">Consumes messages from the Position topic</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="134" y="176.0591">and stores them in memory</text>
    <path d="M40,209.125 L117,209.125 L117,216.2578 L107,226.2578 L40,226.2578 L40,209.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="116.5313" style="stroke:#000000;stroke-width:1.5;" width="625" x="40" y="209.125"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="55" y="222.1919">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="189" x="132" y="221.3354">[for each message in the list]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="262.5234" y2="262.5234"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="262.5234" y2="275.5234"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="275.5234" y2="275.5234"/>
    <polygon fill="#181818" points="125,271.5234,115,275.5234,125,279.5234,121,275.5234" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="121" y="249.8911">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="519" x="134" y="242.3247">Assign message to account-bin by accountID and child action-bin by event-action</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="510" x="138" y="257.4575">(References to the messagses to be stored in bins, no duplication of messages)</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="304.6563" y2="304.6563"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="304.6563" y2="317.6563"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="317.6563" y2="317.6563"/>
    <polygon fill="#181818" points="125,313.6563,115,317.6563,125,321.6563,121,317.6563" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="121" y="299.5903">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="134" y="299.5903">Audit message</text>
    <path d="M20,339.6563 L193,339.6563 L193,346.7891 L183,356.7891 L20,356.7891 L20,339.6563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1153.9844" style="stroke:#000000;stroke-width:1.5;" width="1795.5" x="20" y="339.6563"/>
    <text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="128" x="35" y="352.7231">DB TRANSACTION</text>
    <polygon fill="#181818" points="653,373.9219,663,377.9219,653,381.9219,657,377.9219" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="659" y1="377.9219" y2="377.9219"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="121" y="372.856">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="134" y="372.856">Call Bin Processor with the list of account-bins</text>
    <polygon fill="#181818" points="1598,403.0547,1608,407.0547,1598,411.0547,1602,407.0547" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1604" y1="407.0547" y2="407.0547"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="672" y="401.9888">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="506" x="685" y="401.9888">Pre Bulk fetch all transferStateChanges for all the transferIds in the account-bin</text>
    <polygon fill="#181818" points="1725,447.3203,1735,451.3203,1725,455.3203,1729,451.3203" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1731" y1="451.3203" y2="451.3203"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="672" y="438.688">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="503" x="685" y="431.1216">Pre Bulk fetch all position and settlement account balances for the account-bin</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="685" y="446.2544">Acquire lock on position</text>
    <path d="M575.5,466.3203 L652.5,466.3203 L652.5,473.4531 L642.5,483.4531 L575.5,483.4531 L575.5,466.3203 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="661.3203" style="stroke:#000000;stroke-width:1.5;" width="1230" x="575.5" y="466.3203"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="590.5" y="479.3872">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="208" x="667.5" y="478.5308">[for each account-bin in the list]</text>
    <path d="M670,488.4531 L670,558.4531 L1285,558.4531 L1285,498.4531 L1275,488.4531 L670,488.4531 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1275,488.4531 L1275,498.4531 L1285,498.4531 L1275,488.4531 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="676" y="505.52">Note</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="711" y="505.52">: Order of processing for various actions</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="676" y="520.6528">1. Fulfil - Work in progress is first priority</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="594" x="676" y="535.7856">2. Abort &amp; Timeout - Freeing funds for future transfers is priority before tackling new requests</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="676" y="550.9185">3. Prepare - Processing new requests is last priority</text>
    <polygon fill="#181818" points="1111,581.1172,1121,585.1172,1111,589.1172,1115,585.1172" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1117" y1="585.1172" y2="585.1172"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="672" y="580.0513">7</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="685" y="580.0513">Process Fulfil Bin</text>
    <path d="M670,598.1172 L670,638.1172 L1127,638.1172 L1127,608.1172 L1117,598.1172 L670,598.1172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1117,598.1172 L1117,608.1172 L1127,608.1172 L1117,598.1172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="431" x="676" y="615.1841">Input: Bin, Pre-fetched account balances and transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="676" y="630.3169">Output: Accumulated changes in position and transferStateChanges</text>
    <polygon fill="#181818" points="676,660.5156,666,664.5156,676,668.5156,672,664.5156" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="670" x2="1127" y1="664.5156" y2="664.5156"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="682" y="659.4497">8</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="695" y="659.4497">Result</text>
    <polygon fill="#181818" points="1217.5,689.6484,1227.5,693.6484,1217.5,697.6484,1221.5,693.6484" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1223.5" y1="693.6484" y2="693.6484"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="672" y="688.5825">9</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="685" y="688.5825">Process Abort Bin</text>
    <path d="M670,706.6484 L670,746.6484 L1199,746.6484 L1199,716.6484 L1189,706.6484 L670,706.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1189,706.6484 L1189,716.6484 L1199,716.6484 L1189,706.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="508" x="676" y="723.7153">Input: Bin, previously accumulated account balances and transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="676" y="738.8481">Output: Accumulated changes in position and transferStateChanges</text>
    <polygon fill="#181818" points="676,769.0469,666,773.0469,676,777.0469,672,773.0469" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="670" x2="1233.5" y1="773.0469" y2="773.0469"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="682" y="767.981">10</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="704" y="767.981">Result</text>
    <polygon fill="#181818" points="1337.5,798.1797,1347.5,802.1797,1337.5,806.1797,1341.5,802.1797" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1343.5" y1="802.1797" y2="802.1797"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="797.1138">11</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="694" y="797.1138">Process Timeout Bin</text>
    <path d="M670,815.1797 L670,855.1797 L1199,855.1797 L1199,825.1797 L1189,815.1797 L670,815.1797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1189,815.1797 L1189,825.1797 L1199,825.1797 L1189,815.1797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="508" x="676" y="832.2466">Input: Bin, previously accumulated account balances and transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="676" y="847.3794">Output: Accumulated changes in position and transferStateChanges</text>
    <polygon fill="#181818" points="676,877.5781,666,881.5781,676,885.5781,672,881.5781" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="670" x2="1353.5" y1="881.5781" y2="881.5781"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="682" y="876.5122">12</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="704" y="876.5122">Result</text>
    <polygon fill="#181818" points="1466,906.7109,1476,910.7109,1466,914.7109,1470,910.7109" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1472" y1="910.7109" y2="910.7109"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="905.645">13</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="694" y="905.645">Process Prepare Batch</text>
    <path d="M670,923.7109 L670,963.7109 L1199,963.7109 L1199,933.7109 L1189,923.7109 L670,923.7109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M1189,923.7109 L1189,933.7109 L1199,933.7109 L1189,923.7109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="508" x="676" y="940.7778">Input: Bin, previously accumulated account balances and transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="676" y="955.9106">Output: Accumulated changes in position and transferStateChanges</text>
    <polygon fill="#181818" points="676,986.1094,666,990.1094,676,994.1094,672,990.1094" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="670" x2="1482" y1="990.1094" y2="990.1094"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="682" y="985.0435">14</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="704" y="985.0435">Result</text>
    <polygon fill="#181818" points="1598,1015.2422,1608,1019.2422,1598,1023.2422,1602,1019.2422" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1604" y1="1019.2422" y2="1019.2422"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="1014.1763">15</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="694" y="1014.1763">Bulk insert accumulated transferStateChanges</text>
    <polygon fill="#181818" points="1598,1044.375,1608,1048.375,1598,1052.375,1602,1048.375" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1604" y1="1048.375" y2="1048.375"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="1043.3091">16</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="459" x="694" y="1043.3091">Bulk get the transferStateChangeIds for transferids using select whereIn</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="707" y1="1077.5078" y2="1077.5078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="707" x2="707" y1="1077.5078" y2="1090.5078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="666" x2="707" y1="1090.5078" y2="1090.5078"/>
    <polygon fill="#181818" points="676,1086.5078,666,1090.5078,676,1094.5078,672,1090.5078" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="1072.4419">17</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="427" x="694" y="1072.4419">Mutate accumulated positionChanges with transferStateChangeIds</text>
    <polygon fill="#181818" points="1725,1115.6406,1735,1119.6406,1725,1123.6406,1729,1119.6406" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="665" x2="1731" y1="1119.6406" y2="1119.6406"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="672" y="1114.5747">18</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="694" y="1114.5747">Bulk insert accumulated positionChanges</text>
    <polygon fill="#181818" points="125,1151.7734,115,1155.7734,125,1159.7734,121,1155.7734" style="stroke:#181818;stroke-width:1.0;"/>
    <line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="119" x2="664" y1="1155.7734" y2="1155.7734"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="131" y="1150.7075">19</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="153" y="1150.7075">Return bins with results</text>
    <path d="M30,1170.7734 L94,1170.7734 L94,1177.9063 L84,1187.9063 L30,1187.9063 L30,1170.7734 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="315.8672" style="stroke:#000000;stroke-width:1.5;" width="342" x="30" y="1170.7734"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="1183.8403">alt</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="94" x="109" y="1182.9839">[return is true]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1209.0391" y2="1209.0391"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1209.0391" y2="1222.0391"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1222.0391" y2="1222.0391"/>
    <polygon fill="#181818" points="125,1218.0391,115,1222.0391,125,1226.0391,121,1222.0391" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1203.9731">20</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="143" y="1203.9731">Commit Kafka Offset</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1251.1719" y2="1251.1719"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1251.1719" y2="1264.1719"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1264.1719" y2="1264.1719"/>
    <polygon fill="#181818" points="125,1260.1719,115,1264.1719,125,1268.1719,121,1264.1719" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1246.106">21</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="143" y="1246.106">Commit DB Transaction</text>
    <path d="M40,1279.1719 L117,1279.1719 L117,1286.3047 L107,1296.3047 L40,1296.3047 L40,1279.1719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="101.3984" style="stroke:#000000;stroke-width:1.5;" width="322" x="40" y="1279.1719"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="55" y="1292.2388">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="225" x="132" y="1291.3823">[for each result in the account-bin]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1317.4375" y2="1317.4375"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1317.4375" y2="1330.4375"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1330.4375" y2="1330.4375"/>
    <polygon fill="#181818" points="125,1326.4375,115,1330.4375,125,1334.4375,121,1330.4375" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1312.3716">22</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="143" y="1312.3716">Produce notification message</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1359.5703" y2="1359.5703"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1359.5703" y2="1372.5703"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1372.5703" y2="1372.5703"/>
    <polygon fill="#181818" points="125,1368.5703,115,1372.5703,125,1376.5703,121,1372.5703" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1354.5044">23</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="143" y="1354.5044">Audit notification</text>
    <line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="372" y1="1388.5703" y2="1388.5703"/>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="256" x="35" y="1398.7808">[return is false or unhandled exception]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1423.5078" y2="1423.5078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1423.5078" y2="1436.5078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1436.5078" y2="1436.5078"/>
    <polygon fill="#181818" points="125,1432.5078,115,1436.5078,125,1440.5078,121,1436.5078" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1418.4419">24</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="143" y="1418.4419">Rollback DB Transaction</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="114" x2="156" y1="1465.6406" y2="1465.6406"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="156" x2="156" y1="1465.6406" y2="1478.6406"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="115" x2="156" y1="1478.6406" y2="1478.6406"/>
    <polygon fill="#181818" points="125,1474.6406,115,1478.6406,125,1482.6406,121,1478.6406" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="121" y="1460.5747">25</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="143" y="1460.5747">Audit error</text>
  </g>
</svg>
