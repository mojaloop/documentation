<svg xmlns="http://www.w3.org/2000/svg" height="5051" preserveAspectRatio="none" style="width:2402px;height:5051px" width="2402">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="868" x="765" y="28.708">
    1.3.1. Prepare Position Handler Consume (single message, includes individual transfers from Bulk)
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M36 40.953h2099v5004.078H36z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="1030" y="53.02">
    Central Service
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M94 150.977h10v4800.164H94zM542 3899.164h10v30h-10zM542 4899.141h10v30h-10zM667 3332.109h10v30h-10zM667 4422.883h10v30h-10zM792 196.242h10V2303.93h-10zM1684 2507.664h10v175.664h-10zM2078 379.172h10v77.398h-10zM2078 848.227h10v62.266h-10zM2078 996.891h10v30h-10zM2078 1104.289h10v107.664h-10zM2078 1802.672h10v30h-10zM2078 1925.203h10v30h-10zM2078 2204.664h10v30h-10zM2078 2591.063h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 157.977h2378v2604.617H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M738.5 253.375H2378v2022.422H738.5zM20 2318.93h2162v436.664H20z"/>
  <path fill="#FFF" d="M20 2393.328h2162v362.266H20z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M30 2454.266h2142v237.063H30zM20 2776.594h738.5v1167.57H20z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M30 2800.727h718.5v1136.438H30z"/>
  <path fill="#FFF" d="M30 3370.109h718.5v567.055H30z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M20 3958.164h738.5v985.977H20z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M30 3982.297h718.5v954.844H30z"/>
  <path fill="#FFF" d="M30 4460.883h718.5v476.258H30z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M99 140.977v4820.164M546.5 140.977v4820.164M671.5 140.977v4820.164M796.5 140.977v4820.164M1689 140.977v4820.164M2083 140.977v4820.164"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="40" y="137.675">
    Position Handler
  </text>
  <circle cx="99" cy="108.68" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M95 96.68l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="40" y="4973.136">
    Position Handler
  </text>
  <circle cx="99" cy="4992.438" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M95 4980.438l6-5-2 5 2 5-6-5z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M502.5 85.383h89v46.594h-89z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M498.5 89.383h89v46.594h-89z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="523.5" y="109.378">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="505.5" y="125.675">
    notification
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M502.5 4960.141h89v46.594h-89z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M498.5 4964.141h89v46.594h-89z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="523.5" y="4984.136">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="505.5" y="5000.433">
    notification
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M609.5 85.383h125v46.594h-125z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M605.5 89.383h125v46.594h-125z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="648.5" y="109.378">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="612.5" y="125.675">
    bulk-processing
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M609.5 4960.141h125v46.594h-125z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M605.5 4964.141h125v46.594h-125z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="648.5" y="4984.136">
    topic-
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="612.5" y="5000.433">
    bulk-processing
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="766.5" y="105.081">
    Position
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="748.5" y="121.378">
    Management
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="769" y="137.675">
    Facade
  </text>
  <circle cx="797" cy="76.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M785 90.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="766.5" y="4973.136">
    Position
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="91" x="748.5" y="4989.433">
    Management
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="769" y="5005.73">
    Facade
  </text>
  <circle cx="797" cy="5025.031" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M785 5039.031h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1641" y="137.675">
    Position DAO
  </text>
  <circle cx="1689" cy="108.68" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1677 122.68h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1641" y="4973.136">
    Position DAO
  </text>
  <circle cx="1689" cy="4992.438" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1677 5006.438h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2035" y="137.675">
    Central Store
  </text>
  <path d="M2065 88.68c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M2065 88.68c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2035" y="4973.136">
    Central Store
  </text>
  <path d="M2065 4986.438c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M2065 4986.438c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M94 150.977h10v4800.164H94zM542 3899.164h10v30h-10zM542 4899.141h10v30h-10zM667 3332.109h10v30h-10zM667 4422.883h10v30h-10zM792 196.242h10V2303.93h-10zM1684 2507.664h10v175.664h-10zM2078 379.172h10v77.398h-10zM2078 848.227h10v62.266h-10zM2078 996.891h10v30h-10zM2078 1104.289h10v107.664h-10zM2078 1802.672h10v30h-10zM2078 1925.203h10v30h-10zM2078 2204.664h10v30h-10zM2078 2591.063h10v30h-10z"/>
  <path d="M10 157.977h304v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 157.977h2378v2604.617H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="259" x="25" y="171.043">
    Prepare Position Handler Consume
  </text>
  <path fill="#A80036" stroke="#a80036" d="M780 192.242l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 196.242h682"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="111" y="191.176">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="124" y="191.176">
    Request transfers to be processed
  </text>
  <path stroke="#a80036" d="M802 225.375h42M844 225.375v13M803 238.375h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 234.375l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="220.309">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="822" y="220.309">
    Check 1st transfer to select the Participant and Currency
  </text>
  <path d="M738.5 253.375h173v7l-10 10h-163v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M738.5 253.375H2378v2022.422H738.5z"/>
  <text fill="#00F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="753.5" y="266.442">
    DB TRANSACTION
  </text>
  <path stroke="#a80036" d="M802 321.906h42M844 321.906v13M803 334.906h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 330.906l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="301.707">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="529" x="822" y="286.575">
    Loop through batch and build list of transferIds and calculate sumTransfersInBatch,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="822" y="301.707">
    checking all in Batch are for the correct Paricipant and Currency
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="822" y="316.84">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="908" y="316.84">
    2001, 3100
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 375.172l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 379.172h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="366.54">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="467" x="822" y="358.973">
    Retrieve current state of all transfers in array from DB with select whereIn
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1244" x="822" y="374.106">
    (FYI: The two DB transaction model needs to add a mini-state step here (RECEIVED_PREPARE =&gt; RECEIVDED_PREPARE_PROCESSING) so that the transfers are left alone if processing has started)
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M2014 392.172h138l10 19-10 19h-138l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="2016" y="408.239">
    transferStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2016" y="423.372">
    transferParticipant
  </text>
  <path fill="#A80036" stroke="#a80036" d="M813 452.57l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M807 456.57h1275"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="819" y="451.504">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="832" y="451.504">
    Return current state of all selected transfers from DB
  </text>
  <path stroke="#a80036" d="M802 515.969h42M844 515.969v13M803 528.969h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 524.969l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="495.77">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="550" x="822" y="480.637">
    Validate current state (transferStateChange.transferStateId == &apos;RECEIVED_PREPARE&apos;)
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="822" y="495.77">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="908" y="495.77">
    2001
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="944" y="495.77">
    against failing transfers
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="822" y="510.903">
    Batch is not rejected as a whole.
  </text>
  <path d="M807 541.969v221h1516v-211l-10-10H807" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M2313 541.969v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="813" y="559.036">
    List of transfers used during processing
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="813" y="574.168">
    reservedTransfers
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="951" y="574.168">
    is list of transfers to be processed in the batch
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="813" y="589.301">
    abortedTransfers
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1212" x="945" y="589.301">
    is the list of transfers in the incorrect state going into the process. Currently the transferStateChange is set to ABORTED - this should only be done if not already in a final state (idempotency)
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="813" y="604.434">
    processedTransfers
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1345" x="963" y="604.434">
    is the list of transfers that have gone through the position management algorithm. Both successful and failed trasnfers appear here as the order and &quot;running position&quot; against each is necessary for reconciliation
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="813" y="634.7">
    Scalar intermidate values used in the algorithm
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="813" y="649.832">
    transferAmount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="933" y="649.832">
    = payload.amount.amount
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="813" y="664.965">
    sumTransfersInBatch
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="972" y="664.965">
    = SUM amount against each Transfer in batch
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="813" y="680.098">
    currentPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="929" y="680.098">
    = participantPosition.value
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="813" y="695.231">
    reservedPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="941" y="695.231">
    = participantPosition.{original}reservedValue
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="813" y="710.364">
    effectivePosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="941" y="710.364">
    = currentPosition + reservedPosition
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="813" y="725.497">
    heldPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="908" y="725.497">
    = effectivePosition + sumTransfersInBatch
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="813" y="740.629">
    availablePosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="942" y="740.629">
    = participantLimit(NetDebitCap) - effectivePosition
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="813" y="755.762">
    sumReserved
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="917" y="755.762">
    = SUM of transfers that have met rule criteria and processed
  </text>
  <path d="M751 777.828v40h1377v-30l-10-10H751" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M2118 777.828v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="768" x="1049.25" y="794.895">
    Going to reserve the sum of the valid transfers in the batch against the Participants Positon in the Currency of this batch
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="386" x="1049.25" y="810.028">
    and calculate the available position for the Participant to use
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 844.227l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 848.227h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="843.161">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="822" y="843.161">
    Select effectivePosition FOR UPDATE from DB for Payer
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M2022 861.227h122l10 11-10 12h-122l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2024" y="877.293">
    participantPosition
  </text>
  <path fill="#A80036" stroke="#a80036" d="M813 906.492l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M807 910.492h1275"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="819" y="905.426">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="516" x="832" y="905.426">
    Return effectivePosition (currentPosition and reservedPosition) from DB for Payer
  </text>
  <path stroke="#a80036" d="M802 954.758h42M844 954.758v13M803 967.758h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 963.758l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="942.125">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="822" y="934.559">
    Increment reservedValue to heldPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="822" y="949.692">
    (reservedValue = reservedPosition + sumTransfersInBatch)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 992.89l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 996.891h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="991.825">
    10
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="831" y="991.825">
    Persist reservedValue
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1938 1039.89h289l10 19-10 19h-289l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1940" y="1055.957">
    UPDATE
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="1996" y="1055.957">
    participantPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="1940" y="1071.09">
    SET reservedValue += sumTransfersInBatch
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 1100.29l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 1104.289h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1099.223">
    11
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="831" y="1099.223">
    Request position limits for Payer Participant
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1889 1117.29h388l10 34-10 34h-388l-10-34 10-34z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1891" y="1133.356">
    FROM
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="1931" y="1133.356">
    participantLimit
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="1891" y="1148.489">
    WHERE participantLimit.limitTypeId = &apos;NET-DEBIT-CAP&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="1891" y="1163.622">
    AND participantLimit.participantId = payload.payerFsp
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="1891" y="1178.754">
    AND participantLimit.currencyId = payload.amount.currency
  </text>
  <path fill="#A80036" stroke="#a80036" d="M813 1207.953l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M807 1211.953h1275"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="819" y="1206.887">
    12
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="841" y="1206.887">
    Return position limits
  </text>
  <path stroke="#a80036" d="M802 1241.086h42M844 1241.086v13M803 1254.086h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 1250.086l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1236.02">
    13
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="831" y="1236.02">
    availablePosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="717" x="960" y="1236.02">
    = participantLimit(netDebitCap) - effectivePosition (same as = netDebitCap - currentPosition - reservedPosition)
  </text>
  <path d="M751 1267.086v40h1377v-30l-10-10H751" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M2118 1267.086v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="603" x="1131.75" y="1284.153">
    For each transfer in the batch, validate the availablility of position to meet the transfer amount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="1131.75" y="1299.286">
    this will be as per the position algorithm documented below
  </text>
  <path stroke="#a80036" d="M802 1352.617h42M844 1352.617v13M803 1365.617h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 1361.617l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1339.985">
    14
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="831" y="1332.418">
    Validate availablePosition for each tranfser (see algorithm below)
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="831" y="1347.551">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="917" y="1347.551">
    4001
  </text>
  <path d="M807 1378.617v267h1401v-257l-10-10H807" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M2198 1378.617v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="579" x="813" y="1395.684">
    01: sumReserved = 0 // Record the sum of the transfers we allow to progress to RESERVED
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="563" x="813" y="1410.817">
    02: sumProcessed =0 // Record the sum of the transfers already processed in this batch
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1090" x="813" y="1425.95">
    03: processedTransfers = {} // The list of processed transfers - so that we can store the additional information around the decision. Most importantly the &quot;running&quot; position
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="813" y="1441.082">
    04: foreach transfer in reservedTransfers
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="829" y="1456.215">
    05: sumProcessed += transfer.amount // the total processed so far
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="1265" y="1456.215">
    (NEED TO UPDATE IN CODE)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="829" y="1471.348">
    06: if availablePosition &gt;= transfer.amount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="845" y="1486.481">
    07: transfer.state = &quot;RESERVED&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="845" y="1501.614">
    08: availablePosition -= preparedTransfer.amount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="845" y="1516.747">
    09: sumRESERVED += preparedTransfer.amount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="829" y="1531.879">
    10: else
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="845" y="1547.012">
    11: preparedTransfer.state = &quot;ABORTED&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="686" x="845" y="1562.145">
    12: preparedTransfer.reason = &quot;Net Debit Cap exceeded by this request at this time, please try again later&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="829" y="1577.278">
    13: end if
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1031" x="829" y="1592.411">
    14: runningPosition = currentPosition + sumReserved // the initial value of the Participants position plus the total value that has been accepted in the batch so far
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="553" x="829" y="1607.543">
    15: runningReservedValue = sumTransfersInBatch - sumProcessed + reservedPosition
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="1386" y="1607.543">
    (NEED TO UPDATE IN CODE)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="1595" y="1607.543">
    // the running down of the total reserved value at the begining of the batch.
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1364" x="829" y="1622.676">
    16: Add transfer to the processedTransfer list recording the transfer state and running position and reserved values { transferState, transfer, rawMessage, transferAmount, runningPosition, runningReservedValue }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="813" y="1637.809">
    16: end foreach
  </text>
  <path d="M751 1659.875v55h1377v-45l-10-10H751" fill="#FBFB77" filter="url(#a)" stroke="#a80036"/>
  <path d="M2118 1659.875v10h10l-10-10" fill="#FBFB77" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="874" x="836.25" y="1676.942">
    Once the outcome for all transfers is known,update the Participant&apos;s position and remove the reserved amount associated with the batch
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="654" x="836.25" y="1692.075">
    (If there are any alarm limits, process those returning limits in which the threshold has been breached)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1194" x="836.25" y="1707.207">
    Do a bulk insert of the trasnferStateChanges associated with processing, using the result to complete the participantPositionChange and bulk insert of these to persist the running position
  </text>
  <path stroke="#a80036" d="M802 1760.539h42M844 1760.539v13M803 1773.539h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 1769.54l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1747.907">
    15
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="831" y="1740.34">
    Assess any limit thresholds on the final position
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="831" y="1755.473">
    adding to alarm list if triggered
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 1798.672l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 1802.672h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1797.606">
    16
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="831" y="1797.606">
    Persist latest position
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="972" y="1797.606">
    value
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1015" y="1797.606">
    and
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="1043" y="1797.606">
    reservedValue
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1153" y="1797.606">
    to DB for Payer
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1955 1845.672h255l10 26-10 27h-255l-10-27 10-26z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1957" y="1861.739">
    UPDATE
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="2013" y="1861.739">
    participantPosition
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="1957" y="1876.872">
    SET value += sumRESERVED,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="1957" y="1892.004">
    reservedValue -= sumTransfersInBatch
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 1921.203l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 1925.203h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="1920.137">
    17
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="831" y="1920.137">
    Bulk persist transferStateChange for all processedTransfers
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1808 1968.203h550l10 34-10 34h-550l-10-34 10-34z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="1810" y="1984.27">
    batch INSERT
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="1899" y="1984.27">
    transferStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="546" x="1810" y="1999.403">
    select for update from transfer table where transferId in ([transferBatch.transferId,...])
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="1810" y="2014.536">
    build list of transferStateChanges from transferBatch
  </text>
  <path stroke="#a80036" d="M802 2062.867h42M844 2062.867v13M803 2075.867h41"/>
  <path fill="#A80036" stroke="#a80036" d="M813 2071.867l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="2057.801">
    18
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="762" x="831" y="2057.801">
    Populate batchParticipantPositionChange from the resultant transferStateChange and the earlier processedTransfer list
  </text>
  <path d="M807 2088.867v85h500v-75l-10-10H807" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1297 2088.867v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="813" y="2105.934">
    Effectively:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="829" y="2121.067">
    SET transferStateChangeId = processedTransfer.transferStateChangeId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="829" y="2136.2">
    participantPositionId = preparedTransfer.participantPositionId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="829" y="2151.332">
    value = preparedTransfer.positionValue,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="829" y="2166.465">
    reservedValue = preparedTransfer.positionReservedValue
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 2200.664l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M802 2204.664h1270"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="2199.598">
    19
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444" x="831" y="2199.598">
    Bulk persist the participant position change for all processedTransfers
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1914 2247.664h337l10 11-10 12h-337l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="1916" y="2263.731">
    batch INSERT
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="2005" y="2263.731">
    participantPositionChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M115 2299.93l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M109 2303.93h687"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="121" y="2298.864">
    20
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="143" y="2298.864">
    Return a map of transferIds and their transferStateChanges
  </text>
  <path d="M20 2318.93h64v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 2318.93h2162v436.664H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="35" y="2331.997">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="361" x="99" y="2331.14">
    [Calculate &amp; Validate Latest Position Prepare (success)]
  </text>
  <path stroke="#a80036" d="M104 2372.328h42M146 2372.328v13M105 2385.328h41"/>
  <path fill="#A80036" stroke="#a80036" d="M115 2381.328l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="2359.696">
    21
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="133" y="2352.129">
    Notifications for Position Validation Success
  </text>
  <text fill="#F0F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="402" x="133" y="2367.262">
    Reference: Position Validation Success case (Prepare)
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M20 2394.328h2162"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="352" x="25" y="2404.539">
    [Calculate &amp; Validate Latest Position Prepare (failure)]
  </text>
  <path d="M109 2413.133v25h132v-15l-10-10H109" fill="red" filter="url(#a)" stroke="#a80036"/>
  <path d="M231 2413.133v10h10l-10-10" fill="red" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="115" y="2430.2">
    Validation failure!
  </text>
  <path d="M30 2454.266h608v7l-10 10H30v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M30 2454.266h2142v237.063H30z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="563" x="45" y="2467.332">
    Persist Transfer State (with transferState=&apos;ABORTED&apos; on position check fail)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1672 2503.664l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 2507.664h1574"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="2495.032">
    22
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="133" y="2487.465">
    Request to persist transfer
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="133" y="2502.598">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="219" y="2502.598">
    2003
  </text>
  <path d="M109 2520.664v40h707v-30l-10-10H109" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M806 2520.664v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="115" y="2537.731">
    transferStateChange.state = &quot;ABORTED&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="686" x="115" y="2552.864">
    transferStateChange.reason = &quot;Net Debit Cap exceeded by this request at this time, please try again later&quot;
  </text>
  <path fill="#A80036" stroke="#a80036" d="M2066 2587.063l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1694 2591.063h378"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1701" y="2585.997">
    23
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1723" y="2585.997">
    Persist transfer state
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M2014 2634.063h138l10 11-10 12h-138l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="2016" y="2650.129">
    transferStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M115 2679.328l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M109 2683.328h1579"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="121" y="2678.262">
    24
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="143" y="2678.262">
    Return success
  </text>
  <path stroke="#a80036" d="M104 2734.594h42M146 2734.594v13M105 2747.594h41"/>
  <path fill="#A80036" stroke="#a80036" d="M115 2743.594l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="2721.961">
    25
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="133" y="2714.395">
    Notifications for failures
  </text>
  <text fill="#F0F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="372" x="133" y="2729.528">
    Reference: Failure in Position Validation (Prepare)
  </text>
  <path d="M20 2776.594h417v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 2776.594h738.5v1167.57H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="372" x="35" y="2789.661">
    Reference: Failure in Position Validation (Prepare)
  </text>
  <path d="M30 2800.727h64v7l-10 10H30v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M30 2800.727h718.5v1136.438H30z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="45" y="2813.794">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="109" y="2812.937">
    [If action == &apos;bulk-prepare&apos;]
  </text>
  <path d="M109 2822.86v463h424v-453l-10-10H109" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M523 2822.86v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="115" y="2839.926">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="2855.059">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="147" y="2870.192">
    id: &quot;&lt;messageId&gt;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="147" y="2885.325">
    from: &lt;ledgerName&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="147" y="2900.457">
    to: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="147" y="2915.59">
    type: &quot;application/json&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="147" y="2930.723">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="163" y="2945.856">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="163" y="2960.989">
    payload: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="179" y="2976.122">
    &quot;errorInformation&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="195" y="2991.254">
    &quot;errorCode&quot;: 4001,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="195" y="3006.387">
    &quot;errorDescription&quot;: &quot;Payer FSP insufficient liquidity&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="195" y="3021.52">
    &quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="3036.653">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="147" y="3051.786">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="147" y="3066.919">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="163" y="3082.051">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="3097.184">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="179" y="3112.317">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="179" y="3127.45">
    type: &quot;bulk-processing&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="179" y="3142.582">
    action: &quot;bulk-prepare&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="179" y="3157.715">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="179" y="3172.848">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="195" y="3187.981">
    status: &quot;error&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="195" y="3203.114">
    code: &lt;errorInformation.errorCode&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="195" y="3218.247">
    description: &lt;errorInformation.errorDescription&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="179" y="3233.379">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="3248.512">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="147" y="3263.645">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="3278.778">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M655 3328.11l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 3332.109h557"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="3319.477">
    26
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="490" x="133" y="3311.911">
    Publish Position failure event (in Prepare) to Bulk Processing Topic (for Payer)
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="133" y="3327.044">
    Error codes:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="227" y="3327.044">
    2003
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M30 3371.109h718.5"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="35" y="3381.32">
    [If action == &apos;prepare&apos;]
  </text>
  <path d="M109 3389.914v463h424v-453l-10-10H109" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M523 3389.914v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="115" y="3406.981">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="3422.114">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="147" y="3437.247">
    id: &quot;&lt;messageId&gt;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="147" y="3452.379">
    from: &lt;ledgerName&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="147" y="3467.512">
    to: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="147" y="3482.645">
    type: &quot;application/json&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="147" y="3497.778">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="163" y="3512.911">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="163" y="3528.044">
    payload: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="179" y="3543.176">
    &quot;errorInformation&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="195" y="3558.309">
    &quot;errorCode&quot;: 4001,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="195" y="3573.442">
    &quot;errorDescription&quot;: &quot;Payer FSP insufficient liquidity&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="195" y="3588.575">
    &quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="3603.707">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="147" y="3618.84">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="147" y="3633.973">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="163" y="3649.106">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="3664.239">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="179" y="3679.372">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="179" y="3694.504">
    type: &quot;notification&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="179" y="3709.637">
    action: &quot;position&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="179" y="3724.77">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="179" y="3739.903">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="195" y="3755.036">
    status: &quot;error&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="195" y="3770.169">
    code: &lt;errorInformation.errorCode&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="195" y="3785.301">
    description: &lt;errorInformation.errorDescription&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="179" y="3800.434">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="3815.567">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="147" y="3830.7">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="3845.832">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M530 3895.164l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 3899.164h432"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="3886.532">
    27
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="133" y="3878.965">
    Publish Notification (failure) event for Payer
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="133" y="3894.098">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="219" y="3894.098">
    2003
  </text>
  <path d="M20 3958.164h447v7l-10 10H20v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M20 3958.164h738.5v985.977H20z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="402" x="35" y="3971.231">
    Reference: Position Validation Success case (Prepare)
  </text>
  <path d="M30 3982.297h64v7l-10 10H30v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M30 3982.297h718.5v954.844H30z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="45" y="3995.364">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="109" y="3994.507">
    [If action == &apos;bulk-prepare&apos;]
  </text>
  <path d="M109 4004.43v373h286v-363l-10-10H109" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M385 4004.43v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="115" y="4021.497">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="4036.629">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="147" y="4051.762">
    id: &quot;&lt;messageId&gt;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="147" y="4066.895">
    from: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="147" y="4082.028">
    to: &lt;transferMessage.payeeFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="147" y="4097.161">
    type: &quot;application/json&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="147" y="4112.293">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="163" y="4127.426">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="163" y="4142.559">
    payload: &lt;transferMessage&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="147" y="4157.692">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="147" y="4172.825">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="163" y="4187.958">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="4203.09">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="179" y="4218.223">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="179" y="4233.356">
    type: &quot;bulk-processing&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="179" y="4248.489">
    action: &quot;bulk-prepare&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="179" y="4263.622">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="179" y="4278.754">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="195" y="4293.887">
    status: &quot;success&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="195" y="4309.02">
    code: 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="179" y="4324.153">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="4339.286">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="147" y="4354.418">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="4369.551">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M655 4418.883l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 4422.883h557"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="4410.251">
    28
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="133" y="4402.684">
    Publish Position Success event (in Prepare) to Bulk Processing Topic
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="133" y="4417.817">
    Error codes:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="227" y="4417.817">
    2003
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M30 4461.883h718.5"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="35" y="4472.093">
    [If action == &apos;prepare&apos;]
  </text>
  <path d="M109 4480.688v373h286v-363l-10-10H109" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M385 4480.688v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="115" y="4497.754">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="4512.887">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="147" y="4528.02">
    id: &quot;&lt;messageId&gt;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="147" y="4543.153">
    from: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="147" y="4558.286">
    to: &lt;transferMessage.payeeFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="147" y="4573.418">
    type: &quot;application/json&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="147" y="4588.551">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="163" y="4603.684">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="163" y="4618.817">
    payload: &lt;transferMessage&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="147" y="4633.95">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="147" y="4649.083">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="163" y="4664.215">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="4679.348">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="179" y="4694.481">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="179" y="4709.614">
    type: &quot;notification&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="179" y="4724.747">
    action: &quot;abort&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="179" y="4739.879">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="179" y="4755.012">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="195" y="4770.145">
    status: &quot;success&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="195" y="4785.278">
    code: 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="179" y="4800.411">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="163" y="4815.543">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="147" y="4830.676">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="131" y="4845.809">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M530 4895.14l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M104 4899.141h432"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="111" y="4886.508">
    29
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="133" y="4878.942">
    Publish Notification event
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="133" y="4894.075">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="219" y="4894.075">
    2003
  </text>
</svg>
