<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="5893px" preserveAspectRatio="none" style="width:3972px;height:5893px;background:#FFFFFF;" version="1.1" viewBox="0 0 3972 5893" width="3972px" zoomAndPan="magnify"><defs/><g><rect height="26.2969" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="169" x="1897.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159" x="1902.5" y="27.9951">Settlement Process</text><rect height="309.4375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1300" x="2169.5" y="1095.3594"/><rect height="361.4375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="716.5" x="2169.5" y="1418.7969"/><rect height="629.8125" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1947.5" x="1385.5" y="1794.2344"/><rect height="223.625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="677.5" x="2169.5" y="1844.1094"/><rect height="2720.625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2579.5" x="1375.5" y="2966.1094"/><rect height="511" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1641.5" x="2159.5" y="3015.9844"/><rect height="182.625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1300" x="2169.5" y="3065.8594"/><rect height="497" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1919.5" x="1560" y="3540.9844"/><rect height="112.75" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1300" x="2169.5" y="3590.8594"/><rect height="752.5625" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1939.5" x="1550" y="4051.9844"/><rect height="695.6875" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1919.5" x="1560" y="4101.8594"/><rect height="367.3125" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1300" x="2169.5" y="4221.6094"/><rect height="420.125" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2559.5" x="1385.5" y="4818.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="176" x2="176" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="465" x2="465" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="743.5" x2="743.5" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1506.5" x2="1506.5" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2268.5" x2="2268.5" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="3039.5" x2="3039.5" y1="130.2344" y2="5801.5469"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="3399.5" x2="3399.5" y1="130.2344" y2="5801.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="336" x="5" y="124.5742">Business Hub Operator User</text><ellipse cx="176" cy="50.7969" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M176,58.7969 L176,85.7969 M163,66.7969 L189,66.7969 M176,85.7969 L163,100.7969 M176,85.7969 L189,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="336" x="5" y="5822.8242">Business Hub Operator User</text><ellipse cx="176" cy="5836.9844" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M176,5844.9844 L176,5871.9844 M163,5852.9844 L189,5852.9844 M176,5871.9844 L163,5886.9844 M176,5871.9844 L189,5886.9844 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="357" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="364" y="116.5742">Settlement Bank</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="357" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="364" y="5829.8242">Settlement Bank</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="649.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="656.5" y="116.5742">Micro-frontend</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="649.5" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="656.5" y="5829.8242">Micro-frontend</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="223" x="1395.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="209" x="1402.5" y="116.5742">Experience Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="223" x="1395.5" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="209" x="1402.5" y="5829.8242">Experience Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2179.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="165" x="2186.5" y="116.5742">Process Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2179.5" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="165" x="2186.5" y="5829.8242">Process Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="2970.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="125" x="2977.5" y="116.5742">Report API</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="2970.5" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="125" x="2977.5" y="5829.8242">Report API</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="3340.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="105" x="3347.5" y="116.5742">Mojaloop</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="3340.5" y="5800.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="105" x="3347.5" y="5829.8242">Mojaloop</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="3965" x="0" y="167.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3965" y1="167.2031" y2="167.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="3965" y1="170.2031" y2="170.2031"/><rect fill="#EEEEEE" height="35.9375" style="stroke:#000000;stroke-width:2.0;" width="292" x="1836.5" y="150.2344"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="270" x="1842.5" y="176.5117">Finalise Settlement</text><polygon fill="#181818" points="187,368.7969,177,372.7969,187,376.7969,183,372.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="181" x2="464.5" y1="372.7969" y2="372.7969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="193" y="365.1367">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="214" y="365.1367"> </text><path d="M470,201.1719 L470,518.1719 L1156,518.1719 L1156,211.1719 L1146,201.1719 L470,201.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1146,201.1719 L1146,211.1719 L1156,211.1719 L1146,201.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="45" x="476" y="228.4492">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="233" x="529" y="228.4492">Settlement Bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="274" x="770" y="228.4492">has completed making</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="378" x="476" y="256.3867">transfers between participants.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="45" x="476" y="284.3242">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="247" x="529" y="284.3242">finalisation report</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="253" x="784" y="284.3242">that is recieved from</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="657" x="476" y="312.2617">the Settlement Bank, includes the settlement account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="641" x="476" y="340.1992">balances after all the transfers have been processed.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="476" y="368.1367"> </text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="590" x="476" y="396.0742">It is possible that these account balances are not</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="488" x="476" y="424.0117">as expected. This would indicate that an</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="136" x="972" y="424.0117">additional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="1108" y="424.0117"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="264" x="476" y="451.9492">funds in / funds out</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="363" x="748" y="451.9492">has occured in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="567" x="476" y="479.8867">accounts that has not yet been captured in the</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="354" x="476" y="507.8242">Mojaloop Settlement ledgers.</text><polygon fill="#181818" points="732,553.4219,742,557.4219,732,561.4219,736,557.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176" x2="738" y1="557.4219" y2="557.4219"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="183" y="549.7617">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="283" x="203" y="549.7617">Validate finalisation file</text><polygon fill="#181818" points="1495,595.3594,1505,599.3594,1495,603.3594,1499,599.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="744" x2="1501" y1="599.3594" y2="599.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="751" y="591.6992">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="325" x="772" y="591.6992">POST: /settlements:finalize</text><line style="stroke:#181818;stroke-width:1.0;" x1="1507" x2="1549" y1="847.3281" y2="847.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1549" x2="1549" y1="847.3281" y2="860.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1508" x2="1549" y1="860.3281" y2="860.3281"/><polygon fill="#181818" points="1518,856.3281,1508,860.3281,1518,864.3281,1514,860.3281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="1514" y="825.6992">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="307" x="1535" y="811.7305">Fatal: Validate file format</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="305" x="1543" y="839.668">Load file into JSON object</text><path d="M483,612.3594 L483,1041.3594 L1502,1041.3594 L1502,622.3594 L1492,612.3594 L483,612.3594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1492,612.3594 L1492,622.3594 L1502,622.3594 L1492,612.3594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="489" y="639.6367">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="873" x="505" y="667.5742">"finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="635" x="505" y="695.5117">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="197" x="505" y="723.4492">"participants" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="521" y="751.3867">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="686" x="537" y="779.3242">"name": "payerfsp",# mojaloop participant name (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="488" x="537" y="807.2617">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="905" x="537" y="835.1992">"settlementAccountId": 1, # settlement account id for participant (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="950" x="537" y="863.1367">"externalBalance": 10000, # external balance of settlement account (number)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="323" x="537" y="891.0742">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="284" x="585" y="919.0117">"amount": 0, # number</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="634" x="585" y="946.9492">"currency": "XXX" # currency string (CurrencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="569" y="974.8867">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="686" x="521" y="1002.8242">}  ] # all participants that are involved in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="489" y="1030.7617">}</text><polygon fill="#181818" points="2257,1076.3594,2267,1080.3594,2257,1084.3594,2261,1080.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1507" x2="2263" y1="1080.3594" y2="1080.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="1514" y="1072.6992">5</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="274" x="1534" y="1072.6992">Validate finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="325" x="1816" y="1072.6992">POST: /settlements:finalize</text><path d="M2169.5,1095.3594 L2504.5,1095.3594 L2504.5,1115.2969 L2494.5,1125.2969 L2169.5,1125.2969 L2169.5,1095.3594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="309.4375" style="stroke:#000000;stroke-width:1.5;" width="1300" x="2169.5" y="1095.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="290" x="2184.5" y="1118.6367">load settlement data</text><polygon fill="#181818" points="3388,1183.1719,3398,1187.1719,3388,1191.1719,3392,1187.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="1187.1719" y2="1187.1719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="2276" y="1165.543">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="331" x="2296" y="1151.5742">Get settlement information</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="583" x="2296" y="1179.5117">GET central-settlements/settlements/{id}</text><polygon fill="#181818" points="3388,1253.0469,3398,1257.0469,3388,1261.0469,3392,1257.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="1257.0469" y2="1257.0469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="2276" y="1235.418">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="229" x="2297" y="1221.4492">Get all participants</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2297" y="1249.3867"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="430" x="2305" y="1249.3867">GET central-ledger/participants</text><polygon fill="#181818" points="3388,1322.9219,3398,1326.9219,3388,1330.9219,3392,1326.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="1326.9219" y2="1326.9219"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="2276" y="1305.293">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="304" x="2296" y="1291.3242">Get all participants limits</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2296" y="1319.2617"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="516" x="2304" y="1319.2617">GET central-ledger/participants/limits</text><polygon fill="#181818" points="3388,1392.7969,3398,1396.7969,3388,1400.7969,3392,1396.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="1396.7969" y2="1396.7969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="2276" y="1375.168">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="491" x="2297" y="1361.1992">For each participant get account balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2297" y="1389.1367"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="679" x="2305" y="1389.1367">GET central-ledger/participants/{name}/accounts</text><path d="M2169.5,1418.7969 L2461.5,1418.7969 L2461.5,1438.7344 L2451.5,1448.7344 L2169.5,1448.7344 L2169.5,1418.7969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="361.4375" style="stroke:#000000;stroke-width:1.5;" width="716.5" x="2169.5" y="1418.7969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="247" x="2184.5" y="1442.0742">Process validation</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="1538.5469" y2="1538.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="1538.5469" y2="1551.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="1551.5469" y2="1551.5469"/><polygon fill="#181818" points="2280,1547.5469,2270,1551.5469,2280,1555.5469,2276,1551.5469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="1502.9492">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="438" x="2314" y="1475.0117">Fatal: Validate Participants and their</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="360" x="2322" y="1502.9492">accounts ids are valid, match,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="560" x="2314" y="1530.8867">and are the correct type, and correct currency</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="1593.4844" y2="1593.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="1593.4844" y2="1606.4844"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="1606.4844" y2="1606.4844"/><polygon fill="#181818" points="2280,1602.4844,2270,1606.4844,2280,1610.4844,2276,1606.4844" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="1585.8242">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="519" x="2314" y="1585.8242">Fatal: Validate Settlement Id non-matching</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="1676.3594" y2="1676.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="1676.3594" y2="1689.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="1689.3594" y2="1689.3594"/><polygon fill="#181818" points="2280,1685.3594,2270,1689.3594,2280,1693.3594,2276,1689.3594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="1654.7305">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="514" x="2313" y="1640.7617">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="240" x="2313" y="1668.6992">transfer sum is zero</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="1759.2344" y2="1759.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="1759.2344" y2="1772.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="1772.2344" y2="1772.2344"/><polygon fill="#181818" points="2280,1768.2344,2270,1772.2344,2280,1776.2344,2276,1772.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="1737.6055">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="514" x="2314" y="1723.6367">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="392" x="2314" y="1751.5742">matches net settlement amount</text><path d="M1385.5,1794.2344 L1467.5,1794.2344 L1467.5,1814.1719 L1457.5,1824.1719 L1385.5,1824.1719 L1385.5,1794.2344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="629.8125" style="stroke:#000000;stroke-width:1.5;" width="1947.5" x="1385.5" y="1794.2344"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="1400.5" y="1817.5117">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="265" x="1482.5" y="1818.5117">[Success/Warnings]</text><path d="M2169.5,1844.1094 L2717.5,1844.1094 L2717.5,1864.0469 L2707.5,1874.0469 L2169.5,1874.0469 L2169.5,1844.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="223.625" style="stroke:#000000;stroke-width:1.5;" width="677.5" x="2169.5" y="1844.1094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="503" x="2184.5" y="1867.3867">Calculate Adjustments and Warnings</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="1963.8594" y2="1963.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="1963.8594" y2="1976.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="1976.8594" y2="1976.8594"/><polygon fill="#181818" points="2280,1972.8594,2270,1976.8594,2280,1980.8594,2276,1976.8594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="1928.2617">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="504" x="2314" y="1900.3242">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="240" x="2314" y="1928.2617">balance is expected</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="513" x="2322" y="1956.1992">Return warnings if there are discrepencies</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="2046.7344" y2="2046.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="2046.7344" y2="2059.7344"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="2059.7344" y2="2059.7344"/><polygon fill="#181818" points="2280,2055.7344,2270,2059.7344,2280,2063.7344,2276,2059.7344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="2025.1055">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="504" x="2313" y="2011.1367">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="313" x="2313" y="2039.0742">balance is zero or positive</text><polygon fill="#181818" points="1518,2163.5469,1508,2167.5469,1518,2171.5469,1514,2167.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1512" x2="2268" y1="2167.5469" y2="2167.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1524" y="2159.8867">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="434" x="1561" y="2159.8867">Return finalisation validation results</text><path d="M2274,2079.7344 L2274,2228.7344 L3318,2228.7344 L3318,2089.7344 L3308,2079.7344 L2274,2079.7344 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3308,2079.7344 L3308,2089.7344 L3318,2089.7344 L3308,2079.7344 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="2107.0117">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="614" x="2296" y="2134.9492">"finalisationId": "GUIDv4", # Guid version 4 (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="586" x="2296" y="2162.8867">"valid":true # (boolean) true if none failure error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="999" x="2304" y="2190.8242">"warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="2218.7617">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1385.5" x2="3333" y1="2235.4219" y2="2235.4219"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="90" x="1390.5" y="2257.6992">[Error]</text><polygon fill="#181818" points="1518,2367.1406,1508,2371.1406,1518,2375.1406,1514,2371.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1512" x2="2268" y1="2371.1406" y2="2371.1406"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="1524" y="2349.5117">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="299" x="1562" y="2335.543">Return Error, HTTP: code</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="1562" y="2363.4805"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="646" x="1570" y="2363.4805">Ref: Finalize Settlement Validation Error Codes</text><path d="M2274,2269.3594 L2274,2418.3594 L3273,2418.3594 L3273,2279.3594 L3263,2269.3594 L2274,2269.3594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3263,2269.3594 L3263,2279.3594 L3273,2279.3594 L3263,2269.3594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="2296.6367">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="614" x="2296" y="2324.5742">"finalisationId": "GUIDv4", # Guid version 4 (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="486" x="2296" y="2352.5117">"valid":false, # (boolean) false if failures</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="962" x="2296" y="2380.4492">"errors": [{"type": "string", "message": "description", "errorInformation": {...}}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="2408.3867">}</text><polygon fill="#181818" points="755,2460.9844,745,2464.9844,755,2468.9844,751,2464.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="749" x2="1506" y1="2464.9844" y2="2464.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="761" y="2457.3242">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="370" x="798" y="2457.3242">Show validation results to user</text><polygon fill="#181818" points="187,2502.9219,177,2506.9219,187,2510.9219,183,2506.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="181" x2="743" y1="2506.9219" y2="2506.9219"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="193" y="2499.2617">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="231" y="2499.2617"> </text><polygon fill="#181818" points="732,2544.8594,742,2548.8594,732,2552.8594,736,2548.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="176" x2="738" y1="2548.8594" y2="2548.8594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="183" y="2541.1992">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="507" x="220" y="2541.1992">User confirms proceeding with finalisation</text><polygon fill="#181818" points="1495,2645.6719,1505,2649.6719,1495,2653.6719,1499,2649.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="744" x2="1501" y1="2649.6719" y2="2649.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="751" y="2642.0117">21</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="273" x="788" y="2642.0117">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="421" x="1069" y="2642.0117">POST: /settlements:confirmFinalize</text><path d="M59,2561.8594 L59,2710.8594 L739,2710.8594 L739,2571.8594 L729,2561.8594 L59,2561.8594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M729,2561.8594 L729,2571.8594 L739,2571.8594 L729,2561.8594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="65" y="2589.1367">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="375" x="81" y="2617.0742">finalisationId:"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="635" x="81" y="2645.0117">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="522" x="81" y="2672.9492">balanceSettlementOption: true # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="65" y="2700.8867">}</text><polygon fill="#181818" points="2257,2819.3281,2267,2823.3281,2257,2827.3281,2261,2823.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1507" x2="2263" y1="2823.3281" y2="2823.3281"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="32" x="1514" y="2815.668">22</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="273" x="1550" y="2815.668">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="421" x="1831" y="2815.668">POST: /settlements:confirmFinalize</text><path d="M822,2721.5469 L822,2898.5469 L1502,2898.5469 L1502,2731.5469 L1492,2721.5469 L822,2721.5469 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1492,2721.5469 L1492,2731.5469 L1502,2731.5469 L1492,2721.5469 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="828" y="2748.8242">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="397" x="844" y="2776.7617">"finalisationId":"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="635" x="844" y="2804.6992">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="544" x="844" y="2832.6367">"balanceSettlementOption":true, # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="350" x="844" y="2860.5742">"user":"userName" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="828" y="2888.5117">}</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="2938.1094" y2="2938.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="2938.1094" y2="2951.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="2951.1094" y2="2951.1094"/><polygon fill="#181818" points="2280,2947.1094,2270,2951.1094,2280,2955.1094,2276,2951.1094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="2930.4492">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="720" x="2313" y="2930.4492">validate finalisationId and settlementId against stored state</text><path d="M1375.5,2966.1094 L1457.5,2966.1094 L1457.5,2986.0469 L1447.5,2996.0469 L1375.5,2996.0469 L1375.5,2966.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="2720.625" style="stroke:#000000;stroke-width:1.5;" width="2579.5" x="1375.5" y="2966.1094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="1390.5" y="2989.3867">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="275" x="1472.5" y="2990.3867">[Validation Success]</text><path d="M2159.5,3015.9844 L2261.5,3015.9844 L2261.5,3035.9219 L2251.5,3045.9219 L2159.5,3045.9219 L2159.5,3015.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="511" style="stroke:#000000;stroke-width:1.5;" width="1641.5" x="2159.5" y="3015.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="57" x="2174.5" y="3039.2617">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="535" x="2276.5" y="3040.2617">[for each settlement debit participant]</text><path d="M2169.5,3065.8594 L2251.5,3065.8594 L2251.5,3085.7969 L2241.5,3095.7969 L2169.5,3095.7969 L2169.5,3065.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="182.625" style="stroke:#000000;stroke-width:1.5;" width="1300" x="2169.5" y="3065.8594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="2184.5" y="3089.1367">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="500" x="2266.5" y="3090.1367">[if balanceSettlementOption is true]</text><polygon fill="#181818" points="3388,3166.6094,3398,3170.6094,3388,3174.6094,3392,3170.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3170.6094" y2="3170.6094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="3148.9805">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="743" x="2313" y="3135.0117">Adjust settlment account according to settlement (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2313" y="3162.9492"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="765" x="2321" y="3162.9492">POST central-ledger/participants/{name}/accounts/{id}</text><polygon fill="#181818" points="3388,3236.4844,3398,3240.4844,3388,3244.4844,3392,3240.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3240.4844" y2="3240.4844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="32" x="2276" y="3218.8555">25</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="240" x="2312" y="3204.8867">Confirm adjustment</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2312" y="3232.8242"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="1063" x="2320" y="3232.8242">PUT central-ledger/participants/{name}/accounts/{id}/transfers/{transferId}</text><polygon fill="#181818" points="3388,3341.2969,3398,3345.2969,3388,3349.2969,3392,3345.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3345.2969" y2="3345.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="32" x="2276" y="3309.6992">26</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2312" y="3281.7617">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="422" x="2320" y="3309.6992">state to PS_TRANSFERS_COMMITED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2312" y="3337.6367"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="866" x="2320" y="3337.6367">PUT: central-settlements/settlements/{sid}/participants/{pid}</text><polygon fill="#181818" points="3388,3439.1094,3398,3443.1094,3388,3447.1094,3392,3443.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3443.1094" y2="3443.1094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="3407.5117">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2313" y="3379.5742">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="208" x="2321" y="3407.5117">state to SETTLED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2313" y="3435.4492"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="866" x="2321" y="3435.4492">PUT: central-settlements/settlements/{sid}/participants/{pid}</text><path d="M3405,3456.1094 L3405,3521.1094 L3791,3521.1094 L3791,3466.1094 L3781,3456.1094 L3405,3456.1094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3781,3456.1094 L3781,3466.1094 L3791,3466.1094 L3781,3456.1094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="130" x="3411" y="3483.3867">Net debit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="130" x="3549" y="3483.3867">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="349" x="3427" y="3511.3242">position ledgers are adjusted</text><path d="M1560,3540.9844 L1662,3540.9844 L1662,3560.9219 L1652,3570.9219 L1560,3570.9219 L1560,3540.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="497" style="stroke:#000000;stroke-width:1.5;" width="1919.5" x="1560" y="3540.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="57" x="1575" y="3564.2617">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="544" x="1677" y="3565.2617">[for each settlement credit participant]</text><path d="M2169.5,3590.8594 L2251.5,3590.8594 L2251.5,3610.7969 L2241.5,3620.7969 L2169.5,3620.7969 L2169.5,3590.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="112.75" style="stroke:#000000;stroke-width:1.5;" width="1300" x="2169.5" y="3590.8594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="2184.5" y="3614.1367">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="500" x="2266.5" y="3615.1367">[if balanceSettlementOption is true]</text><polygon fill="#181818" points="3388,3691.6094,3398,3695.6094,3388,3699.6094,3392,3695.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3695.6094" y2="3695.6094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="32" x="2276" y="3673.9805">28</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="722" x="2312" y="3660.0117">Adjust settlment account according to settlement (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2312" y="3687.9492"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="571" x="2320" y="3687.9492">POST /participants/{name}/accounts/{id}</text><path d="M1570,3715.6094 L1570,3836.6094 L2264,3836.6094 L2264,3725.6094 L2254,3715.6094 L1570,3715.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M2254,3715.6094 L2254,3725.6094 L2264,3725.6094 L2254,3715.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="405" x="1576" y="3742.8867">reason: "Settlement Finanisation"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="169" x="1576" y="3770.8242">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="457" x="1592" y="3798.7617">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="641" x="1608" y="3826.6992">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#181818" points="3388,3928.1719,3398,3932.1719,3388,3936.1719,3392,3932.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="3932.1719" y2="3932.1719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="3896.5742">29</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2313" y="3868.6367">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="422" x="2321" y="3896.5742">state to PS_TRANSFERS_COMMITED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2313" y="3924.5117"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="866" x="2321" y="3924.5117">PUT: central-settlements/settlements/{sid}/participants/{pid}</text><polygon fill="#181818" points="3388,4025.9844,3398,4029.9844,3388,4033.9844,3392,4029.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4029.9844" y2="4029.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="3994.3867">30</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2314" y="3966.4492">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="208" x="2322" y="3994.3867">state to SETTLED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2314" y="4022.3242"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="866" x="2322" y="4022.3242">PUT: central-settlements/settlements/{sid}/participants/{pid}</text><path d="M1550,4051.9844 L1632,4051.9844 L1632,4071.9219 L1622,4081.9219 L1550,4081.9219 L1550,4051.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="752.5625" style="stroke:#000000;stroke-width:1.5;" width="1939.5" x="1550" y="4051.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="1565" y="4075.2617">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="500" x="1647" y="4076.2617">[if balanceSettlementOption is true]</text><path d="M1560,4101.8594 L1662,4101.8594 L1662,4121.7969 L1652,4131.7969 L1560,4131.7969 L1560,4101.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="695.6875" style="stroke:#000000;stroke-width:1.5;" width="1919.5" x="1560" y="4101.8594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="57" x="1575" y="4125.1367">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="720" x="1677" y="4126.1367">[For each participant rebalance Settlement account]</text><polygon fill="#181818" points="3388,4202.6094,3398,4206.6094,3388,4210.6094,3392,4206.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4206.6094" y2="4206.6094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="4184.9805">31</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="220" x="2314" y="4171.0117">Get latest balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2314" y="4198.9492"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="679" x="2322" y="4198.9492">GET central-ledger/participants/{name}/accounts</text><path d="M2169.5,4221.6094 L2251.5,4221.6094 L2251.5,4241.5469 L2241.5,4251.5469 L2169.5,4251.5469 L2169.5,4221.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="367.3125" style="stroke:#000000;stroke-width:1.5;" width="1300" x="2169.5" y="4221.6094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="2184.5" y="4244.8867">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="477" x="2266.5" y="4245.8867">[if latest balance &lt; actual balance]</text><polygon fill="#181818" points="3388,4322.3594,3398,4326.3594,3388,4330.3594,3392,4326.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4326.3594" y2="4326.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="4304.7305">32</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="324" x="2313" y="4290.7617">Increase balance (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2313" y="4318.6992"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="765" x="2321" y="4318.6992">POST central-ledger/participants/{name}/accounts/{id}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2169.5" x2="3469.5" y1="4335.3594" y2="4335.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="477" x="2174.5" y="4357.6367">[if latest balance &gt; actual balance]</text><polygon fill="#181818" points="3388,4422.1719,3398,4426.1719,3388,4430.1719,3392,4426.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4426.1719" y2="4426.1719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="4404.543">33</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="356" x="2314" y="4390.5742">Decrease balance (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2314" y="4418.5117"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="765" x="2322" y="4418.5117">POST central-ledger/participants/{name}/accounts/{id}</text><polygon fill="#181818" points="3388,4492.0469,3398,4496.0469,3388,4500.0469,3392,4496.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4496.0469" y2="4496.0469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2276" y="4474.418">34</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="240" x="2314" y="4460.4492">Confirm adjustment</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2314" y="4488.3867"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="869" x="2322" y="4488.3867">PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2169.5" x2="3469.5" y1="4505.0469" y2="4505.0469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="498" x="2174.5" y="4527.3242">[if latest balance == actual balance]</text><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="2311" y1="4567.9219" y2="4567.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="2311" x2="2311" y1="4567.9219" y2="4580.9219"/><line style="stroke:#181818;stroke-width:1.0;" x1="2270" x2="2311" y1="4580.9219" y2="4580.9219"/><polygon fill="#181818" points="2280,4576.9219,2270,4580.9219,2280,4584.9219,2276,4580.9219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="4560.2617">35</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="128" x="2313" y="4560.2617">do nothing</text><path d="M1570,4600.9219 L1570,4721.9219 L2264,4721.9219 L2264,4610.9219 L2254,4600.9219 L1570,4600.9219 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M2254,4600.9219 L2254,4610.9219 L2264,4610.9219 L2254,4600.9219 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="386" x="1576" y="4628.1992">reason: "Settlement Rebalance"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="169" x="1576" y="4656.1367">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="457" x="1592" y="4684.0742">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="641" x="1608" y="4712.0117">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#181818" points="3388,4785.5469,3398,4789.5469,3388,4793.5469,3392,4789.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2269" x2="3394" y1="4789.5469" y2="4789.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="2276" y="4767.918">36</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="289" x="2313" y="4753.9492">Confirm correct balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2313" y="4781.8867"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="679" x="2321" y="4781.8867">GET central-ledger/participants/{name}/accounts</text><path d="M1385.5,4818.5469 L1467.5,4818.5469 L1467.5,4838.4844 L1457.5,4848.4844 L1385.5,4848.4844 L1385.5,4818.5469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="420.125" style="stroke:#000000;stroke-width:1.5;" width="2559.5" x="1385.5" y="4818.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="1400.5" y="4841.8242">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="283" x="1482.5" y="4842.8242">[Processing Success]</text><polygon fill="#181818" points="1518,4922.2969,1508,4926.2969,1518,4930.2969,1514,4926.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1512" x2="2268" y1="4926.2969" y2="4926.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="1524" y="4918.6367">37</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="355" x="1562" y="4918.6367">Response success, HTTP: 200</text><path d="M2274,4866.4219 L2274,4959.4219 L3090,4959.4219 L3090,4876.4219 L3080,4866.4219 L2274,4866.4219 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3080,4866.4219 L3080,4876.4219 L3090,4876.4219 L3080,4866.4219 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="4893.6992">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="779" x="2296" y="4921.6367">"settlement": {... map settlement object from settlements api }</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="4949.5742">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1385.5" x2="3945" y1="4966.2344" y2="4966.2344"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="244" x="1390.5" y="4988.5117">[Processing Error]</text><polygon fill="#181818" points="1518,5139.8594,1508,5143.8594,1518,5147.8594,1514,5143.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1512" x2="2268" y1="5143.8594" y2="5143.8594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1524" y="5122.2305">38</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="299" x="1561" y="5108.2617">Return Error, HTTP: code</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="1561" y="5136.1992"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="678" x="1569" y="5136.1992">Ref:Finalize Settlement Confirmation Error Codes</text><path d="M2274,5000.1719 L2274,5233.1719 L3930,5233.1719 L3930,5010.1719 L3920,5000.1719 L2274,5000.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3920,5000.1719 L3920,5010.1719 L3930,5010.1719 L3920,5000.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="5027.4492">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="787" x="2296" y="5055.3867">"settlement": {... map settlement object from settlements api },</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="256" x="2296" y="5083.3242">"participantErrors" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2312" y="5111.2617">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="488" x="2328" y="5139.1992">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="1587" x="2328" y="5167.1367">"error": {"type": "string", "message": "description", "errorInformation": {...}} # errorInformation std fspiop error information object</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="24" x="2312" y="5195.0742">}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2280" y="5223.0117">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1375.5" x2="3955" y1="5246.6719" y2="5246.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="257" x="1380.5" y="5268.9492">[Validation failure]</text><polygon fill="#181818" points="1518,5504.1094,1508,5508.1094,1518,5512.1094,1514,5508.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1512" x2="2268" y1="5508.1094" y2="5508.1094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="1524" y="5486.4805">39</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="299" x="1562" y="5472.5117">Return Error, HTTP: code</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="1562" y="5500.4492"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="678" x="1570" y="5500.4492">Ref:Finalize Settlement Confirmation Error Codes</text><path d="M2274,5280.6094 L2274,5681.6094 L2965,5681.6094 L2965,5290.6094 L2955,5280.6094 L2274,5280.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M2955,5280.6094 L2955,5290.6094 L2965,5290.6094 L2955,5280.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2296" y="5307.8867">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="251" x="2296" y="5335.8242">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="181" x="2312" y="5363.7617">"errorCode": 0,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="332" x="2312" y="5391.6992">"errorDescription": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="213" x="2312" y="5419.6367">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="164" x="2328" y="5447.5742">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2344" y="5475.5117">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="180" x="2360" y="5503.4492">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="194" x="2360" y="5531.3867">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2344" y="5559.3242">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="9" x="2328" y="5587.2617">]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2312" y="5615.1992">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2296" y="5643.1367">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="670" x="2280" y="5671.0742">} # errorInformation std fspiop error information object</text><polygon fill="#181818" points="755,5779.5469,745,5783.5469,755,5787.5469,751,5783.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="749" x2="1506" y1="5783.5469" y2="5783.5469"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="761" y="5747.9492">40</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="136" x="799" y="5720.0117">Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="90" x="807" y="5747.9492">Process</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="671" x="807" y="5775.8867">Completed (Update settlement Status or display errors)</text><!--MD5=[1ab9bf1a69dc6750c3dba2f08b510140]
@startuml
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja


== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: POST: /settlements:finalize
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST: /settlements:finalize
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
alt Success/Warnings 
  group Calculate Adjustments and Warnings
  pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
  pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
  end

  pl- -> el: Return finalisation validation results
  note right
    {
      "finalisationId": "GUIDv4", # Guid version 4 (string)
      "valid":true # (boolean) true if none failure error
       "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
    }
  end note
else Error 
  pl- -> el: Return Error, HTTP: code \n <b>Ref: Finalize Settlement Validation Error Codes</b>
  note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":false, # (boolean) false if failures
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
  end note
end
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  finalisationId:"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  "finalisationId":"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note
pl -> pl: validate finalisationId and settlementId against stored state
alt Validation Success

  loop for each settlement debit participant
  ' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\nadjust ndc: PUT /participants/{name}/limits
  alt if balanceSettlementOption is true 
  pl->moja: Adjust settlment account according to settlement (funds Out)\n **POST central-ledger/participants/{name}/accounts/{id}**
  pl->moja: Confirm adjustment \n **PUT central-ledger/participants/{name}/accounts/{id}/transfers/{transferId}**
  end

  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_COMMITED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 

  pl->moja: Advance settlement participant account\n state to SETTLED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 
  note right moja
  **Net debit** participant 
    position ledgers are adjusted
  end note

  end loop
  loop for each settlement credit participant
  ' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\n adjust ndc: PUT /participants/{name}/limits
  alt if balanceSettlementOption is true 
  pl->moja: Adjust settlment account according to settlement (funds In)\n **POST /participants/{name}/accounts/{id}**
  end
  note left pl
    reason: "Settlement Finanisation"
    extension list: 
      [ { 'key'='user', 'value'='username'},
        { 'key'='reference', 'value'='finalisatonReference'} ]
  end note
  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_COMMITED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 

  pl->moja: Advance settlement participant account\n state to SETTLED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}**   
  end loop
  alt if balanceSettlementOption is true 
  loop For each participant rebalance Settlement account  
  pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
  alt if latest balance < actual balance
    pl->moja: Increase balance (funds In)\n **POST central-ledger/participants/{name}/accounts/{id}**
  else if latest balance > actual balance
    pl->moja: Decrease balance (funds Out)\n **POST central-ledger/participants/{name}/accounts/{id}**
    pl->moja: Confirm adjustment \n **PUT /participants/{name}/accounts/{id}/transfers/{transferId}**
  else if latest balance == actual balance
    pl->pl: do nothing
  end 
  note left pl
    reason: "Settlement Rebalance"
    extension list: 
      [ { 'key'='user', 'value'='username'},
        { 'key'='reference', 'value'='finalisatonReference'} ]
  end note
  pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
  end 
  end

  alt Processing Success
    pl- ->el: Response success, HTTP: 200
    note right 
      {
        "settlement": {... map settlement object from settlements api }
      }
    end note
  else Processing Error 
    pl- ->el: Return Error, HTTP: code \n <b>Ref:Finalize Settlement Confirmation Error Codes</b>
    note right 
    {
      "settlement": {... map settlement object from settlements api },
      "participantErrors" : [
        { 
          "id": 1, # mojaloop database id (integer)
          "error": {"type": "string", "message": "description", "errorInformation": {...}} # errorInformation std fspiop error information object
        }]
    }
    end note
  end

else Validation failure    

 pl- ->el: Return Error, HTTP: code \n <b>Ref:Finalize Settlement Confirmation Error Codes</b>

    note right 
      {
      "errorInformation": { 
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" 
            }
          ] 
        }
      }
    } # errorInformation std fspiop error information object
    end note
end

el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)
@enduml

@startuml
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja


== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: POST: /settlements:finalize
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST: /settlements:finalize
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
alt Success/Warnings 
  group Calculate Adjustments and Warnings
  pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
  pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
  end

  pl- -> el: Return finalisation validation results
  note right
    {
      "finalisationId": "GUIDv4", # Guid version 4 (string)
      "valid":true # (boolean) true if none failure error
       "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
    }
  end note
else Error 
  pl- -> el: Return Error, HTTP: code \n <b>Ref: Finalize Settlement Validation Error Codes</b>
  note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":false, # (boolean) false if failures
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
  end note
end
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  finalisationId:"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  "finalisationId":"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note
pl -> pl: validate finalisationId and settlementId against stored state
alt Validation Success

  loop for each settlement debit participant
  alt if balanceSettlementOption is true 
  pl->moja: Adjust settlment account according to settlement (funds Out)\n **POST central-ledger/participants/{name}/accounts/{id}**
  pl->moja: Confirm adjustment \n **PUT central-ledger/participants/{name}/accounts/{id}/transfers/{transferId}**
  end

  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_COMMITED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 

  pl->moja: Advance settlement participant account\n state to SETTLED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 
  note right moja
  **Net debit** participant 
    position ledgers are adjusted
  end note

  end loop
  loop for each settlement credit participant
  alt if balanceSettlementOption is true 
  pl->moja: Adjust settlment account according to settlement (funds In)\n **POST /participants/{name}/accounts/{id}**
  end
  note left pl
    reason: "Settlement Finanisation"
    extension list: 
      [ { 'key'='user', 'value'='username'},
        { 'key'='reference', 'value'='finalisatonReference'} ]
  end note
  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_COMMITED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}** 

  pl->moja: Advance settlement participant account\n state to SETTLED \n **PUT: central-settlements/settlements/{sid}/participants/{pid}**   
  end loop
  alt if balanceSettlementOption is true 
  loop For each participant rebalance Settlement account  
  pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
  alt if latest balance < actual balance
    pl->moja: Increase balance (funds In)\n **POST central-ledger/participants/{name}/accounts/{id}**
  else if latest balance > actual balance
    pl->moja: Decrease balance (funds Out)\n **POST central-ledger/participants/{name}/accounts/{id}**
    pl->moja: Confirm adjustment \n **PUT /participants/{name}/accounts/{id}/transfers/{transferId}**
  else if latest balance == actual balance
    pl->pl: do nothing
  end 
  note left pl
    reason: "Settlement Rebalance"
    extension list: 
      [ { 'key'='user', 'value'='username'},
        { 'key'='reference', 'value'='finalisatonReference'} ]
  end note
  pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
  end 
  end

  alt Processing Success
    pl- ->el: Response success, HTTP: 200
    note right 
      {
        "settlement": {... map settlement object from settlements api }
      }
    end note
  else Processing Error 
    pl- ->el: Return Error, HTTP: code \n <b>Ref:Finalize Settlement Confirmation Error Codes</b>
    note right 
    {
      "settlement": {... map settlement object from settlements api },
      "participantErrors" : [
        { 
          "id": 1, # mojaloop database id (integer)
          "error": {"type": "string", "message": "description", "errorInformation": {...}} # errorInformation std fspiop error information object
        }]
    }
    end note
  end

else Validation failure    

 pl- ->el: Return Error, HTTP: code \n <b>Ref:Finalize Settlement Confirmation Error Codes</b>

    note right 
      {
      "errorInformation": { 
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" 
            }
          ] 
        }
      }
    } # errorInformation std fspiop error information object
    end note
end

el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)
@enduml

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>