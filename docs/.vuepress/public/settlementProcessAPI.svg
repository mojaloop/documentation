<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="7460px" preserveAspectRatio="none" style="width:3835px;height:7460px;" version="1.1" viewBox="0 0 3835 7460" width="3835px" zoomAndPan="magnify"><defs><filter height="300%" id="f2ggf4o3byo5m" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="209" x="1808.75" y="34.9141">Settlement Process</text><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="1154.25"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2285.5" y="1346"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="3699.5625"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2285.5" y="4043.25"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2285.5" y="4438.9375"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="402.25" style="stroke: #000000; stroke-width: 2.0;" width="1415.5" x="2275.5" y="5407.8125"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="151.9375" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="5462.1875"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="432.4375" style="stroke: #000000; stroke-width: 2.0;" width="1618" x="1779" y="5824.0625"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="5878.4375"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="641.5625" style="stroke: #000000; stroke-width: 2.0;" width="1628" x="1769" y="6270.5"/><rect fill="#FFFFFF" filter="url(#f2ggf4o3byo5m)" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1779" y="6324.875"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="470" x2="470" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="736" x2="736" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1032" x2="1032" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1706" x2="1706" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2380.5" x2="2380.5" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2915.5" x2="2915.5" y1="144.375" y2="7359.5"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="3319" x2="3319" y1="144.375" y2="7359.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="313" y="139.1016">Business Hub Operator User</text><ellipse cx="470.5" cy="57.1875" fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M470.5,65.1875 L470.5,92.1875 M457.5,73.1875 L483.5,73.1875 M470.5,92.1875 L457.5,107.1875 M470.5,92.1875 L483.5,107.1875 " fill="none" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="309" x="313" y="7383.4141">Business Hub Operator User</text><ellipse cx="470.5" cy="7398.6875" fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M470.5,7406.6875 L470.5,7433.6875 M457.5,7414.6875 L483.5,7414.6875 M470.5,7433.6875 L457.5,7448.6875 M470.5,7433.6875 L483.5,7448.6875 " fill="none" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 2.0;"/><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="638" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="645" y="127.1016">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="192" x="638" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="178" x="645" y="7390.4141">Settlement Bank</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="946" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="953" y="127.1016">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="169" x="946" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="155" x="953" y="7390.4141">Micro-frontend</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1605" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1612" y="127.1016">Experience Layer</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="199" x="1605" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="185" x="1612" y="7390.4141">Experience Layer</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2295.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2302.5" y="127.1016">Process Layer</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="166" x="2295.5" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="152" x="2302.5" y="7390.4141">Process Layer</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2848.5" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2855.5" y="127.1016">Report API</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="130" x="2848.5" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="2855.5" y="7390.4141">Report API</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3262" y="95.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3269" y="127.1016">Mojaloop</text><rect fill="#F8F8F8" filter="url(#f2ggf4o3byo5m)" height="44.1875" style="stroke: #383838; stroke-width: 1.5;" width="111" x="3262" y="7358.5"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="97" x="3269" y="7390.4141">Mojaloop</text><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3820.5" x="3" y="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="182.4688" y2="182.4688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="185.4688" y2="185.4688"/><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="329" x="1748.75" y="164.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="308" x="1754.75" y="193.2891">Close a settlement window</text><polygon fill="#383838" points="1020.5,244.75,1030.5,248.75,1020.5,252.75,1024.5,248.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="248.75" y2="248.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="477.5" y="241.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="494.5" y="241.4766">User clicks close Settlement Window</text><polygon fill="#383838" points="1694.5,293.9375,1704.5,297.9375,1694.5,301.9375,1698.5,297.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1700.5" y1="297.9375" y2="297.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1039.5" y="290.6641">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="1056.5" y="290.6641">Close Settlement Window</text><path d="M883,261.75 L883,301.75 L1023,301.75 L1023,271.75 L1013,261.75 L883,261.75 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,261.75 L1013,271.75 L1023,271.75 L1013,261.75 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="119" x="889" y="291.6641">windows Id</text><polygon fill="#383838" points="3307.5,373.3125,3317.5,377.3125,3307.5,381.3125,3311.5,377.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="3313.5" y1="377.3125" y2="377.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1713.5" y="354.9453">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="223" x="1730.5" y="339.8516">Add user information</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="534" x="1737.5" y="370.0391">POST: /settlementWindows{SettlementWindowId}</text><polygon fill="#383838" points="3307.5,447.6875,3317.5,451.6875,3307.5,455.6875,3311.5,451.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="3313.5" y1="451.6875" y2="451.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1713.5" y="429.3203">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="835" x="1730.5" y="414.2266">Confirm that the settlement window is closed and wait retry with timeout if not.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="520" x="1730.5" y="444.4141">GET central-settlements/settlementWindows/{id}</text><polygon fill="#383838" points="1043.5,491.875,1033.5,495.875,1043.5,499.875,1039.5,495.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1705.5" y1="495.875" y2="495.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1049.5" y="488.6016">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="108" x="1066.5" y="488.6016">Update UI</text><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3820.5" x="3" y="531.9688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="531.9688" y2="531.9688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="534.9688" y2="534.9688"/><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="228" x="1799.25" y="513.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="1805.25" y="542.7891">Initiate Settlement</text><polygon fill="#383838" points="1020.5,614.3438,1030.5,618.3438,1020.5,622.3438,1024.5,618.3438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="618.3438" y2="618.3438"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="477.5" y="611.0703">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="521" x="494.5" y="611.0703">Initiate Settlement for these windows &amp; Currency</text><path d="M8,567.0625 L8,637.0625 L462,637.0625 L462,577.0625 L452,567.0625 L8,567.0625 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M452,567.0625 L452,577.0625 L462,577.0625 L452,567.0625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="325" x="14" y="596.9766">List of Settlement windows Ids</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="433" x="14" y="627.1641">[Optional] Currency or Settlement Model</text><polygon fill="#383838" points="1694.5,774.1875,1704.5,778.1875,1694.5,782.1875,1698.5,778.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1700.5" y1="778.1875" y2="778.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1039.5" y="770.9141">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="286" x="1056.5" y="770.9141">POST: /settlements:initiate</text><path d="M542,651.4375 L542,872.4375 L1023,872.4375 L1023,661.4375 L1013,651.4375 L542,651.4375 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,651.4375 L1013,661.4375 L1023,661.4375 L1013,651.4375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="257" x="548" y="681.3516">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="576" y="711.5391">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="64" x="590" y="741.7266">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="576" y="771.9141">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="555" y="802.1016">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="555" y="832.2891">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="555" y="862.4766">}</text><polygon fill="#383838" points="2368.5,1024.5938,2378.5,1028.5938,2368.5,1032.5938,2372.5,1028.5938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="2374.5" y1="1028.5938" y2="1028.5938"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="1713.5" y="1021.3203">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="286" x="1730.5" y="1021.3203">POST: /settlements:initiate</text><path d="M1216,886.75 L1216,1137.75 L1697,1137.75 L1697,896.75 L1687,886.75 L1216,886.75 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1687,886.75 L1687,896.75 L1697,896.75 L1687,886.75 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="257" x="1222" y="916.6641">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1250" y="946.8516">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="64" x="1264" y="977.0391">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="1250" y="1007.2266">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="1229" y="1037.4141">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="395" x="1229" y="1067.6016">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="417" x="1229" y="1097.7891">"user": "hub operators name" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1229" y="1127.9766">}</text><path d="M2285.5,1154.25 L2668.5,1154.25 L2668.5,1176.25 L2658.5,1186.25 L2285.5,1186.25 L2285.5,1154.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="177.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="1154.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="338" x="2300.5" y="1180.1641">determine settlement Model/s</text><polygon fill="#383838" points="3307.5,1218.625,3317.5,1222.625,3307.5,1226.625,3311.5,1222.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="1222.625" y2="1222.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13" x="2387.5" y="1215.3516">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="898" x="2404.5" y="1215.3516">Load currencies for windows using GET central-settlements/settlementWindows/{id}</text><polygon fill="#383838" points="3307.5,1262.8125,3317.5,1266.8125,3307.5,1270.8125,3311.5,1266.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="1266.8125" y2="1266.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="1259.5391">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2417.5" y="1259.5391">Load settlement models using GET central-ledger/settlementModels</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="1311" y2="1311"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="1311" y2="1324"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="1324" y2="1324"/><polygon fill="#383838" points="2391.5,1320,2381.5,1324,2391.5,1328,2387.5,1324" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="1303.7266">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="483" x="2417.5" y="1303.7266">Determine minimum list of settlement models</text><path d="M2285.5,1346 L2382.5,1346 L2382.5,1368 L2372.5,1378 L2285.5,1378 L2285.5,1346 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="340.875" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="2285.5" y="1346"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2300.5" y="1371.9141">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="2397.5" y="1372.9141">[for settlement models]</text><polygon fill="#383838" points="3307.5,1485.9375,3317.5,1489.9375,3307.5,1493.9375,3311.5,1489.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="1489.9375" y2="1489.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="1452.4766">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="190" x="2417.5" y="1422.2891">Create settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="1452.4766"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="436" x="2424.5" y="1452.4766">POST: central-settlements/settlements</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2867.5" y="1452.4766"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="451" x="2417.5" y="1482.6641">{settlementModel, settlementWindowIds[]}</text><polygon fill="#383838" points="3307.5,1590.5,3317.5,1594.5,3307.5,1598.5,3311.5,1594.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="1594.5" y2="1594.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="1557.0391">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="422" x="2417.5" y="1526.8516">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="423" x="2424.5" y="1557.0391">state to PS_TRANSFERS_RECORDED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="1587.2266"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="466" x="2424.5" y="1587.2266">PUT: central-settlements/settlements/{id}</text><path d="M3324,1607.5 L3324,1677.5 L3656,1677.5 L3656,1617.5 L3646,1607.5 L3324,1607.5 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3646,1607.5 L3646,1617.5 L3656,1617.5 L3646,1607.5 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="3330" y="1637.4141">Net credit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3447" y="1637.4141">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3330" y="1667.6016">position ledgers are adjusted</text><polygon fill="#383838" points="1717.5,1957.4688,1707.5,1961.4688,1717.5,1965.4688,1713.5,1961.4688" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1711.5" x2="2379.5" y1="1961.4688" y2="1961.4688"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1723.5" y="1954.1953">14</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="382" x="1753.5" y="1954.1953">Return reponse, success HTTP:200</text><path d="M2385,1698.875 L2385,2191.875 L2878,2191.875 L2878,1708.875 L2868,1698.875 L2385,1698.875 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2868,1698.875 L2868,1708.875 L2878,1708.875 L2868,1698.875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="1728.7891">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="7" x="2405" y="1758.9766">[</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="444" x="2419" y="1789.1641">"SettlementModel":"defered-net" #(string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="300" x="2419" y="1819.3516">"id":null, # optional (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="349" x="2419" y="1849.5391">"state": "state" # optional (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="322" x="2419" y="1879.7266">"errorInformation": { # optional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="159" x="2440" y="1909.9141">"errorCode": 0,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="287" x="2440" y="1940.1016">"errorDescription": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="179" x="2440" y="1970.2891">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="141" x="2454" y="2000.4766">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2468" y="2030.6641">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="154" x="2482" y="2060.8516">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="226" x="2482" y="2091.0391">"value": "string" } ] } }</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="7" x="2412" y="2121.2266">]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="2151.4141">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2398" y="2181.6016"/><polygon fill="#383838" points="1043.5,2233.0625,1033.5,2237.0625,1043.5,2241.0625,1039.5,2237.0625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1705.5" y1="2237.0625" y2="2237.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="2229.7891">15</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="349" x="1079.5" y="2229.7891">Update UI with settlement status</text><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3820.5" x="3" y="2273.1563"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="2273.1563" y2="2273.1563"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="2276.1563" y2="2276.1563"/><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="415" x="1705.75" y="2255.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="394" x="1711.75" y="2283.9766">Generate Settlement Matrix Report</text><polygon fill="#383838" points="1020.5,2335.4375,1030.5,2339.4375,1020.5,2343.4375,1024.5,2339.4375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="2339.4375" y2="2339.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="2332.1641">16</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="507.5" y="2332.1641">Settlement Initiation Report Download</text><polygon fill="#383838" points="1694.5,2379.625,1704.5,2383.625,1694.5,2387.625,1698.5,2383.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1700.5" y1="2383.625" y2="2383.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="2376.3516">17</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="100" x="1069.5" y="2376.3516">Add User</text><polygon fill="#383838" points="2903.5,2423.8125,2913.5,2427.8125,2903.5,2431.8125,2907.5,2427.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="2909.5" y1="2427.8125" y2="2427.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1713.5" y="2420.5391">18</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="405" x="1743.5" y="2420.5391">Settlement Initiation Report Download</text><polygon fill="#383838" points="1043.5,2468,1033.5,2472,1043.5,2476,1039.5,2472" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="2914.5" y1="2472" y2="2472"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="2464.7266">19</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="1079.5" y="2464.7266">report is downloaded</text><polygon fill="#383838" points="481.5,2512.1875,471.5,2516.1875,481.5,2520.1875,477.5,2516.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="1031.5" y1="2516.1875" y2="2516.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="2508.9141">20</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="225" x="517.5" y="2508.9141">report is downloaded</text><polygon fill="#383838" points="724,2606.6563,734,2610.6563,724,2614.6563,728,2610.6563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="730" y1="2610.6563" y2="2610.6563"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="2603.3828">21</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="514.5" y="2603.3828"/><path d="M157,2529.1875 L157,2659.1875 L461,2659.1875 L461,2539.1875 L451,2529.1875 L157,2529.1875 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M451,2529.1875 L451,2539.1875 L461,2539.1875 L451,2529.1875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="176" x="163" y="2559.1016">Report is sent to</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="163" y="2589.2891">settlement bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="87" x="352" y="2589.2891">to begin</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="254" x="163" y="2619.4766">the settlement transfers</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="222" x="163" y="2649.6641">between participants</text><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3820.5" x="3" y="2697.0313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="2697.0313" y2="2697.0313"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3823.5" y1="2700.0313" y2="2700.0313"/><rect fill="#EEEEEE" filter="url(#f2ggf4o3byo5m)" height="38.1875" style="stroke: #000000; stroke-width: 2.0;" width="240" x="1793.25" y="2678.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="1799.25" y="2707.8516">Finalise Settlement</text><polygon fill="#383838" points="481.5,2915.25,471.5,2919.25,481.5,2923.25,477.5,2919.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="735" y1="2919.25" y2="2919.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="2911.9766">22</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="524.5" y="2911.9766"/><path d="M741,2732.125 L741,3074.125 L1344,3074.125 L1344,2742.125 L1334,2732.125 L741,2732.125 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1334,2732.125 L1334,2742.125 L1344,2742.125 L1334,2732.125 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="747" y="2762.0391">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="795" y="2762.0391">Settlement Bank</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="243" x="989" y="2762.0391">has completed making</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="330" x="747" y="2792.2266">transfers between participants.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="41" x="747" y="2822.4141">The</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="795" y="2822.4141">finalisation report</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="216" x="1006" y="2822.4141">that is recieved from</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="575" x="747" y="2852.6016">the Settlement Bank, includes the settlement account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="570" x="747" y="2882.7891">balances after all the transfers have been processed.</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="754" y="2912.9766"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="525" x="747" y="2943.1641">It is possible that these account balances are not</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="431" x="747" y="2973.3516">as expected. This would indicate that an</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="1185" y="2973.3516">additional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="1307" y="2973.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="747" y="3003.5391">funds in / funds out</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="318" x="981" y="3003.5391">has occured in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="501" x="747" y="3033.7266">accounts that has not yet been captured in the</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="314" x="747" y="3063.9141">Mojaloop Settlement ledgers.</text><polygon fill="#383838" points="1020.5,3115.375,1030.5,3119.375,1020.5,3123.375,1024.5,3119.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="3119.375" y2="3119.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="3112.1016">23</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="245" x="507.5" y="3112.1016">Validate finalisation file</text><polygon fill="#383838" points="1694.5,3159.5625,1704.5,3163.5625,1694.5,3167.5625,1698.5,3163.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1700.5" y1="3163.5625" y2="3163.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="3156.2891">24</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="292" x="1069.5" y="3156.2891">POST: /settlements:finalize</text><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="1748.5" y1="3432.6563" y2="3432.6563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1748.5" x2="1748.5" y1="3432.6563" y2="3445.6563"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1707.5" x2="1748.5" y1="3445.6563" y2="3445.6563"/><polygon fill="#383838" points="1717.5,3441.6563,1707.5,3445.6563,1717.5,3449.6563,1713.5,3445.6563" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1713.5" y="3410.2891">25</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="267" x="1743.5" y="3395.1953">Fatal: Validate file format</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="280" x="1750.5" y="3425.3828">Load file into JSON object</text><path d="M810,3176.5625 L810,3638.5625 L1697,3638.5625 L1697,3186.5625 L1687,3176.5625 L810,3176.5625 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1687,3176.5625 L1687,3186.5625 L1697,3186.5625 L1687,3176.5625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="816" y="3206.4766">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="761" x="830" y="3236.6641">"finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="540" x="830" y="3266.8516">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="170" x="830" y="3297.0391">"participants" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="844" y="3327.2266">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="597" x="858" y="3357.4141">"name": "payerfsp",# mojaloop participant name (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="425" x="858" y="3387.6016">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="779" x="858" y="3417.7891">"settlementAccountId": 1, # settlement account id for participant (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="824" x="858" y="3447.9766">"externalBalance": 10000, # external balance of settlement account (number)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="273" x="858" y="3478.1641">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="243" x="900" y="3508.3516">"amount": 0, # number</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="560" x="900" y="3538.5391">"currency": "XXX" # currency string (CurrencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="886" y="3568.7266">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="844" y="3598.9141">}  ] # all participants that are involved in the settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="816" y="3629.1016">}</text><polygon fill="#383838" points="2368.5,3680.5625,2378.5,3684.5625,2368.5,3688.5625,2372.5,3684.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="2374.5" y1="3684.5625" y2="3684.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1713.5" y="3677.2891">26</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1743.5" y="3677.2891">Validate finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="292" x="1977.5" y="3677.2891">POST: /settlements:finalize</text><path d="M2285.5,3699.5625 L2562.5,3699.5625 L2562.5,3721.5625 L2552.5,3731.5625 L2285.5,3731.5625 L2285.5,3699.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="329.6875" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="3699.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="232" x="2300.5" y="3725.4766">load settlement data</text><polygon fill="#383838" points="3307.5,3794.125,3317.5,3798.125,3307.5,3802.125,3311.5,3798.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="3798.125" y2="3798.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="3775.7578">27</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="284" x="2417.5" y="3760.6641">Get settlement information</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="461" x="2417.5" y="3790.8516">GET central-settlements/settlements/{id}</text><polygon fill="#383838" points="3307.5,3868.5,3317.5,3872.5,3307.5,3876.5,3311.5,3872.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="3872.5" y2="3872.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="3850.1328">28</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="202" x="2417.5" y="3835.0391">Get all participants</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="3865.2266"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="358" x="2424.5" y="3865.2266">GET central-ledger/participants</text><polygon fill="#383838" points="3307.5,3942.875,3317.5,3946.875,3307.5,3950.875,3311.5,3946.875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="3946.875" y2="3946.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="3924.5078">29</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="264" x="2417.5" y="3909.4141">Get all participants limits</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="3939.6016"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="428" x="2424.5" y="3939.6016">GET central-ledger/participants/limits</text><polygon fill="#383838" points="3307.5,4017.25,3317.5,4021.25,3307.5,4025.25,3311.5,4021.25" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="4021.25" y2="4021.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="3998.8828">30</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="439" x="2417.5" y="3983.7891">For each participant get account balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="4013.9766"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2424.5" y="4013.9766">GET central-ledger/participants/{name}/accounts</text><path d="M2285.5,4043.25 L2542.5,4043.25 L2542.5,4065.25 L2532.5,4075.25 L2285.5,4075.25 L2285.5,4043.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="381.6875" style="stroke: #000000; stroke-width: 2.0;" width="635" x="2285.5" y="4043.25"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="212" x="2300.5" y="4069.1641">Process validation</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4172" y2="4172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4172" y2="4185"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4185" y2="4185"/><polygon fill="#383838" points="2391.5,4181,2381.5,4185,2391.5,4189,2387.5,4185" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4134.5391">31</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="389" x="2417.5" y="4104.3516">Fatal: Validate Participants and their</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="319" x="2424.5" y="4134.5391">accounts ids are valid, match,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="491" x="2417.5" y="4164.7266">and are the correct type, and correct currency</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4229.1875" y2="4229.1875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4229.1875" y2="4242.1875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4242.1875" y2="4242.1875"/><polygon fill="#383838" points="2391.5,4238.1875,2381.5,4242.1875,2391.5,4246.1875,2387.5,4242.1875" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4221.9141">32</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="459" x="2417.5" y="4221.9141">Fatal: Validate Settlement Id non-matching</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4316.5625" y2="4316.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4316.5625" y2="4329.5625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4329.5625" y2="4329.5625"/><polygon fill="#383838" points="2391.5,4325.5625,2381.5,4329.5625,2391.5,4333.5625,2387.5,4329.5625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4294.1953">33</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2417.5" y="4279.1016">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="212" x="2417.5" y="4309.2891">transfer sum is zero</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4403.9375" y2="4403.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4403.9375" y2="4416.9375"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4416.9375" y2="4416.9375"/><polygon fill="#383838" points="2391.5,4412.9375,2381.5,4416.9375,2391.5,4420.9375,2387.5,4416.9375" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4381.5703">34</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="452" x="2417.5" y="4366.4766">Fatal: Validate Participant Settlement data</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="339" x="2417.5" y="4396.6641">matches net settlement amount</text><path d="M2285.5,4438.9375 L2755.5,4438.9375 L2755.5,4460.9375 L2745.5,4470.9375 L2285.5,4470.9375 L2285.5,4438.9375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="237.125" style="stroke: #000000; stroke-width: 2.0;" width="604" x="2285.5" y="4438.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="425" x="2300.5" y="4464.8516">Calculate Adjustments and Warnings</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4567.6875" y2="4567.6875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4567.6875" y2="4580.6875"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4580.6875" y2="4580.6875"/><polygon fill="#383838" points="2391.5,4576.6875,2381.5,4580.6875,2391.5,4584.6875,2387.5,4580.6875" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4530.2266">35</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2417.5" y="4500.0391">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="213" x="2417.5" y="4530.2266">balance is expected</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="453" x="2424.5" y="4560.4141">Return warnings if there are discrepencies</text><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="2422.5" y1="4655.0625" y2="4655.0625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2422.5" x2="2422.5" y1="4655.0625" y2="4668.0625"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2381.5" x2="2422.5" y1="4668.0625" y2="4668.0625"/><polygon fill="#383838" points="2391.5,4664.0625,2381.5,4668.0625,2391.5,4672.0625,2387.5,4668.0625" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="4632.6953">36</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="441" x="2417.5" y="4617.6016">Non fatal: Validate Participant Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="277" x="2417.5" y="4647.7891">balance is zero or positive</text><polygon fill="#383838" points="1717.5,4795.7188,1707.5,4799.7188,1717.5,4803.7188,1713.5,4799.7188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1711.5" x2="2379.5" y1="4799.7188" y2="4799.7188"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1723.5" y="4792.4453">37</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="381" x="1753.5" y="4792.4453">Return finalisation validation results</text><path d="M2385,4688.0625 L2385,4879.0625 L3266,4879.0625 L3266,4698.0625 L3256,4688.0625 L2385,4688.0625 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3256,4688.0625 L3256,4698.0625 L3266,4698.0625 L3256,4688.0625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="4717.9766">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="539" x="2405" y="4748.1641">"finalisationId": "GUIDv4", # Guid version 4 (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="511" x="2405" y="4778.3516">"valid":true, # (boolean) true if none failure error</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="818" x="2405" y="4808.5391">"errors": [{"type": "string", "message": "description", "errorInformation": {...}}],</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="846" x="2405" y="4838.7266">"warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="4868.9141">}</text><polygon fill="#383838" points="1043.5,4920.375,1033.5,4924.375,1043.5,4928.375,1039.5,4924.375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1705.5" y1="4924.375" y2="4924.375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="4917.1016">38</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="328" x="1079.5" y="4917.1016">Show validation results to user</text><polygon fill="#383838" points="481.5,4964.5625,471.5,4968.5625,481.5,4972.5625,477.5,4968.5625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="475.5" x2="1031.5" y1="4968.5625" y2="4968.5625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="487.5" y="4961.2891">39</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="524.5" y="4961.2891"/><polygon fill="#383838" points="1020.5,5008.75,1030.5,5012.75,1020.5,5016.75,1024.5,5012.75" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="470.5" x2="1026.5" y1="5012.75" y2="5012.75"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="477.5" y="5005.4766">40</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="446" x="507.5" y="5005.4766">User confirms proceeding with finalisation</text><polygon fill="#383838" points="1694.5,5118.3125,1704.5,5122.3125,1694.5,5126.3125,1698.5,5122.3125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1032.5" x2="1700.5" y1="5122.3125" y2="5122.3125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1039.5" y="5115.0391">41</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="1069.5" y="5115.0391">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="379" x="1310.5" y="5115.0391">POST: /settlements:confirmFinalize</text><path d="M441,5025.75 L441,5185.75 L1023,5185.75 L1023,5035.75 L1013,5025.75 L441,5025.75 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1013,5025.75 L1013,5035.75 L1023,5035.75 L1013,5025.75 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="447" y="5055.6641">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="332" x="461" y="5085.8516">finalisationId:"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="540" x="461" y="5116.0391">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="458" x="461" y="5146.2266">balanceSettlementOption: true # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="447" y="5176.4141">}</text><polygon fill="#383838" points="2368.5,5308.3438,2378.5,5312.3438,2368.5,5316.3438,2372.5,5312.3438" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="1706.5" x2="2374.5" y1="5312.3438" y2="5312.3438"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1713.5" y="5305.0703">42</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="1743.5" y="5305.0703">Confirm Finalisation</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="379" x="1984.5" y="5305.0703">POST: /settlements:confirmFinalize</text><path d="M1115,5200.6875 L1115,5391.6875 L1697,5391.6875 L1697,5210.6875 L1687,5200.6875 L1115,5200.6875 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M1687,5200.6875 L1687,5210.6875 L1697,5210.6875 L1687,5200.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1121" y="5230.6016">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="350" x="1135" y="5260.7891">"finalisationId":"GUIDv4", (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="540" x="1135" y="5290.9766">"settlementId" : 10 , # settlement batch id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="476" x="1135" y="5321.1641">"balanceSettlementOption":true, # (boolean)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="303" x="1135" y="5351.3516">"user":"userName" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="1121" y="5381.5391">}</text><path d="M2275.5,5407.8125 L2372.5,5407.8125 L2372.5,5429.8125 L2362.5,5439.8125 L2275.5,5439.8125 L2275.5,5407.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="402.25" style="stroke: #000000; stroke-width: 2.0;" width="1415.5" x="2275.5" y="5407.8125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="2290.5" y="5433.7266">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="430" x="2387.5" y="5434.7266">[for each settlement debit participant]</text><path d="M2285.5,5462.1875 L2358.5,5462.1875 L2358.5,5484.1875 L2348.5,5494.1875 L2285.5,5494.1875 L2285.5,5462.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="151.9375" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="5462.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="2300.5" y="5488.1016">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="2373.5" y="5489.1016">[if balanceSettlementOption is true]</text><polygon fill="#383838" points="3307.5,5602.125,3317.5,5606.125,3307.5,5610.125,3311.5,5606.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="5606.125" y2="5606.125"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="5568.6641">43</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="655" x="2417.5" y="5538.4766">Adjust settlment account according to settlement (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2424.5" y="5568.6641">POST central-ledger/participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2417.5" y="5598.8516">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><polygon fill="#383838" points="3307.5,5713.6875,3317.5,5717.6875,3307.5,5721.6875,3311.5,5717.6875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="5717.6875" y2="5717.6875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="5680.2266">44</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2417.5" y="5650.0391">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="790" x="2417.5" y="5680.2266">PUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2424.5" y="5710.4141">PUT /settlements/{sid}/participants/{pid}</text><path d="M3324,5730.6875 L3324,5800.6875 L3677,5800.6875 L3677,5740.6875 L3667,5730.6875 L3324,5730.6875 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3667,5730.6875 L3667,5740.6875 L3677,5740.6875 L3667,5730.6875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="3330" y="5760.6016">Net debit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="112" x="3440" y="5760.6016">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="311" x="3351" y="5790.7891">position ledgers are adjusted</text><path d="M1779,5824.0625 L1876,5824.0625 L1876,5846.0625 L1866,5856.0625 L1779,5856.0625 L1779,5824.0625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="432.4375" style="stroke: #000000; stroke-width: 2.0;" width="1618" x="1779" y="5824.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1794" y="5849.9766">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1891" y="5850.9766">[for each settlement credit participant]</text><path d="M2285.5,5878.4375 L2358.5,5878.4375 L2358.5,5900.4375 L2348.5,5910.4375 L2285.5,5910.4375 L2285.5,5878.4375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.75" style="stroke: #000000; stroke-width: 2.0;" width="1101.5" x="2285.5" y="5878.4375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="2300.5" y="5904.3516">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="2373.5" y="5905.3516">[if balanceSettlementOption is true]</text><polygon fill="#383838" points="3307.5,5988.1875,3317.5,5992.1875,3307.5,5996.1875,3311.5,5992.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="5992.1875" y2="5992.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="5969.8203">45</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="635" x="2417.5" y="5954.7266">Adjust settlment account according to settlement (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="432" x="2424.5" y="5984.9141">POST /participants/{name}/accounts/{id}</text><path d="M1789,6012.1875 L1789,6142.1875 L2371,6142.1875 L2371,6022.1875 L2361,6012.1875 L1789,6012.1875 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2361,6012.1875 L2361,6022.1875 L2371,6022.1875 L2361,6012.1875 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="358" x="1795" y="6042.1016">reason: "Settlement Finanisation"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1795" y="6072.2891">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1809" y="6102.4766">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1823" y="6132.6641">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3307.5,6244.5,3317.5,6248.5,3307.5,6252.5,3311.5,6248.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="6248.5" y2="6248.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="6211.0391">46</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="261" x="2417.5" y="6180.8516">Advance state to Settled</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="790" x="2417.5" y="6211.0391">PUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="426" x="2424.5" y="6241.2266">PUT /settlements/{sid}/participants/{pid}</text><path d="M1769,6270.5 L1842,6270.5 L1842,6292.5 L1832,6302.5 L1769,6302.5 L1769,6270.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="641.5625" style="stroke: #000000; stroke-width: 2.0;" width="1628" x="1769" y="6270.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1784" y="6296.4141">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="406" x="1857" y="6297.4141">[if balanceSettlementOption is true]</text><path d="M1779,6324.875 L1876,6324.875 L1876,6346.875 L1866,6356.875 L1779,6356.875 L1779,6324.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="580.1875" style="stroke: #000000; stroke-width: 2.0;" width="1608" x="1779" y="6324.875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="1794" y="6350.7891">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="592" x="1891" y="6351.7891">[For each participant rebalance Settlement account]</text><polygon fill="#383838" points="3307.5,6434.625,3317.5,6438.625,3307.5,6442.625,3311.5,6438.625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="6438.625" y2="6438.625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="6416.2578">47</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="196" x="2417.5" y="6401.1641">Get latest balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="6431.3516"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2424.5" y="6431.3516">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="3307.5,6539.1875,3317.5,6543.1875,3307.5,6547.1875,3311.5,6543.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="6543.1875" y2="6543.1875"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="6505.7266">48</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2417.5" y="6475.5391">if &lt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="293" x="2424.5" y="6505.7266">increase balance (funds In)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2424.5" y="6535.9141">POST central-ledger/participants/{name}/accounts/{id}</text><polygon fill="#383838" points="3307.5,6673.9375,3317.5,6677.9375,3307.5,6681.9375,3311.5,6677.9375" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="6677.9375" y2="6677.9375"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="6625.3828">49</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="252" x="2417.5" y="6580.1016">if &gt; actual balance then</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="321" x="2424.5" y="6610.2891">decrease balance (funds Out)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="581" x="2424.5" y="6640.4766">POST central-ledger/participants/{name}/accounts/{id}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="731" x="2417.5" y="6670.6641">Confirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}</text><path d="M1789,6690.9375 L1789,6820.9375 L2371,6820.9375 L2371,6700.9375 L2361,6690.9375 L1789,6690.9375 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M2361,6690.9375 L2361,6700.9375 L2371,6700.9375 L2361,6690.9375 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="343" x="1795" y="6720.8516">reason: "Settlement Rebalance"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="146" x="1795" y="6751.0391">extension list:</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="374" x="1809" y="6781.2266">[ { 'key'='user', 'value'='username'},</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="533" x="1823" y="6811.4141">{ 'key'='reference', 'value'='finalisatonReference'} ]</text><polygon fill="#383838" points="3307.5,6893.0625,3317.5,6897.0625,3307.5,6901.0625,3311.5,6897.0625" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="2380.5" x2="3313.5" y1="6897.0625" y2="6897.0625"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="2387.5" y="6874.6953">50</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="256" x="2417.5" y="6859.6016">Confirm correct balance</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="0" x="2424.5" y="6889.7891"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="557" x="2424.5" y="6889.7891">GET central-ledger/participants/{name}/accounts</text><polygon fill="#383838" points="1717.5,7092.0938,1707.5,7096.0938,1717.5,7100.0938,1713.5,7096.0938" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1711.5" x2="2379.5" y1="7096.0938" y2="7096.0938"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1723.5" y="7088.8203">51</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="108" x="1753.5" y="7088.8203">Response</text><path d="M2385,6924.0625 L2385,7235.0625 L3809,7235.0625 L3809,6934.0625 L3799,6924.0625 L2385,6924.0625 " fill="#ECECEC" filter="url(#f2ggf4o3byo5m)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M3799,6924.0625 L3799,6934.0625 L3809,6934.0625 L3799,6924.0625 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="6953.9766">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="169" x="2405" y="6984.1641">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="170" x="2405" y="7014.3516">"participants" : [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2405" y="7044.5391">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="597" x="2419" y="7074.7266">"name": "payerfsp",# mojaloop participant name (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="425" x="2419" y="7104.9141">"id": 1, # mojaloop database id (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="779" x="2419" y="7135.1016">"settlementAccountId": 1, # settlement account id for participant (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="1375" x="2419" y="7165.2891">"errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="15" x="2405" y="7195.4766">}]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="8" x="2391" y="7225.6641">}</text><polygon fill="#383838" points="1043.5,7337.5,1033.5,7341.5,1043.5,7345.5,1039.5,7341.5" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1037.5" x2="1705.5" y1="7341.5" y2="7341.5"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="1049.5" y="7304.0391">52</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="116" x="1079.5" y="7273.8516">Settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="86" x="1086.5" y="7304.0391">Process</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacingAndGlyphs" textLength="593" x="1086.5" y="7334.2266">Completed (Update settlement Status or display errors)</text><!--MD5=[ecf074ff3cd90fa2d77e0da2433a5510]
@startuml settlementProcessAPI
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja

== Close a settlement window ==
bu->ui: User clicks close Settlement Window
ui->el: Close Settlement Window
note left
windows Id
end note
el->moja: Add user information\n POST: /settlementWindows{SettlementWindowId}
el->moja: Confirm that the settlement window is closed and wait retry with timeout if not.  \nGET central-settlements/settlementWindows/{id}
el- ->ui: Update UI
== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency or Settlement Model
end note

ui->el: POST: /settlements:initiate 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 }
end note
el->pl: POST: /settlements:initiate
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 "user": "hub operators name" # (string) 
 }
end note
group determine settlement Model/s 
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlement models using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlement models
end

loop for settlement models
pl->moja: Create settlement \n **POST: central-settlements/settlements** \n{settlementModel, settlementWindowIds[]}
pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: central-settlements/settlements/{id}**
note right moja
**Net credit** participant 
position ledgers are adjusted
end note
end loop
pl- ->el: Return reponse, success HTTP:200
note right
 {
   [
     "SettlementModel":"defered-net" #(string)
     "id":null, # optional (integer)
     "state": "state" # optional (string)
     "errorInformation": { # optional
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" } ] } }
    ]
 }

end note
el- ->ui: Update UI with settlement status

== Generate Settlement Matrix Report ==
bu->ui: Settlement Initiation Report Download
ui->el: Add User
el->report: Settlement Initiation Report Download
report- ->ui: report is downloaded
ui- ->bu:report is downloaded
bu->sbank:
note left
Report is sent to 
**settlement bank** to begin 
the settlement transfers 
between participants
end note

== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: POST: /settlements:finalize
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST: /settlements:finalize
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
group Calculate Adjustments and Warnings
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
end 
pl- -> el: Return finalisation validation results
note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":true, # (boolean) true if none failure error
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}],
    "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
end note
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  finalisationId:"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  "finalisationId":"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note

loop for each settlement debit participant
' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\nadjust ndc: PUT /participants/{name}/limits
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
end

pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
note right moja
**Net debit** participant 
   position ledgers are adjusted
end note

end loop
loop for each settlement credit participant
' pl->moja: [Remove if Liquidity adjustment includes settlement account check]\n adjust ndc: PUT /participants/{name}/limits
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds In)\n POST /participants/{name}/accounts/{id}
end
note left pl
  reason: "Settlement Finanisation"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
end loop
alt if balanceSettlementOption is true 
loop For each participant rebalance Settlement account  
pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
pl->moja: if < actual balance then\n increase balance (funds In)\n POST central-ledger/participants/{name}/accounts/{id}
pl->moja: if > actual balance then\n decrease balance (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Rebalance"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
end 
end

pl- ->el: Response
note right 
  {
    "state": "string",
    "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object
    }]
  }
end note
el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)

@enduml

@startuml settlementProcessAPI
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja

== Close a settlement window ==
bu->ui: User clicks close Settlement Window
ui->el: Close Settlement Window
note left
windows Id
end note
el->moja: Add user information\n POST: /settlementWindows{SettlementWindowId}
el->moja: Confirm that the settlement window is closed and wait retry with timeout if not.  \nGET central-settlements/settlementWindows/{id}
el- ->ui: Update UI
== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency or Settlement Model
end note

ui->el: POST: /settlements:initiate 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 }
end note
el->pl: POST: /settlements:initiate
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 "user": "hub operators name" # (string) 
 }
end note
group determine settlement Model/s 
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlement models using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlement models
end

loop for settlement models
pl->moja: Create settlement \n **POST: central-settlements/settlements** \n{settlementModel, settlementWindowIds[]}
pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: central-settlements/settlements/{id}**
note right moja
**Net credit** participant 
position ledgers are adjusted
end note
end loop
pl- ->el: Return reponse, success HTTP:200
note right
 {
   [
     "SettlementModel":"defered-net" #(string)
     "id":null, # optional (integer)
     "state": "state" # optional (string)
     "errorInformation": { # optional
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" } ] } }
    ]
 }

end note
el- ->ui: Update UI with settlement status

== Generate Settlement Matrix Report ==
bu->ui: Settlement Initiation Report Download
ui->el: Add User
el->report: Settlement Initiation Report Download
report- ->ui: report is downloaded
ui- ->bu:report is downloaded
bu->sbank:
note left
Report is sent to 
**settlement bank** to begin 
the settlement transfers 
between participants
end note

== Finalise Settlement ==
sbank- ->bu: 
note right
The **Settlement Bank** has completed making
transfers between participants.
The **finalisation report** that is recieved from 
the Settlement Bank, includes the settlement account 
balances after all the transfers have been processed.

It is possible that these account balances are not
as expected. This would indicate that an **additional** 
**funds in / funds out** has occured in the settlement 
accounts that has not yet been captured in the 
Mojaloop Settlement ledgers.
end note
bu -> ui: Validate finalisation file
ui -> el: POST: /settlements:finalize
el -> el: Fatal: Validate file format \n Load file into JSON object
note left 
{
  "finalisationReference":"SettlementFinalisationFilename.xlsx" # (string),
  "settlementId" : 10 , # settlement batch id (integer) 
  "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "externalBalance": 10000, # external balance of settlement account (number)
      "netSettlementAmount": {
            "amount": 0, # number
            "currency": "XXX" # currency string (CurrencyEnum)
          }
    }  ] # all participants that are involved in the settlement
}
end note

el -> pl: **Validate finalisation** POST: /settlements:finalize
group load settlement data
pl->moja: Get settlement information \n**GET central-settlements/settlements/{id}**
pl->moja: Get all participants\n **GET central-ledger/participants**
pl->moja: Get all participants limits\n **GET central-ledger/participants/limits**
pl->moja: For each participant get account balance\n **GET central-ledger/participants/{name}/accounts**
end
group Process validation 
pl -> pl: Fatal: Validate Participants and their \n accounts ids are valid, match, \nand are the correct type, and correct currency
pl -> pl: Fatal: Validate Settlement Id non-matching
pl -> pl: Fatal: Validate Participant Settlement data \ntransfer sum is zero
pl -> pl: Fatal: Validate Participant Settlement data \nmatches net settlement amount
end
group Calculate Adjustments and Warnings
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is expected \n Return warnings if there are discrepencies
pl -> pl: Non fatal: Validate Participant Settlement \nbalance is zero or positive
end 
pl- -> el: Return finalisation validation results
note right
  {
    "finalisationId": "GUIDv4", # Guid version 4 (string)
    "valid":true, # (boolean) true if none failure error
    "errors": [{"type": "string", "message": "description", "errorInformation": {...}}],
    "warnings": [{"type": "string", "message": "description", "errorInformation": {...}}]
  }
end note
el- -> ui: Show validation results to user
ui- -> bu: 

bu -> ui: User confirms proceeding with finalisation
ui -> el: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  finalisationId:"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  balanceSettlementOption: true # (boolean)
}
end note
el -> pl: **Confirm Finalisation** POST: /settlements:confirmFinalize
note left
{
  "finalisationId":"GUIDv4", (string)
  "settlementId" : 10 , # settlement batch id (integer) 
  "balanceSettlementOption":true, # (boolean)
  "user":"userName" # (string)
}
end note

loop for each settlement debit participant
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
end

pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
note right moja
**Net debit** participant 
   position ledgers are adjusted
end note

end loop
loop for each settlement credit participant
alt if balanceSettlementOption is true 
pl->moja: Adjust settlment account according to settlement (funds In)\n POST /participants/{name}/accounts/{id}
end
note left pl
  reason: "Settlement Finanisation"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Advance state to Settled\nPUT central-settlements/settlements/{sid}/participants/{pid}/accounts/{aid} \n PUT /settlements/{sid}/participants/{pid}
end loop
alt if balanceSettlementOption is true 
loop For each participant rebalance Settlement account  
pl->moja: Get latest balance \n **GET central-ledger/participants/{name}/accounts**
pl->moja: if < actual balance then\n increase balance (funds In)\n POST central-ledger/participants/{name}/accounts/{id}
pl->moja: if > actual balance then\n decrease balance (funds Out)\n POST central-ledger/participants/{name}/accounts/{id}\nConfirm PUT /participants/{name}/accounts/{id}/transfers/{transferId}
note left pl
  reason: "Settlement Rebalance"
  extension list: 
    [ { 'key'='user', 'value'='username'},
      { 'key'='reference', 'value'='finalisatonReference'} ]
end note
pl->moja: Confirm correct balance\n **GET central-ledger/participants/{name}/accounts**
end 
end

pl- ->el: Response
note right 
  {
    "state": "string",
    "participants" : [
    { 
      "name": "payerfsp",# mojaloop participant name (string) 
      "id": 1, # mojaloop database id (integer)
      "settlementAccountId": 1, # settlement account id for participant (integer)
      "errors": [{"type": "string", "message": "description", "errorInformation": {...}}] # errorInformation std fspiop error information object
    }]
  }
end note
el- ->ui: Settlement \n Process \n Completed (Update settlement Status or display errors)

@enduml

PlantUML version 1.2020.13(Sat Jun 13 13:26:38 BST 2020)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) Client VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>