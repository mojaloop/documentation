<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2588px" preserveAspectRatio="none" style="width:4470px;height:2588px;background:#FFFFFF;" version="1.1" viewBox="0 0 4470 2588" width="4470px" zoomAndPan="magnify"><defs/><g><rect height="26.2969" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="169" x="2146.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159" x="2151.5" y="27.9951">Settlement Process</text><rect height="168.75" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1994" x="2133.5" y="738.1094"/><rect height="1460.9375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2948.5" x="1504.5" y="975.7969"/><rect height="412.1875" style="stroke:#000000;stroke-width:1.5;fill:none;" width="2309.5" x="2133.5" y="1494.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="520" x2="520" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="809" x2="809" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1163.5" x2="1163.5" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1625.5" x2="1625.5" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="2232.5" x2="2232.5" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="3918.5" x2="3918.5" y1="130.2344" y2="2495.6719"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="4057.5" x2="4057.5" y1="130.2344" y2="2495.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="336" x="349" y="124.5742">Business Hub Operator User</text><ellipse cx="520" cy="50.7969" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M520,58.7969 L520,85.7969 M507,66.7969 L533,66.7969 M520,85.7969 L507,100.7969 M520,85.7969 L533,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="336" x="349" y="2516.9492">Business Hub Operator User</text><ellipse cx="520" cy="2531.1094" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M520,2539.1094 L520,2566.1094 M507,2547.1094 L533,2547.1094 M520,2566.1094 L507,2581.1094 M520,2566.1094 L533,2581.1094 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="701" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="708" y="116.5742">Settlement Bank</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="701" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="203" x="708" y="2523.9492">Settlement Bank</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="1069.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="1076.5" y="116.5742">Micro-frontend</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="189" x="1069.5" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="175" x="1076.5" y="2523.9492">Micro-frontend</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="223" x="1514.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="209" x="1521.5" y="116.5742">Experience Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="223" x="1514.5" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="209" x="1521.5" y="2523.9492">Experience Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2143.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="165" x="2150.5" y="116.5742">Process Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="179" x="2143.5" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="165" x="2150.5" y="2523.9492">Process Layer</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="3849.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="125" x="3856.5" y="116.5742">Report API</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139" x="3849.5" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="125" x="3856.5" y="2523.9492">Report API</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="3998.5" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="105" x="4005.5" y="116.5742">Mojaloop</text><rect fill="#E3E3E3" height="41.9375" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="3998.5" y="2494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="105" x="4005.5" y="2523.9492">Mojaloop</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4463" x="0" y="167.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4463" y1="167.2031" y2="167.2031"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4463" y1="170.2031" y2="170.2031"/><rect fill="#EEEEEE" height="35.9375" style="stroke:#000000;stroke-width:2.0;" width="289" x="2087" y="150.2344"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="267" x="2093" y="176.5117">Initiate Settlement</text><polygon fill="#181818" points="1152,243.0781,1162,247.0781,1152,251.0781,1156,247.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="520" x2="1158" y1="247.0781" y2="247.0781"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="527" y="239.418">1</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="599" x="548" y="239.418">Initiate Settlement for these windows &amp; Currency</text><path d="M5,201.1719 L5,266.1719 L515,266.1719 L515,211.1719 L505,201.1719 L5,201.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M505,201.1719 L505,211.1719 L515,211.1719 L505,201.1719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="371" x="11" y="228.4492">List of Settlement windows Ids</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="489" x="11" y="256.3867">[Optional] Currency or Settlement Model</text><polygon fill="#181818" points="1614,388.7969,1624,392.7969,1614,396.7969,1618,392.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1164" x2="1620" y1="392.7969" y2="392.7969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="1171" y="385.1367">2</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="324" x="1191" y="385.1367">POST: /settlements:initiate</text><path d="M601,277.0469 L601,482.0469 L1159,482.0469 L1159,287.0469 L1149,277.0469 L601,277.0469 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1149,277.0469 L1149,287.0469 L1159,287.0469 L1149,277.0469 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="302" x="607" y="304.3242">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="639" y="332.2617">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="76" x="655" y="360.1992">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="454" x="639" y="388.1367">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="529" x="615" y="416.0742">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="449" x="615" y="444.0117">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="615" y="471.9492">}</text><polygon fill="#181818" points="2221,618.3281,2231,622.3281,2221,626.3281,2225,622.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1626" x2="2227" y1="622.3281" y2="622.3281"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="1633" y="614.668">3</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="324" x="1654" y="614.668">POST: /settlements:initiate</text><path d="M1063,492.6094 L1063,725.6094 L1621,725.6094 L1621,502.6094 L1611,492.6094 L1063,492.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1611,492.6094 L1611,502.6094 L1621,502.6094 L1611,492.6094 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="302" x="1069" y="519.8867">{"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="1101" y="547.8242">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="76" x="1117" y="575.7617">"id": 0</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="454" x="1101" y="603.6992">}], #settlement window id's (integer)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="529" x="1077" y="631.6367">"settlementModel":"defered net", # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="449" x="1077" y="659.5742">"currency", :"XXX" # (currencyEnum)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="478" x="1077" y="687.5117">"user": "hub operators name" # (string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="1077" y="715.4492">}</text><path d="M2133.5,738.1094 L2598.5,738.1094 L2598.5,758.0469 L2588.5,768.0469 L2133.5,768.0469 L2133.5,738.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="168.75" style="stroke:#000000;stroke-width:1.5;" width="1994" x="2133.5" y="738.1094"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="420" x="2148.5" y="761.3867">determine settlement Model/s</text><polygon fill="#181818" points="4046,797.9844,4056,801.9844,4046,805.9844,4050,801.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="4052" y1="801.9844" y2="801.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="2240" y="794.3242">4</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="1023" x="2261" y="794.3242">Load currencies for windows using GET central-settlements/settlementWindows/{id}</text><polygon fill="#181818" points="4046,839.9219,4056,843.9219,4046,847.9219,4050,843.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="4052" y1="843.9219" y2="843.9219"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="2240" y="836.2617">5</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="810" x="2260" y="836.2617">Load settlementModels using GET central-ledger/settlementModels</text><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="2275" y1="885.8594" y2="885.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2275" x2="2275" y1="885.8594" y2="898.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="2234" x2="2275" y1="898.8594" y2="898.8594"/><polygon fill="#181818" points="2244,894.8594,2234,898.8594,2244,902.8594,2240,898.8594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="2240" y="878.1992">6</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="1652" x="2260" y="878.1992">Determine minimum list of settlementModels, return a map for each settlementModel containing a list of applicable settlementWindows</text><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="2275" y1="947.7969" y2="947.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="2275" x2="2275" y1="947.7969" y2="960.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="2234" x2="2275" y1="960.7969" y2="960.7969"/><polygon fill="#181818" points="2244,956.7969,2234,960.7969,2244,964.7969,2240,960.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="2240" y="940.1367">7</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="98" x="2261" y="940.1367">Validate</text><path d="M1504.5,975.7969 L1586.5,975.7969 L1586.5,995.7344 L1576.5,1005.7344 L1504.5,1005.7344 L1504.5,975.7969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1460.9375" style="stroke:#000000;stroke-width:1.5;" width="2948.5" x="1504.5" y="975.7969"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="37" x="1519.5" y="999.0742">alt</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="236" x="1601.5" y="1000.0742">[Validation Error]</text><polygon fill="#181818" points="1637,1261.1406,1627,1265.1406,1637,1269.1406,1633,1265.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1631" x2="2232" y1="1265.1406" y2="1265.1406"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="16" x="1643" y="1243.5117">8</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="291" x="1663" y="1229.543">Return Error HTTP: code</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="1663" y="1257.4805"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="497" x="1671" y="1257.4805">Ref: Initiate Settlement Error Codes</text><path d="M2238,1023.6719 L2238,1452.6719 L2623,1452.6719 L2623,1033.6719 L2613,1023.6719 L2238,1023.6719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M2613,1023.6719 L2613,1033.6719 L2623,1033.6719 L2613,1023.6719 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2244" y="1050.9492">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="251" x="2260" y="1078.8867">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="181" x="2276" y="1106.8242">"errorCode": 0,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="332" x="2276" y="1134.7617">"errorDescription": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="213" x="2276" y="1162.6992">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="164" x="2292" y="1190.6367">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2308" y="1218.5742">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="180" x="2324" y="1246.5117">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="194" x="2324" y="1274.4492">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2308" y="1302.3867">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="9" x="2292" y="1330.3242">]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2276" y="1358.2617">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2260" y="1386.1992">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2244" y="1414.1367">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2244" y="1442.0742"> </text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1504.5" x2="4453" y1="1458.7344" y2="1458.7344"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="275" x="1509.5" y="1481.0117">[Validation Success]</text><path d="M2133.5,1494.6719 L2235.5,1494.6719 L2235.5,1514.6094 L2225.5,1524.6094 L2133.5,1524.6094 L2133.5,1494.6719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="412.1875" style="stroke:#000000;stroke-width:1.5;" width="2309.5" x="2133.5" y="1494.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="57" x="2148.5" y="1517.9492">loop</text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="330" x="2250.5" y="1518.9492">[for settlement models]</text><polygon fill="#181818" points="4046,1623.3594,4056,1627.3594,4046,1631.3594,4050,1627.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="4052" y1="1627.3594" y2="1627.3594"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="17" x="2240" y="1591.7617">9</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="221" x="2261" y="1563.8242">Create settlement</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2261" y="1591.7617"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="543" x="2269" y="1591.7617">POST: central-settlements/settlements</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2812" y="1591.7617"> </text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="530" x="2261" y="1619.6992">{settlementModel, settlementWindowIds[]}</text><polygon fill="#181818" points="4046,1721.1719,4056,1725.1719,4046,1729.1719,4050,1725.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="4052" y1="1725.1719" y2="1725.1719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2240" y="1689.5742">10</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2278" y="1661.6367">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="425" x="2286" y="1689.5742">state to PS_TRANSFERS_RECORDED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2278" y="1717.5117"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="593" x="2286" y="1717.5117">PUT: central-settlements/settlements/{id}</text><polygon fill="#181818" points="4046,1818.9844,4056,1822.9844,4046,1826.9844,4050,1822.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2233" x2="4052" y1="1822.9844" y2="1822.9844"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="2240" y="1787.3867">11</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="483" x="2278" y="1759.4492">Advance settlement participant account</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="419" x="2286" y="1787.3867">state to PS_TRANSFERS_RESERVED</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="8" x="2278" y="1815.3242"> </text><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="593" x="2286" y="1815.3242">PUT: central-settlements/settlements/{id}</text><path d="M4063,1835.9844 L4063,1900.9844 L4433,1900.9844 L4433,1845.9844 L4423,1835.9844 L4063,1835.9844 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M4423,1835.9844 L4423,1845.9844 L4433,1845.9844 L4423,1835.9844 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="139" x="4069" y="1863.2617">Net credit</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="130" x="4216" y="1863.2617">participant</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="349" x="4069" y="1891.1992">position ledgers are adjusted</text><polygon fill="#181818" points="1637,2184.2656,1627,2188.2656,1637,2192.2656,1633,2188.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1631" x2="2232" y1="2188.2656" y2="2188.2656"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1643" y="2180.6055">12</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="546" x="1680" y="2180.6055">Return response, success/warnings HTTP:200</text><path d="M2238,1918.8594 L2238,2430.8594 L3202,2430.8594 L3202,1928.8594 L3192,1918.8594 L2238,1918.8594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M3192,1918.8594 L3192,1928.8594 L3202,1928.8594 L3192,1918.8594 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="9" x="2244" y="1946.1367">[</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2260" y="1974.0742">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="513" x="2276" y="2002.0117">"settlementModel":"defered-net" #(string)</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="911" x="2276" y="2029.9492">"settlement": {... map settlement object from settlements api }, #optional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="383" x="2276" y="2057.8867">"errorInformation": { # optional</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="181" x="2308" y="2085.8242">"errorCode": 0,</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="332" x="2308" y="2113.7617">"errorDescription": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="213" x="2308" y="2141.6992">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="164" x="2324" y="2169.6367">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2340" y="2197.5742">{</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="180" x="2356" y="2225.5117">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="194" x="2356" y="2253.4492">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2340" y="2281.3867">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="9" x="2324" y="2309.3242">]</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2308" y="2337.2617">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2292" y="2365.1992">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="15" x="2276" y="2393.1367">}</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="9" x="2244" y="2421.0742">]</text><polygon fill="#181818" points="1175,2473.6719,1165,2477.6719,1175,2481.6719,1171,2477.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1169" x2="1625" y1="2477.6719" y2="2477.6719"/><text fill="#000000" font-family="sans-serif" font-size="24" font-weight="bold" lengthAdjust="spacing" textLength="34" x="1181" y="2470.0117">13</text><text fill="#000000" font-family="sans-serif" font-size="24" lengthAdjust="spacing" textLength="400" x="1219" y="2470.0117">Update UI with settlement status</text><!--MD5=[303f415284abdc3eb84535a43a943a55]
@startuml
skinparam activityFontSize 4
skinparam activityDiamondFontSize 30
skinparam activityArrowFontSize 24
skinparam defaultFontSize 24
skinparam noteFontSize 24
skinparam monochrome true
autonumber

title Settlement Process

actor "Business Hub Operator User" as bu

participant "Settlement Bank" as sbank
participant "Micro-frontend" as ui
participant "Experience Layer" as el
participant "Process Layer" as pl
participant "Report API" as report
participant "Mojaloop" as moja


== Initiate Settlement ==
bu->ui: Initiate Settlement for these windows & Currency

note left
List of Settlement windows Ids
[Optional] Currency or Settlement Model
end note

ui->el: POST: /settlements:initiate 
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 }
end note
el->pl: POST: /settlements:initiate
note left
{"settlementWindows": [
    {
      "id": 0
    }], #settlement window id's (integer)
 "settlementModel":"defered net", # (string)
 "currency", :"XXX" # (currencyEnum)
 "user": "hub operators name" # (string) 
 }
end note
group determine settlement Model/s 
pl->moja: Load currencies for windows using GET central-settlements/settlementWindows/{id}
pl->moja: Load settlementModels using GET central-ledger/settlementModels 
pl->pl: Determine minimum list of settlementModels, return a map for each settlementModel containing a list of applicable settlementWindows
end
pl->pl: Validate
alt Validation Error
  pl- ->el: Return Error HTTP: code \n <b>Ref: Initiate Settlement Error Codes</b>

  note right
    {
      "errorInformation": { 
        "errorCode": 0,
        "errorDescription": "string",
        "extensionList": {
          "extension": [
            {
              "key": "string",
              "value": "string" 
            }
          ] 
        }
      }
    }

  end note
else Validation Success
  loop for settlement models
  pl->moja: Create settlement \n **POST: central-settlements/settlements** \n{settlementModel, settlementWindowIds[]}
  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RECORDED \n **PUT: central-settlements/settlements/{id}**
  pl->moja: Advance settlement participant account\n state to PS_TRANSFERS_RESERVED \n **PUT: central-settlements/settlements/{id}** 

  note right moja
  **Net credit** participant 
  position ledgers are adjusted
  end note
  end loop

  pl- ->el: Return response, success/warnings HTTP:200
  note right
  [
    {
      "settlementModel":"defered-net" #(string)
      "settlement": {... map settlement object from settlements api }, #optional
      "errorInformation": { # optional
          "errorCode": 0,
          "errorDescription": "string",
          "extensionList": {
            "extension": [
              {
                "key": "string",
                "value": "string" 
              } 
            ] 
          } 
        }
      }
  ]
  end note
end

el- ->ui: Update UI with settlement status
@enduml

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>