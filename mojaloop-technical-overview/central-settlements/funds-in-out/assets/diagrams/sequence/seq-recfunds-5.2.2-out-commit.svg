<svg xmlns="http://www.w3.org/2000/svg" height="1471" preserveAspectRatio="none" style="width:1494px;height:1471px" width="1494">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="522" x="484" y="28.708">
    5.2.2. Record Funds Out Commit (recordFundsOutCommit)
  </text>
  <path fill="#FFB6C1" stroke="#a80036" d="M16 40.953h114v1424.563H16z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="28.5" y="53.02">
    Central HUB
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M291.5 40.953H1227v1424.563H291.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="703.75" y="53.02">
    Central Service
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M345 298.313h10v546.984h-10zM582 699.5h10v116.664h-10zM784 153.383h10v1215.836h-10zM931 903.563h10v450.656h-10zM1170 980.961h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 160.383h1470v1201.836H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M867 918.563h603v407.523H867z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M877 942.695h583v376.391H877z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M73 143.383v1235.836M349.5 143.383v1235.836M587 143.383v1235.836M788.5 143.383v1235.836M936 143.383v1235.836M1175 143.383v1235.836"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="20" y="140.081">
    Hub Employee
  </text>
  <circle cx="73" cy="70.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="8"/>
  <path d="M73 78.086v27m-13-19h26m-13 19l-13 15m13-15l13 15" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="20" y="1391.214">
    Hub Employee
  </text>
  <circle cx="73" cy="1404.516" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="8"/>
  <path d="M73 1412.516v27m-13-19h26m-13 19l-13 15m13-15l13 15" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="295.5" y="123.784">
    Central Service
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="315" y="140.081">
    Admin API
  </text>
  <path d="M329.5 82.79v24m0-12h17" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <circle cx="358.5" cy="94.789" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="295.5" y="1391.214">
    Central Service
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="315" y="1407.511">
    Admin API
  </text>
  <path d="M329.5 1414.813v24m0-12h17" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <circle cx="358.5" cy="1426.813" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M506 104.086h162v30.297H506z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M502 108.086h162v30.297H502z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="509" y="128.081">
    Admin-Transfer-Topic
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M506 1378.219h162v30.297H506z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M502 1382.219h162v30.297H502z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="509" y="1402.214">
    Admin-Transfer-Topic
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="714.5" y="140.081">
    Admin Event Handler
  </text>
  <circle cx="789" cy="111.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M785 99.086l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="714.5" y="1391.214">
    Admin Event Handler
  </text>
  <circle cx="789" cy="1410.516" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M785 1398.516l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="887" y="140.081">
    Transfer DAO
  </text>
  <circle cx="936" cy="111.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M924 125.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="887" y="1391.214">
    Transfer DAO
  </text>
  <circle cx="936" cy="1410.516" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M924 1424.516h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1127" y="140.081">
    Central Store
  </text>
  <path d="M1157 91.086c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1157 91.086c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1127" y="1391.214">
    Central Store
  </text>
  <path d="M1157 1404.516c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1157 1404.516c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M345 298.313h10v546.984h-10zM582 699.5h10v116.664h-10zM784 153.383h10v1215.836h-10zM931 903.563h10v450.656h-10zM1170 980.961h10v30h-10z"/>
  <path d="M10 160.383h240v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 160.383h1470v1201.836H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="25" y="173.45">
    Record Funds Out Commit
  </text>
  <path d="M78 182.516v70h261v-60l-10-10H78" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M329 182.516v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="84" y="199.583">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="100" y="214.715">
    &quot;action&quot;: &quot;recordFundsOutCommit&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="100" y="229.848">
    &quot;reason&quot;: &quot;string&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="84" y="244.981">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M333 294.313l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M73 298.313h266"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="80" y="285.68">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="93" y="278.114">
    PUT - /participants/{name}/accounts/
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="137" y="293.247">
    {id}/transfers/{transferId}
  </text>
  <path d="M360 311.313v342h283v-332l-10-10H360" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M633 311.313v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="366" y="328.379">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="366" y="343.512">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="382" y="358.645">
    id: &lt;payload.transferId&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="382" y="373.778">
    from: &quot;Hub&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="382" y="388.911">
    to: &quot;dfspName&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="382" y="404.043">
    type: &quot;application/json&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="382" y="419.176">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="398" y="434.309">
    headers: &lt;payloadHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="398" y="449.442">
    payload: &lt;payloadMessage&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="464.575">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="382" y="479.707">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="398" y="494.84">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="414" y="509.973">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="414" y="525.106">
    responseTo: &quot;&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="414" y="540.239">
    type: &quot;transfer&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="414" y="555.372">
    action: &quot;recordFundsOutCommit&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="414" y="570.504">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="414" y="585.637">
    state: &quot;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="398" y="600.77">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="382" y="615.903">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="382" y="631.036">
    pp: &quot;&quot;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="366" y="646.168">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M570 695.5l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M355 699.5h221"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="362" y="686.868">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="375" y="679.301">
    Route &amp; Publish Prepare event
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="375" y="694.434">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="461" y="694.434">
    2003
  </text>
  <path stroke="#a80036" d="M592 758.898h42M634 758.898v13M593 771.898h41"/>
  <path fill="#A80036" stroke="#a80036" d="M603 767.898l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="599" y="738.7">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="612" y="723.567">
    Ensure event is replicated
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="612" y="738.7">
    as configured (ACKS=all)
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="612" y="753.832">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="698" y="753.832">
    2003
  </text>
  <path fill="#A80036" stroke="#a80036" d="M366 812.164l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M360 816.164h226"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="372" y="803.532">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="385" y="795.965">
    Respond replication acks
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="385" y="811.098">
    have been received
  </text>
  <path fill="#A80036" stroke="#a80036" d="M84 841.297l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M78 845.297h271"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="90" y="840.231">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="103" y="840.231">
    Respond HTTP - 202 (Accepted)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M598 870.43l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M592 874.43h191"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="604" y="869.364">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="617" y="869.364">
    Consume message
  </text>
  <path fill="#A80036" stroke="#a80036" d="M919 899.563l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M794 903.563h131"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="801" y="898.497">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="814" y="898.497">
    Commit transfer
  </text>
  <path d="M867 918.563h173v7l-10 10H867v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M867 918.563h603v407.523H867z"/>
  <text fill="#00F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="882" y="931.629">
    DB TRANSACTION
  </text>
  <path d="M877 942.695h275v7l-10 10H877v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M877 942.695h583v376.391H877z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="230" x="892" y="955.762">
    Reconciliation Transfer Commit
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1158 976.96l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M941 980.961h223"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="948" y="975.895">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="961" y="975.895">
    Insert transferFulfilment record
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M909 1023.96h531l10 41-10 42H909l-10-42 10-41z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="911" y="1040.028">
    INSERT INTO
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="994" y="1040.028">
    transferFulfilment
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="927" y="1055.161">
    (transferFulfilmentId, transferId, ilpFulfilment,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="927" y="1070.293">
    completedDate, isValid, settlementWindowId, createdDate)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="911" y="1085.426">
    VALUES ({transferFulfilmentId}, {payload.transferId}, 0, {transactionTimestamp},
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="927" y="1100.559">
    1, NULL, {transactionTimestamp})
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M884 1137.625h338v176.461H884z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M884 1137.625h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="897" y="1151.692">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="921" y="1170.692">
    transferStateAndPositionUpdate
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="921" y="1185.825">
    ({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="937" y="1200.957">
    transferId: {payload.transferId},
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="937" y="1216.09">
    transferStateId: &quot;COMMITTED&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="937" y="1231.223">
    reason: {payload.reason},
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="937" y="1246.356">
    createdDate: {transactionTimestamp},
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="937" y="1261.489">
    drUpdated: false,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="937" y="1276.622">
    crUpdated: true
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="921" y="1291.754">
    }, trx)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M805 1350.219l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M799 1354.219h136"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="811" y="1349.153">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="824" y="1349.153">
    Finished await
  </text>
</svg>
