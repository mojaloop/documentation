<svg xmlns="http://www.w3.org/2000/svg" height="8463" preserveAspectRatio="none" style="width:1605px;height:8463px" width="1605">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="647" x="477.25" y="28.708">
    6.2.5. Acknowledgement of Settlement Transfer (updateSettlementById)
  </text>
  <path fill="#FFB6C1" stroke="#a80036" d="M281 40.953h114v8416.852H281z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="293.5" y="53.02">
    Central HUB
  </text>
  <path fill="#90EE90" stroke="#a80036" d="M438.5 40.953h382v8416.852h-382z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="560" y="53.02">
    Settlement Service
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M1206 40.953h125v8416.852h-125z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="1209" y="53.02">
    Central Services
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M333 153.383h10v8193.125h-10zM518 525.305h10v7821.203h-10zM753 569.57h10v6876.367h-10zM1263.5 622.836h10v183.328h-10zM1263.5 835.297h10v228.727h-10zM1263.5 5269.648h10v62.266h-10zM1263.5 5433.445h10v30h-10zM1263.5 6215.906h10v30h-10zM1263.5 6405.969h10v137.93h-10zM1263.5 7241.273h10v62.266h-10zM1263.5 7332.672h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 160.383h1581.5v8194.125H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M659.5 584.57h922v6833.234h-922z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 1984.664H1152v761.414H689.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M758 2359.188h384v379.891H758z"/>
  <path fill="#FFF" d="M758 2415.453h384v53.938H758zM758 2469.391h384v53.938H758z"/>
  <path fill="#FFF" d="M758 2523.328h384v53.938H758zM758 2577.266h384v53.938H758z"/>
  <path fill="#FFF" d="M758 2631.203h384v53.938H758zM758 2685.141h384v53.938H758z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M669.5 3026.539h902v2190.844h-902z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M679.5 3177.336h882v2033.047h-882z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 3282.734h862v1920.648h-862z"/>
  <path fill="#FFF" d="M689.5 3471.93h862v186.867h-862zM689.5 3658.797h862v247.398h-862zM689.5 3906.195h862v338.195h-862zM689.5 4244.391h862v14.805h-862z"/>
  <path fill="#FFF" d="M689.5 4259.195h862V4274h-862zM689.5 4274h862v14.805h-862zM689.5 4288.805h862v679.984h-862z"/>
  <path fill="#FFF" d="M689.5 4968.789h862v234.594h-862z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 5231.383H1506v394.258H689.5zM679.5 5639.641h657v499.867h-657z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 5663.773h637v468.734h-637z"/>
  <path fill="#FFF" d="M689.5 5821.57h637v155.469h-637zM689.5 5977.039h637v155.469h-637z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M679.5 6153.508H1426v440.523H679.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 6177.641H1416v200.195H689.5zM679.5 6608.031H1441v802.773H679.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M758 6671.297h612v463.445H758z"/>
  <path fill="#FFF" d="M758 6753.305h612v81.875H758zM758 6835.18h612v81.875H758zM758 6917.055h612v94.68H758z"/>
  <path fill="#FFF" d="M758 7011.734h612v81.875H758zM758 7093.609h612v41.133H758z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M689.5 7148.742H1431v255.063H689.5z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M338 143.383v8228.125M522.5 143.383v8228.125M757.5 143.383v8228.125M1268.5 143.383v8228.125"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="285" y="140.081">
    Hub Employee
  </text>
  <circle cx="338" cy="70.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="8"/>
  <path d="M338 78.086v27m-13-19h26m-13 19l-13 15m13-15l13 15" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="285" y="8383.503">
    Hub Employee
  </text>
  <circle cx="338" cy="8396.805" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="8"/>
  <path d="M338 8404.805v27m-13-19h26m-13 19l-13 15m13-15l13 15" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="442.5" y="140.081">
    Settlement Service API
  </text>
  <path d="M502.5 99.086v24m0-12h17" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <circle cx="531.5" cy="111.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="442.5" y="8383.503">
    Settlement Service API
  </text>
  <path d="M502.5 8390.805v24m0-12h17" fill="none" filter="url(#a)" stroke="#a80036" stroke-width="2"/>
  <circle cx="531.5" cy="8402.805" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="699.5" y="140.081">
    Settlement DAO
  </text>
  <circle cx="758" cy="111.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M746 125.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="699.5" y="8383.503">
    Settlement DAO
  </text>
  <circle cx="758" cy="8402.805" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M746 8416.805h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1220.5" y="140.081">
    Central Store
  </text>
  <path d="M1250.5 91.086c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1250.5 91.086c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1220.5" y="8383.503">
    Central Store
  </text>
  <path d="M1250.5 8396.805c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1250.5 8396.805c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M333 153.383h10v8193.125h-10zM518 525.305h10v7821.203h-10zM753 569.57h10v6876.367h-10zM1263.5 622.836h10v183.328h-10zM1263.5 835.297h10v228.727h-10zM1263.5 5269.648h10v62.266h-10zM1263.5 5433.445h10v30h-10zM1263.5 6215.906h10v30h-10zM1263.5 6405.969h10v137.93h-10zM1263.5 7241.273h10v62.266h-10zM1263.5 7332.672h10v30h-10z"/>
  <path d="M10 160.383h354v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 160.383h1581.5v8194.125H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="309" x="25" y="173.45">
    Acknowledgement of Settlement Transfer
  </text>
  <path d="M348 182.516v312h729v-302l-10-10H348" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M1067 182.516v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="354" y="199.583">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="370" y="214.715">
    &quot;participants&quot;: [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="386" y="229.848">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="402" y="244.981">
    &quot;id&quot;: 1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="402" y="260.114">
    &quot;accounts&quot; : [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="418" y="275.247">
    { &quot;id&quot;: 1, &quot;state&quot;: &quot;PENDING_SETTLEMENT&quot;, &quot;reason&quot;: &lt;string&gt; },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="639" x="418" y="290.379">
    { &quot;id&quot;: 2, &quot;state&quot;: &quot;PS_TRANSFERS_RECORDED&quot;, &quot;reason&quot;: &lt;string&gt;, &quot;externalReference&quot;: &lt;string&gt; },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="436" x="418" y="305.512">
    { &quot;id&quot;: 3, &quot;state&quot;: &quot;PS_TRANSFERS_RESERVED&quot;, &quot;reason&quot;: &lt;string&gt; },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="644" x="418" y="320.645">
    { &quot;id&quot;: 4, &quot;state&quot;: &quot;PS_TRANSFERS_COMMITTED&quot;, &quot;reason&quot;: &lt;string&gt;, &quot;externalReference&quot;: &lt;string&gt; },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="418" y="335.778">
    { &quot;id&quot;: 5, &quot;state&quot;: &quot;SETTLED&quot;, &quot;reason&quot;: &lt;string&gt; }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="402" y="350.911">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="386" y="366.043">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="386" y="381.176">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="402" y="396.309">
    &quot;id&quot;: 2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="402" y="411.442">
    &quot;accounts&quot; : [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="418" y="426.575">
    { &quot;id&quot;: 6, &quot;state&quot;: &quot;SETTLED&quot;, &quot;reason&quot;: &lt;string&gt; }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="402" y="441.707">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="386" y="456.84">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="370" y="471.973">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="354" y="487.106">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M506 521.305l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M343 525.305h169"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="350" y="520.239">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="363" y="520.239">
    PUT - /settlement/{id}
  </text>
  <path fill="#A80036" stroke="#a80036" d="M741 565.57l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M528 569.57h219"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="535" y="556.938">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="548" y="549.372">
    updateSettlementById routine
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="548" y="564.504">
    Error code:
  </text>
  <text fill="red" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="634" y="564.504">
    2001
  </text>
  <path d="M659.5 584.57h173v7l-10 10h-163v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M659.5 584.57h922v6833.234h-922z"/>
  <text fill="#00F" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="674.5" y="597.637">
    DB TRANSACTION
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 618.836l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 622.836h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="770" y="617.77">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="783" y="617.77">
    Retrieve settlement information
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1074 635.836h389l10 72-10 72h-389l-10-72 10-72z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="1076" y="651.903">
    SELECT s.settlementId, ssc.settlementStateId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="1092" y="667.036">
    ssc.reason, ssc.createdDate, sm.autoPositionReset
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1076" y="682.168">
    FROM
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="1116" y="682.168">
    settlement
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="1200" y="682.168">
    s
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="1076" y="697.301">
    JOIN
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175" x="1106" y="697.301">
    settlementStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="1285" y="697.301">
    ssc
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="1076" y="712.434">
    ON ssc.settlementStateChangeId = s.currentStateChangeId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="1076" y="727.567">
    JOIN
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="1106" y="727.567">
    settlementModel
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="1235" y="727.567">
    sm
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="1076" y="742.7">
    ON sm.settlementModelId = s.settlementModelId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="1076" y="757.832">
    WHERE s.settlementId = {id}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="1076" y="772.965">
    FOR UPDATE
  </text>
  <path fill="#A80036" stroke="#a80036" d="M774 802.164l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M768 806.164h499.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="780" y="801.098">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="793" y="801.098">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="839" y="801.098">
    settlementData
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 831.297l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 835.297h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="770" y="830.231">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="783" y="830.231">
    Retrive settlement accounts information
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1071 848.297h395l10 94-10 95h-395l-10-95 10-94z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="1073" y="864.364">
    SELECT pc.participantId, spc.participantCurrencyId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="1089" y="879.497">
    spcsc.settlementStateId, spcsc.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="1089" y="894.629">
    spcsc.createdDate, spc.netAmount, pc.currencyId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="1089" y="909.762">
    spc.settlementParticipantCurrencyId AS
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1347" y="909.762">
    key
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1073" y="924.895">
    FROM
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="226" x="1113" y="924.895">
    settlementParticipantCurrency
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1343" y="924.895">
    spc
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="1073" y="940.028">
    JOIN
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="321" x="1103" y="940.028">
    settlementParticipantCurrencyStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1428" y="940.028">
    spcsc
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="1073" y="955.161">
    ON spcsc.settlementParticipantCurrencyStateChangeId =
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1073" y="970.293">
    spc.currentStateChangeId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="1073" y="985.426">
    JOIN
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="1103" y="985.426">
    participantCurrency
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="1253" y="985.426">
    pc
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="1073" y="1000.559">
    ON pc.participantCurrencyId = spc.participantCurrencyId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="1073" y="1015.692">
    WHERE spc.settlementId = {id}
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="1073" y="1030.825">
    FOR UPDATE
  </text>
  <path fill="#A80036" stroke="#a80036" d="M774 1060.023l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M768 1064.023h499.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="780" y="1058.957">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="793" y="1058.957">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="839" y="1058.957">
    settlementAccountsList
  </text>
  <path d="M768 1102.023v70h500v-60l-10-10H768" fill="#ADD8E6" filter="url(#a)" stroke="#a80036"/>
  <path d="M1258 1102.023v10h10l-10-10" fill="#ADD8E6" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="407" x="774" y="1119.09">
    All objects below are for the purpose of the syncronous request.
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="774" y="1134.223">
    If at some point, Node process memory limit is reached, we may decide to:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="478" x="774" y="1149.356">
    A. Limit the amount of transfers per window and windows per settlement or
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="451" x="774" y="1164.489">
    B. Move to asyncronous processing where we don&apos;t need these objects
  </text>
  <path d="M768 1186.555v494h678v-484l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1436 1186.555v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="774" y="1203.622">
    Available raw datasets from DB:
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="774" y="1218.754">
    settlementData
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="893" y="1218.754">
    contains information about settlement and its current state/reason
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="774" y="1233.887">
    settlementAccountsList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="951" y="1233.887">
    holds information about all accounts and their current state/reason
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="774" y="1264.153">
    Local variables and objects:
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="774" y="1279.286">
    settlementAccounts
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="921" y="1279.286">
    : { // (derived from
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1043" y="1279.286">
    settlementAccountsList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1194" y="1279.286">
    )
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="574" x="790" y="1294.418">
    pendingSettlementCount: &lt;integer&gt;, // count of accounts in PENDING_SETTLEMENT state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="614" x="790" y="1309.551">
    psTransfersRecordedCount: &lt;integer&gt;, // count of accounts in PS_TRANSFERS_RECORDED state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="610" x="790" y="1324.684">
    psTransfersReservedCount: &lt;integer&gt;, // count of accounts in PS_TRANSFERS_RESERVED state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="631" x="790" y="1339.817">
    psTransfersCommittedCount: &lt;integer&gt;, // count of accounts in PS_TRANSFERS_COMMITTED state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="403" x="790" y="1354.95">
    settledCount: &lt;integer&gt;, // count of accounts in SETTLED state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="790" y="1370.082">
    abortedCount: &lt;integer&gt; // count of accounts in ABORTED state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="790" y="1385.215">
    unknownCount: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="790" y="1400.348">
    settledIdList: &lt;array&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="790" y="1415.481">
    changedIdList: &lt;array&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="774" y="1430.614">
    }
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="774" y="1445.747">
    settlementAccountsInit
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="948" y="1445.747">
    copy of previous object to be preserved for comparission at the end
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="774" y="1460.879">
    allAccounts
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="413" x="858" y="1460.879">
    : { // same as previous but accessed by account id (derived from
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1275" y="1460.879">
    settlementAccountsList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1426" y="1460.879">
    )
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="790" y="1476.012">
    participantCurrencyId_key: { // number used to access the object in map-like style
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="806" y="1491.145">
    id: participantCurrencyId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="806" y="1506.278">
    state: settlementStateId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="806" y="1521.411">
    reason: reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="806" y="1536.543">
    createdDate: createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="806" y="1551.676">
    netSettlementAmount: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="822" y="1566.809">
    amount: netAmount,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="822" y="1581.942">
    currency: currencyId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="806" y="1597.075">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="462" x="806" y="1612.207">
    participantId: participantId, // could be used to reconstruct allParticipants
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="806" y="1627.34">
    key:
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="836" y="1627.34">
    key
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="862" y="1627.34">
    // will be used to insert new state for settlementParticipantCurrency
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="790" y="1642.473">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="774" y="1657.606">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="774" y="1672.739">
    let
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="794" y="1672.739">
    transactionTimestamp
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="963" y="1672.739">
    = now()
  </text>
  <path stroke="#a80036" d="M763 1735.938h42M805 1735.938v13M764 1748.938h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 1744.938l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="770" y="1730.872">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="783" y="1730.872">
    Declare and initialize variables
  </text>
  <path d="M768 1761.938v206h288v-196l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1046 1761.938v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="774" y="1779.004">
    let settlementAccounts = {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="790" y="1794.137">
    pendingSettlementCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="790" y="1809.27">
    psTransfersRecordedCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="790" y="1824.403">
    psTransfersReservedCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="790" y="1839.536">
    psTransfersCommittedCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="790" y="1854.668">
    settledCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="790" y="1869.801">
    abortedCount: 0,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="790" y="1884.934">
    unknownCount: 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="774" y="1900.067">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="774" y="1915.2">
    let allAccounts = {} // declare map
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="774" y="1930.332">
    let pid // participantId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="774" y="1945.465">
    let aid // accountId (participantCurrencyId)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="774" y="1960.598">
    let state
  </text>
  <path d="M689.5 1984.664h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 1984.664H1152v761.414H689.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="704.5" y="1997.731">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="781.5" y="1996.874">
    [settlementAccountsList as account]
  </text>
  <path stroke="#a80036" d="M763 2022.93h42M805 2022.93v13M764 2035.93h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 2031.93l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="770" y="2017.864">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="783" y="2017.864">
    Populate
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="843" y="2017.864">
    allAccounts
  </text>
  <path d="M768 2048.93v252h256v-242l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1014 2048.93v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="774" y="2065.997">
    pid = account.participantId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="774" y="2081.129">
    aid = account.participantCurrencyId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="774" y="2096.262">
    state = account.settlementStateId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="774" y="2126.528">
    allAccounts[aid] = {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="790" y="2141.661">
    id: aid,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="790" y="2156.794">
    state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="790" y="2171.926">
    reason: account.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="790" y="2187.059">
    createDate: account.createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="790" y="2202.192">
    netSettlementAmount: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="806" y="2217.325">
    amount: account.netAmount,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="806" y="2232.457">
    currency: account.currencyId
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="790" y="2247.59">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="790" y="2262.723">
    participantId: pid,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="790" y="2277.856">
    key: account.key
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="774" y="2292.989">
    }
  </text>
  <path stroke="#a80036" d="M763 2331.188h42M805 2331.188v13M764 2344.188h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 2340.188l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="770" y="2326.122">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="783" y="2326.122">
    Populate
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="843" y="2326.122">
    settlementAccounts
  </text>
  <path d="M758 2359.188h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M758 2359.188h384v379.891H758z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="773" y="2372.254">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="837" y="2371.398">
    [state == &apos;PENDING_SETTLEMENT&apos;]
  </text>
  <path d="M768 2381.32v25h337v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1095 2381.32v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="774" y="2398.387">
    settlementAccounts.pendingSettlementCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2416.453h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="763" y="2426.664">
    [state == &apos;PS_TRANSFERS_RECORDED&apos;]
  </text>
  <path d="M768 2435.258v25h348v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1106 2435.258v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="774" y="2452.325">
    settlementAccounts.psTransfersRecordedCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2470.391h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="763" y="2480.601">
    [state == &apos;PS_TRANSFERS_RESERVED&apos;]
  </text>
  <path d="M768 2489.195v25h347v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1105 2489.195v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="774" y="2506.262">
    settlementAccounts.psTransfersReservedCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2524.328h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="763" y="2534.539">
    [state == &apos;PS_TRANSFERS_COMMITTED&apos;]
  </text>
  <path d="M768 2543.133v25h360v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1118 2543.133v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="774" y="2560.2">
    settlementAccounts.psTransfersCommittedCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2578.266h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="763" y="2588.476">
    [state == &apos;SETTLED&apos;]
  </text>
  <path d="M768 2597.07v25h258v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1016 2597.07v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="774" y="2614.137">
    settlementAccounts.settledCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2632.203h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="763" y="2642.414">
    [state == &apos;ABORTED&apos;]
  </text>
  <path d="M768 2651.008v25h264v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1022 2651.008v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="774" y="2668.075">
    settlementAccounts.abortedCount++
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 2686.141h384"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="763" y="2696.351">
    [default]
  </text>
  <path d="M768 2704.945v25h270v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1028 2704.945v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="774" y="2722.012">
    settlementAccounts.unknownCount++
  </text>
  <path stroke="#a80036" d="M763 2774.211h42M805 2774.211v13M764 2787.211h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 2783.21l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="2769.145">
    10
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="792" y="2769.145">
    Make a copy of settlementAccounts into
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="1053" y="2769.145">
    settlementAccountsInit
  </text>
  <path d="M768 2800.21v25h437v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1195 2800.21v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="416" x="774" y="2817.278">
    settlementAccountsInit = Object.assign({}, settlementAccounts)
  </text>
  <path d="M768 2864.344v146h707v-136l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1465 2864.344v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="774" y="2881.411">
    Available objects after the setup:
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="774" y="2896.544">
    settlementAccounts
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="925" y="2896.544">
    is used for tracing settlement state and state transition allowance
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="774" y="2911.676">
    allAccounts
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="478" x="862" y="2911.676">
    is helper object, same as previous, providing direct access to account by id
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="774" y="2941.942">
    Now we are ready to process the
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="987" y="2941.942">
    payload
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1046" y="2941.942">
    :
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="774" y="2957.075">
    participants
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="593" x="867" y="2957.075">
    = [] // part of the response object that lists the affected participants and respective accounts
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="321" x="774" y="2972.207">
    settlementParticipantCurrencyStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1099" y="2972.207">
    = [] // array to collect inserts to the table
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="305" x="774" y="2987.34">
    settlementParticipantCurrencySettledList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="1083" y="2987.34">
    = [] // array to collect settled accounts
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="774" y="3002.473">
    processedAccounts
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="922" y="3002.473">
    = [] // array to log processed accounts and restrict subsequent processing
  </text>
  <path d="M669.5 3026.54h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M669.5 3026.539h902v2190.844h-902z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="684.5" y="3039.606">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="761.5" y="3038.749">
    [let participant IN payload.participants]
  </text>
  <path stroke="#a80036" d="M763 3064.805h42M805 3064.805v13M764 3077.805h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3073.805l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3059.739">
    11
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="792" y="3059.739">
    Loop payload for each
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="937" y="3059.739">
    participantPayload
  </text>
  <path d="M768 3090.805v70h393v-60l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1151 3090.805v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="774" y="3107.872">
    let participantPayload = payload.participants[participant]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="774" y="3123.004">
    participants.push({id: participantPayload.id, accounts: []})
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="774" y="3138.137">
    let pi = participants.length - 1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="774" y="3153.27">
    participant = participants[pi]
  </text>
  <path d="M679.5 3177.336h77v7l-10 10h-67v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M679.5 3177.336h882v2033.047h-882z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="694.5" y="3190.403">
    loop
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="771.5" y="3189.546">
    [let account IN participantPayload.accounts]
  </text>
  <path stroke="#a80036" d="M763 3215.602h42M805 3215.602v13M764 3228.602h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3224.602l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3210.536">
    12
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="792" y="3210.536">
    Loop payload for each
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117" x="937" y="3210.536">
    accountPayload
  </text>
  <path d="M768 3241.602v25h402v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1160 3241.602v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="774" y="3258.669">
    let accountPayload = participantPayload.accounts[account]
  </text>
  <path d="M689.5 3282.734h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 3282.734h862v1920.648h-862z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="704.5" y="3295.801">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303" x="768.5" y="3294.945">
    [allAccounts[accountPayload.id] == undefined]
  </text>
  <path stroke="#a80036" d="M763 3321h42M805 3321v13M764 3334h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3330l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3315.934">
    13
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="792" y="3315.934">
    If the account doesn&apos;t match the settlement
  </text>
  <path d="M768 3347v115h287v-105l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1045 3347v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="3364.067">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="3379.2">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="790" y="3394.332">
    errorInformation: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="806" y="3409.465">
    errorCode: 3000,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="806" y="3424.598">
    errorDescription: &apos;Account not found&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="790" y="3439.731">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="3454.864">
    })
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 3472.93h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="457" x="694.5" y="3483.14">
    [participantPayload.id != allAccounts[accountPayload.id].participantId]
  </text>
  <path stroke="#a80036" d="M763 3507.867h42M805 3507.867v13M764 3520.867h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3516.867l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3502.801">
    14
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="792" y="3502.801">
    If the account doesn&apos;t match the participant
  </text>
  <path d="M768 3533.867v115h389v-105l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1147 3533.867v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="3550.934">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="3566.067">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="790" y="3581.2">
    errorInformation: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="806" y="3596.332">
    errorCode: 3000,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="806" y="3611.465">
    errorDescription: &apos;Participant and account mismatch&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="790" y="3626.598">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="3641.731">
    })
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 3659.797h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="346" x="694.5" y="3670.007">
    [processedAccounts.indexOf(accountPayload.id) &gt; -1]
  </text>
  <path stroke="#a80036" d="M763 3694.734h42M805 3694.734v13M764 3707.734h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3703.734l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3689.669">
    15
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="792" y="3689.669">
    If the account has been previosly processed (duplicated in the payload)
  </text>
  <path d="M768 3720.734v176h536v-166l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1294 3720.734v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="3737.801">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="3752.934">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="790" y="3768.067">
    state: allAccounts[accountPayload.id].state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="790" y="3783.2">
    reason: allAccounts[accountPayload.id].reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="375" x="790" y="3798.332">
    createdDate: allAccounts[accountPayload.id].createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="790" y="3813.465">
    netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="790" y="3828.598">
    errorInformation: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="806" y="3843.731">
    errorCode: 3000,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="325" x="806" y="3858.864">
    errorDescription: &apos;Account already processed once&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="790" y="3873.997">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="3889.129">
    })
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 3907.195h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="430" x="694.5" y="3917.406">
    [allAccounts[account.id].state == accountPayload.state // allowed]
  </text>
  <path stroke="#a80036" d="M763 3942.133h42M805 3942.133v13M764 3955.133h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 3951.133l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="3937.067">
    16
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="792" y="3937.067">
    Same-state reason amendment is always allowed
  </text>
  <path d="M768 3968.133v267h536v-257l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1294 3968.133v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="774" y="3985.2">
    processedAccounts.push(accountPayload.id)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="4000.332">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="4015.465">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="790" y="4030.598">
    state: accountPayload.state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="790" y="4045.731">
    reason: accountPayload.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="790" y="4060.864">
    externalReference: accountPayload.externalReference,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="790" y="4075.997">
    createdDate: transactionTimestamp,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="790" y="4091.129">
    netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="4106.262">
    })
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="774" y="4121.395">
    settlementParticipantCurrencyStateChange.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="790" y="4136.528">
    settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="790" y="4151.661">
    settlementStateId: accountPayload.state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="790" y="4166.793">
    reason: accountPayload.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="790" y="4181.926">
    externalReference: accountPayload.externalReference
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="4197.059">
    })
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="415" x="774" y="4212.192">
    allAccounts[accountPayload.id].reason = accountPayload.reason
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="774" y="4227.325">
    allAccounts[accountPayload.id].createdDate = currentTimestamp
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 4245.391h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="692" x="694.5" y="4255.601">
    [settlementData.state == &apos;PENDING_SETTLEMENT&apos; &amp;&amp; accountPayload.state == &apos;PS_TRANSFERS_RECORDED&apos;]
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 4260.195h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="713" x="694.5" y="4270.406">
    [settlementData.state == &apos;PS_TRANSFERS_RECORDED&apos; &amp;&amp; accountPayload.state == &apos;PS_TRANSFERS_RESERVED&apos;]
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 4275h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="722" x="694.5" y="4285.21">
    [settlementData.state == &apos;PS_TRANSFERS_RESERVED&apos; &amp;&amp; accountPayload.state == &apos;PS_TRANSFERS_COMMITTED&apos;]
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 4289.805h862"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="857" x="694.5" y="4300.015">
    [settlementData.state == &apos;PS_TRANSFERS_COMMITTED&apos; || settlementData.state == &apos;SETTLING&apos; &amp;&amp; accountPayload.state == &apos;SETTLED&apos;]
  </text>
  <path d="M768 4308.61v40h515v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1273 4308.61v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="774" y="4325.676">
    Note
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="809" y="4325.676">
    : Since we previously checked same-state, here we don&apos;t need to match
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="774" y="4340.809">
    allAccounts[account.id].state == settlementData.state.
  </text>
  <path stroke="#a80036" d="M763 4379.008h42M805 4379.008v13M764 4392.008h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 4388.008l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="4373.942">
    17
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="792" y="4373.942">
    Settlement acknowledgement
  </text>
  <path d="M768 4405.008v554h581v-544l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1339 4405.008v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="774" y="4422.075">
    processedAccounts.push(accountPayload.id)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="4437.208">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="4452.34">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="790" y="4467.473">
    state: accountPayload.state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="790" y="4482.606">
    reason: accountPayload.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="790" y="4497.739">
    externalReference: accountPayload.externalReference,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="790" y="4512.872">
    createdDate: transactionTimestamp,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="790" y="4528.004">
    netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="4543.137">
    })
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="774" y="4558.27">
    settlementParticipantCurrencyStateChange.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="790" y="4573.403">
    settlementParticipantCurrencyId: allAccounts[accountPayload.id].key,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="790" y="4588.536">
    settlementStateId: accountPayload.state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="790" y="4603.668">
    reason: accountPayload.reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="790" y="4618.801">
    externalReference: accountPayload.externalReference,
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="790" y="4633.934">
    settlementTransferId: Uuid() -- only for PS_TRANSFERS_RECORDED
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="4649.067">
    })
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="774" y="4664.2">
    if (accountPayload.state == &apos;PS_TRANSFERS_RECORDED&apos;) {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="790" y="4679.333">
    settlementAccounts.pendingSettlementCount--
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="790" y="4694.465">
    settlementAccounts.psTransfersRecordedCount++
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="423" x="774" y="4709.598">
    } else if (accountPayload.state == &apos;PS_TRANSFERS_RESERVED&apos;) {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="790" y="4724.731">
    settlementAccounts.psTransfersRecordedCount--
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="790" y="4739.864">
    settlementAccounts.psTransfersReservedCount++
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="774" y="4754.997">
    } else if (accountPayload.state == &apos;PS_TRANSFERS_COMMITTED&apos;) {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="790" y="4770.129">
    settlementAccounts.psTransfersReservedCount--
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="790" y="4785.262">
    settlementAccounts.psTransfersCommittedCount++
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="774" y="4800.395">
    } else if (accountPayload.state == &apos;SETTLED&apos;) {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="544" x="790" y="4815.528">
    settlementParticipantCurrencySettledIdList.push(allAccounts[accountPayload.id].key)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="790" y="4830.661">
    settlementAccounts.psTransfersCommittedCount--
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="790" y="4845.793">
    settlementAccounts.settledCount++
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="790" y="4860.926">
    settlementAccounts.settledIdList.push(accountPayload.id)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="774" y="4876.059">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="774" y="4891.192">
    settlementAccounts.changedIdList.push(accountPayload.id)
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="774" y="4906.325">
    allAccounts[accountPayload.id].state = accountPayload.state
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="415" x="774" y="4921.458">
    allAccounts[accountPayload.id].reason = accountPayload.reason
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="559" x="774" y="4936.59">
    allAccounts[accountPayload.id].externalReference = accountPayload.externalReference
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="774" y="4951.723">
    allAccounts[accountPayload.id].createdDate = currentTimestamp
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 4969.789h862"/>
  <path stroke="#a80036" d="M763 4991.922h42M805 4991.922v13M764 5004.922h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 5000.922l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="4986.856">
    18
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="792" y="4986.856">
    All other state transitions are not permitted
  </text>
  <path d="M768 5017.922v176h536v-166l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1294 5017.922v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="774" y="5034.989">
    participant.accounts.push({
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="790" y="5050.122">
    id: accountPayload.id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="790" y="5065.254">
    state: allAccounts[accountPayload.id].state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="790" y="5080.387">
    reason: allAccounts[accountPayload.id].reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="375" x="790" y="5095.52">
    createdDate: allAccounts[accountPayload.id].createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="790" y="5110.653">
    netSettlementAmount: allAccounts[accountPayload.id].netSettlementAmount
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="790" y="5125.786">
    errorInformation: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="806" y="5140.918">
    errorCode: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="806" y="5156.051">
    errorDescription: &apos;State change not allowed&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="790" y="5171.184">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="774" y="5186.317">
    })
  </text>
  <path d="M689.5 5231.383h450v7l-10 10h-440v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 5231.383H1506v394.258H689.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="405" x="704.5" y="5244.45">
    Bulk insert settlementParticipantCurrencyStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 5265.648l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 5269.648h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="5264.583">
    19
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="792" y="5264.583">
    Insert settlementParticipantCurrencyStateChange
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1127 5282.648h283l10 11-10 12h-283l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="1129" y="5298.715">
    settlementParticipantCurrencyStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M774 5327.914l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M768 5331.914h499.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="780" y="5326.848">
    20
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="802" y="5326.848">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="361" x="848" y="5326.848">
    settlementParticipantCurrencyStateChangeIdList
  </text>
  <path stroke="#a80036" d="M763 5391.313h42M805 5391.313v13M764 5404.313h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 5400.313l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="5371.114">
    21
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="792" y="5355.981">
    Merge settlementParticipantCurrencyStateChangeIdList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="792" y="5371.114">
    to
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="809" y="5371.114">
    settlementParticipantCurrencyIdList
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="1079" y="5371.114">
    in order to
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="792" y="5386.247">
    issue the following update in one knex command
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 5429.445l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 5433.445h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="5428.379">
    22
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="792" y="5428.379">
    Update pointers to current state change ids
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1050 5476.445h436l10 72-10 72h-436l-10-72 10-72z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1052" y="5492.512">
    UPDATE
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="226" x="1108" y="5492.512">
    settlementParticipantCurrency
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="1052" y="5507.645">
    SET currentStateChangeId =
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="1068" y="5522.778">
    {settlementParticipantCurrencyStateChangeIdList},
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1068" y="5537.911">
    settlementTransferId =
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="416" x="1068" y="5553.043">
    settlementParticipantCurrencyStateChange.settlementTransferId
  </text>
  <text fill="#00F" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="1068" y="5568.176">
    -- only for PENDING_SETTLEMENT to PS_TRANSFERS_RECORDED
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="1052" y="5583.309">
    WHERE settlementParticipantCurrencyId =
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="1084" y="5598.442">
    {settlementParticipantCurrencyStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1084" y="5613.575">
    .settlementParticipantCurrencyIdList}
  </text>
  <path d="M679.5 5639.64h70v7l-10 10h-60v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M679.5 5639.641h657v499.867h-657z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="694.5" y="5652.708">
    opt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="764.5" y="5651.851">
    [autoPositionReset == true]
  </text>
  <path d="M689.5 5663.773h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 5663.773h637v468.734h-637z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="704.5" y="5676.84">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="323" x="768.5" y="5675.984">
    [settlementData.state == &apos;PENDING_SETTLEMENT&apos;]
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M696.5 5705.906h619v85.664h-619z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M696.5 5705.906h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="709.5" y="5719.973">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="826" y="5738.973">
    Settlement Transfer Prepare
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="826" y="5769.239">
    Inputs
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="872" y="5769.239">
    : settlementId, transactionTimestamp, enums, trx
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 5822.57h637"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="348" x="694.5" y="5832.781">
    [settlementData.state == &apos;PS_TRANSFERS_RECORDED&apos;]
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M696.5 5861.375h619v85.664h-619z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M696.5 5861.375h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="709.5" y="5875.442">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="826" y="5894.442">
    Settlement Transfer Reserve
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="826" y="5924.708">
    Inputs
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="872" y="5924.708">
    : settlementId, transactionTimestamp, enums, trx
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M689.5 5978.039h637"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="344" x="694.5" y="5988.249">
    [settlementData.state == &apos;PS_TRANSFERS_RESERVED&apos;]
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M696.5 6016.844h619v85.664h-619z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M696.5 6016.844h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="709.5" y="6030.911">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="826" y="6049.911">
    Settlement Transfer Commit
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="826" y="6080.176">
    Inputs
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="872" y="6080.176">
    : settlementId, transactionTimestamp, enums, trx
  </text>
  <path d="M679.5 6153.508h362v7l-10 10h-352v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M679.5 6153.508H1426v440.523H679.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="317" x="694.5" y="6166.575">
    Update aggregations, contents &amp; windows
  </text>
  <path d="M689.5 6177.64h70v7l-10 10h-60v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 6177.641H1416v200.195H689.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="704.5" y="6190.708">
    opt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="357" x="774.5" y="6189.851">
    [settlementParticipantCurrencySettledIdList.length &gt; 0]
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 6211.906l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 6215.906h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="6210.84">
    23
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="792" y="6210.84">
    Change settlementWindowState where applicable
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1140 6258.906h256l10 56-10 57h-256l-10-57 10-56z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="1142" y="6274.973">
    settlementContentAggregation
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="1142" y="6290.106">
    transferParticipantStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1142" y="6305.239">
    transferParticipant
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="1142" y="6320.372">
    settlementWindowContentStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1142" y="6335.504">
    settlementWindowContent
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="1142" y="6350.637">
    settlementWindowStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1142" y="6365.77">
    settlementWindow
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 6401.969l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 6405.969h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="6400.903">
    24
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="792" y="6400.903">
    Retrieve all affected content (incl. when settled)
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1140 6418.969h256l10 49-10 49h-256l-10-49 10-49z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="1142" y="6435.036">
    settlementContentAggregation
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1142" y="6450.168">
    settlementWindowContent
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="1142" y="6465.301">
    settlementWindowContentStateChange
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="1142" y="6480.434">
    ledgerAccountType
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1142" y="6495.567">
    settlementWindow
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="1142" y="6510.7">
    settlementWindowStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M774 6539.898l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M768 6543.898h499.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="780" y="6538.833">
    25
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="802" y="6538.833">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="848" y="6538.833">
    affectedWindowsReport
  </text>
  <path stroke="#a80036" d="M763 6573.031h42M805 6573.031v13M764 6586.031h41"/>
  <path fill="#A80036" stroke="#a80036" d="M774 6582.031l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="6567.965">
    26
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="792" y="6567.965">
    Use previous result to produce settlementWindowsData (
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="1156" y="6567.965">
    swd
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="1186" y="6567.965">
    ) array
  </text>
  <path d="M679.5 6608.031h364v7l-10 10h-354v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M679.5 6608.031H1441v802.773H679.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="319" x="694.5" y="6621.098">
    Prepare and insert settlementStateChange
  </text>
  <path d="M768 6630.164v25h248v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1006 6630.164v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="774" y="6647.231">
    let settlementStateChanged = true
  </text>
  <path d="M758 6671.297h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M758 6671.297h612v463.445H758z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="773" y="6684.364">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="318" x="837" y="6683.507">
    [settlementData.state == &apos;PENDING_SETTLEMENT&apos;
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="354" x="837" y="6696.312">
    &amp;&amp; settlementAccounts.pendingSettlementCount == 0]
  </text>
  <path d="M768 6704.04v40h552v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1310 6704.04v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="774" y="6721.106">
    settlementData.state = &apos;PS_TRANSFERS_RECORDED&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="531" x="774" y="6736.239">
    settlementData.reason = &apos;All settlement accounts are PS_TRANSFERS_RECORDED&apos;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 6754.305h612"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="343" x="763" y="6764.515">
    [settlementData.state == &apos;PS_TRANSFERS_RECORDED&apos;
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="368" x="763" y="6777.32">
    &amp;&amp; settlementAccounts.psTransfersRecordedCount == 0]
  </text>
  <path d="M768 6785.914v40h549v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1307 6785.914v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="337" x="774" y="6802.981">
    settlementData.state = &apos;PS_TRANSFERS_RESERVED&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="528" x="774" y="6818.114">
    settlementData.reason = &apos;All settlement accounts are PS_TRANSFERS_RESERVED&apos;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 6836.18h612"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="339" x="763" y="6846.39">
    [settlementData.state == &apos;PS_TRANSFERS_RESERVED&apos;
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="763" y="6859.195">
    &amp;&amp; settlementAccounts.psTransfersReservedCount == 0]
  </text>
  <path d="M768 6867.79v40h557v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1315 6867.79v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="774" y="6884.856">
    settlementData.state = &apos;PS_TRANSFERS_COMMITTED&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="536" x="774" y="6899.989">
    settlementData.reason = &apos;All settlement accounts are PS_TRANSFERS_COMMITTED&apos;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 6918.055h612"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="352" x="763" y="6928.265">
    [settlementData.state == &apos;PS_TRANSFERS_COMMITTED&apos;
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="363" x="763" y="6941.07">
    &amp;&amp; settlementAccounts.psTransfersCommittedCount &gt; 0
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="763" y="6953.874">
    &amp;&amp; settlementAccounts.settledCount &gt; 0]
  </text>
  <path d="M768 6962.469v40h454v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1212 6962.469v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="774" y="6979.536">
    settlementData.state = &apos;SETTLING&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="774" y="6994.668">
    settlementData.reason = &apos;Some settlement accounts are SETTLED&apos;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 7012.734h612"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="607" x="763" y="7022.945">
    [(settlementData.state == &apos;PS_TRANSFERS_COMMITTED&apos; || settlementData.state == &apos;SETTLING&apos;)
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="377" x="763" y="7035.749">
    &amp;&amp; settlementAccounts.psTransfersCommittedCount == 0]
  </text>
  <path d="M768 7044.344v40h431v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1189 7044.344v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="774" y="7061.411">
    settlementData.state = &apos;SETTLED&apos;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="774" y="7076.543">
    settlementData.reason = &apos;All settlement accounts are SETTLED&apos;
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M758 7094.609h612"/>
  <path d="M768 7100.61v25h232v-15l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M990 7100.61v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="774" y="7117.676">
    settlementStateChanged = false
  </text>
  <path d="M689.5 7148.742h70v7l-10 10h-60v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M689.5 7148.742H1431v255.063H689.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="704.5" y="7161.809">
    opt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="222" x="774.5" y="7160.953">
    [settlementStateChanged == true]
  </text>
  <path d="M768 7170.875v40h343v-30l-10-10H768" fill="#D3D3D3" filter="url(#a)" stroke="#a80036"/>
  <path d="M1101 7170.875v10h10l-10-10" fill="#D3D3D3" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="774" y="7187.942">
    settlementData.createdDate = currentTimestamp
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="774" y="7203.075">
    settlementStateChange.push(settlementData)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 7237.273l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 7241.273h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="7236.208">
    27
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="792" y="7236.208">
    Insert settlementStateChange
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1189 7254.273h158l10 11-10 12h-158l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1191" y="7270.34">
    settlementStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M774 7299.54l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M768 7303.539h499.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="780" y="7298.473">
    28
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="802" y="7298.473">
    Return
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="848" y="7298.473">
    settlementStateChangeId
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1251.5 7328.672l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M763 7332.672h494.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="770" y="7327.606">
    29
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="792" y="7327.606">
    Update pointer to current state change id
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1126 7375.672h285l10 11-10 12h-285l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1128" y="7391.739">
    UPDATE
  </text>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="1184" y="7391.739">
    settlement
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1264" y="7391.739">
    .currentStateChangeId
  </text>
  <path fill="#A80036" stroke="#a80036" d="M539 7441.938l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M533 7445.938h224"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="545" y="7440.872">
    30
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="567" y="7440.872">
    Return transaction result
  </text>
  <path d="M20 7458.938v857h489v-847l-10-10H20" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M499 7458.938v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="26" y="7476.004">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="42" y="7491.137">
    &quot;id&quot;: {id},
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="42" y="7506.27">
    &quot;state&quot;: settlementData.state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="42" y="7521.403">
    &quot;createdDate&quot;: settlementData.createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="42" y="7536.536">
    &quot;settlementWindows&quot;: [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="58" y="7551.668">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="74" y="7566.801">
    &quot;id&quot;: swd[m].id,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="74" y="7581.934">
    &quot;state&quot;: swd[m].state,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="74" y="7597.067">
    &quot;reason&quot;: swd[m].reason,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="74" y="7612.2">
    &quot;createdDate&quot;: swd[m].createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="74" y="7627.333">
    &quot;changedDate&quot;: swd[m].changedDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="74" y="7642.465">
    &quot;content&quot;: [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="90" y="7657.598">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="106" y="7672.731">
    &quot;id&quot;: swd[m].content[n].settlementWindowContentId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="106" y="7687.864">
    &quot;state&quot;: swd[m].content[n].settlementWindowStateId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="388" x="106" y="7702.997">
    &quot;ledgerAccountType&quot;: swd[m].content[n].ledgerAccountType,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="106" y="7718.129">
    &quot;currencyId&quot;: swd[m].content[n].currencyId,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="106" y="7733.262">
    &quot;createdDate&quot;: swd[m].content[n].createdDate,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="106" y="7748.395">
    &quot;changedDate&quot;: swd[m].content[n].changedDate
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="90" y="7763.528">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="74" y="7778.661">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="58" y="7793.793">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="42" y="7808.926">
    ],
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="42" y="7824.059">
    &quot;participants&quot;: [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="58" y="7839.192">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="74" y="7854.325">
    &quot;id&quot;: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="74" y="7869.458">
    &quot;accounts&quot;: [
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="90" y="7884.59">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="106" y="7899.723">
    &quot;id&quot;: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="106" y="7914.856">
    &quot;state&quot;: &quot;&lt;string&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="106" y="7929.989">
    &quot;reason&quot;: &lt;string&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="106" y="7945.122">
    &quot;externalReference&quot;: &lt;string&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="106" y="7960.254">
    &quot;createdDate&quot;: &lt;date&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="106" y="7975.387">
    &quot;netSettlementAmount&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="122" y="7990.52">
    &quot;amount&quot;: &lt;decimal&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="122" y="8005.653">
    &quot;currency&quot;: &lt;enum&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="106" y="8020.786">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="90" y="8035.918">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="90" y="8051.051">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="106" y="8066.184">
    &quot;id&quot;: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="106" y="8081.317">
    &quot;state&quot;: &lt;string&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="106" y="8096.45">
    &quot;reason&quot;: &lt;string&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="106" y="8111.583">
    &quot;createdDate&quot;: &lt;date&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="106" y="8126.715">
    &quot;netSettlementAmount&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="122" y="8141.848">
    &quot;amount&quot;: &lt;decimal&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="122" y="8156.981">
    &quot;currency&quot;: &lt;enum&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="106" y="8172.114">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="106" y="8187.247">
    &quot;errorInformation&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="122" y="8202.379">
    &quot;errorCode&quot;: &lt;integer&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="122" y="8217.512">
    &quot;errorDescription&quot;: &lt;string&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="106" y="8232.645">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="90" y="8247.778">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="74" y="8262.911">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="58" y="8278.043">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="42" y="8293.176">
    ]
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="26" y="8308.309">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M349 8342.508l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M343 8346.508h179"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="355" y="8341.442">
    31
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="377" y="8341.442">
    Return response
  </text>
</svg>
