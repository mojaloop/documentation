<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3540px" preserveAspectRatio="none" style="width:1218px;height:3540px;" version="1.1" viewBox="0 0 1218 3540" width="1218px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vni6l1jht6gd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="778" x="221" y="23.5352">6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)</text><rect fill="#FFB6C1" height="3495.377" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="70" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="85.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="3495.377" style="stroke: #A80036; stroke-width: 1.0;" width="479.5" x="313.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="491.25" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="3495.377" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="843" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="846" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3264.0898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="121" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3264.0898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="391" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="446.6348"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="198.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="768.6719"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1106.0195"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1412.7461"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="526.0059" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1740.4727"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="372.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="2311.0996"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="475.9453"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="797.9824"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1135.3301"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1442.0566"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="475.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1769.7832"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="322.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="2340.4102"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3272.0898" style="stroke: #000000; stroke-width: 2.0;" width="1194" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="123.8633" style="stroke: #000000; stroke-width: 2.0;" width="420.5" x="64" y="178.5977"/><rect fill="#FFFFFF" height="61.9316" style="stroke: none; stroke-width: 1.0;" width="420.5" x="64" y="240.5293"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="957.8008" style="stroke: #000000; stroke-width: 2.0;" width="813.5" x="287.5" y="714.7402"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="613.4531" style="stroke: #000000; stroke-width: 2.0;" width="772.5" x="297.5" y="1052.0879"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="299.7266" style="stroke: #000000; stroke-width: 2.0;" width="752.5" x="307.5" y="1358.8145"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="1732.8359" style="stroke: #000000; stroke-width: 2.0;" width="1174" x="23" y="1686.541"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="453.3848" style="stroke: #000000; stroke-width: 2.0;" width="512" x="644" y="1784.7832"/><rect fill="#FFFFFF" height="249.6582" style="stroke: none; stroke-width: 1.0;" width="512" x="644" y="1988.5098"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="300.2793" style="stroke: #000000; stroke-width: 2.0;" width="574" x="613" y="2355.4102"/><rect fill="#FFFFFF" height="142.4844" style="stroke: none; stroke-width: 1.0;" width="574" x="613" y="2513.2051"/><rect fill="#FFFFFF" height="199.4395" style="stroke: none; stroke-width: 1.0;" width="1174" x="23" y="3219.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="137.2871" y2="3443.377"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="395.5" x2="395.5" y1="137.2871" y2="3443.377"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="732" x2="732" y1="137.2871" y2="3443.377"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="900" x2="900" y1="137.2871" y2="3443.377"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="74" y="134.334">Hub Employee</text><ellipse cx="126" cy="63.7988" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126,71.7988 L126,98.7988 M113,79.7988 L139,79.7988 M126,98.7988 L113,113.7988 M126,98.7988 L139,113.7988 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="74" y="3455.9121">Hub Employee</text><ellipse cx="126" cy="3468.8652" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126,3476.8652 L126,3503.8652 M113,3484.8652 L139,3484.8652 M126,3503.8652 L113,3518.8652 M126,3503.8652 L139,3518.8652 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="317.5" y="134.334">Settlement Service API</text><path d="M375.5,92.7988 L375.5,116.7988 M375.5,104.7988 L392.5,104.7988 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="404.5" cy="104.7988" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="317.5" y="3455.9121">Settlement Service API</text><path d="M375.5,3462.8652 L375.5,3486.8652 M375.5,3474.8652 L392.5,3474.8652 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="404.5" cy="3474.8652" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="675" y="134.334">Settlement DAO</text><ellipse cx="732" cy="104.7988" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="720" x2="744" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="675" y="3455.9121">Settlement DAO</text><ellipse cx="732" cy="3474.8652" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="720" x2="744" y1="3488.8652" y2="3488.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="852" y="134.334">Central Store</text><path d="M882,84.7988 C882,74.7988 900,74.7988 900,74.7988 C900,74.7988 918,74.7988 918,84.7988 L918,110.7988 C918,120.7988 900,120.7988 900,120.7988 C900,120.7988 882,120.7988 882,110.7988 L882,84.7988 " fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M882,84.7988 C882,94.7988 900,94.7988 900,94.7988 C900,94.7988 918,94.7988 918,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="852" y="3455.9121">Central Store</text><path d="M882,3468.8652 C882,3458.8652 900,3458.8652 900,3458.8652 C900,3458.8652 918,3458.8652 918,3468.8652 L918,3494.8652 C918,3504.8652 900,3504.8652 900,3504.8652 C900,3504.8652 882,3504.8652 882,3494.8652 L882,3468.8652 " fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M882,3468.8652 C882,3478.8652 900,3478.8652 900,3478.8652 C900,3478.8652 918,3478.8652 918,3468.8652 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3264.0898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="121" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3264.0898" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="391" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="183.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="446.6348"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="198.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="768.6719"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1106.0195"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1412.7461"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="526.0059" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="1740.4727"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="372.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727" y="2311.0996"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="475.9453"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="797.9824"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1135.3301"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1442.0566"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="475.3848" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="1769.7832"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="322.2793" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895" y="2340.4102"/><path d="M13,154.2871 L422,154.2871 L422,161.2871 L412,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3272.0898" style="stroke: #000000; stroke-width: 2.0;" width="1194" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="364" x="28" y="167.8555">Get Settlement By Settlement, Participant and Account</text><path d="M64,178.5977 L126,178.5977 L126,185.5977 L116,195.5977 L64,195.5977 L64,178.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="123.8633" style="stroke: #000000; stroke-width: 2.0;" width="420.5" x="64" y="178.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="79" y="192.166">alt</text><polygon fill="#A80036" points="379,228.5293,389,232.5293,379,236.5293,383,232.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131" x2="385" y1="232.5293" y2="232.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="138" y="220.1318">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="151" y="212.4766">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="151" y="227.7871">participants/{participantId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="484.5" y1="241.5293" y2="241.5293"/><polygon fill="#A80036" points="379,290.4609,389,294.4609,379,298.4609,383,294.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131" x2="385" y1="294.4609" y2="294.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="138" y="274.4082">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="151" y="259.0977">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="151" y="274.4082">participants/{participantId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="151" y="289.7188">accounts/{accountId}</text><path d="M406,314.4609 L406,400.4609 L771,400.4609 L771,324.4609 L761,314.4609 L406,314.4609 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M761,314.4609 L761,324.4609 L771,324.4609 L761,314.4609 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="412" y="332.0293">let settlementFound = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="412" y="347.3398">let participantFoundInSettlement = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="412" y="362.6504">let accountProvided = accountId &gt; 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="412" y="377.9609">let participantAndAccountMatched = !accountProvided</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="412" y="393.2715">let accountFoundInSettlement = !accountProvided</text><polygon fill="#A80036" points="715,442.6348,725,446.6348,715,450.6348,719,446.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="446.6348" y2="446.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="408" y="434.2373">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="421" y="426.582">Request settlement state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="421" y="441.8926">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="498" y="441.8926">2001</text><polygon fill="#A80036" points="883,471.9453,893,475.9453,883,479.9453,887,475.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="475.9453" y2="475.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="744" y="471.2031">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="757" y="471.2031">Retrieve settlement</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="679,518.9453,1120,518.9453,1130,560.9453,1120,602.9453,679,602.9453,669,560.9453,679,518.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="437" x="681" y="535.5137">SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="681" y="550.8242">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="721" y="550.8242">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="797" y="550.8242">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="681" y="566.1348">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="713" y="566.1348">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="874" y="566.1348">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="681" y="581.4453">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="681" y="596.7559">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="412,625.8086,402,629.8086,412,633.8086,408,629.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="629.8086" y2="629.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="418" y="625.0664">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="431" y="625.0664">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="476" y="625.0664">settlement</text><path d="M406,642.8086 L406,697.8086 L606,697.8086 L606,652.8086 L596,642.8086 L406,642.8086 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M596,642.8086 L596,652.8086 L606,652.8086 L596,642.8086 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="412" y="660.377">if (settlement.settlementId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="428" y="675.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="428" y="675.6875">settlementFound</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="546" y="675.6875">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="412" y="690.998">}</text><path d="M287.5,714.7402 L354.5,714.7402 L354.5,721.7402 L344.5,731.7402 L287.5,731.7402 L287.5,714.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="957.8008" style="stroke: #000000; stroke-width: 2.0;" width="813.5" x="287.5" y="714.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="302.5" y="728.3086">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="369.5" y="727.375">[settlementFound]</text><polygon fill="#A80036" points="715,764.6719,725,768.6719,715,772.6719,719,768.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="768.6719" y2="768.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="408" y="756.2744">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="421" y="748.6191">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="421" y="763.9297">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="498" y="763.9297">2001</text><polygon fill="#A80036" points="883,793.9824,893,797.9824,883,801.9824,887,797.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="797.9824" y2="797.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="744" y="793.2402">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="757" y="793.2402">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="718,840.9824,1081,840.9824,1091,889.9824,1081,939.9824,718,939.9824,708,889.9824,718,840.9824" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="720" y="857.5508">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="720" y="872.8613">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="760" y="872.8613">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="971" y="872.8613">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="720" y="888.1719">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="752" y="888.1719">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="892" y="888.1719">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="720" y="903.4824">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="720" y="918.793">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="720" y="934.1035">AND pc.participantId = {participantId}</text><polygon fill="#A80036" points="412,963.1563,402,967.1563,412,971.1563,408,967.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="967.1563" y2="967.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="418" y="962.4141">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="431" y="962.4141">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="476" y="962.4141">settlementParticipantCurrencyIdList</text><path d="M406,980.1563 L406,1035.1563 L751,1035.1563 L751,990.1563 L741,980.1563 L406,980.1563 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M741,980.1563 L741,990.1563 L751,990.1563 L741,980.1563 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="412" y="997.7246">if (settlementParticipantCurrencyIdList.length &gt; 0) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="428" y="1013.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="428" y="1013.0352">participantFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="633" y="1013.0352">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="412" y="1028.3457">}</text><path d="M297.5,1052.0879 L364.5,1052.0879 L364.5,1059.0879 L354.5,1069.0879 L297.5,1069.0879 L297.5,1052.0879 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="613.4531" style="stroke: #000000; stroke-width: 2.0;" width="772.5" x="297.5" y="1052.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="312.5" y="1065.6563">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="288" x="379.5" y="1064.7227">[participantFoundInSettlement &amp;&amp; accountProvided]</text><polygon fill="#A80036" points="715,1102.0195,725,1106.0195,715,1110.0195,719,1106.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="1106.0195" y2="1106.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="408" y="1093.6221">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="421" y="1085.9668">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="421" y="1101.2773">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="498" y="1101.2773">2001</text><polygon fill="#A80036" points="883,1131.3301,893,1135.3301,883,1139.3301,887,1135.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="1135.3301" y2="1135.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="744" y="1130.5879">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="766" y="1130.5879">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="762,1178.3301,1037,1178.3301,1047,1212.3301,1037,1247.3301,762,1247.3301,752,1212.3301,762,1178.3301" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="764" y="1194.8984">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="764" y="1210.209">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="796" y="1210.209">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="764" y="1225.5195">WHERE participantCurrencyId = {accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="764" y="1240.8301">AND participantId = {participantId}</text><polygon fill="#A80036" points="412,1269.8828,402,1273.8828,412,1277.8828,408,1273.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="1273.8828" y2="1273.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="418" y="1269.1406">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="440" y="1269.1406">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="485" y="1269.1406">account</text><path d="M406,1286.8828 L406,1341.8828 L701,1341.8828 L701,1296.8828 L691,1286.8828 L406,1286.8828 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M691,1286.8828 L691,1296.8828 L701,1296.8828 L691,1286.8828 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="412" y="1304.4512">if (account) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="428" y="1319.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="215" x="428" y="1319.7617">participantAndAccountMatched</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="647" y="1319.7617">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="412" y="1335.0723">}</text><path d="M307.5,1358.8145 L374.5,1358.8145 L374.5,1365.8145 L364.5,1375.8145 L307.5,1375.8145 L307.5,1358.8145 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="299.7266" style="stroke: #000000; stroke-width: 2.0;" width="752.5" x="307.5" y="1358.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="322.5" y="1372.3828">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="389.5" y="1371.4492">[participantAndAccountMatched]</text><polygon fill="#A80036" points="715,1408.7461,725,1412.7461,715,1416.7461,719,1412.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="1412.7461" y2="1412.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="408" y="1400.3486">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="430" y="1392.6934">Check account in settlement</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="430" y="1408.0039">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="507" y="1408.0039">2001</text><polygon fill="#A80036" points="883,1438.0566,893,1442.0566,883,1446.0566,887,1442.0566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="1442.0566" y2="1442.0566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="744" y="1437.3145">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="766" y="1437.3145">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="760,1485.0566,1040,1485.0566,1050,1519.0566,1040,1554.0566,760,1554.0566,750,1519.0566,760,1485.0566" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="762" y="1501.625">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="762" y="1516.9355">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="802" y="1516.9355">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="762" y="1532.2461">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="762" y="1547.5566">AND pc.participantCurrencyId = {accountId}</text><polygon fill="#A80036" points="412,1576.6094,402,1580.6094,412,1584.6094,408,1580.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="1580.6094" y2="1580.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="418" y="1575.8672">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="440" y="1575.8672">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="485" y="1575.8672">settlementParticipantCurrencyId</text><path d="M406,1593.6094 L406,1648.6094 L666,1648.6094 L666,1603.6094 L656,1593.6094 L406,1593.6094 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M656,1593.6094 L656,1603.6094 L666,1603.6094 L656,1593.6094 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="412" y="1611.1777">if (settlementParticipantCurrencyId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="428" y="1626.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="428" y="1626.4883">accountFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="612" y="1626.4883">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="412" y="1641.7988">}</text><path d="M23,1686.541 L85,1686.541 L85,1693.541 L75,1703.541 L23,1703.541 L23,1686.541 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1732.8359" style="stroke: #000000; stroke-width: 2.0;" width="1174" x="23" y="1686.541"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="1700.1094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="654" x="100" y="1699.1758">[settlementFound &amp;&amp; participantFoundInSettlement &amp;&amp; participantAndAccountMatched &amp;&amp; accountFoundInSettlement]</text><polygon fill="#A80036" points="715,1736.4727,725,1740.4727,715,1744.4727,719,1740.4727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="1740.4727" y2="1740.4727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="408" y="1728.0752">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="430" y="1720.4199">Request settlement windows</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="430" y="1735.7305">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="507" y="1735.7305">2001</text><polygon fill="#A80036" points="883,1765.7832,893,1769.7832,883,1773.7832,887,1769.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="1769.7832" y2="1769.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="744" y="1765.041">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="766" y="1765.041">Retrieve windows</text><path d="M644,1784.7832 L706,1784.7832 L706,1791.7832 L696,1801.7832 L644,1801.7832 L644,1784.7832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="453.3848" style="stroke: #000000; stroke-width: 2.0;" width="512" x="644" y="1784.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="659" y="1798.3516">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="721" y="1797.418">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="664,1807.0938,1136,1807.0938,1146,1895.0938,1136,1983.0938,664,1983.0938,654,1895.0938,664,1807.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="468" x="666" y="1823.6621">SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="682" y="1838.9727">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="666" y="1854.2832">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="706" y="1854.2832">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="907" y="1854.2832">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="1869.5938">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="698" y="1869.5938">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="827" y="1869.5938">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="666" y="1884.9043">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="1900.2148">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="698" y="1900.2148">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="912" y="1900.2148">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="666" y="1915.5254">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="1930.8359">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="698" y="1930.8359">settlementTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="905" y="1930.8359">stp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="666" y="1946.1465">ON stp.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="666" y="1961.457">AND stp.participantCurrencyId = {accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="666" y="1976.7676">WHERE ssw.settlementId = {id}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="644" x2="1156" y1="1989.5098" y2="1989.5098"/><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="664,1995.5098,1136,1995.5098,1146,2113.5098,1136,2232.5098,664,2232.5098,654,2113.5098,664,1995.5098" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="468" x="666" y="2012.0781">SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="682" y="2027.3887">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="666" y="2042.6992">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="706" y="2042.6992">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="907" y="2042.6992">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="2058.0098">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="698" y="2058.0098">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="827" y="2058.0098">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="666" y="2073.3203">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="2088.6309">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="698" y="2088.6309">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="912" y="2088.6309">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="666" y="2103.9414">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="666" y="2119.252">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="698" y="2119.252">settlementTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="905" y="2119.252">stp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="666" y="2134.5625">ON stp.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="666" y="2149.873">AND stp.participantCurrencyId IN(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="682" y="2165.1836">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="682" y="2180.4941">FROM participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="682" y="2195.8047">WHERE participantId = {participantId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="666" y="2211.1152">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="666" y="2226.4258">WHERE ssw.settlementId = {id}</text><polygon fill="#A80036" points="412,2262.4785,402,2266.4785,412,2270.4785,408,2266.4785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="2266.4785" y2="2266.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="418" y="2261.7363">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="440" y="2261.7363">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="485" y="2261.7363">windows</text><polygon fill="#A80036" points="715,2307.0996,725,2311.0996,715,2315.0996,719,2311.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401" x2="721" y1="2311.0996" y2="2311.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="408" y="2298.7021">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="430" y="2291.0469">Request settlement accounts</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="430" y="2306.3574">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="507" y="2306.3574">2001</text><polygon fill="#A80036" points="883,2336.4102,893,2340.4102,883,2344.4102,887,2340.4102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737" x2="889" y1="2340.4102" y2="2340.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="744" y="2335.668">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="766" y="2335.668">Retrieve accounts</text><path d="M613,2355.4102 L675,2355.4102 L675,2362.4102 L665,2372.4102 L613,2372.4102 L613,2355.4102 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="300.2793" style="stroke: #000000; stroke-width: 2.0;" width="574" x="613" y="2355.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="628" y="2368.9785">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="690" y="2368.0449">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="636,2377.7207,1163,2377.7207,1173,2442.7207,1163,2507.7207,636,2507.7207,626,2442.7207,636,2377.7207" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="638" y="2394.2891">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="654" y="2409.5996">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="638" y="2424.9102">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="678" y="2424.9102">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="889" y="2424.9102">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="638" y="2440.2207">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="670" y="2440.2207">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="966" y="2440.2207">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="638" y="2455.5313">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="638" y="2470.8418">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="670" y="2470.8418">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="810" y="2470.8418">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="638" y="2486.1523">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="503" x="638" y="2501.4629">WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="613" x2="1187" y1="2514.2051" y2="2514.2051"/><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="633,2520.2051,1167,2520.2051,1177,2585.2051,1167,2650.2051,633,2650.2051,623,2585.2051,633,2520.2051" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="635" y="2536.7734">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="651" y="2552.084">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="635" y="2567.3945">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="675" y="2567.3945">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="886" y="2567.3945">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="2582.7051">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="667" y="2582.7051">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="963" y="2582.7051">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="635" y="2598.0156">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="635" y="2613.3262">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="667" y="2613.3262">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="807" y="2613.3262">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="635" y="2628.6367">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="530" x="635" y="2643.9473">WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}</text><polygon fill="#A80036" points="412,2680,402,2684,412,2688,408,2684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="406" x2="731" y1="2684" y2="2684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="418" y="2679.2578">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="440" y="2679.2578">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="485" y="2679.2578">accounts</text><path d="M33,2697 L33,3181 L382,3181 L382,2707 L372,2697 L33,2697 " fill="#FFFF00" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M372,2697 L372,2707 L382,2707 L372,2697 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="2714.5684">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="55" y="2729.8789">"id": settlement.settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="55" y="2745.1895">"state": settlement.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="55" y="2760.5">"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="71" y="2775.8105">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="87" y="2791.1211">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="103" y="2806.4316">"id": window.settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="103" y="2821.7422">"reason": window.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="103" y="2837.0527">"state": window.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="103" y="2852.3633">"createdDate": window.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="103" y="2867.6738">"changedDate": window.changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="87" y="2882.9844">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="71" y="2898.2949">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="55" y="2913.6055">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="55" y="2928.916">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="71" y="2944.2266">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="87" y="2959.5371">"id": account.participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="87" y="2974.8477">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="103" y="2990.1582">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="119" y="3005.4688">"id": account.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="119" y="3020.7793">"reason": account.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="119" y="3036.0898">"state": account.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="119" y="3051.4004">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="135" y="3066.7109">"amount": account.netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="135" y="3082.0215">"currency": account.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="119" y="3097.332">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="103" y="3112.6426">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="87" y="3127.9531">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="71" y="3143.2637">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="55" y="3158.5742">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="3173.8848">}</text><polygon fill="#A80036" points="142,3207.9375,132,3211.9375,142,3215.9375,138,3211.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="136" x2="390" y1="3211.9375" y2="3211.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="148" y="3207.1953">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="170" y="3207.1953">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1197" y1="3220.9375" y2="3220.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="642" x="28" y="3231.5723">[!settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement]</text><path d="M406,3239.8926 L406,3264.8926 L670,3264.8926 L670,3249.8926 L660,3239.8926 L406,3239.8926 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M660,3239.8926 L660,3249.8926 L670,3249.8926 L660,3239.8926 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="412" y="3257.4609">Log ERROR event (based on the failure)</text><path d="M52,3279.2031 L52,3380.2031 L382,3380.2031 L382,3289.2031 L372,3279.2031 L52,3279.2031 " fill="#FFFF00" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M372,3279.2031 L372,3289.2031 L382,3289.2031 L372,3279.2031 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="58" y="3296.7715">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="74" y="3312.082">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="90" y="3327.3926">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="90" y="3342.7031">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="74" y="3358.0137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="58" y="3373.3242">}</text><polygon fill="#A80036" points="137,3407.377,127,3411.377,137,3415.377,133,3411.377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="131" x2="395" y1="3411.377" y2="3411.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143" y="3406.6348">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="165" y="3406.6348">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Get Settlement By Settlement, Participant and Account
activate OPERATOR
    alt
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}
    else
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}/\naccounts/{accountId}
    end

    activate SSAPI

    note right of SSAPI #lightgray
        let settlementFound = false
        let participantFoundInSettlement = false
        let accountProvided = accountId > 0
        let participantAndAccountMatched = !accountProvided
        let accountFoundInSettlement = !accountProvided
    end note
    SSAPI-> SETTLE_DAO: Request settlement state\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Retrieve settlement
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlement**
    deactivate SETTLE_DAO
    note right of SSAPI #lightgray
        if (settlement.settlementId) {
            **settlementFound** = true
        }
    end note

    opt settlementFound
        SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Check exists
        activate DB
        hnote over DB #lightyellow
            SELECT settlementParticipantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            AND pc.participantId = {participantId}
        end hnote
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyIdList**
        deactivate SETTLE_DAO
        note right of SSAPI #lightgray
            if (settlementParticipantCurrencyIdList.length > 0) {
                **participantFoundInSettlement** = true
            }
        end note

        opt participantFoundInSettlement && accountProvided
            SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Check exists
            activate DB
            hnote over DB #lightyellow
                SELECT participantCurrencyId
                JOIN **participantCurrency**
                WHERE participantCurrencyId = {accountId}
                AND participantId = {participantId}
            end hnote
            deactivate DB
            SSAPI <- - SETTLE_DAO: Return **account**
            deactivate SETTLE_DAO
            note right of SSAPI #lightgray
                if (account) {
                    **participantAndAccountMatched** = true
                }
            end note

            opt participantAndAccountMatched
                SSAPI-> SETTLE_DAO: Check account in settlement\n<color #FF0000><b>Error code:</b> 2001</color>
                activate SETTLE_DAO
                SETTLE_DAO -> DB: Check exists
                activate DB
                hnote over DB #lightyellow
                    SELECT settlementParticipantCurrencyId
                    FROM **settlementParticipantCurrency**
                    WHERE spc.settlementId = {id}
                    AND pc.participantCurrencyId = {accountId}
                end hnote
                deactivate DB
                SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyId**
                deactivate SETTLE_DAO

                note right of SSAPI #lightgray
                    if (settlementParticipantCurrencyId) {
                        **accountFoundInSettlement** = true
                    }
                end note
            end
        end
    end

    alt settlementFound && participantFoundInSettlement && participantAndAccountMatched && accountFoundInSettlement
        SSAPI-> SETTLE_DAO: Request settlement windows\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve windows
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN **settlementTransferParticipant** stp
                ON stp.settlementWindowId = sw.settlementWindowId
                AND stp.participantCurrencyId = {accountId}
                WHERE ssw.settlementId = {id}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN **settlementTransferParticipant** stp
                ON stp.settlementWindowId = sw.settlementWindowId
                AND stp.participantCurrencyId IN(
                    SELECT participantCurrencyId
                    FROM participantCurrency
                    WHERE participantId = {participantId}
                )
                WHERE ssw.settlementId = {id}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **windows**
        deactivate SETTLE_DAO

        SSAPI-> SETTLE_DAO: Request settlement accounts\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve accounts
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **accounts**
        deactivate SETTLE_DAO

        deactivate SETTLE_DAO
        note left of SSAPI #yellow
            {
                "id": settlement.settlementId,
                "state": settlement.settlementStateId,
                "settlementWindows": [
                    [
                        {
                            "id": window.settlementWindowId,
                            "reason": window.reason,
                            "state": window.settlementWindowStateId,
                            "createdDate": window.createdDate,
                            "changedDate": window.changedDate
                        }
                    ]
                ],
                "participants": [
                    {
                        "id": account.participantId,
                        "accounts": [
                            {
                                "id": account.participantCurrencyId,
                                "reason": account.reason,
                                "state": account.settlementStateId,
                                "netSettlementAmount": {
                                    "amount": account.netAmount,
                                    "currency": account.currencyId
                                }
                            }
                        ]
                    }
                ]
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 200 (OK)
    else !settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement
        note right of SSAPI #lightgray
            Log ERROR event (based on the failure)
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>