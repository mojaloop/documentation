<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3504px" preserveAspectRatio="none" style="width:1389px;height:3504px;" version="1.1" viewBox="0 0 1389 3504" width="1389px" zoomAndPan="magnify"><defs><filter height="300%" id="f5zhh3qrf7f9q" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="326" x="532.5" y="23.5352">6.2.6. Settlement Abort (abortSettlementById)</text><rect fill="#FFB6C1" height="3458.7441" style="stroke: #A80036; stroke-width: 1.0;" width="112" x="146" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="161.5" y="47.0566">Central HUB</text><rect fill="#90EE90" height="3458.7441" style="stroke: #A80036; stroke-width: 1.0;" width="408.5" x="339.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="481.75" y="47.0566">Settlement Service</text><rect fill="#FFFFE0" height="3458.7441" style="stroke: #A80036; stroke-width: 1.0;" width="114" x="1028" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="1031" y="47.0566">Central Services</text><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="3249.457" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="197" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="3096.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="417" y="278.1504"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="2696.0039" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682" y="322.7715"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="352.082"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="755.1816"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1000.9316"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1363.2109"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1623.5586"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1862.2852"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1996.5273"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2212.0117"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2346.2539"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2531.4277"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2665.6699"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2789.6016"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2912.1543"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="3235.457" style="stroke: #000000; stroke-width: 2.0;" width="1365" x="13" y="154.2871"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="804.334" style="stroke: #000000; stroke-width: 2.0;" width="758" x="610" y="506.2559"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="687" y="554.4316"/><rect fill="#FFFFFF" height="270.0605" style="stroke: none; stroke-width: 1.0;" width="758" x="610" y="694.6055"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="241.1055" style="stroke: #000000; stroke-width: 2.0;" width="628" x="620" y="716.5605"/><rect fill="#FFFFFF" height="345.9238" style="stroke: none; stroke-width: 1.0;" width="758" x="610" y="964.666"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="687" y="1170.416"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="1665.875" style="stroke: #000000; stroke-width: 2.0;" width="716" x="610" y="1324.5898"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="690" x="620" y="1823.6641"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="305.416" style="stroke: #000000; stroke-width: 2.0;" width="609" x="620" y="2173.3906"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="649" x="620" y="2492.8066"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="628" x="620" y="2750.9805"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="348.9688" style="stroke: #000000; stroke-width: 2.0;" width="550" x="23" y="3033.7754"/><rect fill="#FFFFFF" height="201.7949" style="stroke: none; stroke-width: 1.0;" width="550" x="23" y="3180.9492"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="202" x2="202" y1="137.2871" y2="3406.7441"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="421.5" x2="421.5" y1="137.2871" y2="3406.7441"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="687" x2="687" y1="137.2871" y2="3406.7441"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1085" x2="1085" y1="137.2871" y2="3406.7441"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="150" y="134.334">Hub Employee</text><ellipse cx="202" cy="63.7988" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M202,71.7988 L202,98.7988 M189,79.7988 L215,79.7988 M202,98.7988 L189,113.7988 M202,98.7988 L215,113.7988 " fill="none" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="150" y="3419.2793">Hub Employee</text><ellipse cx="202" cy="3432.2324" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M202,3440.2324 L202,3467.2324 M189,3448.2324 L215,3448.2324 M202,3467.2324 L189,3482.2324 M202,3467.2324 L215,3482.2324 " fill="none" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="343.5" y="134.334">Settlement Service API</text><path d="M401.5,92.7988 L401.5,116.7988 M401.5,104.7988 L418.5,104.7988 " fill="none" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="430.5" cy="104.7988" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="151" x="343.5" y="3419.2793">Settlement Service API</text><path d="M401.5,3426.2324 L401.5,3450.2324 M401.5,3438.2324 L418.5,3438.2324 " fill="none" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="430.5" cy="3438.2324" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="630" y="134.334">Settlement DAO</text><ellipse cx="687" cy="104.7988" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="675" x2="699" y1="118.7988" y2="118.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="630" y="3419.2793">Settlement DAO</text><ellipse cx="687" cy="3438.2324" fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="675" x2="699" y1="3452.2324" y2="3452.2324"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1037" y="134.334">Central Store</text><path d="M1067,84.7988 C1067,74.7988 1085,74.7988 1085,74.7988 C1085,74.7988 1103,74.7988 1103,84.7988 L1103,110.7988 C1103,120.7988 1085,120.7988 1085,120.7988 C1085,120.7988 1067,120.7988 1067,110.7988 L1067,84.7988 " fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1067,84.7988 C1067,94.7988 1085,94.7988 1085,94.7988 C1085,94.7988 1103,94.7988 1103,84.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1037" y="3419.2793">Central Store</text><path d="M1067,3432.2324 C1067,3422.2324 1085,3422.2324 1085,3422.2324 C1085,3422.2324 1103,3422.2324 1103,3432.2324 L1103,3458.2324 C1103,3468.2324 1085,3468.2324 1085,3468.2324 C1085,3468.2324 1067,3468.2324 1067,3458.2324 L1067,3432.2324 " fill="#FEFECE" filter="url(#f5zhh3qrf7f9q)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1067,3432.2324 C1067,3442.2324 1085,3442.2324 1085,3442.2324 C1085,3442.2324 1103,3442.2324 1103,3432.2324 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="3249.457" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="197" y="147.2871"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="3096.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="417" y="278.1504"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="2696.0039" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="682" y="322.7715"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="139.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="352.082"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="755.1816"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="154.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1000.9316"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="231.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1363.2109"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="185.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1623.5586"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1862.2852"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1996.5273"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2212.0117"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2346.2539"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2531.4277"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2665.6699"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2789.6016"/><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="2912.1543"/><path d="M13,154.2871 L172,154.2871 L172,161.2871 L162,171.2871 L13,171.2871 L13,154.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3235.457" style="stroke: #000000; stroke-width: 2.0;" width="1365" x="13" y="154.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="28" y="167.8555">Settlement Abort</text><path d="M212,176.5977 L212,247.5977 L432,247.5977 L432,186.5977 L422,176.5977 L212,176.5977 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M422,176.5977 L422,186.5977 L432,186.5977 L422,176.5977 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="218" y="194.166">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="234" y="209.4766">"state": "ABORTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="234" y="224.7871">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="218" y="240.0977">}</text><polygon fill="#A80036" points="405,274.1504,415,278.1504,405,282.1504,409,278.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="207" x2="411" y1="278.1504" y2="278.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="214" y="273.4082">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="227" y="273.4082">PUT - /settlement/{id}</text><polygon fill="#A80036" points="670,318.7715,680,322.7715,670,326.7715,674,322.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427" x2="676" y1="322.7715" y2="322.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="434" y="310.374">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="447" y="302.7188">abortSettlementById facade method</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="447" y="318.0293">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="524" y="318.0293">2001</text><polygon fill="#A80036" points="1068,348.082,1078,352.082,1068,356.082,1072,352.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="352.082" y2="352.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="347.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="712" y="347.3398">Retrieve settlement information</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="898,365.082,1272,365.082,1282,414.082,1272,464.082,898,464.082,888,414.082,898,365.082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="900" y="381.6504">SELECT s.settlementId, ssc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="916" y="396.9609">ssc.reason, ssc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="900" y="412.2715">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="940" y="412.2715">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="1016" y="412.2715">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="900" y="427.582">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="932" y="427.582">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="1093" y="427.582">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="900" y="442.8926">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="900" y="458.2031">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="703,487.2559,693,491.2559,703,495.2559,699,491.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="491.2559" y2="491.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="486.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="486.5137">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="767" y="486.5137">settlementData</text><path d="M610,506.2559 L672,506.2559 L672,513.2559 L662,523.2559 L610,523.2559 L610,506.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="804.334" style="stroke: #000000; stroke-width: 2.0;" width="758" x="610" y="506.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="625" y="519.8242">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="388" x="687" y="518.8906">[settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="687" y="531.8457">settlementData.settlementStateId == 'SETTLING'||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="268" x="687" y="544.8008">settlementData.settlementStateId == 'SETTLED']</text><path d="M687,554.4316 L771,554.4316 L771,561.4316 L761,571.4316 L687,571.4316 L687,554.4316 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="380" x="687" y="554.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="702" y="568">break</text><path d="M697,576.7422 L697,677.7422 L1053,677.7422 L1053,586.7422 L1043,576.7422 L697,576.7422 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1043,576.7422 L1043,586.7422 L1053,586.7422 L1043,576.7422 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="594.3105">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="719" y="609.6211">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="735" y="624.9316">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="735" y="640.2422">"errorDescription": "State change is not allowed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="719" y="655.5527">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="670.8633">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="610" x2="1368" y1="695.6055" y2="695.6055"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="615" y="706.2402">[settlementData.settlementStateId == 'ABORTED']</text><path d="M620,716.5605 L704,716.5605 L704,723.5605 L694,733.5605 L620,733.5605 L620,716.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="241.1055" style="stroke: #000000; stroke-width: 2.0;" width="628" x="620" y="716.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="635" y="730.1289">break</text><polygon fill="#A80036" points="1068,751.1816,1078,755.1816,1068,759.1816,1072,755.1816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="755.1816" y2="755.1816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="750.4395">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="712" y="750.4395">Append additional info at settlement level</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="941,798.1816,1228,798.1816,1238,824.1816,1228,851.1816,941,851.1816,931,824.1816,941,798.1816" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="943" y="814.75">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="1027" y="814.75">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="959" y="830.0605">(settlementId, settlementStateId, reason)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="943" y="845.3711">VALUES ({id}, 'ABORTED', {abortReasonString})</text><path d="M697,862.1133 L697,948.1133 L917,948.1133 L917,872.1133 L907,862.1133 L697,862.1133 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M907,862.1133 L907,872.1133 L917,872.1133 L907,862.1133 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="879.6816">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="719" y="894.9922">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="719" y="910.3027">"state": 'ABORTED',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="719" y="925.6133">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="940.9238">}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="610" x2="1368" y1="965.666" y2="965.666"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="371" x="615" y="976.3008">[settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED']</text><polygon fill="#A80036" points="1068,996.9316,1078,1000.9316,1068,1004.9316,1072,1000.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="1000.9316" y2="1000.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="996.1895">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="712" y="996.1895">Find account in PS_TRANSFERS_COMMITTED</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="821,1013.9316,1348,1013.9316,1358,1070.9316,1348,1128.9316,821,1128.9316,811,1070.9316,821,1013.9316" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="823" y="1030.5">SELECT spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="823" y="1045.8105">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="863" y="1045.8105">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1074" y="1045.8105">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="823" y="1061.1211">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="855" y="1061.1211">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1151" y="1061.1211">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="523" x="823" y="1076.4316">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="823" y="1091.7422">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="823" y="1107.0527">AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="823" y="1122.3633">LIMIT 1</text><polygon fill="#A80036" points="703,1151.416,693,1155.416,703,1159.416,699,1155.416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="1155.416" y2="1155.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="1150.6738">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="1150.6738">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="767" y="1150.6738">transferCommittedAccount</text><path d="M687,1170.416 L771,1170.416 L771,1177.416 L761,1187.416 L687,1187.416 L687,1170.416 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="133.1738" style="stroke: #000000; stroke-width: 2.0;" width="494" x="687" y="1170.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="702" y="1183.9844">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="786" y="1183.0508">[transferCommittedAccount != undefined]</text><path d="M697,1192.7266 L697,1293.7266 L1167,1293.7266 L1167,1202.7266 L1157,1192.7266 L697,1192.7266 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1157,1192.7266 L1157,1202.7266 L1167,1202.7266 L1157,1192.7266 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="1210.2949">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="719" y="1225.6055">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="735" y="1240.916">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="735" y="1256.2266">"errorDescription": "At least one settlement transfer is committed"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="719" y="1271.5371">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="703" y="1286.8477">}</text><path d="M610,1324.5898 L775,1324.5898 L775,1331.5898 L765,1341.5898 L610,1341.5898 L610,1324.5898 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1665.875" style="stroke: #000000; stroke-width: 2.0;" width="716" x="610" y="1324.5898"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="625" y="1338.1582">DB TRANSACTION</text><polygon fill="#A80036" points="1068,1359.2109,1078,1363.2109,1068,1367.2109,1072,1363.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="1363.2109" y2="1363.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="699" y="1358.4688">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="712" y="1358.4688">Retrive settlement accounts information</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="901,1376.2109,1269,1376.2109,1279,1471.2109,1269,1567.2109,901,1567.2109,891,1471.2109,901,1376.2109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="903" y="1392.7793">SELECT pc.participantId, spc.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="919" y="1408.0898">spcsc.settlementStateId, spcsc.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="919" y="1423.4004">spcsc.createdDate, spc.netAmount, pc.currencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="919" y="1438.7109">spc.settlementParticipantCurrencyId AS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1171" y="1438.7109">key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="903" y="1454.0215">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="943" y="1454.0215">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="1154" y="1454.0215">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="903" y="1469.332">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="935" y="1469.332">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1231" y="1469.332">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="903" y="1484.6426">ON spcsc.settlementParticipantCurrencyStateChangeId =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="903" y="1499.9531">spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="903" y="1515.2637">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="935" y="1515.2637">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="1075" y="1515.2637">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="359" x="903" y="1530.5742">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="903" y="1545.8848">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="903" y="1561.1953">FOR UPDATE</text><polygon fill="#A80036" points="703,1590.248,693,1594.248,703,1598.248,699,1594.248" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="1594.248" y2="1594.248"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="709" y="1589.5059">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="722" y="1589.5059">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="767" y="1589.5059">settlementAccountsList</text><polygon fill="#A80036" points="1068,1619.5586,1078,1623.5586,1068,1627.5586,1072,1623.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="1623.5586" y2="1623.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1618.8164">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="721" y="1618.8164">Retrive settlement windows information</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="863,1636.5586,1306,1636.5586,1316,1708.5586,1306,1781.5586,863,1781.5586,853,1708.5586,863,1636.5586" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="865" y="1653.127">SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="881" y="1668.4375">swsc.reason, swsc.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="865" y="1683.748">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="197" x="905" y="1683.748">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="1106" y="1683.748">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="865" y="1699.0586">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="897" y="1699.0586">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="1026" y="1699.0586">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="865" y="1714.3691">ON sw.settlementWindow = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="865" y="1729.6797">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="897" y="1729.6797">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1111" y="1729.6797">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="439" x="865" y="1744.9902">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="865" y="1760.3008">WHERE ssw.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="865" y="1775.6113">FOR UPDATE</text><polygon fill="#A80036" points="703,1804.6641,693,1808.6641,703,1812.6641,699,1808.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="1808.6641" y2="1808.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="1803.9219">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="1803.9219">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="776" y="1803.9219">windowsList</text><path d="M620,1823.6641 L1033,1823.6641 L1033,1830.6641 L1023,1840.6641 L620,1840.6641 L620,1823.6641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="690" x="620" y="1823.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="368" x="635" y="1837.2324">Bulk insert settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="1068,1858.2852,1078,1862.2852,1068,1866.2852,1072,1862.2852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="1862.2852" y2="1862.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1857.543">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="721" y="1857.543">Insert settlementParticipantCurrencyStateChange</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="949,1875.2852,1221,1875.2852,1231,1886.2852,1221,1898.2852,949,1898.2852,939,1886.2852,949,1875.2852" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="951" y="1891.8535">settlementParticipantCurrencyStateChange</text><polygon fill="#A80036" points="703,1920.9063,693,1924.9063,703,1928.9063,699,1924.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="1924.9063" y2="1924.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="1920.1641">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="1920.1641">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="776" y="1920.1641">spcscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="1954.2168" y2="1954.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="1954.2168" y2="1967.2168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="1967.2168" y2="1967.2168"/><polygon fill="#A80036" points="703,1963.2168,693,1967.2168,703,1971.2168,699,1967.2168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1949.4746">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="721" y="1949.4746">Merge spcscIdList into settlementAccountsList</text><polygon fill="#A80036" points="1068,1992.5273,1078,1996.5273,1068,2000.5273,1072,1996.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="1996.5273" y2="1996.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="1991.7852">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="721" y="1991.7852">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="879,2039.5273,1290,2039.5273,1300,2050.5273,1290,2062.5273,879,2062.5273,869,2050.5273,879,2039.5273" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="881" y="2056.0957">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="935" y="2056.0957">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1142" y="2056.0957">.currentStateChangeIds</text><rect fill="#FFFFFF" filter="url(#f5zhh3qrf7f9q)" height="86.5527" style="stroke: #000000; stroke-width: 2.0;" width="505" x="627" y="2074.8379"/><polygon fill="#EEEEEE" points="627,2074.8379,691,2074.8379,691,2081.8379,681,2091.8379,627,2091.8379,627,2074.8379" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="640" y="2089.4063">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="704" y="2108.4063">Settlement Transfer Abort</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="708" y="2123.7168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="704" y="2139.0273">Inputs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="747" y="2139.0273">: settlementId, transactionTimestamp, enums, trx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="708" y="2154.3379"/><path d="M620,2173.3906 L975,2173.3906 L975,2180.3906 L965,2190.3906 L620,2190.3906 L620,2173.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="305.416" style="stroke: #000000; stroke-width: 2.0;" width="609" x="620" y="2173.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="310" x="635" y="2186.959">Bulk insert and reset contents &amp; aggregations</text><polygon fill="#A80036" points="1068,2208.0117,1078,2212.0117,1068,2216.0117,1072,2212.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2212.0117" y2="2212.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2207.2695">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="721" y="2207.2695">Bulk insert aborted state</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="961,2225.0117,1209,2225.0117,1219,2236.0117,1209,2248.0117,961,2248.0117,951,2236.0117,961,2225.0117" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="963" y="2241.5801">settlementWindowContentStateChange</text><polygon fill="#A80036" points="703,2270.6328,693,2274.6328,703,2278.6328,699,2274.6328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="2274.6328" y2="2274.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2269.8906">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2269.8906">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="776" y="2269.8906">swcscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="2303.9434" y2="2303.9434"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="2303.9434" y2="2316.9434"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="2316.9434" y2="2316.9434"/><polygon fill="#A80036" points="703,2312.9434,693,2316.9434,703,2320.9434,699,2316.9434" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2299.2012">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="721" y="2299.2012">Merge swcscIdList</text><polygon fill="#A80036" points="1068,2342.2539,1078,2346.2539,1068,2350.2539,1072,2346.2539" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2346.2539" y2="2346.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2341.5117">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="721" y="2341.5117">Update current state references and reset settlementId</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="978,2389.2539,1192,2389.2539,1202,2431.2539,1192,2473.2539,978,2473.2539,968,2431.2539,978,2389.2539" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="980" y="2405.8223">settlementWindowContent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="996" y="2421.1328">.currentStateChangeIds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="996" y="2436.4434">.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="980" y="2451.7539">settlementContentAggregation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="996" y="2467.0645">.settlementId</text><path d="M620,2492.8066 L951,2492.8066 L951,2499.8066 L941,2509.8066 L620,2509.8066 L620,2492.8066 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.1738" style="stroke: #000000; stroke-width: 2.0;" width="649" x="620" y="2492.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="635" y="2506.375">Bulk insert settlementWindowStateChange</text><polygon fill="#A80036" points="1068,2527.4277,1078,2531.4277,1068,2535.4277,1072,2531.4277" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2531.4277" y2="2531.4277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2526.6855">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="721" y="2526.6855">Insert settlementWindowStateChange</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="986,2544.4277,1184,2544.4277,1194,2555.4277,1184,2567.4277,986,2567.4277,976,2555.4277,986,2544.4277" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="988" y="2560.9961">settlementWindowStateChange</text><polygon fill="#A80036" points="703,2590.0488,693,2594.0488,703,2598.0488,699,2594.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="2594.0488" y2="2594.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2589.3066">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2589.3066">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="776" y="2589.3066">swscIdList</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="734" y1="2623.3594" y2="2623.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="734" x2="734" y1="2623.3594" y2="2636.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="693" x2="734" y1="2636.3594" y2="2636.3594"/><polygon fill="#A80036" points="703,2632.3594,693,2636.3594,703,2640.3594,699,2636.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2618.6172">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="721" y="2618.6172">Merge swscIdList into windowList</text><polygon fill="#A80036" points="1068,2661.6699,1078,2665.6699,1068,2669.6699,1072,2665.6699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2665.6699" y2="2665.6699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2660.9277">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="721" y="2660.9277">Update all pointers to current state change ids</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="920,2708.6699,1249,2708.6699,1259,2719.6699,1249,2731.6699,920,2731.6699,910,2719.6699,920,2708.6699" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="922" y="2725.2383">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="976" y="2725.2383">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1101" y="2725.2383">.currentStateChangeIds</text><path d="M620,2750.9805 L865,2750.9805 L865,2757.9805 L855,2767.9805 L620,2767.9805 L620,2750.9805 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="232.4844" style="stroke: #000000; stroke-width: 2.0;" width="628" x="620" y="2750.9805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="200" x="635" y="2764.5488">Insert settlementStateChange</text><polygon fill="#A80036" points="1068,2785.6016,1078,2789.6016,1068,2793.6016,1072,2789.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2789.6016" y2="2789.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2784.8594">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="721" y="2784.8594">Insert settlementStateChange</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="941,2802.6016,1228,2802.6016,1238,2828.6016,1228,2855.6016,941,2855.6016,931,2828.6016,941,2802.6016" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="943" y="2819.1699">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="1027" y="2819.1699">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="959" y="2834.4805">(settlementId, settlementStateId, reason)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="943" y="2849.791">VALUES ({id}, 'ABORTED', {abortReasonString})</text><polygon fill="#A80036" points="703,2878.8438,693,2882.8438,703,2886.8438,699,2882.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="697" x2="1084" y1="2882.8438" y2="2882.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="709" y="2878.1016">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="731" y="2878.1016">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="776" y="2878.1016">settlementStateChangeId</text><polygon fill="#A80036" points="1068,2908.1543,1078,2912.1543,1068,2916.1543,1072,2912.1543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="1074" y1="2912.1543" y2="2912.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="699" y="2907.4121">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="721" y="2907.4121">Update pointer to current state change id</text><polygon fill="#FFFFE0" filter="url(#f5zhh3qrf7f9q)" points="950,2955.1543,1219,2955.1543,1229,2966.1543,1219,2978.1543,950,2978.1543,940,2966.1543,950,2955.1543" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="952" y="2971.7227">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="1006" y="2971.7227">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1078" y="2971.7227">.currentStateChangeId</text><polygon fill="#A80036" points="438,3014.7754,428,3018.7754,438,3022.7754,434,3018.7754" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="432" x2="686" y1="3018.7754" y2="3018.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="444" y="3014.0332">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="466" y="3014.0332">Return facade method result</text><path d="M23,3033.7754 L85,3033.7754 L85,3040.7754 L75,3050.7754 L23,3050.7754 L23,3033.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="348.9688" style="stroke: #000000; stroke-width: 2.0;" width="550" x="23" y="3033.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="3047.3438">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="100" y="3046.4102">[success]</text><path d="M188,3056.0859 L188,3142.0859 L408,3142.0859 L408,3066.0859 L398,3056.0859 L188,3056.0859 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M398,3056.0859 L398,3066.0859 L408,3066.0859 L398,3056.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="194" y="3073.6543">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="210" y="3088.9648">"id": {id},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="210" y="3104.2754">"state": 'ABORTED',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="210" y="3119.5859">"reason": {abortReasonString}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="194" y="3134.8965">}</text><polygon fill="#A80036" points="218,3168.9492,208,3172.9492,218,3176.9492,214,3172.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="212" x2="416" y1="3172.9492" y2="3172.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="224" y="3168.207">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="246" y="3168.207">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="573" y1="3181.9492" y2="3181.9492"/><path d="M432,3187.9492 L432,3212.9492 L559,3212.9492 L559,3197.9492 L549,3187.9492 L432,3187.9492 " fill="#D3D3D3" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M549,3187.9492 L549,3197.9492 L559,3197.9492 L549,3187.9492 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="438" y="3205.5176">Log ERROR event</text><path d="M33,3227.2598 L33,3328.2598 L408,3328.2598 L408,3237.2598 L398,3227.2598 L33,3227.2598 " fill="#FFFF00" filter="url(#f5zhh3qrf7f9q)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M398,3227.2598 L398,3237.2598 L408,3237.2598 L398,3227.2598 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="3244.8281">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="55" y="3260.1387">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="71" y="3275.4492">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="71" y="3290.7598">"errorDescription": "Client/Server error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="55" y="3306.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="39" y="3321.3809">}</text><polygon fill="#A80036" points="218,3370.7441,208,3374.7441,218,3378.7441,214,3374.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="212" x2="421" y1="3374.7441" y2="3374.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="224" y="3362.3467">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="246" y="3354.6914">Respond HTTP 4xx or 5xx</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="246" y="3370.002">(Client/Server error)</text><!--
@startuml
title 6.2.6. Settlement Abort (abortSettlementById)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Settlement Abort
    activate OPERATOR
    note right of OPERATOR #yellow
        {
            "state": "ABORTED",
            "reason": {abortReasonString}
        }
    end note

    OPERATOR -> SSAPI: PUT - /settlement/{id}
    activate SSAPI
    SSAPI -> SETTLE_DAO: abortSettlementById facade method\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO

    SETTLE_DAO -> DB: Retrieve settlement information
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId,
            ssc.reason, ssc.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    SETTLE_DAO <- - DB: Return **settlementData**
    deactivate DB

    alt settlementData.settlementStateId == 'PS_TRANSFERS_COMMITTED'||\nsettlementData.settlementStateId == 'SETTLING'||\nsettlementData.settlementStateId == 'SETTLED'
    break
        note right of SETTLE_DAO #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "State change is not allowed"
                }
            }
        end note
    end
    else settlementData.settlementStateId == 'ABORTED'
    break
        SETTLE_DAO -> DB: Append additional info at settlement level
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            INSERT INTO **settlementStateChange**
                (settlementId, settlementStateId, reason)
            VALUES ({id}, 'ABORTED', {abortReasonString})
        end hnote

        note right of SETTLE_DAO #yellow
            {
                "id": {id},
                "state": 'ABORTED',
                "reason": {abortReasonString}
            }
        end note
    end
    else settlementData.settlementStateId == 'PS_TRANSFERS_RESERVED'
        SETTLE_DAO -> DB: Find account in PS_TRANSFERS_COMMITTED
        activate DB
        hnote over DB #lightyellow
            SELECT spc.participantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
            WHERE spc.settlementId = {id}
            AND spcsc.settlementStateId = 'PS_TRANSFERS_COMMITTED'
            LIMIT 1
        end hnote
        SETTLE_DAO <- - DB: Return **transferCommittedAccount**
        deactivate DB
        break transferCommittedAccount != undefined
            note right of SETTLE_DAO #yellow
                {
                    errorInformation: {
                        "errorCode": <integer>,
                        "errorDescription": "At least one settlement transfer is committed"
                    }
                }
            end note
        end
    end

    group <color #blue>DB TRANSACTION</color>
        SETTLE_DAO -> DB: Retrive settlement accounts information
        activate DB
        hnote over DB #lightyellow
            SELECT pc.participantId, spc.participantCurrencyId,
                spcsc.settlementStateId, spcsc.reason,
                spcsc.createdDate, spc.netAmount, pc.currencyId,
                spc.settlementParticipantCurrencyId AS <color #0000FF>key</color>
            FROM **settlementParticipantCurrency** spc
            JOIN **settlementParticipantCurrencyStateChange** spcsc
            ON spcsc.settlementParticipantCurrencyStateChangeId =
            spc.currentStateChangeId
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **settlementAccountsList**
        deactivate DB

        SETTLE_DAO -> DB: Retrive settlement windows information
        activate DB
        hnote over DB #lightyellow
            SELECT ssw.settlementWindowId, swsc.settlementWindowStateId,
                swsc.reason, swsc.createdDate
            FROM **settlementSettlementWindow** ssw
            JOIN **settlementWindow** sw
            ON sw.settlementWindow = ssw.settlementWindowId
            JOIN **settlementWindowStateChange** swsc
            ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
            WHERE ssw.settlementId = {id}
            FOR UPDATE
        end hnote
        SETTLE_DAO <- - DB: Return **windowsList**
        deactivate DB

        group Bulk insert settlementParticipantCurrencyStateChange
            SETTLE_DAO -> DB: Insert settlementParticipantCurrencyStateChange
            activate DB
            hnote over DB #lightyellow
                settlementParticipantCurrencyStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **spcscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge spcscIdList into settlementAccountsList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementParticipantCurrency**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        ref over SETTLE_DAO, DB: Settlement Transfer Abort\n\n**Inputs**: settlementId, transactionTimestamp, enums, trx\n

        group Bulk insert and reset contents & aggregations
            SETTLE_DAO -> DB: Bulk insert aborted state
            activate DB
            hnote over DB #lightyellow
                settlementWindowContentStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **swcscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge swcscIdList

            SETTLE_DAO -> DB: Update current state references and reset settlementId
            activate DB
            hnote over DB #lightyellow
                **settlementWindowContent**
                    .currentStateChangeIds
                    .settlementId
                **settlementContentAggregation**
                    .settlementId
            end hnote
            deactivate DB
        end

        group Bulk insert settlementWindowStateChange
            SETTLE_DAO -> DB: Insert settlementWindowStateChange
            activate DB
            hnote over DB #lightyellow
                settlementWindowStateChange
            end hnote
            SETTLE_DAO <- - DB: Return **swscIdList**
            deactivate DB

            SETTLE_DAO -> SETTLE_DAO: Merge swscIdList into windowList

            SETTLE_DAO -> DB: Update all pointers to current state change ids
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlementWindow**.currentStateChangeIds
            end hnote
            deactivate DB
        end

        group Insert settlementStateChange
            SETTLE_DAO -> DB: Insert settlementStateChange
            activate DB
            hnote over DB #lightyellow
                INSERT INTO **settlementStateChange**
                    (settlementId, settlementStateId, reason)
                VALUES ({id}, 'ABORTED', {abortReasonString})
            end hnote
            SETTLE_DAO <- - DB: Return **settlementStateChangeId**
            deactivate DB

            SETTLE_DAO -> DB: Update pointer to current state change id
            activate DB
            hnote over DB #lightyellow
                UPDATE **settlement**.currentStateChangeId
            end hnote
            deactivate DB
        end
    end
    SSAPI <- - SETTLE_DAO: Return facade method result
    deactivate SETTLE_DAO

    alt success
        note left of SSAPI #yellow
            {
                "id": {id},
                "state": 'ABORTED',
                "reason": {abortReasonString}
            }
        end note

        SSAPI - -> OPERATOR: Respond HTTP - 200 (OK)
      else
        note right of SSAPI #lightgray
            Log ERROR event
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client/Server error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP 4xx or 5xx\n(Client/Server error)
        deactivate SSAPI
    end
end
deactivate OPERATOR
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>