<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2072px" preserveAspectRatio="none" style="width:1099px;height:2072px;" version="1.1" viewBox="0 0 1099 2072" width="1099px" zoomAndPan="magnify"><defs><filter height="300%" id="f73faoz8he0gd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="668" x="216.5" y="23.5352">9.1.1. Prepare Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)</text><rect fill="#FFFFE0" height="2027.1855" style="stroke: #A80036; stroke-width: 1.0;" width="1006.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="471.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="642.0547"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="1855.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="601.5" y="1229.5762"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="601.5" y="1556.3262"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="206.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="740.9863"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="1716.2129"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="968.5" y="855.5391"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="968.5" y="1745.5234"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="188" y="190.3965"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="188" y="361.9492"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="1373.2637" style="stroke: #000000; stroke-width: 2.0;" width="1075" x="13" y="603.4336"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="268.416" style="stroke: #000000; stroke-width: 2.0;" width="880" x="188" y="687.0547"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="932.916" style="stroke: #000000; stroke-width: 2.0;" width="920" x="158" y="1036.7813"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="213.4844" style="stroke: #000000; stroke-width: 2.0;" width="517.5" x="178" y="1061.0918"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="182.1738" style="stroke: #000000; stroke-width: 2.0;" width="497.5" x="188" y="1085.4023"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="294.75" style="stroke: #000000; stroke-width: 2.0;" width="537.5" x="168" y="1313.5762"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="263.4395" style="stroke: #000000; stroke-width: 2.0;" width="517.5" x="178" y="1337.8867"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="146.1973" style="stroke: #000000; stroke-width: 2.0;" width="497.5" x="188" y="1448.1289"/><rect fill="#FFFFFF" height="74.2656" style="stroke: none; stroke-width: 1.0;" width="497.5" x="188" y="1520.0605"/><rect fill="#FFFFFF" height="329.3711" style="stroke: none; stroke-width: 1.0;" width="920" x="158" y="1640.3262"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="300.416" style="stroke: #000000; stroke-width: 2.0;" width="880" x="188" y="1662.2813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="78" x2="78" y1="118.7754" y2="1993.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="238" x2="238" y1="118.7754" y2="1993.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="476.5" x2="476.5" y1="118.7754" y2="1993.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="606.5" x2="606.5" y1="118.7754" y2="1993.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="733.5" x2="733.5" y1="118.7754" y2="1993.6973"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="973.5" x2="973.5" y1="118.7754" y2="1993.6973"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="79.2871"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="103.8223">topic-source</text><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="1992.6973"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="1996.6973"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="2017.2324">topic-source</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="99.334">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="115.8223">Handler</text><ellipse cx="238" cy="69.7988" fill="#FEFECE" filter="url(#f73faoz8he0gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,57.7988,240,52.7988,238,57.7988,240,62.7988,234,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="2006.2324">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="2022.7207">Handler</text><ellipse cx="238" cy="2041.6738" fill="#FEFECE" filter="url(#f73faoz8he0gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,2029.6738,240,2024.6738,238,2029.6738,240,2034.6738,234,2029.6738" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="430.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="426.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="433.5" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="430.5" y="1992.6973"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="426.5" y="1996.6973"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="433.5" y="2017.2324">topic-event</text><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="541.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="537.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="544.5" y="103.8223">topic-notifcation</text><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="541.5" y="1992.6973"/><rect fill="#FEFECE" filter="url(#f73faoz8he0gd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="537.5" y="1996.6973"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="544.5" y="2017.2324">topic-notifcation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="685.5" y="115.8223">Request DAO</text><ellipse cx="733.5" cy="86.2871" fill="#FEFECE" filter="url(#f73faoz8he0gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="721.5" x2="745.5" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="685.5" y="2006.2324">Request DAO</text><ellipse cx="733.5" cy="2025.1855" fill="#FEFECE" filter="url(#f73faoz8he0gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="721.5" x2="745.5" y1="2039.1855" y2="2039.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="925.5" y="115.8223">Central Store</text><path d="M955.5,66.2871 C955.5,56.2871 973.5,56.2871 973.5,56.2871 C973.5,56.2871 991.5,56.2871 991.5,66.2871 L991.5,92.2871 C991.5,102.2871 973.5,102.2871 973.5,102.2871 C973.5,102.2871 955.5,102.2871 955.5,92.2871 L955.5,66.2871 " fill="#FEFECE" filter="url(#f73faoz8he0gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M955.5,66.2871 C955.5,76.2871 973.5,76.2871 973.5,76.2871 C973.5,76.2871 991.5,76.2871 991.5,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="925.5" y="2006.2324">Central Store</text><path d="M955.5,2019.1855 C955.5,2009.1855 973.5,2009.1855 973.5,2009.1855 C973.5,2009.1855 991.5,2009.1855 991.5,2019.1855 L991.5,2045.1855 C991.5,2055.1855 973.5,2055.1855 973.5,2055.1855 C973.5,2055.1855 955.5,2055.1855 955.5,2045.1855 L955.5,2019.1855 " fill="#FEFECE" filter="url(#f73faoz8he0gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M955.5,2019.1855 C955.5,2029.1855 973.5,2029.1855 973.5,2029.1855 C973.5,2029.1855 991.5,2029.1855 991.5,2019.1855 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="642.0547"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="1855.9219" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="601.5" y="1229.5762"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="601.5" y="1556.3262"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="206.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="740.9863"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="728.5" y="1716.2129"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="968.5" y="855.5391"/><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="968.5" y="1745.5234"/><path d="M248,133.7754 L248,173.7754 L525,173.7754 L525,143.7754 L515,133.7754 L248,133.7754 " fill="#D3D3D3" filter="url(#f73faoz8he0gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M515,133.7754 L515,143.7754 L525,143.7754 L515,133.7754 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="254" y="151.3438">Processing Handler here refers to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="254" y="166.6543">entry point where the request is received</text><path d="M188,190.3965 L332,190.3965 L332,197.3965 L322,207.3965 L188,207.3965 L188,190.3965 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="188" y="190.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="203" y="203.9648">Security Check</text><polygon fill="#A80036" points="465,250.0176,475,254.0176,465,258.0176,469,254.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="471" y1="254.0176" y2="254.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="249.2754">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="249.2754">Produce message</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="331.5" x="195" y="262.0176"/><polygon fill="#EEEEEE" points="195,262.0176,259,262.0176,259,269.0176,249,279.0176,195,279.0176,195,262.0176" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="276.5859">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="287.75" y="295.5859">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="291.75" y="310.8965"/><path d="M188,361.9492 L387,361.9492 L387,368.9492 L377,378.9492 L188,378.9492 L188,361.9492 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="349.5" x="188" y="361.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="203" y="375.5176">Schema Validation (joi)</text><polygon fill="#A80036" points="465,421.5703,475,425.5703,465,429.5703,469,425.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="471" y1="425.5703" y2="425.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="420.8281">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="420.8281">Produce message</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="331.5" x="195" y="433.5703"/><polygon fill="#EEEEEE" points="195,433.5703,259,433.5703,259,440.5703,249,450.5703,195,450.5703,195,433.5703" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="448.1387">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="287.75" y="467.1387">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="291.75" y="482.4492"/><path d="M248,531.502 L248,586.502 L623,586.502 L623,541.502 L613,531.502 L248,531.502 " fill="#D3D3D3" filter="url(#f73faoz8he0gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M613,531.502 L613,541.502 L623,541.502 L613,531.502 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="254" y="549.0703">Processing Handler onwards refers to the corresponding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="254" y="564.3809">Handler where duplicate checking is executed (e.g.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="254" y="579.6914">PrepareHandler, BulkPrepareHandler, etc.)</text><path d="M13,603.4336 L226,603.4336 L226,610.4336 L216,620.4336 L13,620.4336 L13,603.4336 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1373.2637" style="stroke: #000000; stroke-width: 2.0;" width="1075" x="13" y="603.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="28" y="617.002">Request Duplicate Check</text><polygon fill="#A80036" points="94,638.0547,84,642.0547,94,646.0547,90,642.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="232" y1="642.0547" y2="642.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100" y="637.3125">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="113" y="637.3125">Consume message</text><path d="M188,687.0547 L312,687.0547 L312,694.0547 L302,704.0547 L188,704.0547 L188,687.0547 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="268.416" style="stroke: #000000; stroke-width: 2.0;" width="880" x="188" y="687.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="203" y="700.623">UUID Check</text><polygon fill="#A80036" points="716.5,736.9863,726.5,740.9863,716.5,744.9863,720.5,740.9863" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="722.5" y1="740.9863" y2="740.9863"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="728.5889">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="263" y="720.9336">Query hash by id</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="736.2441">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="736.2441">2003</text><path d="M743,753.9863 L743,824.9863 L980,824.9863 L980,763.9863 L970,753.9863 L743,753.9863 " fill="#D3D3D3" filter="url(#f73faoz8he0gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M970,753.9863 L970,763.9863 L980,763.9863 L970,753.9863 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="749" y="771.5547">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="800" y="771.5547">keyword to be replaced by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="749" y="786.8652">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="803" y="786.8652">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="811" y="786.8652">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="903" y="786.8652">or other</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="749" y="802.1758">depending on the referencing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="749" y="817.4863">sequence diagram</text><polygon fill="#A80036" points="956.5,851.5391,966.5,855.5391,956.5,859.5391,960.5,855.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="962.5" y1="855.5391" y2="855.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="745.5" y="850.7969">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="758.5" y="850.7969">getHashById</text><polygon fill="#FFFFE0" filter="url(#f73faoz8he0gd)" points="898,868.5391,1048,868.5391,1058,879.5391,1048,891.5391,898,891.5391,888,879.5391,898,868.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="900" y="885.1074">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="947" y="885.1074">DuplicateCheck</text><polygon fill="#A80036" points="749.5,914.1602,739.5,918.1602,749.5,922.1602,745.5,918.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="743.5" x2="972.5" y1="918.1602" y2="918.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="755.5" y="913.418">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="768.5" y="913.418">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="813.5" y="913.418">hashRecord</text><polygon fill="#A80036" points="254,943.4707,244,947.4707,254,951.4707,250,947.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="732.5" y1="947.4707" y2="947.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="942.7285">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="273" y="942.7285">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="318" y="942.7285">hashRecord</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="983.7813" y2="983.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="983.7813" y2="996.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="996.7813" y2="996.7813"/><polygon fill="#A80036" points="254,992.7813,244,996.7813,254,1000.7813,250,996.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="979.0391">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="263" y="979.0391">Generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="322" y="979.0391">currentMessageHash</text><path d="M158,1036.7813 L220,1036.7813 L220,1043.7813 L210,1053.7813 L158,1053.7813 L158,1036.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="932.916" style="stroke: #000000; stroke-width: 2.0;" width="920" x="158" y="1036.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="173" y="1050.3496">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="235" y="1049.416">[hashRecord EXISTS]</text><path d="M178,1061.0918 L326,1061.0918 L326,1068.0918 L316,1078.0918 L178,1078.0918 L178,1061.0918 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="213.4844" style="stroke: #000000; stroke-width: 2.0;" width="517.5" x="178" y="1061.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="193" y="1074.6602">Hash Mismatch</text><path d="M188,1085.4023 L255,1085.4023 L255,1092.4023 L245,1102.4023 L188,1102.4023 L188,1085.4023 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.1738" style="stroke: #000000; stroke-width: 2.0;" width="497.5" x="188" y="1085.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="203" y="1098.9707">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="237" x="270" y="1098.0371">[currentMessageHash != hashRecord.hash]</text><polygon fill="#A80036" points="465,1120.0234,475,1124.0234,465,1128.0234,469,1124.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="471" y1="1124.0234" y2="1124.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="1119.2813">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="1119.2813">Produce message</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="331.5" x="195" y="1132.0234"/><polygon fill="#EEEEEE" points="195,1132.0234,259,1132.0234,259,1139.0234,249,1149.0234,195,1149.0234,195,1132.0234" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1146.5918">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="287.75" y="1165.5918">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="291.75" y="1180.9023"/><polygon fill="#A80036" points="589.5,1225.5762,599.5,1229.5762,589.5,1233.5762,593.5,1229.5762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="595.5" y1="1229.5762" y2="1229.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1217.1787">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1209.5234">Produce message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1224.834">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="349" y="1224.834">3106 - Modified Request</text><path d="M168,1313.5762 L329,1313.5762 L329,1320.5762 L319,1330.5762 L168,1330.5762 L168,1313.5762 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="294.75" style="stroke: #000000; stroke-width: 2.0;" width="537.5" x="168" y="1313.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="183" y="1327.1445">Resend Handling</text><path d="M178,1337.8867 L245,1337.8867 L245,1344.8867 L235,1354.8867 L178,1354.8867 L178,1337.8867 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="263.4395" style="stroke: #000000; stroke-width: 2.0;" width="517.5" x="178" y="1337.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="193" y="1351.4551">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="260" y="1350.5215">[currentMessageHash == hashRecord.hash]</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="479.5" x="195" y="1380.1973"/><polygon fill="#EEEEEE" points="195,1380.1973,259,1380.1973,259,1387.1973,249,1397.1973,195,1397.1973,195,1380.1973" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1394.7656">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="264.75" y="1413.7656">Apply specific</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="357.75" y="1413.7656">getMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="434.75" y="1413.7656">to report</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="493.75" y="1413.7656">currentState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="236.75" y="1429.0762"/><path d="M188,1448.1289 L250,1448.1289 L250,1455.1289 L240,1465.1289 L188,1465.1289 L188,1448.1289 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="146.1973" style="stroke: #000000; stroke-width: 2.0;" width="497.5" x="188" y="1448.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="203" y="1461.6973">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="265" y="1460.7637">[currentState ===</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="370" y="1460.7637">inProgress</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="1460.7637">]</text><path d="M248,1470.4395 L248,1510.4395 L536,1510.4395 L536,1480.4395 L526,1470.4395 L248,1470.4395 " fill="#D3D3D3" filter="url(#f73faoz8he0gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M526,1470.4395 L526,1480.4395 L536,1480.4395 L526,1470.4395 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="254" y="1488.0078">Ignore this request and allow the ongoing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="254" y="1503.3184">request to complete with a callback</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="685.5" y1="1521.0605" y2="1521.0605"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="193" y="1531.6953">[Previous reqest has completed]</text><polygon fill="#A80036" points="589.5,1552.3262,599.5,1556.3262,589.5,1560.3262,593.5,1556.3262" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="595.5" y1="1556.3262" y2="1556.3262"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1551.584">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="272" y="1551.584">Produce GET callback notification</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="158" x2="1078" y1="1641.3262" y2="1641.3262"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="146" x="163" y="1651.9609">[hashRecord NOT FOUND]</text><path d="M188,1662.2813 L343,1662.2813 L343,1669.2813 L333,1679.2813 L188,1679.2813 L188,1662.2813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="300.416" style="stroke: #000000; stroke-width: 2.0;" width="880" x="188" y="1662.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="203" y="1675.8496">Process Request</text><polygon fill="#A80036" points="716.5,1712.2129,726.5,1716.2129,716.5,1720.2129,720.5,1716.2129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="722.5" y1="1716.2129" y2="1716.2129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1703.8154">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="272" y="1696.1602">Persist request hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1711.4707">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="1711.4707">2003</text><polygon fill="#A80036" points="956.5,1741.5234,966.5,1745.5234,956.5,1749.5234,960.5,1745.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="738.5" x2="962.5" y1="1745.5234" y2="1745.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="745.5" y="1740.7813">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="767.5" y="1740.7813">Persist</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="813.5" y="1740.7813">currentMessageHash</text><polygon fill="#FFFFE0" filter="url(#f73faoz8he0gd)" points="898,1788.5234,1048,1788.5234,1058,1799.5234,1048,1811.5234,898,1811.5234,888,1799.5234,898,1788.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="900" y="1805.0918">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="947" y="1805.0918">DuplicateCheck</text><polygon fill="#A80036" points="254,1834.1445,244,1838.1445,254,1842.1445,250,1838.1445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="732.5" y1="1838.1445" y2="1838.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1833.4023">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="1833.4023">Return success</text><rect fill="#FFFFFF" filter="url(#f73faoz8he0gd)" height="86.5527" style="stroke: #000000; stroke-width: 2.0;" width="479.5" x="195" y="1871.1445"/><polygon fill="#EEEEEE" points="195,1871.1445,259,1871.1445,259,1878.1445,249,1888.1445,195,1888.1445,195,1871.1445" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1885.7129">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="241.75" y="1904.7129">Execute</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="294.75" y="1904.7129">specific processing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="427.75" y="1904.7129">(Quote, Bulk or Transfer Prepare)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="241.75" y="1920.0234">outside of a DB transaction (insert all records which pass DB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="241.75" y="1935.334">integrity constraints and ignore non-successful inserts)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="245.75" y="1950.6445"/><!--
@startuml
title 9.1.1. Prepare Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)

autonumber


collections "topic-source" as TOPIC_SOURCE
control "Processing\nHandler" as HANDLER
collections "topic-event" as TOPIC_EVENTS
collections "topic-notifcation" as TOPIC_NOTIFICATION
entity "Request DAO" as DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_SOURCE
    participant HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant DAO
    participant DB
end box

activate HANDLER

note right of HANDLER #lightgrey
    Processing Handler here refers to the
    entry point where the request is received
end note

group Security Check
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

group Schema Validation (joi)
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

note right of HANDLER #lightgrey
    Processing Handler onwards refers to the corresponding
    Handler where duplicate checking is executed (e.g. 
    PrepareHandler, BulkPrepareHandler, etc.)
end note

group Request Duplicate Check
    TOPIC_SOURCE <- HANDLER: Consume message
    activate TOPIC_SOURCE
    deactivate TOPIC_SOURCE

    group UUID Check
        HANDLER -> DAO: Query hash by id\n<color #red><b>Error code:</b> 2003</color>
        activate DAO
        note right of DAO #lightgrey
            //request// keyword to be replaced by
            **transfer**, **bulkTransfer** or other
            depending on the referencing 
            sequence diagram
        end note
        DAO -> DB: getHashById
        hnote over DB #lightyellow
            //request//DuplicateCheck
        end note
        activate DB
        DB - -> DAO: Return **hashRecord**
        deactivate DB
        DAO - -> HANDLER: Return **hashRecord**
        deactivate DAO
    end
    
    HANDLER -> HANDLER: Generate **currentMessageHash**
    |||
    
    alt hashRecord EXISTS
        group Hash Mismatch
            opt currentMessageHash != hashRecord.hash
                HANDLER -> TOPIC_EVENTS: Produce message
                ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
                HANDLER -> TOPIC_NOTIFICATION: Produce message\n<color #red><b>Error code:</b> 3106 - Modified Request</color>
                activate TOPIC_NOTIFICATION
                deactivate TOPIC_NOTIFICATION
            end
        end
        |||

        group Resend Handling
            opt currentMessageHash == hashRecord.hash
                |||
                ref over HANDLER, TOPIC_NOTIFICATION: \tApply specific **getMethod** to report **currentState**\t\t\n
                alt currentState === //inProgress//
                    note right of HANDLER #lightgrey
                        Ignore this request and allow the ongoing 
                        request to complete with a callback
                    end note
                else Previous reqest has completed
                    HANDLER -> TOPIC_NOTIFICATION: Produce GET callback notification
                    activate TOPIC_NOTIFICATION
                    deactivate TOPIC_NOTIFICATION
                end
            end
        end
        |||

    else hashRecord NOT FOUND
        group Process Request
            HANDLER -> DAO: Persist request hash \n<color #FF0000><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: Persist **currentMessageHash**
            activate DB
            deactivate DB
            hnote over DB #lightyellow
                //request//DuplicateCheck
            end note
            DAO - -> HANDLER: Return success
            deactivate DAO
            |||
            ref over HANDLER, TOPIC_NOTIFICATION: Execute **specific processing** (Quote, Bulk or Transfer Prepare)\noutside of a DB transaction (insert all records which pass DB\nintegrity constraints and ignore non-successful inserts)\n
        end
    end
end

@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>