<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1503px" preserveAspectRatio="none" style="width:1094px;height:1503px;" version="1.1" viewBox="0 0 1094 1503" width="1094px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wj1ubisrnjaq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="609" x="243.5" y="23.5352">9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)</text><rect fill="#FFFFE0" height="1458.2617" style="stroke: #A80036; stroke-width: 1.0;" width="1001.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="469.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="642.0547"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="1286.998" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="206.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727.5" y="783.2969"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727.5" y="1178.5996"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="963.5" y="897.8496"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="963.5" y="1207.9102"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="188" y="190.3965"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="188" y="361.9492"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="804.3398" style="stroke: #000000; stroke-width: 2.0;" width="1070" x="13" y="603.4336"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="268.416" style="stroke: #000000; stroke-width: 2.0;" width="875" x="188" y="729.3652"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="303.75" style="stroke: #000000; stroke-width: 2.0;" width="895" x="178" y="1011.7813"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="254" x="188" y="1036.0918"/><rect fill="#FFFFFF" height="212.8184" style="stroke: none; stroke-width: 1.0;" width="895" x="178" y="1102.7129"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="875" x="188" y="1124.668"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="78" x2="78" y1="118.7754" y2="1424.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="238" x2="238" y1="118.7754" y2="1424.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="475.5" x2="475.5" y1="118.7754" y2="1424.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="605.5" x2="605.5" y1="118.7754" y2="1424.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="732.5" x2="732.5" y1="118.7754" y2="1424.7734"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="968.5" x2="968.5" y1="118.7754" y2="1424.7734"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="103.8223">topic-source</text><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="1423.7734"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="1427.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="1448.3086">topic-source</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="99.334">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="115.8223">Handler</text><ellipse cx="238" cy="69.7988" fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,57.7988,240,52.7988,238,57.7988,240,62.7988,234,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="1437.3086">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="1453.7969">Handler</text><ellipse cx="238" cy="1472.75" fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,1460.75,240,1455.75,238,1460.75,240,1465.75,234,1460.75" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="429.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="425.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="432.5" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="429.5" y="1423.7734"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="425.5" y="1427.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="432.5" y="1448.3086">topic-event</text><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="540.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="536.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="543.5" y="103.8223">topic-notifcation</text><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="540.5" y="1423.7734"/><rect fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="536.5" y="1427.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="543.5" y="1448.3086">topic-notifcation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="684.5" y="115.8223">Request DAO</text><ellipse cx="732.5" cy="86.2871" fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="720.5" x2="744.5" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="684.5" y="1437.3086">Request DAO</text><ellipse cx="732.5" cy="1456.2617" fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="720.5" x2="744.5" y1="1470.2617" y2="1470.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="920.5" y="115.8223">Central Store</text><path d="M950.5,66.2871 C950.5,56.2871 968.5,56.2871 968.5,56.2871 C968.5,56.2871 986.5,56.2871 986.5,66.2871 L986.5,92.2871 C986.5,102.2871 968.5,102.2871 968.5,102.2871 C968.5,102.2871 950.5,102.2871 950.5,92.2871 L950.5,66.2871 " fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M950.5,66.2871 C950.5,76.2871 968.5,76.2871 968.5,76.2871 C968.5,76.2871 986.5,76.2871 986.5,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="920.5" y="1437.3086">Central Store</text><path d="M950.5,1450.2617 C950.5,1440.2617 968.5,1440.2617 968.5,1440.2617 C968.5,1440.2617 986.5,1440.2617 986.5,1450.2617 L986.5,1476.2617 C986.5,1486.2617 968.5,1486.2617 968.5,1486.2617 C968.5,1486.2617 950.5,1486.2617 950.5,1476.2617 L950.5,1450.2617 " fill="#FEFECE" filter="url(#f1wj1ubisrnjaq)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M950.5,1450.2617 C950.5,1460.2617 968.5,1460.2617 968.5,1460.2617 C968.5,1460.2617 986.5,1460.2617 986.5,1450.2617 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="642.0547"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="1286.998" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="206.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727.5" y="783.2969"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="727.5" y="1178.5996"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="963.5" y="897.8496"/><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="963.5" y="1207.9102"/><path d="M248,133.7754 L248,173.7754 L525,173.7754 L525,143.7754 L515,133.7754 L248,133.7754 " fill="#D3D3D3" filter="url(#f1wj1ubisrnjaq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M515,133.7754 L515,143.7754 L525,143.7754 L515,133.7754 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="254" y="151.3438">Processing Handler here refers to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="254" y="166.6543">entry point where the request is received</text><path d="M188,190.3965 L332,190.3965 L332,197.3965 L322,207.3965 L188,207.3965 L188,190.3965 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="188" y="190.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="203" y="203.9648">Security Check</text><polygon fill="#A80036" points="464,250.0176,474,254.0176,464,258.0176,468,254.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="470" y1="254.0176" y2="254.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="249.2754">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="249.2754">Produce message</text><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="330.5" x="195" y="262.0176"/><polygon fill="#EEEEEE" points="195,262.0176,259,262.0176,259,269.0176,249,279.0176,195,279.0176,195,262.0176" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="276.5859">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="287.25" y="295.5859">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="291.25" y="310.8965"/><path d="M188,361.9492 L387,361.9492 L387,368.9492 L377,378.9492 L188,378.9492 L188,361.9492 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="188" y="361.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="203" y="375.5176">Schema Validation (joi)</text><polygon fill="#A80036" points="464,421.5703,474,425.5703,464,429.5703,468,425.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="470" y1="425.5703" y2="425.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="420.8281">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="420.8281">Produce message</text><rect fill="#FFFFFF" filter="url(#f1wj1ubisrnjaq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="330.5" x="195" y="433.5703"/><polygon fill="#EEEEEE" points="195,433.5703,259,433.5703,259,440.5703,249,450.5703,195,450.5703,195,433.5703" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="448.1387">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="287.25" y="467.1387">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="291.25" y="482.4492"/><path d="M248,531.502 L248,586.502 L623,586.502 L623,541.502 L613,531.502 L248,531.502 " fill="#D3D3D3" filter="url(#f1wj1ubisrnjaq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M613,531.502 L613,541.502 L623,541.502 L613,531.502 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="254" y="549.0703">Processing Handler onwards refers to the corresponding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="254" y="564.3809">Handler where duplicate checking is executed (e.g.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="254" y="579.6914">PrepareHandler, FulfilHandler, BulkPrepareHandler, etc.)</text><path d="M13,603.4336 L226,603.4336 L226,610.4336 L216,620.4336 L13,620.4336 L13,603.4336 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="804.3398" style="stroke: #000000; stroke-width: 2.0;" width="1070" x="13" y="603.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="28" y="617.002">Request Duplicate Check</text><polygon fill="#A80036" points="94,638.0547,84,642.0547,94,646.0547,90,642.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="232" y1="642.0547" y2="642.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100" y="637.3125">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="113" y="637.3125">Consume message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="701.3652" y2="701.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="701.3652" y2="714.3652"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="714.3652" y2="714.3652"/><polygon fill="#A80036" points="254,710.3652,244,714.3652,254,718.3652,250,714.3652" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="696.623">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="263" y="696.623">Generate hash:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="360" y="696.623">generatedHash</text><path d="M188,729.3652 L414,729.3652 L414,736.3652 L404,746.3652 L188,746.3652 L188,729.3652 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="268.416" style="stroke: #000000; stroke-width: 2.0;" width="875" x="188" y="729.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="203" y="742.9336">UUID Check (compareById)</text><polygon fill="#A80036" points="715.5,779.2969,725.5,783.2969,715.5,787.2969,719.5,783.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="721.5" y1="783.2969" y2="783.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="770.8994">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="263" y="763.2441">Query hash using getDuplicateDataFuncOverride(id)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="778.5547">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="778.5547">2003</text><path d="M742,796.2969 L742,867.2969 L979,867.2969 L979,806.2969 L969,796.2969 L742,796.2969 " fill="#D3D3D3" filter="url(#f1wj1ubisrnjaq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M969,796.2969 L969,806.2969 L979,806.2969 L969,796.2969 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="748" y="813.8652">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="799" y="813.8652">keyword to be replaced by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="748" y="829.1758">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="802" y="829.1758">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="810" y="829.1758">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="932" y="829.1758">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="748" y="844.4863">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="840" y="844.4863">or other depending</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="748" y="859.7969">on the override</text><polygon fill="#A80036" points="951.5,893.8496,961.5,897.8496,951.5,901.8496,955.5,897.8496" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737.5" x2="957.5" y1="897.8496" y2="897.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="744.5" y="893.1074">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="757.5" y="893.1074">getDuplicateDataFuncOverride</text><polygon fill="#FFFFE0" filter="url(#f1wj1ubisrnjaq)" points="893,910.8496,1043,910.8496,1053,921.8496,1043,933.8496,893,933.8496,883,921.8496,893,910.8496" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="895" y="927.418">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="942" y="927.418">DuplicateCheck</text><polygon fill="#A80036" points="748.5,956.4707,738.5,960.4707,748.5,964.4707,744.5,960.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="742.5" x2="967.5" y1="960.4707" y2="960.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="754.5" y="955.7285">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="767.5" y="955.7285">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="812.5" y="955.7285">duplicateHashRecord</text><polygon fill="#A80036" points="254,985.7813,244,989.7813,254,993.7813,250,989.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="731.5" y1="989.7813" y2="989.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="985.0391">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="273" y="985.0391">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="318" y="985.0391">hasDuplicateId</text><path d="M178,1011.7813 L240,1011.7813 L240,1018.7813 L230,1028.7813 L178,1028.7813 L178,1011.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="303.75" style="stroke: #000000; stroke-width: 2.0;" width="895" x="178" y="1011.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="193" y="1025.3496">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="255" y="1024.416">[hasDuplicateId == TRUE]</text><path d="M188,1036.0918 L435,1036.0918 L435,1043.0918 L425,1053.0918 L188,1053.0918 L188,1036.0918 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="254" x="188" y="1036.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="203" y="1049.6602">Hash Check (compareByHash)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="1074.7129" y2="1074.7129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="1074.7129" y2="1087.7129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="1087.7129" y2="1087.7129"/><polygon fill="#A80036" points="254,1083.7129,244,1087.7129,254,1091.7129,250,1087.7129" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="1069.9707">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="263" y="1069.9707">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="308" y="1069.9707">hasDuplicateHash</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="178" x2="1073" y1="1103.7129" y2="1103.7129"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="183" y="1114.3477">[hasDuplicateId == FALSE]</text><path d="M188,1124.668 L368,1124.668 L368,1131.668 L358,1141.668 L188,1141.668 L188,1124.668 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="875" x="188" y="1124.668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="203" y="1138.2363">Store Message Hash</text><polygon fill="#A80036" points="715.5,1174.5996,725.5,1178.5996,715.5,1182.5996,719.5,1178.5996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="721.5" y1="1178.5996" y2="1178.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1166.2021">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="272" y="1158.5469">Persist hash using saveHashFuncOverride(id, generatedHash)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1173.8574">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="1173.8574">2003</text><polygon fill="#A80036" points="951.5,1203.9102,961.5,1207.9102,951.5,1211.9102,955.5,1207.9102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="737.5" x2="957.5" y1="1207.9102" y2="1207.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="744.5" y="1203.168">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="766.5" y="1203.168">Persist</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="812.5" y="1203.168">generatedHash</text><polygon fill="#FFFFE0" filter="url(#f1wj1ubisrnjaq)" points="893,1250.9102,1043,1250.9102,1053,1261.9102,1043,1273.9102,893,1273.9102,883,1261.9102,893,1250.9102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="895" y="1267.4785">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="942" y="1267.4785">DuplicateCheck</text><polygon fill="#A80036" points="254,1296.5313,244,1300.5313,254,1304.5313,250,1300.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="731.5" y1="1300.5313" y2="1300.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1295.7891">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="1295.7891">Return success</text><path d="M248,1327.5313 L248,1398.5313 L456,1398.5313 L456,1337.5313 L446,1327.5313 L248,1327.5313 " fill="#FFFF00" filter="url(#f1wj1ubisrnjaq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M446,1327.5313 L446,1337.5313 L456,1337.5313 L446,1327.5313 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="254" y="1345.0996">return {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="270" y="1360.4102">hasDuplicateId: Boolean,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="270" y="1375.7207">hasDuplicateHash: Boolean</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="254" y="1391.0313">}</text><!--
@startuml
title 9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)

autonumber


collections "topic-source" as TOPIC_SOURCE
control "Processing\nHandler" as HANDLER
collections "topic-event" as TOPIC_EVENTS
collections "topic-notifcation" as TOPIC_NOTIFICATION
entity "Request DAO" as DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_SOURCE
    participant HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant DAO
    participant DB
end box

activate HANDLER

note right of HANDLER #lightgrey
    Processing Handler here refers to the
    entry point where the request is received
end note

group Security Check
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

group Schema Validation (joi)
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

note right of HANDLER #lightgrey
    Processing Handler onwards refers to the corresponding
    Handler where duplicate checking is executed (e.g. 
    PrepareHandler, FulfilHandler, BulkPrepareHandler, etc.)
end note

group Request Duplicate Check
    TOPIC_SOURCE <- HANDLER: Consume message
    activate TOPIC_SOURCE
    deactivate TOPIC_SOURCE

    HANDLER -> HANDLER: Generate hash: **generatedHash**
    group UUID Check (compareById)
        HANDLER -> DAO: Query hash using getDuplicateDataFuncOverride(id)\n<color #red><b>Error code:</b> 2003</color>
        activate DAO
        note right of DAO #lightgrey
            //request// keyword to be replaced by
            **transfer**, **transferFulfilment**, 
            **bulkTransfer** or other depending 
            on the override
        end note
        DAO -> DB: getDuplicateDataFuncOverride
        hnote over DB #lightyellow
            //request//DuplicateCheck
        end note
        activate DB
        DB - -> DAO: Return **duplicateHashRecord**
        deactivate DB
        DAO - -> HANDLER: Return **hasDuplicateId**
        deactivate DAO
    end
    
    alt hasDuplicateId == TRUE
        group Hash Check (compareByHash)
            HANDLER -> HANDLER: Return **hasDuplicateHash**
        end
    else hasDuplicateId == FALSE
        group Store Message Hash
            HANDLER -> DAO: Persist hash using saveHashFuncOverride(id, generatedHash)\n<color #FF0000><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: Persist **generatedHash**
            activate DB
            deactivate DB
            hnote over DB #lightyellow
                //request//DuplicateCheck
            end note
            DAO - -> HANDLER: Return success
            deactivate DAO
        end
    end

    note right of HANDLER #yellow
        return {
            hasDuplicateId: Boolean,
            hasDuplicateHash: Boolean
        }
    end note
end

@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>