<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2739px" preserveAspectRatio="none" style="width:1170px;height:2739px;" version="1.1" viewBox="0 0 1170 2739" width="1170px" zoomAndPan="magnify"><defs><filter height="300%" id="f1l5axhow2nk0n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="504.5" y="23.5352">2.3.2. Timeout Handler</text><rect fill="#FFFFE0" height="2693.8184" style="stroke: #A80036; stroke-width: 1.0;" width="1096.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="516.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="86.5" y="171.9082"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="2519.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="256.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="499.5" y="2361.6445"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="629.5" y="1453.7832"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="182.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="392.3926"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="650.8086"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="1543.3594"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="2508.8867"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="123.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="421.7031"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="680.1191"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="1572.6699"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="2538.1973"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="2512.5313" style="stroke: #000000; stroke-width: 2.0;" width="1146" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="645.5" x="160" y="216.9082"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="244.416" style="stroke: #000000; stroke-width: 2.0;" width="989" x="160" y="338.4609"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="1844.0781" style="stroke: #000000; stroke-width: 2.0;" width="989" x="160" y="596.877"/><rect fill="#FFFFFF" height="907.8613" style="stroke: none; stroke-width: 1.0;" width="989" x="160" y="1491.7832"/><rect fill="#FFFFFF" height="41.3105" style="stroke: none; stroke-width: 1.0;" width="989" x="160" y="2399.6445"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="977" x="160" y="2454.9551"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="91" x2="91" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="261" x2="261" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="504.5" x2="504.5" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="634.5" x2="634.5" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="744.5" x2="744.5" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="854.5" x2="854.5" y1="116.2871" y2="2662.8184"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1063.5" x2="1063.5" y1="116.2871" y2="2662.8184"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="27" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="23" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="66.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="30" y="101.334">transfer-timeout</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="27" y="2661.8184"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="23" y="2665.8184"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="66.5" y="2686.3535">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="30" y="2702.8418">transfer-timeout</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="170" y="113.334">Transfer Timeout Handler</text><ellipse cx="261.5" cy="83.7988" fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="257.5,71.7988,263.5,66.7988,261.5,71.7988,263.5,76.7988,257.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="170" y="2675.3535">Transfer Timeout Handler</text><ellipse cx="261.5" cy="2694.3066" fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="257.5,2682.3066,263.5,2677.3066,261.5,2682.3066,263.5,2687.3066,257.5,2682.3066" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="438.5" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="434.5" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="479.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="441.5" y="101.334">transfer-position</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="438.5" y="2661.8184"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="434.5" y="2665.8184"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="479.5" y="2686.3535">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="441.5" y="2702.8418">transfer-position</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="588.5" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="584.5" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="609.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="591.5" y="101.334">notification</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="588.5" y="2661.8184"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="584.5" y="2665.8184"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="609.5" y="2686.3535">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="591.5" y="2702.8418">notification</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="698.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="694.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="701.5" y="101.334">topic-event</text><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="698.5" y="2661.8184"/><rect fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="694.5" y="2665.8184"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="701.5" y="2686.3535">topic-event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="805.5" y="113.334">Timeout DAO</text><ellipse cx="854.5" cy="83.7988" fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="842.5" x2="866.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="805.5" y="2675.3535">Timeout DAO</text><ellipse cx="854.5" cy="2694.3066" fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="842.5" x2="866.5" y1="2708.3066" y2="2708.3066"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1015.5" y="113.334">Central Store</text><path d="M1045.5,63.7988 C1045.5,53.7988 1063.5,53.7988 1063.5,53.7988 C1063.5,53.7988 1081.5,53.7988 1081.5,63.7988 L1081.5,89.7988 C1081.5,99.7988 1063.5,99.7988 1063.5,99.7988 C1063.5,99.7988 1045.5,99.7988 1045.5,89.7988 L1045.5,63.7988 " fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1045.5,63.7988 C1045.5,73.7988 1063.5,73.7988 1063.5,73.7988 C1063.5,73.7988 1081.5,73.7988 1081.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1015.5" y="2675.3535">Central Store</text><path d="M1045.5,2688.3066 C1045.5,2678.3066 1063.5,2678.3066 1063.5,2678.3066 C1063.5,2678.3066 1081.5,2678.3066 1081.5,2688.3066 L1081.5,2714.3066 C1081.5,2724.3066 1063.5,2724.3066 1063.5,2724.3066 C1063.5,2724.3066 1045.5,2724.3066 1045.5,2714.3066 L1045.5,2688.3066 " fill="#FEFECE" filter="url(#f1l5axhow2nk0n)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1045.5,2688.3066 C1045.5,2698.3066 1063.5,2698.3066 1063.5,2698.3066 C1063.5,2698.3066 1081.5,2698.3066 1081.5,2688.3066 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="86.5" y="171.9082"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="2519.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="256.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="499.5" y="2361.6445"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="629.5" y="1453.7832"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="182.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="392.3926"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="650.8086"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="1543.3594"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="849.5" y="2508.8867"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="123.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="421.7031"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="680.1191"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="1572.6699"/><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1058.5" y="2538.1973"/><path d="M13,133.2871 L239,133.2871 L239,140.2871 L229,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2512.5313" style="stroke: #000000; stroke-width: 2.0;" width="1146" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="28" y="146.8555">Timeout Handler Consume</text><polygon fill="#A80036" points="107.5,167.9082,97.5,171.9082,107.5,175.9082,103.5,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="101.5" x2="255.5" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="113.5" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="126.5" y="167.166">Consume message</text><path d="M160,216.9082 L375,216.9082 L375,223.9082 L365,233.9082 L160,233.9082 L160,216.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="645.5" x="160" y="216.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="175" y="230.4766">Persist Event Information</text><polygon fill="#A80036" points="733,251.5293,743,255.5293,733,259.5293,737,255.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="739" y1="255.5293" y2="255.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="273.5" y="250.7871">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="286.5" y="250.7871">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1l5axhow2nk0n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="627.5" x="167" y="263.5293"/><polygon fill="#EEEEEE" points="167,263.5293,231,263.5293,231,270.5293,221,280.5293,167,280.5293,167,263.5293" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="180" y="278.0977">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="407.75" y="297.0977">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="411.75" y="312.4082"/><path d="M160,338.4609 L316,338.4609 L316,345.4609 L306,355.4609 L160,355.4609 L160,338.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.416" style="stroke: #000000; stroke-width: 2.0;" width="989" x="160" y="338.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="175" y="352.0293">Get transfer info</text><polygon fill="#A80036" points="837.5,388.3926,847.5,392.3926,837.5,396.3926,841.5,392.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="843.5" y1="392.3926" y2="392.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="273.5" y="379.9951">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="286.5" y="372.3398">Acquire transfer information</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="286.5" y="387.6504">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="363.5" y="387.6504">2003</text><polygon fill="#A80036" points="1046.5,417.7031,1056.5,421.7031,1046.5,425.7031,1050.5,421.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="859.5" x2="1052.5" y1="421.7031" y2="421.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="866.5" y="416.9609">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="879.5" y="416.9609">Get transfer data and state</text><polygon fill="#FFFFE0" filter="url(#f1l5axhow2nk0n)" points="998,434.7031,1129,434.7031,1139,476.7031,1129,518.7031,998,518.7031,988,476.7031,998,434.7031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1000" y="451.2715">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1000" y="466.582">transferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1000" y="481.8926">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1000" y="497.2031">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1000" y="512.5137">transferStateChange</text><polygon fill="#A80036" points="870.5,541.5664,860.5,545.5664,870.5,549.5664,866.5,545.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="864.5" x2="1062.5" y1="545.5664" y2="545.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="876.5" y="540.8242">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="889.5" y="540.8242">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="934.5" y="540.8242">transferInfo</text><polygon fill="#A80036" points="277.5,570.877,267.5,574.877,277.5,578.877,273.5,574.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271.5" x2="853.5" y1="574.877" y2="574.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="283.5" y="570.1348">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="296.5" y="570.1348">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="341.5" y="570.1348">transferInfo</text><path d="M160,596.877 L222,596.877 L222,603.877 L212,613.877 L160,613.877 L160,596.877 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1844.0781" style="stroke: #000000; stroke-width: 2.0;" width="989" x="160" y="596.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="175" y="610.4453">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="307" x="237" y="609.5117">[transferInfo.transferStateId == 'RECEIVED_PREPARE']</text><polygon fill="#A80036" points="837.5,646.8086,847.5,650.8086,837.5,654.8086,841.5,650.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="843.5" y1="650.8086" y2="650.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="273.5" y="638.4111">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="286.5" y="630.7559">Set EXPIRED_PREPARED state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="286.5" y="646.0664">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="363.5" y="646.0664">2003</text><polygon fill="#A80036" points="1046.5,676.1191,1056.5,680.1191,1046.5,684.1191,1050.5,680.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="859.5" x2="1052.5" y1="680.1191" y2="680.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="866.5" y="675.377">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="879.5" y="675.377">Insert state change</text><polygon fill="#FFFFE0" filter="url(#f1l5axhow2nk0n)" points="998,723.1191,1129,723.1191,1139,734.1191,1129,746.1191,998,746.1191,988,734.1191,998,723.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1000" y="739.6875">transferStateChange</text><polygon fill="#A80036" points="277.5,768.7402,267.5,772.7402,277.5,776.7402,273.5,772.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271.5" x2="853.5" y1="772.7402" y2="772.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="283.5" y="767.998">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="296.5" y="767.998">Return success</text><path d="M271,785.7402 L271,1422.7402 L687,1422.7402 L687,795.7402 L677,785.7402 L271,785.7402 " fill="#FFFF00" filter="url(#f1l5axhow2nk0n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M677,785.7402 L677,795.7402 L687,795.7402 L677,785.7402 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="277" y="803.3086">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="277" y="818.6191">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="293" y="833.9297">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="293" y="849.2402">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="293" y="864.5508">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="293" y="879.8613">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="293" y="895.1719">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="309" y="910.4824"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="309" y="910.4824">headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="366" y="910.4824">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="325" y="925.793">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="325" y="941.1035">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="325" y="956.4141">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="325" y="971.7246">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="325" y="987.0352">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="325" y="1002.3457">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="325" y="1017.6563">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="325" y="1032.9668">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="325" y="1048.2773">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="325" y="1063.5879">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="309" y="1078.8984">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="309" y="1094.209">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="341" y="1109.5195">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="357" y="1124.8301">"errorCode": 3303,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="357" y="1140.1406">"errorDescription": "Transfer expired",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="357" y="1155.4512">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="341" y="1170.7617">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="309" y="1186.0723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="293" y="1201.3828">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="293" y="1216.6934">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="309" y="1232.0039">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="325" y="1247.3145">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="325" y="1262.625">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="325" y="1277.9355">action: timeout-received,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="325" y="1293.2461">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="325" y="1308.5566">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="341" y="1323.8672">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="341" y="1339.1777">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="341" y="1354.4883">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="325" y="1369.7988">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="309" y="1385.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="293" y="1400.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="277" y="1415.7305">}</text><polygon fill="#A80036" points="617.5,1449.7832,627.5,1453.7832,617.5,1457.7832,621.5,1453.7832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="623.5" y1="1453.7832" y2="1453.7832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="273.5" y="1449.041">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="295.5" y="1449.041">Publish Notification event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="1149" y1="1492.7832" y2="1492.7832"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="251" x="165" y="1503.418">[transferInfo.transferStateId == 'RESERVED']</text><polygon fill="#A80036" points="837.5,1539.3594,847.5,1543.3594,837.5,1547.3594,841.5,1543.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="843.5" y1="1543.3594" y2="1543.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="273.5" y="1530.9619">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="295.5" y="1523.3066">Set RESERVED_TIMEOUT state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="295.5" y="1538.6172">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="372.5" y="1538.6172">2003</text><polygon fill="#A80036" points="1046.5,1568.6699,1056.5,1572.6699,1046.5,1576.6699,1050.5,1572.6699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="859.5" x2="1052.5" y1="1572.6699" y2="1572.6699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="866.5" y="1567.9277">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="888.5" y="1567.9277">Insert state change</text><polygon fill="#FFFFE0" filter="url(#f1l5axhow2nk0n)" points="998,1615.6699,1129,1615.6699,1139,1626.6699,1129,1638.6699,998,1638.6699,988,1626.6699,998,1615.6699" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1000" y="1632.2383">transferStateChange</text><polygon fill="#A80036" points="277.5,1661.291,267.5,1665.291,277.5,1669.291,273.5,1665.291" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271.5" x2="853.5" y1="1665.291" y2="1665.291"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="283.5" y="1660.5488">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="305.5" y="1660.5488">Return success</text><path d="M271,1678.291 L271,2315.291 L671,2315.291 L671,1688.291 L661,1678.291 L271,1678.291 " fill="#FFFF00" filter="url(#f1l5axhow2nk0n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M661,1678.291 L661,1688.291 L671,1688.291 L661,1678.291 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="277" y="1695.8594">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="277" y="1711.1699">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="293" y="1726.4805">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="293" y="1741.791">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="293" y="1757.1016">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="293" y="1772.4121">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="293" y="1787.7227">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="309" y="1803.0332"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="309" y="1803.0332">headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="366" y="1803.0332">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="325" y="1818.3438">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="325" y="1833.6543">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="325" y="1848.9648">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="325" y="1864.2754">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="325" y="1879.5859">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="325" y="1894.8965">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="325" y="1910.207">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="325" y="1925.5176">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="325" y="1940.8281">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="325" y="1956.1387">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="309" y="1971.4492">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="309" y="1986.7598">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="325" y="2002.0703">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="341" y="2017.3809">"errorCode": 3303,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="341" y="2032.6914">"errorDescription": "Transfer expired",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="341" y="2048.002">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="325" y="2063.3125">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="309" y="2078.623">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="293" y="2093.9336">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="293" y="2109.2441">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="309" y="2124.5547">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="325" y="2139.8652">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="325" y="2155.1758">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="325" y="2170.4863">action: timeout-reserved,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="325" y="2185.7969">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="325" y="2201.1074">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="341" y="2216.418">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="341" y="2231.7285">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="341" y="2247.0391">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="325" y="2262.3496">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="309" y="2277.6602">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="293" y="2292.9707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="277" y="2308.2813">}</text><polygon fill="#A80036" points="487.5,2357.6445,497.5,2361.6445,487.5,2365.6445,491.5,2361.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="493.5" y1="2361.6445" y2="2361.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="273.5" y="2349.2471">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="295.5" y="2341.5918">Route &amp; Publish Position event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="295.5" y="2356.9023">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="372.5" y="2356.9023">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="1149" y1="2400.6445" y2="2400.6445"/><path d="M271,2406.6445 L271,2431.6445 L455,2431.6445 L455,2416.6445 L445,2406.6445 L271,2406.6445 " fill="#D3D3D3" filter="url(#f1l5axhow2nk0n)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M445,2406.6445 L445,2416.6445 L455,2416.6445 L445,2406.6445 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="277" y="2424.2129">Any other state is ignored</text><path d="M160,2454.9551 L261,2454.9551 L261,2461.9551 L251,2471.9551 L160,2471.9551 L160,2454.9551 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="977" x="160" y="2454.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="175" y="2468.5234">Cleanup</text><polygon fill="#A80036" points="837.5,2504.8867,847.5,2508.8867,837.5,2512.8867,841.5,2508.8867" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266.5" x2="843.5" y1="2508.8867" y2="2508.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="273.5" y="2496.4893">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="295.5" y="2488.834">Cleanup handled expiring transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="295.5" y="2504.1445">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="372.5" y="2504.1445">2003</text><polygon fill="#A80036" points="1046.5,2534.1973,1056.5,2538.1973,1046.5,2542.1973,1050.5,2538.1973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="859.5" x2="1052.5" y1="2538.1973" y2="2538.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="866.5" y="2533.4551">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="888.5" y="2533.4551">Delete record</text><polygon fill="#FFFFE0" filter="url(#f1l5axhow2nk0n)" points="1009,2581.1973,1117,2581.1973,1127,2592.1973,1117,2604.1973,1009,2604.1973,999,2592.1973,1009,2581.1973" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1011" y="2597.7656">expiringTransfer</text><polygon fill="#A80036" points="277.5,2626.8184,267.5,2630.8184,277.5,2634.8184,273.5,2630.8184" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271.5" x2="853.5" y1="2630.8184" y2="2630.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="283.5" y="2626.0762">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="305.5" y="2626.0762">Return success</text><!--
@startuml
title 2.3.2. Timeout Handler

autonumber


control "Transfer Timeout Handler" as TIMEOUT_HANDLER
collections "topic-\ntransfer-timeout" as TOPIC_TRANSFER_TIMEOUT
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
collections "topic-\nnotification" as NOTIFICATIONS_TOPIC
collections "topic-event" as EVENT_TOPIC
entity "Timeout DAO" as TIMEOUT_DAO
database "Central Store" as DB

box "Central Service" #lightyellow
    participant TOPIC_TRANSFER_TIMEOUT
    participant TIMEOUT_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant NOTIFICATIONS_TOPIC
    participant EVENT_TOPIC
    participant TIMEOUT_DAO
    participant DB
end box


group Timeout Handler Consume
    activate TIMEOUT_HANDLER
    TOPIC_TRANSFER_TIMEOUT <- TIMEOUT_HANDLER: Consume message
    activate TOPIC_TRANSFER_TIMEOUT
    deactivate TOPIC_TRANSFER_TIMEOUT

    group Persist Event Information
        TIMEOUT_HANDLER -> EVENT_TOPIC: Publish event information
        ref over TIMEOUT_HANDLER, EVENT_TOPIC:  Event Handler Consume\n
    end
    
    group Get transfer info
        TIMEOUT_HANDLER -> TIMEOUT_DAO: Acquire transfer information\n<color #red><b>Error code:</b> 2003</color>
        activate TIMEOUT_DAO
        TIMEOUT_DAO -> DB: Get transfer data and state
        activate DB
        hnote over DB #lightyellow
            transfer
            transferParticipant
            participantCurrency
            participant
            transferStateChange
        end note
        TIMEOUT_DAO <- - DB: Return **transferInfo**
        deactivate DB
        TIMEOUT_HANDLER <- - TIMEOUT_DAO: Return **transferInfo**
        deactivate TIMEOUT_DAO
    end

    alt transferInfo.transferStateId == 'RECEIVED_PREPARE'
        TIMEOUT_HANDLER -> TIMEOUT_DAO: Set EXPIRED_PREPARED state\n<color #red><b>Error code:</b> 2003</color>
        activate TIMEOUT_DAO
        TIMEOUT_DAO -> DB: Insert state change
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            transferStateChange
        end note
        TIMEOUT_HANDLER <- - TIMEOUT_DAO: Return success
        deactivate TIMEOUT_DAO

        note right of TIMEOUT_HANDLER #yellow
            Message:
            {
                id: <transferId>,
                from: <payerParticipantId>,
                to: <payeeParticipantId>,
                type: application/json,
                content: {
                    <color #red>headers:</color> {
                        Content-Length: <Content-Length>,
                        Content-Type: <Content-Type>,
                        Date: <Date>,
                        X-Forwarded-For: <X-Forwarded-For>,
                        FSPIOP-Source: <FSPIOP-Source>,
                        FSPIOP-Destination: <FSPIOP-Destination>,
                        FSPIOP-Encryption: <FSPIOP-Encryption>,
                        FSPIOP-Signature: <FSPIOP-Signature>,
                        FSPIOP-URI: <FSPIOP-URI>,
                        FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
                    },
                    payload: {
                            "errorInformation": {
                                "errorCode": 3303,
                                "errorDescription": "Transfer expired",
                                "extensionList": <transferMessage.extensionList>
                            }
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        type: notification,
                        action: timeout-received,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        TIMEOUT_HANDLER -> NOTIFICATIONS_TOPIC: Publish Notification event
        activate NOTIFICATIONS_TOPIC
        deactivate NOTIFICATIONS_TOPIC
    else transferInfo.transferStateId == 'RESERVED'
        TIMEOUT_HANDLER -> TIMEOUT_DAO: Set RESERVED_TIMEOUT state\n<color #red><b>Error code:</b> 2003</color>
        activate TIMEOUT_DAO
        TIMEOUT_DAO -> DB: Insert state change
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            transferStateChange
        end note
        TIMEOUT_HANDLER <- - TIMEOUT_DAO: Return success
        deactivate TIMEOUT_DAO
        
        note right of TIMEOUT_HANDLER #yellow
            Message:
            {
                id: <transferId>,
                from: <payerParticipantId>,
                to: <payeeParticipantId>,
                type: application/json,
                content: {
                    <color #red>headers:</color> {
                        Content-Length: <Content-Length>,
                        Content-Type: <Content-Type>,
                        Date: <Date>,
                        X-Forwarded-For: <X-Forwarded-For>,
                        FSPIOP-Source: <FSPIOP-Source>,
                        FSPIOP-Destination: <FSPIOP-Destination>,
                        FSPIOP-Encryption: <FSPIOP-Encryption>,
                        FSPIOP-Signature: <FSPIOP-Signature>,
                        FSPIOP-URI: <FSPIOP-URI>,
                        FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
                    },
                    payload: {
                        "errorInformation": {
                            "errorCode": 3303,
                            "errorDescription": "Transfer expired",
                            "extensionList": <transferMessage.extensionList>
                        }
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        type: position,
                        action: timeout-reserved,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        TIMEOUT_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event\n<color #red><b>Error code:</b> 2003</color>
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    else
        note right of TIMEOUT_HANDLER #lightgrey
            Any other state is ignored
        end note
    end

    group Cleanup
        TIMEOUT_HANDLER -> TIMEOUT_DAO: Cleanup handled expiring transfer\n<color #red><b>Error code:</b> 2003</color>
        activate TIMEOUT_DAO
        TIMEOUT_DAO -> DB: Delete record
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            expiringTransfer
        end note
        TIMEOUT_HANDLER <- - TIMEOUT_DAO: Return success
        deactivate TIMEOUT_DAO
    end

    deactivate TIMEOUT_HANDLER
end
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.15.1
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>