<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1946px" preserveAspectRatio="none" style="width:2066px;height:1946px;" version="1.1" viewBox="0 0 2066 1946" width="2066px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nbnycihbmwzu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="834" y="23.5352">1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="1900.7285" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="1900.7285" style="stroke: #A80036; stroke-width: 1.0;" width="562.5" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="489.25" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1900.7285" style="stroke: #A80036; stroke-width: 1.0;" width="1198" x="851" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1399.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="594.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="753.9551"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="723.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="86.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1084" y="1232.3398"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1442" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1803" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1644.4648" style="stroke: #000000; stroke-width: 2.0;" width="2022" x="33" y="170.7754"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="728" x2="728" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="922" x2="922" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1089" x2="1089" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1447" x2="1447" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1627" x2="1627" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1808" x2="1808" y1="153.7754" y2="1832.2402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1971" x2="1971" y1="153.7754" y2="1832.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1844.7754">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="1861.2637">Payer</text><ellipse cx="67.5" cy="1874.2168" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1882.2168 L67.5,1909.2168 M54.5,1890.2168 L80.5,1890.2168 M67.5,1909.2168 L54.5,1924.2168 M67.5,1909.2168 L80.5,1924.2168 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1844.7754">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="1861.2637">Payee</text><ellipse cx="126.5" cy="1874.2168" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1882.2168 L126.5,1909.2168 M113.5,1890.2168 L139.5,1890.2168 M126.5,1909.2168 L113.5,1924.2168 M126.5,1909.2168 L139.5,1924.2168 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="1844.7754">ML API Adapter</text><path d="M325,1851.7285 L325,1875.7285 M325,1863.7285 L342,1863.7285 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="1863.7285" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="612" y="150.8223">ML API Notification Event Handler</text><ellipse cx="728.5" cy="121.2871" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="724.5,109.2871,730.5,104.2871,728.5,109.2871,730.5,114.2871,724.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="612" y="1844.7754">ML API Notification Event Handler</text><ellipse cx="728.5" cy="1863.7285" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="724.5,1851.7285,730.5,1846.7285,728.5,1851.7285,730.5,1856.7285,724.5,1851.7285" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="855" y="150.8223">Central Service API</text><path d="M901.5,109.2871 L901.5,133.2871 M901.5,121.2871 L918.5,121.2871 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="930.5" cy="121.2871" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="855" y="1844.7754">Central Service API</text><path d="M901.5,1851.7285 L901.5,1875.7285 M901.5,1863.7285 L918.5,1863.7285 " fill="none" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="930.5" cy="1863.7285" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1003" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="999" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="1006" y="138.8223">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="1003" y="1831.2402"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="172" x="999" y="1835.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="1006" y="1855.7754">topic-transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1368" y="150.8223">Prepare Event Handler</text><ellipse cx="1447" cy="121.2871" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1443,109.2871,1449,104.2871,1447,109.2871,1449,114.2871,1443,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="1368" y="1844.7754">Prepare Event Handler</text><ellipse cx="1447" cy="1863.7285" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1443,1851.7285,1449,1846.7285,1447,1851.7285,1449,1856.7285,1443,1851.7285" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1540" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1536" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1543" y="138.8223">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1540" y="1831.2402"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1536" y="1835.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1543" y="1855.7754">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1728" y="150.8223">Position Event Handler</text><ellipse cx="1808" cy="121.2871" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1804,109.2871,1810,104.2871,1808,109.2871,1810,114.2871,1804,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1728" y="1844.7754">Position Event Handler</text><ellipse cx="1808" cy="1863.7285" fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1804,1851.7285,1810,1846.7285,1808,1851.7285,1810,1856.7285,1804,1851.7285" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1902" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1898" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1905" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1902" y="1831.2402"/><rect fill="#FEFECE" filter="url(#f1nbnycihbmwzu)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1898" y="1835.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1905" y="1855.7754">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="594.627" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="753.9551"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="723.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="86.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1084" y="1232.3398"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1442" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="1658.4648" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1803" y="163.7754"/><path d="M33,170.7754 L412,170.7754 L412,177.7754 L402,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1644.4648" style="stroke: #000000; stroke-width: 2.0;" width="2022" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="334" x="48" y="184.3438">DFSP1 sends a Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,723.0859 L413,723.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="210.6543">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="78" y="409.6914">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="94" y="440.3125">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="94" y="455.623">"payeeFsp": dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="94" y="470.9336">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="94" y="486.2441">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="110" y="501.5547">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="110" y="516.8652">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="532.1758">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="94" y="547.4863">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="562.7969">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="578.1074">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="593.418">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="608.7285">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="624.0391">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="142" y="639.3496">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="142" y="654.6602">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="669.9707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="685.2813">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="700.5918">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="715.9023">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="753.9551" y2="749.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="753.9551" y2="757.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="753.9551" y2="753.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="749.2129">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="87.5" y="749.2129">POST - /transfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="798.5762" y2="798.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="798.5762" y2="811.5762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="811.5762" y2="811.5762"/><polygon fill="#A80036" points="361.5,807.5762,351.5,811.5762,361.5,815.5762,357.5,811.5762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="786.1787">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="370.5" y="778.5234">Validate incoming token and originator matching Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="793.834">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="793.834">3000-3002, 3100-3107</text><path d="M355,824.5762 L355,1186.5762 L617,1186.5762 L617,834.5762 L607,824.5762 L355,824.5762 " fill="#FFFF00" filter="url(#f1nbnycihbmwzu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M607,824.5762 L607,834.5762 L617,834.5762 L607,824.5762 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="842.1445">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="857.4551">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="377" y="872.7656">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="377" y="888.0762">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="377" y="903.3867">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="918.6973">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="934.0078">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="393" y="949.3184">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="393" y="964.6289">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="979.9395">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="995.25">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1010.5605">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1025.8711">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="409" y="1041.1816">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="409" y="1056.4922">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1071.8027">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1087.1133">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1102.4238">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1117.7344">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1133.0449">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1148.3555">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1163.666">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1178.9766">}</text><polygon fill="#A80036" points="1072,1228.3398,1082,1232.3398,1072,1236.3398,1076,1232.3398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1078" y1="1232.3398" y2="1232.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1219.9424">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="370.5" y="1212.2871">Route &amp; Publish Prepare event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1227.5977">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1227.5977">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094" x2="1136" y1="1276.9609" y2="1276.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1136" x2="1136" y1="1276.9609" y2="1289.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1095" x2="1136" y1="1289.9609" y2="1289.9609"/><polygon fill="#A80036" points="1105,1285.9609,1095,1289.9609,1105,1293.9609,1101,1289.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1101" y="1264.5635">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="1114" y="1256.9082">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1114" y="1272.2188">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1191" y="1272.2188">2003</text><polygon fill="#A80036" points="361.5,1315.2715,351.5,1319.2715,361.5,1323.2715,357.5,1319.2715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1088" y1="1319.2715" y2="1319.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1314.5293">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="380.5" y="1314.5293">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1348.582" y2="1344.582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1348.582" y2="1352.582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1348.582" y2="1348.582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1343.8398">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1343.8398">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1100,1398.8926,1090,1402.8926,1100,1406.8926,1096,1402.8926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1094" x2="1441" y1="1402.8926" y2="1402.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1106" y="1398.1504">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1119" y="1398.1504">Consume message</text><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="721" x="996" y="1410.8926"/><polygon fill="#EEEEEE" points="996,1410.8926,1060,1410.8926,1060,1417.8926,1050,1427.8926,996,1427.8926,996,1410.8926" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1009" y="1425.4609">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1277.5" y="1444.4609">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1281.5" y="1459.7715"/><polygon fill="#A80036" points="1615,1489.1348,1625,1493.1348,1615,1497.1348,1619,1493.1348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1452" x2="1621" y1="1493.1348" y2="1493.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1459" y="1488.3926">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1472" y="1488.3926">Produce message</text><polygon fill="#A80036" points="1638,1543.4453,1628,1547.4453,1638,1551.4453,1634,1547.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1632" x2="1802" y1="1547.4453" y2="1547.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1644" y="1542.7031">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1657" y="1542.7031">Consume message</text><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="354" x="1533" y="1555.4453"/><polygon fill="#EEEEEE" points="1533,1555.4453,1597,1555.4453,1597,1562.4453,1587,1572.4453,1533,1572.4453,1533,1555.4453" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1546" y="1570.0137">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1628.5" y="1589.0137">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1632.5" y="1604.3242"/><polygon fill="#A80036" points="1959.5,1633.6875,1969.5,1637.6875,1959.5,1641.6875,1963.5,1637.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1813" x2="1965.5" y1="1637.6875" y2="1637.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1820" y="1632.9453">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1842" y="1632.9453">Produce message</text><polygon fill="#A80036" points="1959.5,1687.998,1969.5,1691.998,1959.5,1695.998,1963.5,1691.998" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="1965.5" y1="1691.998" y2="1691.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="740.5" y="1687.2559">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="762.5" y="1687.2559">Consume message</text><rect fill="#FFFFFF" filter="url(#f1nbnycihbmwzu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1945" x="99" y="1699.998"/><polygon fill="#EEEEEE" points="99,1699.998,163,1699.998,163,1706.998,153,1716.998,99,1716.998,99,1699.998" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="1714.5664">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="952.5" y="1733.5664">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="956.5" y="1748.877"/><polygon fill="#A80036" points="137.5,1778.2402,127.5,1782.2402,137.5,1786.2402,133.5,1782.2402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="722.5" y1="1782.2402" y2="1782.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="1777.498">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="165.5" y="1777.498">Send callback notification</text><!--
@startuml
title 1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Event Handler" as PREP_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
group DFSP1 sends a Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp2,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /transfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payer\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event for Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_TRANSFER_PREPARE
    TOPIC_TRANSFER_PREPARE <-> TOPIC_TRANSFER_PREPARE: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_TRANSFER_PREPARE - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_TRANSFER_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume\n
    PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER : Position Handler Consume\n
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send callback notification
    |||
end
deactivate POS_HANDLER
deactivate PREP_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>