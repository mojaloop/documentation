<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2892px" preserveAspectRatio="none" style="width:1080px;height:2892px;" version="1.1" viewBox="0 0 1080 2892" width="1080px" zoomAndPan="magnify"><defs><filter height="300%" id="f5waugsj4dhr4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="609" x="236.5" y="23.5352">9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)</text><rect fill="#FFFFE0" height="2847.1465" style="stroke: #A80036; stroke-width: 1.0;" width="982.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="459.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="517.502"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="2675.8828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="610.5" y="2548.1738"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="640.7441"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="821.5625"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="1403.4629"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="2396.9316"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="670.0547"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="850.873"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="1432.7734"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="2426.2422"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="135.7754"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="307.3281"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="2317.7773" style="stroke: #000000; stroke-width: 2.0;" width="1056" x="13" y="478.8809"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="395.3027" style="stroke: #000000; stroke-width: 2.0;" width="881" x="178" y="562.502"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="363.9922" style="stroke: #000000; stroke-width: 2.0;" width="861" x="188" y="586.8125"/><rect fill="#FFFFFF" height="180.8184" style="stroke: none; stroke-width: 1.0;" width="861" x="188" y="769.9863"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="1596.3691" style="stroke: #000000; stroke-width: 2.0;" width="891" x="158" y="996.8047"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="225.7949" style="stroke: #000000; stroke-width: 2.0;" width="526.5" x="178" y="1021.1152"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="152.1738" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1087.7363"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="671.0977" style="stroke: #000000; stroke-width: 2.0;" width="871" x="168" y="1285.9102"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="313.7266" style="stroke: #000000; stroke-width: 2.0;" width="851" x="178" y="1349.5313"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="116.5527" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1539.7051"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="247.75" style="stroke: #000000; stroke-width: 2.0;" width="526.5" x="178" y="1702.2578"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="216.4395" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1726.5684"/><rect fill="#FFFFFF" height="69.5762" style="stroke: none; stroke-width: 1.0;" width="506.5" x="188" y="1873.4316"/><rect fill="#FFFFFF" height="604.166" style="stroke: none; stroke-width: 1.0;" width="891" x="158" y="1989.0078"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="575.2109" style="stroke: #000000; stroke-width: 2.0;" width="851" x="178" y="2010.9629"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="162.1738" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="2191.1367"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="78" x2="78" y1="118.7754" y2="2813.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="238" x2="238" y1="118.7754" y2="2813.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="485.5" x2="485.5" y1="118.7754" y2="2813.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="615.5" x2="615.5" y1="118.7754" y2="2813.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="742.5" x2="742.5" y1="118.7754" y2="2813.6582"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="949.5" x2="949.5" y1="118.7754" y2="2813.6582"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="79.2871"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="103.8223">topic-source</text><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="2812.6582"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="2816.6582"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="2837.1934">topic-source</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="99.334">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="115.8223">Handler</text><ellipse cx="238" cy="69.7988" fill="#FEFECE" filter="url(#f5waugsj4dhr4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,57.7988,240,52.7988,238,57.7988,240,62.7988,234,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="2826.1934">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="2842.6816">Handler</text><ellipse cx="238" cy="2861.6348" fill="#FEFECE" filter="url(#f5waugsj4dhr4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,2849.6348,240,2844.6348,238,2849.6348,240,2854.6348,234,2849.6348" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="439.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="435.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="442.5" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="439.5" y="2812.6582"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="435.5" y="2816.6582"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="442.5" y="2837.1934">topic-event</text><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="550.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="546.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="553.5" y="103.8223">topic-notifcation</text><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="550.5" y="2812.6582"/><rect fill="#FEFECE" filter="url(#f5waugsj4dhr4)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="546.5" y="2816.6582"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="553.5" y="2837.1934">topic-notifcation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="694.5" y="115.8223">Request DAO</text><ellipse cx="742.5" cy="86.2871" fill="#FEFECE" filter="url(#f5waugsj4dhr4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="730.5" x2="754.5" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="694.5" y="2826.1934">Request DAO</text><ellipse cx="742.5" cy="2845.1465" fill="#FEFECE" filter="url(#f5waugsj4dhr4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="730.5" x2="754.5" y1="2859.1465" y2="2859.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="901.5" y="115.8223">Central Store</text><path d="M931.5,66.2871 C931.5,56.2871 949.5,56.2871 949.5,56.2871 C949.5,56.2871 967.5,56.2871 967.5,66.2871 L967.5,92.2871 C967.5,102.2871 949.5,102.2871 949.5,102.2871 C949.5,102.2871 931.5,102.2871 931.5,92.2871 L931.5,66.2871 " fill="#FEFECE" filter="url(#f5waugsj4dhr4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M931.5,66.2871 C931.5,76.2871 949.5,76.2871 949.5,76.2871 C949.5,76.2871 967.5,76.2871 967.5,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="901.5" y="2826.1934">Central Store</text><path d="M931.5,2839.1465 C931.5,2829.1465 949.5,2829.1465 949.5,2829.1465 C949.5,2829.1465 967.5,2829.1465 967.5,2839.1465 L967.5,2865.1465 C967.5,2875.1465 949.5,2875.1465 949.5,2875.1465 C949.5,2875.1465 931.5,2875.1465 931.5,2865.1465 L931.5,2839.1465 " fill="#FEFECE" filter="url(#f5waugsj4dhr4)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M931.5,2839.1465 C931.5,2849.1465 949.5,2849.1465 949.5,2849.1465 C949.5,2849.1465 967.5,2849.1465 967.5,2839.1465 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="517.502"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="2675.8828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="610.5" y="2548.1738"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="640.7441"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="821.5625"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="1403.4629"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="737.5" y="2396.9316"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="670.0547"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="850.873"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="1432.7734"/><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="2426.2422"/><path d="M188,135.7754 L332,135.7754 L332,142.7754 L322,152.7754 L188,152.7754 L188,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="203" y="149.3438">Security Check</text><polygon fill="#A80036" points="474,195.3965,484,199.3965,474,203.3965,478,199.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="480" y1="199.3965" y2="199.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="194.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="194.6543">Produce message</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="340.5" x="195" y="207.3965"/><polygon fill="#EEEEEE" points="195,207.3965,259,207.3965,259,214.3965,249,224.3965,195,224.3965,195,207.3965" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="221.9648">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="292.25" y="240.9648">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="296.25" y="256.2754"/><path d="M188,307.3281 L387,307.3281 L387,314.3281 L377,324.3281 L188,324.3281 L188,307.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="307.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="203" y="320.8965">Schema Validation (joi)</text><polygon fill="#A80036" points="474,366.9492,484,370.9492,474,374.9492,478,370.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="480" y1="370.9492" y2="370.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="366.207">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="366.207">Produce message</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="340.5" x="195" y="378.9492"/><polygon fill="#EEEEEE" points="195,378.9492,259,378.9492,259,385.9492,249,395.9492,195,395.9492,195,378.9492" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="393.5176">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="292.25" y="412.5176">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="296.25" y="427.8281"/><path d="M13,478.8809 L226,478.8809 L226,485.8809 L216,495.8809 L13,495.8809 L13,478.8809 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2317.7773" style="stroke: #000000; stroke-width: 2.0;" width="1056" x="13" y="478.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="28" y="492.4492">Request Duplicate Check</text><polygon fill="#A80036" points="94,513.502,84,517.502,94,521.502,90,517.502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="232" y1="517.502" y2="517.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100" y="512.7598">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="113" y="512.7598">Consume message</text><path d="M178,562.502 L302,562.502 L302,569.502 L292,579.502 L178,579.502 L178,562.502 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="395.3027" style="stroke: #000000; stroke-width: 2.0;" width="881" x="178" y="562.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="193" y="576.0703">UUID Check</text><path d="M188,586.8125 L250,586.8125 L250,593.8125 L240,603.8125 L188,603.8125 L188,586.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="363.9922" style="stroke: #000000; stroke-width: 2.0;" width="861" x="188" y="586.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="203" y="600.3809">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="265" y="599.4473">[request.method == 'POST']</text><polygon fill="#A80036" points="725.5,636.7441,735.5,640.7441,725.5,644.7441,729.5,640.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="731.5" y1="640.7441" y2="640.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="628.3467">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="263" y="620.6914">Query hash by id</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="636.002">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="636.002">2003</text><polygon fill="#A80036" points="932.5,666.0547,942.5,670.0547,932.5,674.0547,936.5,670.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="747.5" x2="938.5" y1="670.0547" y2="670.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="754.5" y="665.3125">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="767.5" y="665.3125">getHashById</text><polygon fill="#FFFFE0" filter="url(#f5waugsj4dhr4)" points="874,683.0547,1024,683.0547,1034,694.0547,1024,706.0547,874,706.0547,864,694.0547,874,683.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="876" y="699.623">requestDuplicateCheck</text><polygon fill="#A80036" points="758.5,728.6758,748.5,732.6758,758.5,736.6758,754.5,732.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="752.5" x2="948.5" y1="732.6758" y2="732.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="764.5" y="727.9336">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="777.5" y="727.9336">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="822.5" y="727.9336">hashRecord</text><polygon fill="#A80036" points="254,757.9863,244,761.9863,254,765.9863,250,761.9863" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="741.5" y1="761.9863" y2="761.9863"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="757.2441">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="273" y="757.2441">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="318" y="757.2441">hashRecord</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="1049" y1="770.9863" y2="770.9863"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="193" y="781.6211">[request.method == 'PUT']</text><polygon fill="#A80036" points="725.5,817.5625,735.5,821.5625,725.5,825.5625,729.5,821.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="731.5" y1="821.5625" y2="821.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="809.165">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="263" y="801.5098">Query hash by id and source</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="816.8203">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="816.8203">2003</text><polygon fill="#A80036" points="932.5,846.873,942.5,850.873,932.5,854.873,936.5,850.873" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="747.5" x2="938.5" y1="850.873" y2="850.873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="754.5" y="846.1309">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="767.5" y="846.1309">getHashByIdSource</text><polygon fill="#FFFFE0" filter="url(#f5waugsj4dhr4)" points="869,863.873,1029,863.873,1039,874.873,1029,886.873,869,886.873,859,874.873,869,863.873" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="871" y="880.4414">responseDuplicateCheck</text><polygon fill="#A80036" points="758.5,909.4941,748.5,913.4941,758.5,917.4941,754.5,913.4941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="752.5" x2="948.5" y1="913.4941" y2="913.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="764.5" y="908.752">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="786.5" y="908.752">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="831.5" y="908.752">hashRecord</text><polygon fill="#A80036" points="254,938.8047,244,942.8047,254,946.8047,250,942.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="741.5" y1="942.8047" y2="942.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="938.0625">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="282" y="938.0625">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="938.0625">hashRecord</text><path d="M158,996.8047 L220,996.8047 L220,1003.8047 L210,1013.8047 L158,1013.8047 L158,996.8047 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1596.3691" style="stroke: #000000; stroke-width: 2.0;" width="891" x="158" y="996.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="173" y="1010.373">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="235" y="1009.4395">[hashRecord EXISTS]</text><path d="M178,1021.1152 L326,1021.1152 L326,1028.1152 L316,1038.1152 L178,1038.1152 L178,1021.1152 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="225.7949" style="stroke: #000000; stroke-width: 2.0;" width="526.5" x="178" y="1021.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="193" y="1034.6836">Hash Mismatch</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="285" y1="1059.7363" y2="1059.7363"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="285" y1="1059.7363" y2="1072.7363"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="244" x2="285" y1="1072.7363" y2="1072.7363"/><polygon fill="#A80036" points="254,1068.7363,244,1072.7363,254,1076.7363,250,1072.7363" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1054.9941">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="272" y="1054.9941">Generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="331" y="1054.9941">currentMessageHash</text><path d="M188,1087.7363 L255,1087.7363 L255,1094.7363 L245,1104.7363 L188,1104.7363 L188,1087.7363 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="152.1738" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1087.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="203" y="1101.3047">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="237" x="270" y="1100.3711">[currentMessageHash != hashRecord.hash]</text><polygon fill="#A80036" points="474,1122.3574,484,1126.3574,474,1130.3574,478,1126.3574" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="480" y1="1126.3574" y2="1126.3574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1121.6152">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1121.6152">Produce message</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="340.5" x="195" y="1134.3574"/><polygon fill="#EEEEEE" points="195,1134.3574,259,1134.3574,259,1141.3574,249,1151.3574,195,1151.3574,195,1134.3574" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1148.9258">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="292.25" y="1167.9258">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="296.25" y="1183.2363"/><polygon fill="#A80036" points="603.5,1227.9102,613.5,1231.9102,603.5,1235.9102,607.5,1231.9102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="609.5" y1="1231.9102" y2="1231.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1219.5127">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1211.8574">Produce message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1227.168">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="349" y="1227.168">3106 - Modified Request</text><path d="M168,1285.9102 L235,1285.9102 L235,1292.9102 L225,1302.9102 L168,1302.9102 L168,1285.9102 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="671.0977" style="stroke: #000000; stroke-width: 2.0;" width="871" x="168" y="1285.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="183" y="1299.4785">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="250" y="1298.5449">[currentMessageHash == hashRecord.hash]</text><path d="M248,1308.2207 L248,1333.2207 L375,1333.2207 L375,1318.2207 L365,1308.2207 L248,1308.2207 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M365,1308.2207 L365,1318.2207 L375,1318.2207 L365,1308.2207 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="254" y="1325.7891">Resend Handling</text><path d="M178,1349.5313 L302,1349.5313 L302,1356.5313 L292,1366.5313 L178,1366.5313 L178,1349.5313 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="313.7266" style="stroke: #000000; stroke-width: 2.0;" width="851" x="178" y="1349.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="193" y="1363.0996">Error Check</text><polygon fill="#A80036" points="725.5,1399.4629,735.5,1403.4629,725.5,1407.4629,729.5,1403.4629" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="731.5" y1="1403.4629" y2="1403.4629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1391.0654">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="382" x="272" y="1383.4102">Query completed requests by uuid, requestType [and source]</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1398.7207">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="1398.7207">2003</text><polygon fill="#A80036" points="932.5,1428.7734,942.5,1432.7734,932.5,1436.7734,936.5,1432.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="747.5" x2="938.5" y1="1432.7734" y2="1432.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="754.5" y="1428.0313">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="776.5" y="1428.0313">getCompletedRequest</text><polygon fill="#FFFFE0" filter="url(#f5waugsj4dhr4)" points="889,1445.7734,1009,1445.7734,1019,1456.7734,1009,1468.7734,889,1468.7734,879,1456.7734,889,1445.7734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="891" y="1462.3418">completedRequest</text><polygon fill="#A80036" points="758.5,1491.3945,748.5,1495.3945,758.5,1499.3945,754.5,1495.3945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="752.5" x2="948.5" y1="1495.3945" y2="1495.3945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="764.5" y="1490.6523">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="786.5" y="1490.6523">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="831.5" y="1490.6523">crRecord</text><polygon fill="#A80036" points="254,1520.7051,244,1524.7051,254,1528.7051,250,1524.7051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="741.5" y1="1524.7051" y2="1524.7051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1519.9629">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="282" y="1519.9629">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="327" y="1519.9629">crRecord</text><path d="M188,1539.7051 L255,1539.7051 L255,1546.7051 L245,1556.7051 L188,1556.7051 L188,1539.7051 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="116.5527" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1539.7051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="203" y="1553.2734">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="270" y="1552.3398">[crRecord &amp;&amp; crRecord.errorCode IS NOT NULL]</text><path d="M248,1562.0156 L248,1587.0156 L550,1587.0156 L550,1572.0156 L540,1562.0156 L248,1562.0156 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M540,1562.0156 L540,1572.0156 L550,1572.0156 L540,1562.0156 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="254" y="1579.584">An error occured during previous processing</text><polygon fill="#A80036" points="603.5,1644.2578,613.5,1648.2578,603.5,1652.2578,607.5,1648.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="609.5" y1="1648.2578" y2="1648.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1628.2051">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1612.8945">Produce message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1628.2051">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="349" y="1628.2051">3xxx / 4xxx / 5xxx</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="272" y="1643.5156">Client / Payer / Payee Error</text><path d="M178,1702.2578 L341,1702.2578 L341,1709.2578 L331,1719.2578 L178,1719.2578 L178,1702.2578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="247.75" style="stroke: #000000; stroke-width: 2.0;" width="526.5" x="178" y="1702.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="193" y="1715.8262">Completed Check</text><path d="M188,1726.5684 L250,1726.5684 L250,1733.5684 L240,1743.5684 L188,1743.5684 L188,1726.5684 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="216.4395" style="stroke: #000000; stroke-width: 2.0;" width="506.5" x="188" y="1726.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="203" y="1740.1367">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="237" x="265" y="1739.2031">[crRecord &amp;&amp; crRecord.errorCode IS NULL]</text><path d="M248,1748.8789 L248,1773.8789 L632,1773.8789 L632,1758.8789 L622,1748.8789 L248,1748.8789 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M622,1748.8789 L622,1758.8789 L632,1758.8789 L622,1748.8789 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="254" y="1766.4473">Previous message processing has completed successfully</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="488.5" x="195" y="1783.1895"/><polygon fill="#EEEEEE" points="195,1783.1895,259,1783.1895,259,1790.1895,249,1800.1895,195,1800.1895,195,1783.1895" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1797.7578">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="268.75" y="1816.7578">Use specific</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="348.75" y="1816.7578">getMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="425.75" y="1816.7578">to reply with current state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="240.75" y="1832.0684"/><polygon fill="#A80036" points="603.5,1861.4316,613.5,1865.4316,603.5,1869.4316,607.5,1865.4316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="609.5" y1="1865.4316" y2="1865.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1860.6895">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1860.6895">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="694.5" y1="1874.4316" y2="1874.4316"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="193" y="1885.0664">[crRecord NOT EXISTS]</text><path d="M248,1893.3867 L248,1933.3867 L533,1933.3867 L533,1903.3867 L523,1893.3867 L248,1893.3867 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M523,1893.3867 L523,1903.3867 L533,1903.3867 L523,1893.3867 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="254" y="1910.9551">Ignore resend and leave the initial request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="254" y="1926.2656">to complete with a callback</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="158" x2="1049" y1="1990.0078" y2="1990.0078"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="163" y="2000.6426">[hashRecord NOT EXISTS]</text><path d="M178,2010.9629 L333,2010.9629 L333,2017.9629 L323,2027.9629 L178,2027.9629 L178,2010.9629 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="575.2109" style="stroke: #000000; stroke-width: 2.0;" width="851" x="178" y="2010.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="193" y="2024.5313">Process Request</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="71.2422" style="stroke: #000000; stroke-width: 2.0;" width="488.5" x="195" y="2053.2734"/><polygon fill="#EEEEEE" points="195,2053.2734,259,2053.2734,259,2060.2734,249,2070.2734,195,2070.2734,195,2053.2734" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="2067.8418">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="270.25" y="2086.8418">Execute</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="129" x="323.25" y="2086.8418">specific processing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="452.25" y="2086.8418">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="270.25" y="2102.1523">Transfer/Quote/Bulk Prepare/Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="274.25" y="2117.4629"/><path d="M248,2134.5156 L248,2174.5156 L434,2174.5156 L434,2144.5156 L424,2134.5156 L248,2134.5156 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M424,2134.5156 L424,2144.5156 L434,2144.5156 L424,2134.5156 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="254" y="2152.084">let errorCode = null</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="254" y="2167.3945">let errorDescription = null</text><path d="M188,2191.1367 L255,2191.1367 L255,2198.1367 L245,2208.1367 L188,2208.1367 L188,2191.1367 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="162.1738" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="188" y="2191.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="203" y="2204.7051">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="270" y="2203.7715">[errorOccured]</text><path d="M248,2213.4473 L248,2253.4473 L499,2253.4473 L499,2223.4473 L489,2213.4473 L248,2213.4473 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M489,2213.4473 L489,2223.4473 L499,2223.4473 L489,2213.4473 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="254" y="2231.0156">let errorCode = &lt;3xxx/4xxx/5xxx&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="254" y="2246.3262">let errorDescription = &lt;text&gt;</text><polygon fill="#A80036" points="474,2280.3789,484,2284.3789,474,2288.3789,478,2284.3789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="480" y1="2284.3789" y2="2284.3789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2279.6367">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="2279.6367">Produce message</text><rect fill="#FFFFFF" filter="url(#f5waugsj4dhr4)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="340.5" x="195" y="2292.3789"/><polygon fill="#EEEEEE" points="195,2292.3789,259,2292.3789,259,2299.3789,249,2309.3789,195,2309.3789,195,2292.3789" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="2306.9473">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="292.25" y="2325.9473">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="296.25" y="2341.2578"/><polygon fill="#A80036" points="725.5,2392.9316,735.5,2396.9316,725.5,2400.9316,729.5,2396.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="731.5" y1="2396.9316" y2="2396.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2384.5342">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="272" y="2376.8789">Store processing result</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="2392.1895">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="2392.1895">2003</text><polygon fill="#A80036" points="932.5,2422.2422,942.5,2426.2422,932.5,2430.2422,936.5,2426.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="747.5" x2="938.5" y1="2426.2422" y2="2426.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="754.5" y="2421.5">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="776.5" y="2421.5">Insert completedRequest</text><polygon fill="#FFFFE0" filter="url(#f5waugsj4dhr4)" points="889,2469.2422,1009,2469.2422,1019,2480.2422,1009,2492.2422,889,2492.2422,879,2480.2422,889,2469.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="891" y="2485.8105">completedRequest</text><polygon fill="#A80036" points="254,2514.8633,244,2518.8633,254,2522.8633,250,2518.8633" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="741.5" y1="2518.8633" y2="2518.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="2514.1211">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="2514.1211">Return success</text><polygon fill="#A80036" points="598.5,2544.1738,608.5,2548.1738,598.5,2552.1738,602.5,2548.1738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="604.5" y1="2548.1738" y2="2548.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2543.4316">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="2543.4316">Produce message</text><path d="M248,2630.1738 L248,2762.1738 L974,2762.1738 L974,2640.1738 L964,2630.1738 L248,2630.1738 " fill="#D3D3D3" filter="url(#f5waugsj4dhr4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M964,2630.1738 L964,2640.1738 L974,2640.1738 L964,2630.1738 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="705" x="254" y="2647.7422"> Performance wise for success scenarios, just one extra step has been added (the insert to completedRequest).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="266" y="2663.0527">The addition of source for responses/fulfils comes at no extra cost;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="430" x="254" y="2678.3633"> Hash check remains unchanged for POSTs and improved for PUTs;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="570" x="254" y="2693.6738"> For the resend scenarios there is not only performance gain, but also improved handling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="266" y="2708.9844">to fix current inconsistencies;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="254" y="2724.2949"></text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="271" y="2724.2949">(TBD)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="417" x="308" y="2724.2949">completedRequest may be replaced by completedTransferRequest,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="546" x="266" y="2739.6055">completedQuoteRequest, completedBulkTransferRequest, completedBulkQuoteRequest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="415" x="266" y="2754.916">if necessary, also avoiding the need for requestType lookup table.</text><!--
@startuml
title 9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Bulk Quotes)

autonumber


collections "topic-source" as TOPIC_SOURCE
control "Processing\nHandler" as HANDLER
collections "topic-event" as TOPIC_EVENTS
collections "topic-notifcation" as TOPIC_NOTIFICATION
entity "Request DAO" as DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_SOURCE
    participant HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant DAO
    participant DB
end box

group Security Check
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

group Schema Validation (joi)
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

activate HANDLER
group Request Duplicate Check
    TOPIC_SOURCE <- HANDLER: Consume message
    activate TOPIC_SOURCE
    deactivate TOPIC_SOURCE

    group UUID Check
        alt request.method == 'POST'
            HANDLER -> DAO: Query hash by id\n<color #red><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: getHashById
            hnote over DB #lightyellow
                requestDuplicateCheck
            end note
            activate DB
            DB - -> DAO: Return **hashRecord**
            deactivate DB
            DAO - -> HANDLER: Return **hashRecord**
            deactivate DAO
        else request.method == 'PUT'
            HANDLER -> DAO: Query hash by id and source\n<color #red><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: getHashByIdSource
            hnote over DB #lightyellow
                responseDuplicateCheck
            end note
            activate DB
            DB - -> DAO: Return **hashRecord**
            deactivate DB
            DAO - -> HANDLER: Return **hashRecord**
            deactivate DAO
        end
    end
    |||
    alt hashRecord EXISTS
        group Hash Mismatch
            HANDLER -> HANDLER: Generate **currentMessageHash**
            opt currentMessageHash != hashRecord.hash
                HANDLER -> TOPIC_EVENTS: Produce message
                ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
                HANDLER -> TOPIC_NOTIFICATION: Produce message\n<color #red><b>Error code:</b> 3106 - Modified Request</color>
            end
        end
        |||

        opt currentMessageHash == hashRecord.hash
            note right of HANDLER #lightgrey
                Resend Handling
            end note

            group Error Check
                HANDLER -> DAO: Query completed requests by uuid, requestType [and source]\n<color #red><b>Error code:</b> 2003</color>
                activate DAO
                DAO -> DB: getCompletedRequest
                hnote over DB #lightyellow
                    completedRequest
                end note
                activate DB
                DB - -> DAO: Return **crRecord**
                deactivate DB
                DAO - -> HANDLER: Return **crRecord**
                deactivate DAO

                opt crRecord && crRecord.errorCode IS NOT NULL
                    note right of HANDLER #lightgrey
                        An error occured during previous processing
                    end note
                    HANDLER -> TOPIC_NOTIFICATION: Produce message\n<color #red><b>Error code:</b> 3xxx / 4xxx / 5xxx</color>\n<color #red>Client / Payer / Payee Error</color>
                end
            end
            |||

            group Completed Check
                alt crRecord && crRecord.errorCode IS NULL
                    note right of HANDLER #lightgrey
                        Previous message processing has completed successfully
                    end note
                    ref over HANDLER, TOPIC_NOTIFICATION: \tUse specific **getMethod** to reply with current state\t\t\n
                    HANDLER -> TOPIC_NOTIFICATION: Produce message
                else crRecord NOT EXISTS
                    note right of HANDLER #lightgrey
                        Ignore resend and leave the initial request
                        to complete with a callback
                    end note
                end
            end
        end
        |||
    else hashRecord NOT EXISTS
        group Process Request
            |||
            ref over HANDLER, TOPIC_NOTIFICATION: Execute **specific processing**:\t\t\t\t\t\nTransfer/Quote/Bulk Prepare/Fulfil\n

            note right of HANDLER #lightgrey
                let errorCode = null
                let errorDescription = null
            end note

            opt errorOccured
                note right of HANDLER #lightgrey
                    let errorCode = <3xxx/4xxx/5xxx>
                    let errorDescription = <text>
                end note
                HANDLER -> TOPIC_EVENTS: Produce message
                ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
            end

            HANDLER -> DAO: Store processing result\n<color #red><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: Insert completedRequest
            hnote over DB #lightyellow
                completedRequest
            end note
            activate DB
            deactivate DB
            DAO - -> HANDLER: Return success
            deactivate DAO

            HANDLER -> TOPIC_NOTIFICATION: Produce message
            activate TOPIC_NOTIFICATION
            deactivate TOPIC_NOTIFICATION
        end
    end
    |||

    note right of HANDLER #lightgrey
         Performance wise for success scenarios, just one extra step has been added (the insert to completedRequest).
           The addition of source for responses/fulfils comes at no extra cost;
         Hash check remains unchanged for POSTs and improved for PUTs;
         For the resend scenarios there is not only performance gain, but also improved handling
           to fix current inconsistencies;
         <color #red>(TBD)</color> completedRequest may be replaced by completedTransferRequest,
           completedQuoteRequest, completedBulkTransferRequest, completedBulkQuoteRequest
           if necessary, also avoiding the need for requestType lookup table.
    end note
    |||
end

@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>