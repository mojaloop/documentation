<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4224px" preserveAspectRatio="none" style="width:1000px;height:4224px;" version="1.1" viewBox="0 0 1000 4224" width="1000px" zoomAndPan="magnify"><defs><filter height="300%" id="f1d8gfecx58ooo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="613" x="194.5" y="23.5352">9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Transactions)</text><rect fill="#FFFFE0" height="4179.4102" style="stroke: #A80036; stroke-width: 1.0;" width="934" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="435.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="572.123"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="4008.1465" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="1191.5996"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="2537.5527"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="3028.5215"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="3554.0664"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="725.6758"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="931.8496"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="1526.9707"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="1771.7656"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="2355.6895"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="2846.6582"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="3780.1953"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="770.2969"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="976.4707"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="1571.5918"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="1801.0762"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="2415.6211"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="2906.5898"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="3840.127"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="256.5" x="188" y="135.7754"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="256.5" x="188" y="307.3281"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="3595.4199" style="stroke: #000000; stroke-width: 2.0;" width="976" x="13" y="533.502"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="731.6738" style="stroke: #000000; stroke-width: 2.0;" width="801" x="168" y="617.123"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="463.8789" style="stroke: #000000; stroke-width: 2.0;" width="781" x="178" y="877.918"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="251.3945" style="stroke: #000000; stroke-width: 2.0;" width="484" x="188" y="1083.4023"/><rect fill="#FFFFFF" height="89.5762" style="stroke: none; stroke-width: 1.0;" width="484" x="188" y="1140.0234"/><rect fill="#FFFFFF" height="105.1973" style="stroke: none; stroke-width: 1.0;" width="484" x="188" y="1229.5996"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="520.9004" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="1387.7969"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="1717.834"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="641.8555" style="stroke: #000000; stroke-width: 2.0;" width="811" x="168" y="1947.6973"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="571.2344" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="2011.3184"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="539.9238" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="2035.6289"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="87.9316" style="stroke: #000000; stroke-width: 2.0;" width="346" x="228" y="2099.25"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="56.6211" style="stroke: #000000; stroke-width: 2.0;" width="326" x="238" y="2123.5605"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="110.8867" style="stroke: #000000; stroke-width: 2.0;" width="269" x="238" y="2201.1816"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="269" x="238" y="2257.8027"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="451.9688" style="stroke: #000000; stroke-width: 2.0;" width="811" x="168" y="2628.5527"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="305.1055" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="2768.416"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="273.7949" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="2792.7266"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="821.2266" style="stroke: #000000; stroke-width: 2.0;" width="781" x="178" y="3119.5215"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="407.2578" style="stroke: #000000; stroke-width: 2.0;" width="467" x="188" y="3329.3164"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="172.1289" style="stroke: #000000; stroke-width: 2.0;" width="407" x="238" y="3353.627"/><rect fill="#FFFFFF" height="84.8867" style="stroke: none; stroke-width: 1.0;" width="407" x="238" y="3440.8691"/><rect fill="#FFFFFF" height="144.5078" style="stroke: none; stroke-width: 1.0;" width="467" x="188" y="3592.0664"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="78" x2="78" y1="118.7754" y2="4145.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="238" x2="238" y1="118.7754" y2="4145.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="383.5" x2="383.5" y1="118.7754" y2="4145.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="554" x2="554" y1="118.7754" y2="4145.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="681" x2="681" y1="118.7754" y2="4145.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="901" x2="901" y1="118.7754" y2="4145.9219"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="103.8223">topic-source</text><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="27" y="4144.9219"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="23" y="4148.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="30" y="4169.457">topic-source</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="99.334">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="115.8223">Handler</text><ellipse cx="238" cy="69.7988" fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,57.7988,240,52.7988,238,57.7988,240,62.7988,234,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="198" y="4158.457">Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="208" y="4174.9453">Handler</text><ellipse cx="238" cy="4193.8984" fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="234,4181.8984,240,4176.8984,238,4181.8984,240,4186.8984,234,4181.8984" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="337.5" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="333.5" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="340.5" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="337.5" y="4144.9219"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="333.5" y="4148.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="340.5" y="4169.457">topic-event</text><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="489" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="485" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="492" y="103.8223">topic-notifcation</text><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="489" y="4144.9219"/><rect fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="485" y="4148.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="492" y="4169.457">topic-notifcation</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="633" y="115.8223">Request DAO</text><ellipse cx="681" cy="86.2871" fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="669" x2="693" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="633" y="4158.457">Request DAO</text><ellipse cx="681" cy="4177.4102" fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="669" x2="693" y1="4191.4102" y2="4191.4102"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="853" y="115.8223">Central Store</text><path d="M883,66.2871 C883,56.2871 901,56.2871 901,56.2871 C901,56.2871 919,56.2871 919,66.2871 L919,92.2871 C919,102.2871 901,102.2871 901,102.2871 C901,102.2871 883,102.2871 883,92.2871 L883,66.2871 " fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M883,66.2871 C883,76.2871 901,76.2871 901,76.2871 C901,76.2871 919,76.2871 919,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="853" y="4158.457">Central Store</text><path d="M883,4171.4102 C883,4161.4102 901,4161.4102 901,4161.4102 C901,4161.4102 919,4161.4102 919,4171.4102 L919,4197.4102 C919,4207.4102 901,4207.4102 901,4207.4102 C901,4207.4102 883,4207.4102 883,4197.4102 L883,4171.4102 " fill="#FEFECE" filter="url(#f1d8gfecx58ooo)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M883,4171.4102 C883,4181.4102 901,4181.4102 901,4181.4102 C901,4181.4102 919,4181.4102 919,4171.4102 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="73" y="572.123"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="4008.1465" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="233" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="1191.5996"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="2537.5527"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="3028.5215"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="549" y="3554.0664"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="725.6758"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="931.8496"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="1526.9707"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="1771.7656"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="2355.6895"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="2846.6582"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="676" y="3780.1953"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="770.2969"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="976.4707"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="1571.5918"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="1801.0762"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="2415.6211"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="2906.5898"/><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="896" y="3840.127"/><path d="M188,135.7754 L332,135.7754 L332,142.7754 L322,152.7754 L188,152.7754 L188,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="256.5" x="188" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="203" y="149.3438">Security Check</text><polygon fill="#A80036" points="372,195.3965,382,199.3965,372,203.3965,376,199.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="378" y1="199.3965" y2="199.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="194.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="194.6543">Produce message</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="238.5" x="195" y="207.3965"/><polygon fill="#EEEEEE" points="195,207.3965,259,207.3965,259,214.3965,249,224.3965,195,224.3965,195,207.3965" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="221.9648">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="241.25" y="240.9648">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="245.25" y="256.2754"/><path d="M188,307.3281 L387,307.3281 L387,314.3281 L377,324.3281 L188,324.3281 L188,307.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="256.5" x="188" y="307.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="203" y="320.8965">Schema Validation (joi)</text><polygon fill="#A80036" points="372,366.9492,382,370.9492,372,374.9492,376,370.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="378" y1="370.9492" y2="370.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="366.207">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="263" y="366.207">Produce message</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="238.5" x="195" y="378.9492"/><polygon fill="#EEEEEE" points="195,378.9492,259,378.9492,259,385.9492,249,395.9492,195,395.9492,195,378.9492" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="393.5176">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="241.25" y="412.5176">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="245.25" y="427.8281"/><path d="M248,476.8809 L248,516.8809 L481,516.8809 L481,486.8809 L471,476.8809 L248,476.8809 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M471,476.8809 L471,486.8809 L481,486.8809 L471,476.8809 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="254" y="494.4492">Onwards, each unique (by source)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="254" y="509.7598">request would leave its footprint</text><path d="M13,533.502 L226,533.502 L226,540.502 L216,550.502 L13,550.502 L13,533.502 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3595.4199" style="stroke: #000000; stroke-width: 2.0;" width="976" x="13" y="533.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="28" y="547.0703">Request Duplicate Check</text><polygon fill="#A80036" points="94,568.123,84,572.123,94,576.123,90,572.123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="88" x2="232" y1="572.123" y2="572.123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100" y="567.3809">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="113" y="567.3809">Consume message</text><path d="M168,617.123 L346,617.123 L346,624.123 L336,634.123 L168,634.123 L168,617.123 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="731.6738" style="stroke: #000000; stroke-width: 2.0;" width="801" x="168" y="617.123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="183" y="630.6914">Idempotency Check</text><path d="M248,639.4336 L248,679.4336 L636,679.4336 L636,649.4336 L626,639.4336 L248,639.4336 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M626,639.4336 L626,649.4336 L636,649.4336 L626,639.4336 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="254" y="657.002">Source qualified, each (unique) POST/PUT message is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="254" y="672.3125">processed</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="79" x="322" y="672.3125">exactly once</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="401" y="672.3125">, except when requestStatus is GET</text><polygon fill="#A80036" points="664,721.6758,674,725.6758,664,729.6758,668,725.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="725.6758" y2="725.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="713.2783">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="263" y="705.623">Save request with status RECEIVED</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="720.9336">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="720.9336">2003</text><polygon fill="#A80036" points="884,766.2969,894,770.2969,884,774.2969,888,770.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="770.2969" y2="770.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="693" y="757.8994">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="706" y="750.2441">Insert utilising unique index</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="706" y="765.5547">on source, uuid, hash</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,813.2969,926,813.2969,936,824.2969,926,836.2969,875,836.2969,865,824.2969,875,813.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="829.8652">request</text><polygon fill="#A80036" points="254,858.918,244,862.918,254,866.918,250,862.918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="862.918" y2="862.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="260" y="858.1758">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="273" y="858.1758">Return requestId or insert failure</text><path d="M178,877.918 L262,877.918 L262,884.918 L252,894.918 L178,894.918 L178,877.918 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="463.8789" style="stroke: #000000; stroke-width: 2.0;" width="781" x="178" y="877.918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="193" y="891.4863">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="277" y="890.5527">[Insert failed]</text><polygon fill="#A80036" points="664,927.8496,674,931.8496,664,935.8496,668,931.8496" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="931.8496" y2="931.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="250" y="919.4521">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="263" y="911.7969">Retrieve duplicate request</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="263" y="927.1074">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="340" y="927.1074">2003</text><polygon fill="#A80036" points="884,972.4707,894,976.4707,884,980.4707,888,976.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="976.4707" y2="976.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="693" y="964.0732">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="706" y="956.418">Use same index:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="710" y="971.7285">source, uuid, hash</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,989.4707,926,989.4707,936,1000.4707,926,1012.4707,875,1012.4707,865,1000.4707,875,989.4707" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="1006.0391">request</text><polygon fill="#A80036" points="697,1035.0918,687,1039.0918,697,1043.0918,693,1039.0918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="691" x2="900" y1="1039.0918" y2="1039.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="703" y="1034.3496">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="716" y="1034.3496">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="761" y="1034.3496">requestInfo</text><polygon fill="#A80036" points="254,1064.4023,244,1068.4023,254,1072.4023,250,1068.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="1068.4023" y2="1068.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1063.6602">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="282" y="1063.6602">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="327" y="1063.6602">requestInfo</text><path d="M188,1083.4023 L250,1083.4023 L250,1090.4023 L240,1100.4023 L188,1100.4023 L188,1083.4023 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="251.3945" style="stroke: #000000; stroke-width: 2.0;" width="484" x="188" y="1083.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="203" y="1096.9707">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="265" y="1096.0371">[requestStatus IN ['RECEIVED', 'ACCEPTED']]</text><path d="M248,1105.7129 L248,1130.7129 L360,1130.7129 L360,1115.7129 L350,1105.7129 L248,1105.7129 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M350,1105.7129 L350,1115.7129 L360,1115.7129 L350,1105.7129 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="254" y="1123.2813">Ignore request</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="672" y1="1141.0234" y2="1141.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="479" x="193" y="1151.6582">[requestStatus IN ['UUID_COLLISION', 'MODIFIED', 'INVALID', 'ERROR', 'COMPLETED']]</text><polygon fill="#A80036" points="537,1187.5996,547,1191.5996,537,1195.5996,541,1191.5996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="543" y1="1191.5996" y2="1191.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1179.2021">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="272" y="1171.5469">Produce previous response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="272" y="1186.8574">using stored</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="355" y="1186.8574">requestInfo</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="672" y1="1230.5996" y2="1230.5996"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="193" y="1241.2344">[requestStatus IN ['GET']]</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="427" x="195" y="1244.5547"/><polygon fill="#EEEEEE" points="195,1244.5547,259,1244.5547,259,1251.5547,249,1261.5547,195,1261.5547,195,1244.5547" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="1259.123">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="270" y="1278.123">Use specific</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="350" y="1278.123">getMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="427" y="1278.123">to reply with current state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="210" y="1293.4336"/><polygon fill="#A80036" points="542,1322.7969,552,1326.7969,542,1330.7969,546,1326.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="548" y1="1326.7969" y2="1326.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1322.0547">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="1322.0547">Produce message</text><path d="M178,1387.7969 L302,1387.7969 L302,1394.7969 L292,1404.7969 L178,1404.7969 L178,1387.7969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="520.9004" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="1387.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="193" y="1401.3652">UUID Check</text><path d="M248,1410.1074 L248,1481.1074 L598,1481.1074 L598,1420.1074 L588,1410.1074 L248,1410.1074 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M588,1410.1074 L588,1420.1074 L598,1420.1074 L588,1410.1074 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="254" y="1427.6758">Request is currently RECEIVED, but we need to verify</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="254" y="1442.9863">by querying db for other records with same UUID.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="254" y="1458.2969">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="285" y="1458.2969">: uuid uniqueness is not guaranteed across</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="254" y="1473.6074">different request types.</text><polygon fill="#A80036" points="664,1522.9707,674,1526.9707,664,1530.9707,668,1526.9707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="1526.9707" y2="1526.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1514.5732">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="272" y="1506.918">Find matching UUIDs (excl. current)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1522.2285">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="1522.2285">2003</text><polygon fill="#A80036" points="884,1567.5918,894,1571.5918,884,1575.5918,888,1571.5918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="1571.5918" y2="1571.5918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="693" y="1559.1943">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="715" y="1551.5391">Use index: uuid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="715" y="1566.8496">requestType, isFulfil</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,1584.5918,926,1584.5918,936,1595.5918,926,1607.5918,875,1607.5918,865,1595.5918,875,1584.5918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="1601.1602">request</text><polygon fill="#A80036" points="697,1630.2129,687,1634.2129,697,1638.2129,693,1634.2129" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="691" x2="900" y1="1634.2129" y2="1634.2129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="703" y="1629.4707">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="725" y="1629.4707">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="770" y="1629.4707">requestsInfo</text><polygon fill="#A80036" points="254,1659.5234,244,1663.5234,254,1667.5234,250,1663.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="1663.5234" y2="1663.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1658.7813">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="282" y="1658.7813">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="327" y="1658.7813">requestsInfo</text><path d="M248,1676.5234 L248,1701.5234 L538,1701.5234 L538,1686.5234 L528,1676.5234 L248,1676.5234 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M528,1676.5234 L528,1686.5234 L538,1686.5234 L528,1676.5234 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="254" y="1694.0918">isUniqueUuid</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="350" y="1694.0918">= requestsInfo.length == 0</text><path d="M188,1717.834 L255,1717.834 L255,1724.834 L245,1734.834 L188,1734.834 L188,1717.834 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="1717.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="203" y="1731.4023">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="270" y="1730.4688">[isUniqueUuid == true]</text><polygon fill="#A80036" points="664,1767.7656,674,1771.7656,664,1775.7656,668,1771.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="1771.7656" y2="1771.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="1759.3682">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="272" y="1751.7129">Change request status to ACCEPTED</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="1767.0234">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="1767.0234">2003</text><polygon fill="#A80036" points="884,1797.0762,894,1801.0762,884,1805.0762,888,1801.0762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="1801.0762" y2="1801.0762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="693" y="1796.334">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="715" y="1796.334">Update status</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,1844.0762,926,1844.0762,936,1855.0762,926,1867.0762,875,1867.0762,865,1855.0762,875,1844.0762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="1860.6445">request</text><polygon fill="#A80036" points="254,1889.6973,244,1893.6973,254,1897.6973,250,1893.6973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="1893.6973" y2="1893.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="1888.9551">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="1888.9551">Return success</text><path d="M168,1947.6973 L376,1947.6973 L376,1954.6973 L366,1964.6973 L168,1964.6973 L168,1947.6973 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="641.8555" style="stroke: #000000; stroke-width: 2.0;" width="811" x="168" y="1947.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="183" y="1961.2656">Modified Request Check</text><path d="M248,1970.0078 L248,1995.0078 L575,1995.0078 L575,1980.0078 L565,1970.0078 L248,1970.0078 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M565,1970.0078 L565,1980.0078 L575,1980.0078 L565,1970.0078 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="254" y="1987.5762">Request is still RECEIVED and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="442" y="1987.5762">UUID Check</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="525" y="1987.5762">failed</text><path d="M178,2011.3184 L245,2011.3184 L245,2018.3184 L235,2028.3184 L178,2028.3184 L178,2011.3184 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="571.2344" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="2011.3184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="193" y="2024.8867">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="260" y="2023.9531">[isUniqueUuid == false]</text><path d="M188,2035.6289 L272,2035.6289 L272,2042.6289 L262,2052.6289 L188,2052.6289 L188,2035.6289 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="539.9238" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="2035.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="203" y="2049.1973">break</text><path d="M248,2057.9395 L248,2082.9395 L424,2082.9395 L424,2067.9395 L414,2057.9395 L248,2057.9395 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M414,2057.9395 L414,2067.9395 L424,2067.9395 L414,2057.9395 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="254" y="2075.5078">sourceMatched</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="361" y="2075.5078">= false</text><path d="M228,2099.25 L302,2099.25 L302,2106.25 L292,2116.25 L228,2116.25 L228,2099.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="87.9316" style="stroke: #000000; stroke-width: 2.0;" width="346" x="228" y="2099.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="243" y="2112.8184">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="184" x="317" y="2111.8848">[foreach request in requestsInfo]</text><path d="M238,2123.5605 L305,2123.5605 L305,2130.5605 L295,2140.5605 L238,2140.5605 L238,2123.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="56.6211" style="stroke: #000000; stroke-width: 2.0;" width="326" x="238" y="2123.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="253" y="2137.1289">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="239" x="320" y="2136.1953">[currentRequest.source == request.source]</text><path d="M248,2145.8711 L248,2170.8711 L415,2170.8711 L415,2155.8711 L405,2145.8711 L248,2145.8711 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M405,2145.8711 L405,2155.8711 L415,2155.8711 L405,2145.8711 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="254" y="2163.4395">sourceMatched</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="361" y="2163.4395">= true</text><path d="M238,2201.1816 L300,2201.1816 L300,2208.1816 L290,2218.1816 L238,2218.1816 L238,2201.1816 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="110.8867" style="stroke: #000000; stroke-width: 2.0;" width="269" x="238" y="2201.1816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="253" y="2214.75">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="315" y="2213.8164">[sourceMatched == true]</text><path d="M248,2223.4922 L248,2248.4922 L449,2248.4922 L449,2233.4922 L439,2223.4922 L248,2223.4922 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M439,2223.4922 L439,2233.4922 L449,2233.4922 L439,2223.4922 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="2241.0605">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="351" y="2241.0605">= 'MODIFIED'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="238" x2="507" y1="2258.8027" y2="2258.8027"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="243" y="2269.4375">[sourceMatched == false]</text><path d="M248,2277.7578 L248,2302.7578 L493,2302.7578 L493,2287.7578 L483,2277.7578 L248,2277.7578 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M483,2277.7578 L483,2287.7578 L493,2287.7578 L483,2277.7578 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="2295.3262">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="351" y="2295.3262">= 'UUID_COLLISION'</text><polygon fill="#A80036" points="664,2351.6895,674,2355.6895,664,2359.6895,668,2355.6895" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="2355.6895" y2="2355.6895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2343.292">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="272" y="2335.6367">Store response and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="396" y="2335.6367">requestStatus</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="2350.9473">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="2350.9473">2003</text><polygon fill="#A80036" points="884,2411.6211,894,2415.6211,884,2419.6211,888,2415.6211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="2415.6211" y2="2415.6211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="693" y="2395.5684">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="715" y="2380.2578">Update responsePayload,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="715" y="2395.5684">responseHeaders and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="715" y="2410.8789">requestStatus</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,2458.6211,926,2458.6211,936,2469.6211,926,2481.6211,875,2481.6211,865,2469.6211,875,2458.6211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="2475.1895">request</text><polygon fill="#A80036" points="254,2504.2422,244,2508.2422,254,2512.2422,250,2508.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="2508.2422" y2="2508.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="2503.5">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="2503.5">Return success</text><polygon fill="#A80036" points="537,2533.5527,547,2537.5527,537,2541.5527,541,2537.5527" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="543" y1="2537.5527" y2="2537.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2532.8105">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="2532.8105">Produce message</text><path d="M168,2628.5527 L363,2628.5527 L363,2635.5527 L353,2645.5527 L168,2645.5527 L168,2628.5527 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="451.9688" style="stroke: #000000; stroke-width: 2.0;" width="811" x="168" y="2628.5527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="183" y="2642.1211">Invalid Request Check</text><path d="M248,2650.8633 L248,2675.8633 L404,2675.8633 L404,2660.8633 L394,2650.8633 L248,2650.8633 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M394,2650.8633 L394,2660.8633 L404,2660.8633 L394,2650.8633 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="254" y="2668.4316">Request is ACCEPTED</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="71.2422" style="stroke: #000000; stroke-width: 2.0;" width="427" x="195" y="2685.1738"/><polygon fill="#EEEEEE" points="195,2685.1738,259,2685.1738,259,2692.1738,249,2702.1738,195,2702.1738,195,2685.1738" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="2699.7422">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="269" y="2718.7422">Use specific</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="171" x="349" y="2718.7422">requestValidationMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="269" y="2734.0527">or</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="286" y="2734.0527">fulfilValidationMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="440" y="2734.0527">to validate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="241" y="2749.3633"/><path d="M178,2768.416 L245,2768.416 L245,2775.416 L235,2785.416 L178,2785.416 L178,2768.416 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="305.1055" style="stroke: #000000; stroke-width: 2.0;" width="791" x="178" y="2768.416"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="193" y="2781.9844">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="260" y="2781.0508">[validationFailed == true]</text><path d="M188,2792.7266 L272,2792.7266 L272,2799.7266 L262,2809.7266 L188,2809.7266 L188,2792.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.7949" style="stroke: #000000; stroke-width: 2.0;" width="771" x="188" y="2792.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="203" y="2806.2949">break</text><polygon fill="#A80036" points="664,2842.6582,674,2846.6582,664,2850.6582,668,2846.6582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="2846.6582" y2="2846.6582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="2834.2607">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="272" y="2826.6055">Store response and requestStatus = 'INVALID'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="2841.916">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="2841.916">2003</text><polygon fill="#A80036" points="884,2902.5898,894,2906.5898,884,2910.5898,888,2906.5898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="2906.5898" y2="2906.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="693" y="2886.5371">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="715" y="2871.2266">Update responsePayload,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="715" y="2886.5371">responseHeaders and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="715" y="2901.8477">requestStatus</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,2949.5898,926,2949.5898,936,2960.5898,926,2972.5898,875,2972.5898,865,2960.5898,875,2949.5898" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="2966.1582">request</text><polygon fill="#A80036" points="254,2995.2109,244,2999.2109,254,3003.2109,250,2999.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="2999.2109" y2="2999.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="2994.4688">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="2994.4688">Return success</text><polygon fill="#A80036" points="537,3024.5215,547,3028.5215,537,3032.5215,541,3028.5215" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="543" y1="3028.5215" y2="3028.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="3023.7793">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="3023.7793">Produce message</text><path d="M178,3119.5215 L346,3119.5215 L346,3126.5215 L336,3136.5215 L178,3136.5215 L178,3119.5215 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="821.2266" style="stroke: #000000; stroke-width: 2.0;" width="781" x="178" y="3119.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="193" y="3133.0898">Complete Request</text><path d="M248,3141.832 L248,3166.832 L502,3166.832 L502,3151.832 L492,3141.832 L248,3141.832 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M492,3141.832 L492,3151.832 L502,3151.832 L492,3141.832 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="254" y="3159.4004">Request remained in ACCEPTED state</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="71.2422" style="stroke: #000000; stroke-width: 2.0;" width="427" x="195" y="3176.1426"/><polygon fill="#EEEEEE" points="195,3176.1426,259,3176.1426,259,3183.1426,249,3193.1426,195,3193.1426,195,3176.1426" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="3190.7109">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="266.5" y="3209.7109">Execute specific processing:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="266.5" y="3225.0215">Transfer/Quote/Bulk Prepare/Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="270.5" y="3240.332"/><path d="M248,3257.3848 L248,3312.3848 L429,3312.3848 L429,3267.3848 L419,3257.3848 L248,3257.3848 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M419,3257.3848 L419,3267.3848 L429,3267.3848 L419,3257.3848 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="3274.9531">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="351" y="3274.9531">= null</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="254" y="3290.2637">responseHeaders</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="376" y="3290.2637">= null</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="254" y="3305.5742">responsePayload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="373" y="3305.5742">= null</text><path d="M188,3329.3164 L250,3329.3164 L250,3336.3164 L240,3346.3164 L188,3346.3164 L188,3329.3164 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="407.2578" style="stroke: #000000; stroke-width: 2.0;" width="467" x="188" y="3329.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="203" y="3342.8848">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="265" y="3341.9512">[static response]</text><path d="M238,3353.627 L300,3353.627 L300,3360.627 L290,3370.627 L238,3370.627 L238,3353.627 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="172.1289" style="stroke: #000000; stroke-width: 2.0;" width="407" x="238" y="3353.627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="253" y="3367.1953">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="315" y="3366.2617">[success]</text><path d="M248,3375.9375 L248,3430.9375 L526,3430.9375 L526,3385.9375 L516,3375.9375 L248,3375.9375 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M516,3375.9375 L516,3385.9375 L526,3385.9375 L516,3375.9375 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="3393.5059">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="351" y="3393.5059">= 'COMPLETED'</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="254" y="3408.8164">responseHeaders</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="376" y="3408.8164">= &lt;content.headers&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="254" y="3424.127">responsePayload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="373" y="3424.127">= &lt;content.payload&gt;</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="238" x2="645" y1="3441.8691" y2="3441.8691"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="243" y="3452.5039">[error]</text><path d="M248,3460.8242 L248,3515.8242 L631,3515.8242 L631,3470.8242 L621,3460.8242 L248,3460.8242 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M621,3460.8242 L621,3470.8242 L631,3470.8242 L621,3460.8242 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="3478.3926">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="351" y="3478.3926">= 'ERROR'</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="254" y="3493.7031">responseHeaders</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="376" y="3493.7031">= &lt;content.headers&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="254" y="3509.0137">responsePayload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="373" y="3509.0137">= &lt;content.payload.errorInformation&gt;</text><polygon fill="#A80036" points="537,3550.0664,547,3554.0664,537,3558.0664,541,3554.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="543" y1="3554.0664" y2="3554.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="3549.3242">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="3549.3242">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="188" x2="655" y1="3593.0664" y2="3593.0664"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="193" y="3603.7012">[non-static response]</text><path d="M248,3612.0215 L248,3637.0215 L410,3637.0215 L410,3622.0215 L400,3612.0215 L248,3612.0215 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M400,3612.0215 L400,3622.0215 L410,3622.0215 L400,3612.0215 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="254" y="3629.5898">requestStatus</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="351" y="3629.5898">= 'GET'</text><rect fill="#FFFFFF" filter="url(#f1d8gfecx58ooo)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="427" x="195" y="3646.332"/><polygon fill="#EEEEEE" points="195,3646.332,259,3646.332,259,3653.332,249,3663.332,195,3663.332,195,3646.332" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="208" y="3660.9004">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="270" y="3679.9004">Use specific</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="350" y="3679.9004">getMethod</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="427" y="3679.9004">to reply with current state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="210" y="3695.2109"/><polygon fill="#A80036" points="542,3724.5742,552,3728.5742,542,3732.5742,546,3728.5742" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="548" y1="3728.5742" y2="3728.5742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="3723.832">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="272" y="3723.832">Produce message</text><polygon fill="#A80036" points="664,3776.1953,674,3780.1953,664,3784.1953,668,3780.1953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="243" x2="670" y1="3780.1953" y2="3780.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="250" y="3767.7979">30</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="272" y="3760.1426">Store requestStatus and response (not set when GET)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="272" y="3775.4531">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="349" y="3775.4531">2003</text><polygon fill="#A80036" points="884,3836.127,894,3840.127,884,3844.127,888,3840.127" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="686" x2="890" y1="3840.127" y2="3840.127"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="693" y="3820.0742">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="715" y="3804.7637">Update responsePayload,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="715" y="3820.0742">responseHeaders and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="715" y="3835.3848">requestStatus</text><polygon fill="#FFFFE0" filter="url(#f1d8gfecx58ooo)" points="875,3883.127,926,3883.127,936,3894.127,926,3906.127,875,3906.127,865,3894.127,875,3883.127" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="877" y="3899.6953">request</text><polygon fill="#A80036" points="254,3928.748,244,3932.748,254,3936.748,250,3932.748" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="248" x2="680" y1="3932.748" y2="3932.748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="260" y="3928.0059">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="282" y="3928.0059">Return success</text><path d="M248,3977.748 L248,4094.748 L946,4094.748 L946,3987.748 L936,3977.748 L248,3977.748 " fill="#D3D3D3" filter="url(#f1d8gfecx58ooo)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M936,3977.748 L936,3987.748 L946,3987.748 L936,3977.748 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="254" y="3995.3164"> Order is performance optimised</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="525" x="254" y="4010.627"> request.isFulfil replaces additional lookup or doubling the count of requestTypes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="677" x="254" y="4025.9375"> request.destination provides for fulfil request validation (destination should match when isFulfil == true)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="254" y="4041.248"></text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="271" y="4041.248">(TBD)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="590" x="308" y="4041.248">Unique and regular indexes are used for performance during check, BUT may delay operations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="254" y="4056.5586"></text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="271" y="4056.5586">(TBD)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="587" x="308" y="4056.5586">Status update and store response may cost resources, BUT no await or following notification?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="254" y="4071.8691"></text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="271" y="4071.8691">(TBD)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="576" x="308" y="4071.8691">Saved response provides processing exactly once, but storage and security may be affected</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="254" y="4087.1797"></text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="271" y="4087.1797">(TBD)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="619" x="308" y="4087.1797">requestType.methods provide easy configuration for custom processing according to request type</text><!--
@startuml
title 9.1.1. Request Duplicate Check (incl. Transfers, Quotes, Bulk Transfers, Transactions)

autonumber


collections "topic-source" as TOPIC_SOURCE
control "Processing\nHandler" as HANDLER
collections "topic-event" as TOPIC_EVENTS
collections "topic-notifcation" as TOPIC_NOTIFICATION
entity "Request DAO" as DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_SOURCE
    participant HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant DAO
    participant DB
end box

group Security Check
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

group Schema Validation (joi)
    |||
    HANDLER -> TOPIC_EVENTS: Produce message
    ref over HANDLER, TOPIC_EVENTS: Event Handler Consume\n
    |||
end

note right of HANDLER #lightgrey
    Onwards, each unique (by source)
    request would leave its footprint
end note

activate HANDLER
group Request Duplicate Check
    TOPIC_SOURCE <- HANDLER: Consume message
    activate TOPIC_SOURCE
    deactivate TOPIC_SOURCE

    group Idempotency Check
        note right of HANDLER #lightgrey
            Source qualified, each (unique) POST/PUT message is
            processed //exactly once//, except when requestStatus is GET
        end note

        HANDLER -> DAO: Save request with status RECEIVED\n<color #red><b>Error code:</b> 2003</color>
        activate DAO
        DAO -> DB: Insert utilising unique index\non source, uuid, hash
        hnote over DB #lightyellow
            request
        end note
        activate DB
        deactivate DB
        DAO - -> HANDLER: Return requestId or insert failure
        deactivate DAO

        break Insert failed
            HANDLER -> DAO: Retrieve duplicate request\n<color #red><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: Use same index:\n source, uuid, hash
            hnote over DB #lightyellow
                request
            end note
            activate DB
            DB - -> DAO: Return **requestInfo**
            deactivate DB
            DAO - -> HANDLER: Return **requestInfo**
            deactivate DAO

            alt requestStatus IN ['RECEIVED', 'ACCEPTED']
                note right of HANDLER #lightgrey
                    Ignore request
                end note
            else requestStatus IN ['UUID_COLLISION', 'MODIFIED', 'INVALID', 'ERROR', 'COMPLETED']
                HANDLER -> TOPIC_NOTIFICATION: Produce previous response\nusing stored **requestInfo**
                activate TOPIC_NOTIFICATION
                deactivate TOPIC_NOTIFICATION
            else requestStatus IN ['GET']
                ref over HANDLER, TOPIC_NOTIFICATION: \t\tUse specific **getMethod** to reply with current state\t\n
                HANDLER -> TOPIC_NOTIFICATION: Produce message
            end
        end
    end
    |||

    group UUID Check
        note right of HANDLER #lightgrey
            Request is currently RECEIVED, but we need to verify
            by querying db for other records with same UUID.
            **Note**: uuid uniqueness is not guaranteed across
            different request types.
        end note

        HANDLER -> DAO: Find matching UUIDs (excl. current)\n<color #red><b>Error code:</b> 2003</color>
        activate DAO
        DAO -> DB: Use index: uuid,\nrequestType, isFulfil
        hnote over DB #lightyellow
            request
        end note
        activate DB
        DB - -> DAO: Return **requestsInfo**
        deactivate DB
        DAO - -> HANDLER: Return **requestsInfo**
        deactivate DAO

        note right of HANDLER #lightgrey
            **isUniqueUuid** = requestsInfo.length == 0
        end note

        opt isUniqueUuid == true
            HANDLER -> DAO: Change request status to ACCEPTED\n<color #red><b>Error code:</b> 2003</color>
            activate DAO
            DAO -> DB: Update status
            hnote over DB #lightyellow
                request
            end note
            activate DB
            deactivate DB
            DAO - -> HANDLER: Return success
            deactivate DAO
        end
    end
    |||

    group Modified Request Check
        note right of HANDLER #lightgrey
            Request is still RECEIVED and **UUID Check** failed
        end note
        opt isUniqueUuid == false
            break
                note right of HANDLER #lightgrey
                    **sourceMatched** = false 
                end note

                loop foreach request in requestsInfo
                    opt currentRequest.source == request.source
                        note right of HANDLER #lightgrey
                            **sourceMatched** = true
                        end note
                    end
                end

                alt sourceMatched == true
                    note right of HANDLER #lightgrey
                        **requestStatus** = 'MODIFIED'
                    end note
                else sourceMatched == false
                    note right of HANDLER #lightgrey
                        **requestStatus** = 'UUID_COLLISION'
                    end note
                end

                HANDLER -> DAO: Store response and **requestStatus**\n<color #red><b>Error code:</b> 2003</color>
                activate DAO
                DAO -> DB: Update responsePayload,\nresponseHeaders and\nrequestStatus
                hnote over DB #lightyellow
                    request
                end note
                activate DB
                deactivate DB
                DAO - -> HANDLER: Return success
                deactivate DAO

                HANDLER -> TOPIC_NOTIFICATION: Produce message
                activate TOPIC_NOTIFICATION
                deactivate TOPIC_NOTIFICATION
            end
        end
    end
    |||

    group Invalid Request Check
        note right of HANDLER #lightgrey
            Request is ACCEPTED
        end note

        ref over HANDLER, TOPIC_NOTIFICATION: \tUse specific **requestValidationMethod**\t\t\n\tor **fulfilValidationMethod** to validate\n

        opt validationFailed == true
            break
                HANDLER -> DAO: Store response and requestStatus = 'INVALID'\n<color #red><b>Error code:</b> 2003</color>
                activate DAO
                DAO -> DB: Update responsePayload,\nresponseHeaders and\nrequestStatus
                hnote over DB #lightyellow
                    request
                end note
                activate DB
                deactivate DB
                DAO - -> HANDLER: Return success
                deactivate DAO

                HANDLER -> TOPIC_NOTIFICATION: Produce message
                activate TOPIC_NOTIFICATION
                deactivate TOPIC_NOTIFICATION
            end
        end
    end
    |||

    group Complete Request
        note right of HANDLER #lightgrey
            Request remained in ACCEPTED state
        end note

        ref over HANDLER, TOPIC_NOTIFICATION: Execute specific processing:\t\t\t\t\nTransfer/Quote/Bulk Prepare/Fulfil\n

        note right of HANDLER #lightgrey
            **requestStatus** = null
            **responseHeaders** = null
            **responsePayload** = null
        end note


        alt static response
            alt success
                note right of HANDLER #lightgrey
                    **requestStatus** = 'COMPLETED'
                    **responseHeaders** = <content.headers>
                    **responsePayload** = <content.payload>
                end note
            else error
                note right of HANDLER #lightgrey
                    **requestStatus** = 'ERROR'
                    **responseHeaders** = <content.headers>
                    **responsePayload** = <content.payload.errorInformation>
                end note
            end

            HANDLER -> TOPIC_NOTIFICATION: Produce message
            activate TOPIC_NOTIFICATION
            deactivate TOPIC_NOTIFICATION
        else non-static response
            note right of HANDLER #lightgrey
                **requestStatus** = 'GET'
            end note
            ref over HANDLER, TOPIC_NOTIFICATION: \t\tUse specific **getMethod** to reply with current state\t\n
            HANDLER -> TOPIC_NOTIFICATION: Produce message
        end

        HANDLER -> DAO: <color #red>Store requestStatus and response (not set when GET)</color>\n<color #red><b>Error code:</b> 2003</color>
        activate DAO
        DAO -> DB: Update responsePayload,\nresponseHeaders and\nrequestStatus
        hnote over DB #lightyellow
            request
        end note
        activate DB
        deactivate DB
        DAO - -> HANDLER: Return success
        deactivate DAO
    end
    |||
    
    note right of HANDLER #lightgrey
         Order is performance optimised
         request.isFulfil replaces additional lookup or doubling the count of requestTypes
         request.destination provides for fulfil request validation (destination should match when isFulfil == true)
         <color #red>(TBD)</color> Unique and regular indexes are used for performance during check, BUT may delay operations
         <color #red>(TBD)</color> Status update and store response may cost resources, BUT no await or following notification?
         <color #red>(TBD)</color> Saved response provides processing exactly once, but storage and security may be affected
         <color #red>(TBD)</color> requestType.methods provide easy configuration for custom processing according to request type
    end note
    |||
end

@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>