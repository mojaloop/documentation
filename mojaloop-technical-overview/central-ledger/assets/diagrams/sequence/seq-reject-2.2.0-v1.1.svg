<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1476px" preserveAspectRatio="none" style="width:1924px;height:1476px;" version="1.1" viewBox="0 0 1924 1476" width="1924px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tl4bkf1lvlro" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="363" x="781.5" y="23.5352">2.2.0. DFSP2 sends a Fulfil Reject Transfer request</text><rect fill="#D3D3D3" height="1430.5176" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="1430.5176" style="stroke: #A80036; stroke-width: 1.0;" width="564.5" x="332.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="536.25" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1430.5176" style="stroke: #A80036; stroke-width: 1.0;" width="630.5" x="899" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1163.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="386.5" y="662.0918"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="1189.2539" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="771.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1093" y="1109.8555"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="1189.2539" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1451" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="1174.2539" style="stroke: #000000; stroke-width: 2.0;" width="1821" x="92" y="170.7754"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="391.5" x2="391.5" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="776" x2="776" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="970" x2="970" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1098" x2="1098" y1="153.7754" y2="1362.0293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1455.5" x2="1455.5" y1="153.7754" y2="1362.0293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1374.5645">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="1391.0527">Payer</text><ellipse cx="67.5" cy="1404.0059" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1412.0059 L67.5,1439.0059 M54.5,1420.0059 L80.5,1420.0059 M67.5,1439.0059 L54.5,1454.0059 M67.5,1439.0059 L80.5,1454.0059 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1374.5645">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="1391.0527">Payee</text><ellipse cx="126.5" cy="1404.0059" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1412.0059 L126.5,1439.0059 M113.5,1420.0059 L139.5,1420.0059 M126.5,1439.0059 L113.5,1454.0059 M126.5,1439.0059 L139.5,1454.0059 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="336.5" y="150.8223">ML API Adapter</text><path d="M371,109.2871 L371,133.2871 M371,121.2871 L388,121.2871 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="400" cy="121.2871" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="336.5" y="1374.5645">ML API Adapter</text><path d="M371,1381.5176 L371,1405.5176 M371,1393.5176 L388,1393.5176 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="400" cy="1393.5176" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="660" y="150.8223">ML API Notification Event Handler</text><ellipse cx="776.5" cy="121.2871" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="772.5,109.2871,778.5,104.2871,776.5,109.2871,778.5,114.2871,772.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="660" y="1374.5645">ML API Notification Event Handler</text><ellipse cx="776.5" cy="1393.5176" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="772.5,1381.5176,778.5,1376.5176,776.5,1381.5176,778.5,1386.5176,772.5,1381.5176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="903" y="150.8223">Central Service API</text><path d="M949.5,109.2871 L949.5,133.2871 M949.5,121.2871 L966.5,121.2871 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="978.5" cy="121.2871" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="903" y="1374.5645">Central Service API</text><path d="M949.5,1381.5176 L949.5,1405.5176 M949.5,1393.5176 L966.5,1393.5176 " fill="none" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="978.5" cy="1393.5176" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1051" y="114.2871"/><rect fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1047" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1054" y="138.8223">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1051" y="1361.0293"/><rect fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1047" y="1365.0293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1054" y="1385.5645">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1386.5" y="150.8223">Fulfil Event Handler</text><ellipse cx="1456" cy="121.2871" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1452,109.2871,1458,104.2871,1456,109.2871,1458,114.2871,1452,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1386.5" y="1374.5645">Fulfil Event Handler</text><ellipse cx="1456" cy="1393.5176" fill="#FEFECE" filter="url(#f1tl4bkf1lvlro)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1452,1381.5176,1458,1376.5176,1456,1381.5176,1458,1386.5176,1452,1381.5176" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="386.5" y="662.0918"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="1189.2539" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="771.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1093" y="1109.8555"/><rect fill="#FFFFFF" filter="url(#f1tl4bkf1lvlro)" height="1189.2539" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1451" y="163.7754"/><path d="M92,170.7754 L705,170.7754 L705,177.7754 L695,187.7754 L92,187.7754 L92,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1174.2539" style="stroke: #000000; stroke-width: 2.0;" width="1821" x="92" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="568" x="107" y="184.3438">DFSP2 sends an error callback to reject a transfer with an errorCode and description</text><path d="M131,193.0859 L131,631.0859 L472,631.0859 L472,203.0859 L462,193.0859 L131,193.0859 " fill="#FFFF00" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M462,193.0859 L462,203.0859 L472,203.0859 L462,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="137" y="210.6543">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="153" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="153" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="153" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="153" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="153" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="153" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="153" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="153" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="137" y="409.6914">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="153" y="440.3125">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="169" y="455.623">"errorCode": &lt;errorCode&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="169" y="470.9336">"errorDescription": &lt;errorDescription&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="169" y="486.2441">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="185" y="501.5547">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="201" y="516.8652">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="217" y="532.1758">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="217" y="547.4863">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="201" y="562.7969">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="185" y="578.1074">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="169" y="593.418">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="153" y="608.7285">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="624.0391">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="374.5" y1="662.0918" y2="658.0918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384.5" x2="374.5" y1="662.0918" y2="666.0918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="385.5" y1="662.0918" y2="662.0918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="657.3496">1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="193" x="146.5" y="657.3496">PUT - /transfers/&lt;ID&gt;/error</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="438.5" y1="691.4023" y2="691.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438.5" x2="438.5" y1="691.4023" y2="704.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="397.5" x2="438.5" y1="704.4023" y2="704.4023"/><polygon fill="#A80036" points="407.5,700.4023,397.5,704.4023,407.5,708.4023,403.5,704.4023" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403.5" y="686.6602">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="416.5" y="686.6602">Validate incoming token and originator matching Payee</text><path d="M401,717.4023 L401,1079.4023 L710,1079.4023 L710,727.4023 L700,717.4023 L401,717.4023 " fill="#FFFF00" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M700,717.4023 L700,727.4023 L710,727.4023 L700,717.4023 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="407" y="734.9707">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="407" y="750.2813">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="423" y="765.5918">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="423" y="780.9023">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="423" y="796.2129">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="423" y="811.5234">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="423" y="826.834">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="439" y="842.1445">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="439" y="857.4551">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="423" y="872.7656">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="423" y="888.0762">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="439" y="903.3867">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="455" y="918.6973">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="455" y="934.0078">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="455" y="949.3184">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="455" y="964.6289">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="455" y="979.9395">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="471" y="995.25">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="471" y="1010.5605">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="455" y="1025.8711">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="439" y="1041.1816">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="423" y="1056.4922">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="407" y="1071.8027">}</text><polygon fill="#A80036" points="1081,1105.8555,1091,1109.8555,1081,1113.8555,1085,1109.8555" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="1087" y1="1109.8555" y2="1109.8555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="403.5" y="1105.1133">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="416.5" y="1105.1133">Route &amp; Publish Fulfil event for Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1103" x2="1145" y1="1139.166" y2="1139.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1145" x2="1145" y1="1139.166" y2="1152.166"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1104" x2="1145" y1="1152.166" y2="1152.166"/><polygon fill="#A80036" points="1114,1148.166,1104,1152.166,1114,1156.166,1110,1152.166" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1110" y="1134.4238">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="1123" y="1134.4238">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="407.5,1177.4766,397.5,1181.4766,407.5,1185.4766,403.5,1181.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="401.5" x2="1097" y1="1181.4766" y2="1181.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="413.5" y="1176.7344">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="426.5" y="1176.7344">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1210.7871" y2="1206.7871"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1210.7871" y2="1214.7871"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="126.5" x2="390.5" y1="1210.7871" y2="1210.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="143.5" y="1206.0449">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="156.5" y="1206.0449">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1109,1236.0977,1099,1240.0977,1109,1244.0977,1105,1240.0977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1103" x2="1450" y1="1240.0977" y2="1240.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1115" y="1235.3555">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1128" y="1235.3555">Consume message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1461" x2="1503" y1="1269.4082" y2="1269.4082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1503" x2="1503" y1="1269.4082" y2="1282.4082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1462" x2="1503" y1="1282.4082" y2="1282.4082"/><polygon fill="#A80036" points="1472,1278.4082,1462,1282.4082,1472,1286.4082,1468,1282.4082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1468" y="1264.666">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1481" y="1264.666">Log error message</text><path d="M1466,1295.4082 L1466,1335.4082 L1899,1335.4082 L1899,1305.4082 L1889,1295.4082 L1466,1295.4082 " fill="#FBFB77" filter="url(#f1tl4bkf1lvlro)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1889,1295.4082 L1889,1305.4082 L1899,1305.4082 L1889,1295.4082 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="1472" y="1312.9766">(corresponding to a Fulfil message with transferState='ABORTED')</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="1472" y="1328.2871">action REJECT is not allowed into fulfil handler</text><!--
@startuml
title 2.2.0. DFSP2 sends a Fulfil Reject Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER


box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
group DFSP2 sends an error callback to reject a transfer with an errorCode and description
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "errorInformation": {
                "errorCode": <errorCode>,
                "errorDescription": <errorDescription>,
                "extensionList": {
                    "extension": [
                        {
                            "key": <string>,
                            "value": <string>
                        }
                    ]
                }
            }
        }
    end note
    DFSP2 ->> MLAPI: **PUT - /transfers/<ID>/error**
    
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: Route & Publish Fulfil event for Payee
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - ->> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    FULF_HANDLER -> FULF_HANDLER: Log error message
    note right of FULF_HANDLER: (corresponding to a Fulfil message with transferState='ABORTED')\naction REJECT is not allowed into fulfil handler
end
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>