<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4984px" preserveAspectRatio="none" style="width:2005px;height:4984px;" version="1.1" viewBox="0 0 2005 4984" width="2005px" zoomAndPan="magnify"><defs><filter height="300%" id="fvpz4chvh2xfd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="319" x="844" y="23.5352">2.2.1. Fulfil Handler Consume (Reject/Abort)</text><rect fill="#FFFFE0" height="4939.1738" style="stroke: #A80036; stroke-width: 1.0;" width="1841.5" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="899.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4771.8867" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="980" y="3058.3359"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="980" y="4280.8789"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1269.5" y="3548.3652"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1269.5" y="4770.9082"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="681.1875"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="944.293"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1516.748"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1721.6113"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1993.7168"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="2279.4668"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="2390.5332" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="2508.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1198.6113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1407.5" y="3700.5625"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="710.498"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="973.6035"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="1546.0586"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="1750.9219"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2023.0273"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2308.7773"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2537.9512"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="3729.873"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4757.8867" style="stroke: #000000; stroke-width: 2.0;" width="1981" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4726.5762" style="stroke: #000000; stroke-width: 2.0;" width="1961" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="561.5" x="287.5" y="241.2188"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="541.5" x="297.5" y="265.5293"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="903.5" x="297.5" y="361.4609"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="467.7031"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1068.7344" style="stroke: #000000; stroke-width: 2.0;" width="1706.5" x="267.5" y="584.9453"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="756.3184" style="stroke: #000000; stroke-width: 2.0;" width="1668.5" x="277.5" y="890.3613"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="362.3262" style="stroke: #000000; stroke-width: 2.0;" width="1080.5" x="287.5" y="1095.8457"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="263.5" x="297.5" y="1120.1563"/><rect fill="#FFFFFF" height="107.1973" style="stroke: none; stroke-width: 1.0;" width="1080.5" x="287.5" y="1186.7773"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="1208.7324"/><rect fill="#FFFFFF" height="88.5762" style="stroke: none; stroke-width: 1.0;" width="1080.5" x="287.5" y="1293.9746"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="234.5" x="297.5" y="1315.9297"/><rect fill="#FFFFFF" height="75.6211" style="stroke: none; stroke-width: 1.0;" width="1080.5" x="287.5" y="1382.5508"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="297.5" y="1391.5508"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1668.5" x="277.5" y="1465.1719"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="3155.2285" style="stroke: #000000; stroke-width: 2.0;" width="1646.5" x="277.5" y="1667.6797"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="558.5449" style="stroke: #000000; stroke-width: 2.0;" width="1619.5" x="287.5" y="1857.8535"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1599.5" x="297.5" y="1939.7852"/><rect fill="#FFFFFF" height="270.4395" style="stroke: none; stroke-width: 1.0;" width="1619.5" x="287.5" y="2145.959"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1598.5" x="297.5" y="2225.5352"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1162.9668" style="stroke: #000000; stroke-width: 2.0;" width="1626.5" x="287.5" y="2430.3984"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1606.5" x="297.5" y="2454.709"/><rect fill="#FFFFFF" height="497.0293" style="stroke: none; stroke-width: 1.0;" width="1626.5" x="287.5" y="3096.3359"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="3118.291"/><rect fill="#FFFFFF" height="1222.543" style="stroke: none; stroke-width: 1.0;" width="1646.5" x="277.5" y="3600.3652"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1193.5879" style="stroke: #000000; stroke-width: 2.0;" width="1626.5" x="287.5" y="3622.3203"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1606.5" x="297.5" y="3646.6309"/><rect fill="#FFFFFF" height="497.0293" style="stroke: none; stroke-width: 1.0;" width="1626.5" x="287.5" y="4318.8789"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="4340.834"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1961" x="23" y="4829.9082"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="84" x2="84" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="376.5" x2="376.5" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="985" x2="985" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1138" x2="1138" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1274" x2="1274" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1407" x2="1407" y1="116.2871" y2="4908.1738"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1818.5" x2="1818.5" y1="116.2871" y2="4908.1738"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="101.334">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="4907.1738"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="4911.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="4931.709">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="307.5" y="113.334">Fulfil Event Handler</text><ellipse cx="377" cy="83.7988" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="373,71.7988,379,66.7988,377,71.7988,379,76.7988,373,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="307.5" y="4920.709">Fulfil Event Handler</text><ellipse cx="377" cy="4939.6621" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="373,4927.6621,379,4922.6621,377,4927.6621,379,4932.6621,373,4927.6621" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="898" y="76.7988"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="894" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="901" y="101.334">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="898" y="4907.1738"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="894" y="4911.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="901" y="4931.709">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1090" y="76.7988"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1086" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1093" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1090" y="4907.1738"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1086" y="4911.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1093" y="4931.709">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1205" y="76.7988"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1201" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1208" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1205" y="4907.1738"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1201" y="4911.1738"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1208" y="4931.709">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1358" y="113.334">Transfer DAO</text><ellipse cx="1407.5" cy="83.7988" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1395.5" x2="1419.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1358" y="4920.709">Transfer DAO</text><ellipse cx="1407.5" cy="4939.6621" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1395.5" x2="1419.5" y1="4953.6621" y2="4953.6621"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1770.5" y="113.334">Central Store</text><path d="M1800.5,63.7988 C1800.5,53.7988 1818.5,53.7988 1818.5,53.7988 C1818.5,53.7988 1836.5,53.7988 1836.5,63.7988 L1836.5,89.7988 C1836.5,99.7988 1818.5,99.7988 1818.5,99.7988 C1818.5,99.7988 1800.5,99.7988 1800.5,89.7988 L1800.5,63.7988 " fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1800.5,63.7988 C1800.5,73.7988 1818.5,73.7988 1818.5,73.7988 C1818.5,73.7988 1836.5,73.7988 1836.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1770.5" y="4920.709">Central Store</text><path d="M1800.5,4933.6621 C1800.5,4923.6621 1818.5,4923.6621 1818.5,4923.6621 C1818.5,4923.6621 1836.5,4923.6621 1836.5,4933.6621 L1836.5,4959.6621 C1836.5,4969.6621 1818.5,4969.6621 1818.5,4969.6621 C1818.5,4969.6621 1800.5,4969.6621 1800.5,4959.6621 L1800.5,4933.6621 " fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1800.5,4933.6621 C1800.5,4943.6621 1818.5,4943.6621 1818.5,4943.6621 C1818.5,4943.6621 1836.5,4943.6621 1836.5,4933.6621 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4771.8867" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="980" y="3058.3359"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="980" y="4280.8789"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1269.5" y="3548.3652"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1269.5" y="4770.9082"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="681.1875"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="944.293"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1516.748"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1721.6113"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="1993.7168"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="2279.4668"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="2390.5332" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1402.5" y="2508.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1198.6113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1407.5" y="3700.5625"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="710.498"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="973.6035"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="1546.0586"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="1750.9219"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2023.0273"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2308.7773"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="2537.9512"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1813.5" y="3729.873"/><path d="M13,133.2871 L276,133.2871 L276,140.2871 L266,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4757.8867" style="stroke: #000000; stroke-width: 2.0;" width="1981" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="28" y="146.8555">Fulfil Handler Consume (Failure)</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4726.5762" style="stroke: #000000; stroke-width: 2.0;" width="1961" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="100,192.2188,90,196.2188,100,200.2188,96,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="371" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="106" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="119" y="191.4766">Consume Fulfil event message for Payer</text><path d="M287.5,241.2188 L371.5,241.2188 L371.5,248.2188 L361.5,258.2188 L287.5,258.2188 L287.5,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="561.5" x="287.5" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="302.5" y="254.7871">break</text><path d="M297.5,265.5293 L439.5,265.5293 L439.5,272.5293 L429.5,282.5293 L297.5,282.5293 L297.5,265.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="541.5" x="297.5" y="265.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="312.5" y="279.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="319.4609" y2="319.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="319.4609" y2="332.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="332.4609" y2="332.4609"/><polygon fill="#A80036" points="393,328.4609,383,332.4609,393,336.4609,389,332.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="307.0635">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425" x="402" y="299.4082">Validate event - Rule: type == 'fulfil' &amp;&amp; ( action IN ['reject','abort'] )</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="402" y="314.7188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="486" y="314.7188">2001</text><path d="M297.5,361.4609 L512.5,361.4609 L512.5,368.4609 L502.5,378.4609 L297.5,378.4609 L297.5,361.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="903.5" x="297.5" y="361.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="312.5" y="375.0293">Persist Event Information</text><polygon fill="#A80036" points="1126.5,396.082,1136.5,400.082,1126.5,404.082,1130.5,400.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1132.5" y1="400.082" y2="400.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="395.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="402" y="395.3398">Publish event information</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="885.5" x="304.5" y="408.082"/><polygon fill="#EEEEEE" points="304.5,408.082,368.5,408.082,368.5,415.082,358.5,425.082,304.5,425.082,304.5,408.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="317.5" y="422.6504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="652.25" y="441.6504">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="32" x="810.25" y="441.6504">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="810.25" x2="842.25" y1="443.6504" y2="443.6504"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="842.25" y="441.6504">}</text><path d="M297.5,467.7031 L519.5,467.7031 L519.5,474.7031 L509.5,484.7031 L297.5,484.7031 L297.5,467.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="467.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="312.5" y="481.2715">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1042.5" x="304.5" y="510.0137"/><polygon fill="#EEEEEE" points="304.5,510.0137,368.5,510.0137,368.5,517.0137,358.5,527.0137,304.5,527.0137,304.5,510.0137" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="317.5" y="524.582">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="572.25" y="543.582">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="790.25" y="543.582">FSPIOP-Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="912.25" y="543.582">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="159" x="916.25" y="543.582">seq-signature-validation</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="916.25" x2="1075.25" y1="545.582" y2="545.582"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1075.25" y="543.582">}</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="572.25" y="558.8926">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="656.25" y="558.8926">2001</text><path d="M267.5,584.9453 L579.5,584.9453 L579.5,591.9453 L569.5,601.9453 L267.5,601.9453 L267.5,584.9453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1068.7344" style="stroke: #000000; stroke-width: 2.0;" width="1706.5" x="267.5" y="584.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="267" x="282.5" y="598.5137">Validate Transfer Fulfil Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="623.5664" y2="623.5664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="623.5664" y2="636.5664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="636.5664" y2="636.5664"/><polygon fill="#A80036" points="393,632.5664,383,636.5664,393,640.5664,389,636.5664" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="618.8242">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="402" y="618.8242">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1390.5,677.1875,1400.5,681.1875,1390.5,685.1875,1394.5,681.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="681.1875" y2="681.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="668.79">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="402" y="661.1348">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="402" y="676.4453">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="479" y="676.4453">2003</text><polygon fill="#A80036" points="1801.5,706.498,1811.5,710.498,1801.5,714.498,1805.5,710.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="710.498" y2="710.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1419.5" y="705.7559">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="1432.5" y="705.7559">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1683,723.498,1954,723.498,1964,749.498,1954,776.498,1683,776.498,1673,749.498,1683,723.498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1685" y="740.0664">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1685" y="755.377">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1725" y="755.377">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1685" y="770.6875">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1423.5,799.7402,1413.5,803.7402,1423.5,807.7402,1419.5,803.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1417.5" x2="1817.5" y1="803.7402" y2="803.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1429.5" y="798.998">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1442.5" y="798.998">Return existing hashes</text><polygon fill="#A80036" points="393,829.0508,383,833.0508,393,837.0508,389,833.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="833.0508" y2="833.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="399" y="828.3086">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="412" y="828.3086">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="862.3613" y2="862.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="862.3613" y2="875.3613"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="875.3613" y2="875.3613"/><polygon fill="#A80036" points="393,871.3613,383,875.3613,393,879.3613,389,875.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="857.6191">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="571" x="402" y="857.6191">Loop the list of returned hashes and compare each entry with the calculated message hash</text><path d="M277.5,890.3613 L339.5,890.3613 L339.5,897.3613 L329.5,907.3613 L277.5,907.3613 L277.5,890.3613 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="756.3184" style="stroke: #000000; stroke-width: 2.0;" width="1668.5" x="277.5" y="890.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="292.5" y="903.9297">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="354.5" y="902.9961">[Hash matched]</text><polygon fill="#A80036" points="1390.5,940.293,1400.5,944.293,1390.5,948.293,1394.5,944.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="944.293" y2="944.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="931.8955">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="411" y="924.2402">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="939.5508">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="939.5508">2003</text><polygon fill="#A80036" points="1801.5,969.6035,1811.5,973.6035,1801.5,977.6035,1805.5,973.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="973.6035" y2="973.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="968.8613">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="1441.5" y="968.8613">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1753,986.6035,1884,986.6035,1894,1005.6035,1884,1024.6035,1753,1024.6035,1743,1005.6035,1753,986.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1755" y="1003.1719">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1755" y="1018.4824">transferStateChange</text><polygon fill="#A80036" points="1423.5,1047.5352,1413.5,1051.5352,1423.5,1055.5352,1419.5,1051.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1417.5" x2="1817.5" y1="1051.5352" y2="1051.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1429.5" y="1046.793">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1451.5" y="1046.793">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="393,1076.8457,383,1080.8457,393,1084.8457,389,1080.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="1080.8457" y2="1080.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="1076.1035">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="421" y="1076.1035">Return Transfer Fulfilment and Transfer state</text><path d="M287.5,1095.8457 L349.5,1095.8457 L349.5,1102.8457 L339.5,1112.8457 L287.5,1112.8457 L287.5,1095.8457 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="362.3262" style="stroke: #000000; stroke-width: 2.0;" width="1080.5" x="287.5" y="1095.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="302.5" y="1109.4141">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="185" x="364.5" y="1108.4805">[transferFulfilment.isValid == 0]</text><path d="M297.5,1120.1563 L381.5,1120.1563 L381.5,1127.1563 L371.5,1137.1563 L297.5,1137.1563 L297.5,1120.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="263.5" x="297.5" y="1120.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="1133.7246">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="1158.7773" y2="1158.7773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="1158.7773" y2="1171.7773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="1171.7773" y2="1171.7773"/><polygon fill="#A80036" points="393,1167.7773,383,1171.7773,393,1175.7773,389,1171.7773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1154.0352">14</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="411" y="1154.0352">Error handling:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="517" y="1154.0352">3105</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1368" y1="1187.7773" y2="1187.7773"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="292.5" y="1198.4121">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M297.5,1208.7324 L381.5,1208.7324 L381.5,1215.7324 L371.5,1225.7324 L297.5,1225.7324 L297.5,1208.7324 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="1208.7324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="1222.3008">break</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1042.5" x="304.5" y="1226.043"/><polygon fill="#EEEEEE" points="304.5,1226.043,368.5,1226.043,368.5,1233.043,358.5,1243.043,304.5,1243.043,304.5,1226.043" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="317.5" y="1240.6113">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="677.25" y="1259.6113">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="43" x="927.25" y="1259.6113">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="927.25" x2="970.25" y1="1261.6113" y2="1261.6113"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="970.25" y="1259.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="681.25" y="1274.9219"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1368" y1="1294.9746" y2="1294.9746"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="292.5" y="1305.6094">[transferState NOT 'RESERVED']</text><path d="M297.5,1315.9297 L381.5,1315.9297 L381.5,1322.9297 L371.5,1332.9297 L297.5,1332.9297 L297.5,1315.9297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="234.5" x="297.5" y="1315.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="1329.498">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="1354.5508" y2="1354.5508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="1354.5508" y2="1367.5508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="1367.5508" y2="1367.5508"/><polygon fill="#A80036" points="393,1363.5508,383,1367.5508,393,1371.5508,389,1367.5508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1349.8086">15</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="1349.8086">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="1349.8086">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1368" y1="1383.5508" y2="1383.5508"/><path d="M297.5,1391.5508 L381.5,1391.5508 L381.5,1398.5508 L371.5,1408.5508 L297.5,1408.5508 L297.5,1391.5508 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="348.5" x="297.5" y="1391.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="1405.1191">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="1430.1719" y2="1430.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="1430.1719" y2="1443.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="1443.1719" y2="1443.1719"/><polygon fill="#A80036" points="393,1439.1719,383,1443.1719,393,1447.1719,389,1443.1719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1425.4297">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="411" y="1425.4297">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="277.5" x2="1946" y1="1466.1719" y2="1466.1719"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="282.5" y="1476.8066">[Hash not matched]</text><polygon fill="#A80036" points="1390.5,1512.748,1400.5,1516.748,1390.5,1520.748,1394.5,1516.748" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="1516.748" y2="1516.748"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1504.3506">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="411" y="1496.6953">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="1512.0059">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="1512.0059">2003</text><polygon fill="#A80036" points="1801.5,1542.0586,1811.5,1546.0586,1801.5,1550.0586,1805.5,1546.0586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="1546.0586" y2="1546.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="1541.3164">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1441.5" y="1541.3164">Persist hash</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1710,1589.0586,1926,1589.0586,1936,1600.0586,1926,1612.0586,1710,1612.0586,1700,1600.0586,1710,1589.0586" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1712" y="1605.627">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="393,1634.6797,383,1638.6797,393,1642.6797,389,1638.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="1638.6797" y2="1638.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="1633.9375">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="1633.9375">Return success</text><path d="M277.5,1667.6797 L339.5,1667.6797 L339.5,1674.6797 L329.5,1684.6797 L277.5,1684.6797 L277.5,1667.6797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3155.2285" style="stroke: #000000; stroke-width: 2.0;" width="1646.5" x="277.5" y="1667.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="292.5" y="1681.248">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287" x="354.5" y="1680.3145">[action=='reject' call made on PUT /transfers/{ID}]</text><polygon fill="#A80036" points="1390.5,1717.6113,1400.5,1721.6113,1390.5,1725.6113,1394.5,1721.6113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="1721.6113" y2="1721.6113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1709.2139">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="411" y="1701.5586">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="1716.8691">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="1716.8691">2003</text><polygon fill="#A80036" points="1801.5,1746.9219,1811.5,1750.9219,1801.5,1754.9219,1805.5,1750.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="1750.9219" y2="1750.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="1746.1797">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1441.5" y="1746.1797">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1792,1763.9219,1845,1763.9219,1855,1774.9219,1845,1786.9219,1792,1786.9219,1782,1774.9219,1792,1763.9219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1794" y="1780.4902">transfer</text><polygon fill="#A80036" points="1423.5,1809.543,1413.5,1813.543,1423.5,1817.543,1419.5,1813.543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1417.5" x2="1817.5" y1="1813.543" y2="1813.543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1429.5" y="1808.8008">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1455.5" y="1808.8008"/><polygon fill="#A80036" points="393,1838.8535,383,1842.8535,393,1846.8535,389,1842.8535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="1842.8535" y2="1842.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="1838.1113">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="421" y="1838.1113">Return transfer</text><path d="M287.5,1857.8535 L349.5,1857.8535 L349.5,1864.8535 L339.5,1874.8535 L287.5,1874.8535 L287.5,1857.8535 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="558.5449" style="stroke: #000000; stroke-width: 2.0;" width="1619.5" x="287.5" y="1857.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="302.5" y="1871.4219">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="313" x="364.5" y="1870.4883">[Fulfilment present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="1911.7852" y2="1911.7852"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="1911.7852" y2="1924.7852"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="1924.7852" y2="1924.7852"/><polygon fill="#A80036" points="393,1920.7852,383,1924.7852,393,1928.7852,389,1924.7852" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1899.3877">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="411" y="1891.7324">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="1907.043">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="1907.043">2001</text><path d="M297.5,1939.7852 L457.5,1939.7852 L457.5,1946.7852 L447.5,1956.7852 L297.5,1956.7852 L297.5,1939.7852 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1599.5" x="297.5" y="1939.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="312.5" y="1953.3535">Persist fulfilment</text><polygon fill="#A80036" points="1390.5,1989.7168,1400.5,1993.7168,1390.5,1997.7168,1394.5,1993.7168" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="1993.7168" y2="1993.7168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1981.3193">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="411" y="1973.6641">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="1988.9746">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="1988.9746">2003</text><polygon fill="#A80036" points="1801.5,2019.0273,1811.5,2023.0273,1801.5,2027.0273,1805.5,2023.0273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="2023.0273" y2="2023.0273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="2018.2852">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1441.5" y="2018.2852">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1760,2066.0273,1877,2066.0273,1887,2085.0273,1877,2104.0273,1760,2104.0273,1750,2085.0273,1760,2066.0273" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1762" y="2082.5957">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1762" y="2097.9063">transferExtension</text><polygon fill="#A80036" points="393,2126.959,383,2130.959,393,2134.959,389,2130.959" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="2130.959" y2="2130.959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="2126.2168">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="2126.2168">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1907" y1="2146.959" y2="2146.959"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="342" x="292.5" y="2157.5938">[Fulfilment NOT present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="2197.5352" y2="2197.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="2197.5352" y2="2210.5352"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="2210.5352" y2="2210.5352"/><polygon fill="#A80036" points="393,2206.5352,383,2210.5352,393,2214.5352,389,2210.5352" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2185.1377">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="411" y="2177.4824">Validate that transfer fulfilment message to Abort is valid</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="2192.793">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="2192.793">2001</text><path d="M297.5,2225.5352 L464.5,2225.5352 L464.5,2232.5352 L454.5,2242.5352 L297.5,2242.5352 L297.5,2225.5352 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1598.5" x="297.5" y="2225.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="312.5" y="2239.1035">Persist extensions</text><polygon fill="#A80036" points="1390.5,2275.4668,1400.5,2279.4668,1390.5,2283.4668,1394.5,2279.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="2279.4668" y2="2279.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2267.0693">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="411" y="2259.4141">Persist extensionList elements</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="2274.7246">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="2274.7246">2003</text><polygon fill="#A80036" points="1801.5,2304.7773,1811.5,2308.7773,1801.5,2312.7773,1805.5,2308.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="2308.7773" y2="2308.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="2304.0352">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1441.5" y="2304.0352">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1761,2351.7773,1876,2351.7773,1886,2362.7773,1876,2374.7773,1761,2374.7773,1751,2362.7773,1761,2351.7773" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1763" y="2368.3457">transferExtension</text><polygon fill="#A80036" points="393,2397.3984,383,2401.3984,393,2405.3984,389,2401.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="2401.3984" y2="2401.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="2396.6563">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="2396.6563">Return success</text><path d="M287.5,2430.3984 L349.5,2430.3984 L349.5,2437.3984 L339.5,2447.3984 L287.5,2447.3984 L287.5,2430.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1162.9668" style="stroke: #000000; stroke-width: 2.0;" width="1626.5" x="287.5" y="2430.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="302.5" y="2443.9668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="429" x="364.5" y="2443.0332">[Transfer.ilpCondition validate successful OR generic validation successful]</text><path d="M297.5,2454.709 L756.5,2454.709 L756.5,2461.709 L746.5,2471.709 L297.5,2471.709 L297.5,2454.709 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1606.5" x="297.5" y="2454.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="414" x="312.5" y="2468.2773">Persist Transfer State (with transferState='RECEIVED_REJECT')</text><polygon fill="#A80036" points="1390.5,2504.6406,1400.5,2508.6406,1390.5,2512.6406,1394.5,2508.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1396.5" y1="2508.6406" y2="2508.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2496.2432">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="411" y="2488.5879">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="2503.8984">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="2503.8984">2003</text><polygon fill="#A80036" points="1801.5,2533.9512,1811.5,2537.9512,1801.5,2541.9512,1805.5,2537.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1412.5" x2="1807.5" y1="2537.9512" y2="2537.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1419.5" y="2533.209">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1441.5" y="2533.209">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1753,2580.9512,1884,2580.9512,1894,2591.9512,1884,2603.9512,1753,2603.9512,1743,2591.9512,1753,2580.9512" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1755" y="2597.5195">transferStateChange</text><polygon fill="#A80036" points="393,2626.5723,383,2630.5723,393,2634.5723,389,2630.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1401.5" y1="2630.5723" y2="2630.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="2625.8301">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="2625.8301">Return success</text><path d="M387,2650.5723 L387,3027.5723 L696,3027.5723 L696,2660.5723 L686,2650.5723 L387,2650.5723 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,2650.5723 L686,2660.5723 L696,2660.5723 L686,2650.5723 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="2668.1406">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="2683.4512">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="2698.7617">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="2714.0723">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="2729.3828">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="2744.6934">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="2760.0039">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="2775.3145">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="2790.625">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="2805.9355">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="2821.2461">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="2836.5566">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="2851.8672">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="2867.1777">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="441" y="2882.4883">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="441" y="2897.7988">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="2913.1094">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="2928.4199">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="2943.7305">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="2959.041">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="2974.3516">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="2989.6621">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="3004.9727">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3020.2832">}</text><polygon fill="#A80036" points="968,3054.3359,978,3058.3359,968,3062.3359,972,3058.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="974" y1="3058.3359" y2="3058.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3053.5938">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="411" y="3053.5938">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1914" y1="3097.3359" y2="3097.3359"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="382" x="292.5" y="3107.9707">[Validate Fulfil Transfer not successful or Generic validation failed]</text><path d="M297.5,3118.291 L381.5,3118.291 L381.5,3125.291 L371.5,3135.291 L297.5,3135.291 L297.5,3118.291 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="3118.291"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="3131.8594">break</text><path d="M387,3140.6016 L387,3517.6016 L696,3517.6016 L696,3150.6016 L686,3140.6016 L387,3140.6016 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,3140.6016 L686,3150.6016 L696,3150.6016 L686,3140.6016 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="3158.1699">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3173.4805">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="3188.791">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="3204.1016">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="3219.4121">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="3234.7227">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="3250.0332">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="3265.3438">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="3280.6543">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="3295.9648">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="3311.2754">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="3326.5859">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="3341.8965">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="3357.207">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="441" y="3372.5176">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="441" y="3387.8281">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="3403.1387">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="3418.4492">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="457" y="3433.7598">status: "fail",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="3449.0703">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="3464.3809">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="3479.6914">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="3495.002">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3510.3125">}</text><polygon fill="#A80036" points="1257.5,3544.3652,1267.5,3548.3652,1257.5,3552.3652,1261.5,3548.3652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1263.5" y1="3548.3652" y2="3548.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3543.623">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="411" y="3543.623">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="277.5" x2="1924" y1="3601.3652" y2="3601.3652"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="282.5" y="3612">[action=='abort' Error callback]</text><path d="M287.5,3622.3203 L349.5,3622.3203 L349.5,3629.3203 L339.5,3639.3203 L287.5,3639.3203 L287.5,3622.3203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1193.5879" style="stroke: #000000; stroke-width: 2.0;" width="1626.5" x="287.5" y="3622.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="302.5" y="3635.8887">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="364.5" y="3634.9551">[Validation successful]</text><path d="M297.5,3646.6309 L754.5,3646.6309 L754.5,3653.6309 L744.5,3663.6309 L297.5,3663.6309 L297.5,3646.6309 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1606.5" x="297.5" y="3646.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="412" x="312.5" y="3660.1992">Persist Transfer State (with transferState='RECEIVED_ERROR')</text><polygon fill="#A80036" points="1395.5,3696.5625,1405.5,3700.5625,1395.5,3704.5625,1399.5,3700.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1401.5" y1="3700.5625" y2="3700.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3688.165">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="411" y="3680.5098">Request to persist transfer state and Error</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="3695.8203">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="3695.8203">2003</text><polygon fill="#A80036" points="1801.5,3725.873,1811.5,3729.873,1801.5,3733.873,1805.5,3729.873" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1417.5" x2="1807.5" y1="3729.873" y2="3729.873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1424.5" y="3725.1309">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1446.5" y="3725.1309">Persist transfer state and error information</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1753,3772.873,1884,3772.873,1894,3798.873,1884,3825.873,1753,3825.873,1743,3798.873,1753,3772.873" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1755" y="3789.4414">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1755" y="3804.752">transferError</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1755" y="3820.0625">transferExtension</text><polygon fill="#A80036" points="393,3849.1152,383,3853.1152,393,3857.1152,389,3853.1152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1406.5" y1="3853.1152" y2="3853.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="3848.373">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="3848.373">Return success</text><path d="M387,3873.1152 L387,4250.1152 L696,4250.1152 L696,3883.1152 L686,3873.1152 L387,3873.1152 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,3873.1152 L686,3883.1152 L696,3883.1152 L686,3873.1152 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="3890.6836">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3905.9941">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="3921.3047">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="3936.6152">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="3951.9258">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="3967.2363">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="3982.5469">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="3997.8574">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="4013.168">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="4028.4785">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="4043.7891">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="4059.0996">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="4074.4102">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="4089.7207">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="441" y="4105.0313">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="441" y="4120.3418">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="4135.6523">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="4150.9629">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="4166.2734">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="4181.584">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="4196.8945">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="4212.2051">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="4227.5156">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="4242.8262">}</text><polygon fill="#A80036" points="968,4276.8789,978,4280.8789,968,4284.8789,972,4280.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="974" y1="4280.8789" y2="4280.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4276.1367">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="411" y="4276.1367">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="287.5" x2="1914" y1="4319.8789" y2="4319.8789"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="274" x="292.5" y="4330.5137">[Validate Transfer Error Message not successful]</text><path d="M297.5,4340.834 L381.5,4340.834 L381.5,4347.834 L371.5,4357.834 L297.5,4357.834 L297.5,4340.834 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="1060.5" x="297.5" y="4340.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="312.5" y="4354.4023">break</text><path d="M387,4363.1445 L387,4740.1445 L696,4740.1445 L696,4373.1445 L686,4363.1445 L387,4363.1445 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,4363.1445 L686,4373.1445 L696,4373.1445 L686,4363.1445 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="4380.7129">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="4396.0234">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="4411.334">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="4426.6445">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="4441.9551">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="4457.2656">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="4472.5762">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="4487.8867">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="4503.1973">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="4518.5078">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="4533.8184">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="4549.1289">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="4564.4395">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="4579.75">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="441" y="4595.0605">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="441" y="4610.3711">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="4625.6816">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="4640.9922">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="457" y="4656.3027">status: "fail",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="4671.6133">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="4686.9238">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="4702.2344">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="4717.5449">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="4732.8555">}</text><polygon fill="#A80036" points="1257.5,4766.9082,1267.5,4770.9082,1257.5,4774.9082,1261.5,4770.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1263.5" y1="4770.9082" y2="4770.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4766.166">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="411" y="4766.166">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1984" y1="4830.9082" y2="4830.9082"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="4841.543">[Consume Batch Messages]</text><path d="M149,4849.8633 L149,4874.8633 L363,4874.8633 L363,4859.8633 L353,4849.8633 L149,4849.8633 " fill="#ADD8E6" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M353,4849.8633 L353,4859.8633 L363,4859.8633 L353,4849.8633 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="155" y="4867.4316">To be delivered by future story</text><!--
@startuml
title 2.2.1. Fulfil Handler Consume (Reject/Abort)
autonumber
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Event-Topic" as TOPIC_EVENT
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Failure)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Fulfil event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type == 'fulfil' && ( action IN ['reject','abort'] )\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT:  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg 9.1.0]]}
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature** {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg seq-signature-validation]]} \n<color #FF0000><b>Error codes:</b> 2001</color>
        end
        group Validate Transfer Fulfil Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> TRANS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            TRANS_DAO <- - DB: Return existing hashes
            deactivate DB
            TRANS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate TRANS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare each entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TRANS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                TRANS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate TRANS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error handling:</b> 3105</color>
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]]} \n
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end
        alt action=='reject' call made on PUT /transfers/{ID}
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> TRANS_DAO
            deactivate DB
            FULF_HANDLER <- - TRANS_DAO: Return transfer
            deactivate TRANS_DAO

            alt Fulfilment present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>

                group Persist fulfilment
                    FULF_HANDLER -> TRANS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferFulfilment
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            else Fulfilment NOT present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that transfer fulfilment message to Abort is valid\n<color #FF0000><b>Error code:</b> 2001</color>
                group Persist extensions
                    FULF_HANDLER -> TRANS_DAO: Persist extensionList elements\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            end

            alt Transfer.ilpCondition validate successful OR generic validation successful
                group Persist Transfer State (with transferState='RECEIVED_REJECT')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: reject,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note

                FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
                activate TOPIC_TRANSFER_POSITION
                deactivate TOPIC_TRANSFER_POSITION
            else Validate Fulfil Transfer not successful or Generic validation failed
                break
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: reject,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "fail",
                                        code: 1
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        else action=='abort' Error callback
            alt Validation successful
                group Persist Transfer State (with transferState='RECEIVED_ERROR')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state and Error\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state and error information
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                        transferError
                        transferExtension
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: abort,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note

                FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
                activate TOPIC_TRANSFER_POSITION
                deactivate TOPIC_TRANSFER_POSITION
            else Validate Transfer Error Message not successful
                break
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: abort,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "fail",
                                        code: 1
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>