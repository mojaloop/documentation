<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2006px" preserveAspectRatio="none" style="width:2255px;height:2006px;" version="1.1" viewBox="0 0 2255 2006" width="2255px" zoomAndPan="magnify"><defs><filter height="300%" id="fqpna23cs8hfx" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="363" x="947.25" y="23.5352">2.2.0. DFSP2 sends a Fulfil Reject Transfer request</text><rect fill="#D3D3D3" height="1961.1074" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="1961.1074" style="stroke: #A80036; stroke-width: 1.0;" width="564.5" x="397.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="601.25" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1961.1074" style="stroke: #A80036; stroke-width: 1.0;" width="1264.5" x="964" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1545.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451.5" y="828.9551"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="836.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1158" y="1276.7188"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1516" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1982.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1704.8438" style="stroke: #000000; stroke-width: 2.0;" width="2221.5" x="23" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2201.5" x="33" y="1711.0664"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="456.5" x2="456.5" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="841" x2="841" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1035" x2="1035" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1163" x2="1163" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1520.5" x2="1520.5" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1691.5" x2="1691.5" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1844.5" x2="1844.5" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1987.5" x2="1987.5" y1="153.7754" y2="1892.6191"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2150.5" x2="2150.5" y1="153.7754" y2="1892.6191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="1905.1543">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="1921.6426">Payer</text><ellipse cx="67.5" cy="1934.5957" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,1942.5957 L67.5,1969.5957 M54.5,1950.5957 L80.5,1950.5957 M67.5,1969.5957 L54.5,1984.5957 M67.5,1969.5957 L80.5,1984.5957 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="1905.1543">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="1921.6426">Payee</text><ellipse cx="126.5" cy="1934.5957" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,1942.5957 L126.5,1969.5957 M113.5,1950.5957 L139.5,1950.5957 M126.5,1969.5957 L113.5,1984.5957 M126.5,1969.5957 L139.5,1984.5957 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="401.5" y="150.8223">ML API Adapter</text><path d="M436,109.2871 L436,133.2871 M436,121.2871 L453,121.2871 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="465" cy="121.2871" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="401.5" y="1905.1543">ML API Adapter</text><path d="M436,1912.1074 L436,1936.1074 M436,1924.1074 L453,1924.1074 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="465" cy="1924.1074" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="725" y="150.8223">ML API Notification Event Handler</text><ellipse cx="841.5" cy="121.2871" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="837.5,109.2871,843.5,104.2871,841.5,109.2871,843.5,114.2871,837.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="725" y="1905.1543">ML API Notification Event Handler</text><ellipse cx="841.5" cy="1924.1074" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="837.5,1912.1074,843.5,1907.1074,841.5,1912.1074,843.5,1917.1074,837.5,1912.1074" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="968" y="150.8223">Central Service API</text><path d="M1014.5,109.2871 L1014.5,133.2871 M1014.5,121.2871 L1031.5,121.2871 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1043.5" cy="121.2871" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="968" y="1905.1543">Central Service API</text><path d="M1014.5,1912.1074 L1014.5,1936.1074 M1014.5,1924.1074 L1031.5,1924.1074 " fill="none" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1043.5" cy="1924.1074" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1116" y="114.2871"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1112" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1119" y="138.8223">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1116" y="1891.6191"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1112" y="1895.6191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1119" y="1916.1543">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1451.5" y="150.8223">Fulfil Event Handler</text><ellipse cx="1521" cy="121.2871" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1517,109.2871,1523,104.2871,1521,109.2871,1523,114.2871,1517,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="133" x="1451.5" y="1905.1543">Fulfil Event Handler</text><ellipse cx="1521" cy="1924.1074" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1517,1912.1074,1523,1907.1074,1521,1912.1074,1523,1917.1074,1517,1912.1074" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1604.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1600.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1607.5" y="138.8223">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1604.5" y="1891.6191"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="1600.5" y="1895.6191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="1607.5" y="1916.1543">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1796.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1792.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1799.5" y="138.8223">Event-Topic</text><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1796.5" y="1891.6191"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1792.5" y="1895.6191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1799.5" y="1916.1543">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1907.5" y="150.8223">Position Event Handler</text><ellipse cx="1987.5" cy="121.2871" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1983.5,109.2871,1989.5,104.2871,1987.5,109.2871,1989.5,114.2871,1983.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="1907.5" y="1905.1543">Position Event Handler</text><ellipse cx="1987.5" cy="1924.1074" fill="#FEFECE" filter="url(#fqpna23cs8hfx)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1983.5,1912.1074,1989.5,1907.1074,1987.5,1912.1074,1989.5,1917.1074,1983.5,1912.1074" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2081.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2077.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2084.5" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2081.5" y="1891.6191"/><rect fill="#FEFECE" filter="url(#fqpna23cs8hfx)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="2077.5" y="1895.6191"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="2084.5" y="1916.1543">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="548.6953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="451.5" y="828.9551"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="836.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="71.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1158" y="1276.7188"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1516" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="1719.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1982.5" y="163.7754"/><path d="M23,170.7754 L365,170.7754 L365,177.7754 L355,187.7754 L23,187.7754 L23,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1704.8438" style="stroke: #000000; stroke-width: 2.0;" width="2221.5" x="23" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="38" y="184.3438">DFSP2 sends a Fulfil Reject Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="168.5" y1="240.0176" y2="240.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168.5" x2="168.5" y1="240.0176" y2="253.0176"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="127.5" x2="168.5" y1="253.0176" y2="253.0176"/><polygon fill="#A80036" points="137.5,249.0176,127.5,253.0176,137.5,257.0176,133.5,253.0176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="219.9648">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="146.5" y="204.6543">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="146.5" y="219.9648">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="146.5" y="235.2754">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="230.5" y="235.2754">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="257.5" y="235.2754">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="329.5" y="235.2754">as inputs</text><path d="M131,266.0176 L131,306.0176 L438,306.0176 L438,276.0176 L428,266.0176 L131,266.0176 " fill="#ADD8E6" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M428,266.0176 L428,276.0176 L438,276.0176 L428,266.0176 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="137" y="283.5859">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="168" y="283.5859">: In the payload for PUT /transfers/&lt;ID&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="137" y="298.8965">only the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="298.8965">transferState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="283" y="298.8965">field is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="330" y="298.8965">required</text><path d="M131,320.6387 L131,743.6387 L472,743.6387 L472,330.6387 L462,320.6387 L131,320.6387 " fill="#FFFF00" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M462,320.6387 L462,330.6387 L472,330.6387 L462,320.6387 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="137" y="338.207">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="153" y="353.5176">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="153" y="368.8281">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="153" y="384.1387">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="399.4492">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="153" y="414.7598">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="153" y="430.0703">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="153" y="445.3809">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="153" y="460.6914">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="153" y="476.002">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="153" y="491.3125">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="506.623">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="521.9336"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="137" y="537.2441">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="552.5547">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="153" y="567.8652">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="153" y="583.1758">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="153" y="598.4863">"transferState": "ABORTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="153" y="613.7969">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="169" y="629.1074">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="185" y="644.418">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="201" y="659.7285">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="201" y="675.0391">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="185" y="690.3496">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="169" y="705.6602">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="153" y="720.9707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="736.2813">}</text><path d="M131,758.0234 L131,798.0234 L456,798.0234 L456,768.0234 L446,758.0234 L131,758.0234 " fill="#D3D3D3" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M446,758.0234 L446,768.0234 L456,768.0234 L446,758.0234 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="137" y="775.5918">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="273" x="168" y="775.5918">: Payee rejection reason should be captured</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="137" y="790.9023">in the extensionList within the payload.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="449.5" x2="439.5" y1="828.9551" y2="824.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="449.5" x2="439.5" y1="828.9551" y2="832.9551"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="450.5" y1="828.9551" y2="828.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="824.2129">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="146.5" y="824.2129">PUT - /transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="461.5" x2="503.5" y1="858.2656" y2="858.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="503.5" y1="858.2656" y2="871.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="462.5" x2="503.5" y1="871.2656" y2="871.2656"/><polygon fill="#A80036" points="472.5,867.2656,462.5,871.2656,472.5,875.2656,468.5,871.2656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="468.5" y="853.5234">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="481.5" y="853.5234">Validate incoming token and originator matching Payee</text><path d="M466,884.2656 L466,1246.2656 L775,1246.2656 L775,894.2656 L765,884.2656 L466,884.2656 " fill="#FFFF00" filter="url(#fqpna23cs8hfx)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M765,884.2656 L765,894.2656 L775,894.2656 L765,884.2656 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="472" y="901.834">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="472" y="917.1445">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="488" y="932.4551">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="488" y="947.7656">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="488" y="963.0762">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="488" y="978.3867">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="488" y="993.6973">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="504" y="1009.0078">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="504" y="1024.3184">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="488" y="1039.6289">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="488" y="1054.9395">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="504" y="1070.25">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="520" y="1085.5605">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="520" y="1100.8711">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="520" y="1116.1816">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="520" y="1131.4922">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="520" y="1146.8027">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="536" y="1162.1133">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="536" y="1177.4238">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="520" y="1192.7344">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="504" y="1208.0449">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="488" y="1223.3555">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="472" y="1238.666">}</text><polygon fill="#A80036" points="1146,1272.7188,1156,1276.7188,1146,1280.7188,1150,1276.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="461.5" x2="1152" y1="1276.7188" y2="1276.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="468.5" y="1271.9766">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="481.5" y="1271.9766">Route &amp; Publish Fulfil event for Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1168" x2="1210" y1="1306.0293" y2="1306.0293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1210" x2="1210" y1="1306.0293" y2="1319.0293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1169" x2="1210" y1="1319.0293" y2="1319.0293"/><polygon fill="#A80036" points="1179,1315.0293,1169,1319.0293,1179,1323.0293,1175,1319.0293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1175" y="1301.2871">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="1188" y="1301.2871">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="472.5,1344.3398,462.5,1348.3398,472.5,1352.3398,468.5,1348.3398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="466.5" x2="1162" y1="1348.3398" y2="1348.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="478.5" y="1343.5977">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="373" x="491.5" y="1343.5977">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1377.6504" y2="1373.6504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1377.6504" y2="1381.6504"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="126.5" x2="455.5" y1="1377.6504" y2="1377.6504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="143.5" y="1372.9082">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="156.5" y="1372.9082">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1174,1402.9609,1164,1406.9609,1174,1410.9609,1170,1406.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1168" x2="1515" y1="1406.9609" y2="1406.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1180" y="1402.2188">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1193" y="1402.2188">Consume message</text><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="787.5" x="1109" y="1414.9609"/><polygon fill="#EEEEEE" points="1109,1414.9609,1173,1414.9609,1173,1421.9609,1163,1431.9609,1109,1431.9609,1109,1414.9609" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1122" y="1429.5293">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1384.75" y="1448.5293">Fulfil Handler Consume (Reject/Abort)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1388.75" y="1463.8398"/><polygon fill="#A80036" points="1679.5,1493.2031,1689.5,1497.2031,1679.5,1501.2031,1683.5,1497.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1526" x2="1685.5" y1="1497.2031" y2="1497.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1533" y="1492.4609">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1546" y="1492.4609">Produce message</text><polygon fill="#A80036" points="1702.5,1547.5137,1692.5,1551.5137,1702.5,1555.5137,1698.5,1551.5137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1696.5" x2="1981.5" y1="1551.5137" y2="1551.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1708.5" y="1546.7715">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1730.5" y="1546.7715">Consume message</text><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="626" x="1597.5" y="1559.5137"/><polygon fill="#EEEEEE" points="1597.5,1559.5137,1661.5,1559.5137,1661.5,1566.5137,1651.5,1576.5137,1597.5,1576.5137,1597.5,1559.5137" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1610.5" y="1574.082">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="1804" y="1593.082">Position Handler Consume (Reject)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1808" y="1608.3926"/><polygon fill="#A80036" points="2139,1637.7559,2149,1641.7559,2139,1645.7559,2143,1641.7559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1992.5" x2="2145" y1="1641.7559" y2="1641.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1999.5" y="1637.0137">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2021.5" y="1637.0137">Produce message</text><polygon fill="#A80036" points="2139,1692.0664,2149,1696.0664,2139,1700.0664,2143,1696.0664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846.5" x2="2145" y1="1696.0664" y2="1696.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="853.5" y="1691.3242">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="875.5" y="1691.3242">Consume message</text><path d="M33,1711.0664 L100,1711.0664 L100,1718.0664 L90,1728.0664 L33,1728.0664 L33,1711.0664 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2201.5" x="33" y="1711.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="1724.6348">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="115" y="1723.7012">[action == 'reject']</text><rect fill="#FFFFFF" filter="url(#fqpna23cs8hfx)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2183.5" x="40" y="1753.377"/><polygon fill="#EEEEEE" points="40,1753.377,104,1753.377,104,1760.377,94,1770.377,40,1770.377,40,1753.377" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="1767.9453">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1013.75" y="1786.9453">Send notification to Participant (Payer)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1017.75" y="1802.2559"/><polygon fill="#A80036" points="78.5,1831.6191,68.5,1835.6191,78.5,1839.6191,74.5,1835.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="835.5" y1="1835.6191" y2="1835.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="1830.877">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="106.5" y="1830.877">Send callback notification</text><!--
@startuml
title 2.2.0. DFSP2 sends a Fulfil Reject Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENTS
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
group DFSP2 sends a Fulfil Reject Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #lightblue
        **Note**: In the payload for PUT /transfers/<ID>
        only the **transferState** field is **required**
    end note
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": "ABORTED",
            "extensionList": {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    note right of DFSP2 #lightgray
        **Note**: Payee rejection reason should be captured
        in the extensionList within the payload.
    end note
    DFSP2 ->> MLAPI: **PUT - /transfers/<ID>**
    
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: Route & Publish Fulfil event for Payee
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - ->> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_EVENTS: Fulfil Handler Consume (Reject/Abort)\n
    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_NOTIFICATIONS: Position Handler Consume (Reject)\n
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'reject'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer)\n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
end
activate POS_HANDLER
activate FULF_HANDLER
activate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>