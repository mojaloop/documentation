<svg xmlns="http://www.w3.org/2000/svg" height="3021" preserveAspectRatio="none" style="width:1877px;height:3021px" width="1877">
  <defs>
    <filter height="300%" id="a" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2"/>
      <feColorMatrix in="blurOut" result="blurOut2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3"/>
    </filter>
  </defs>
  <text font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="459" x="707" y="28.708">
    1.1.2.a. Position Handler Consume (single message)
  </text>
  <path fill="#FFFFE0" stroke="#a80036" d="M16 40.953h1790.5v2974.141H16z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="855.75" y="53.02">
    Central Service
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M102 177.648h10v30h-10zM423 132.383h10v2785.414h-10zM1178.5 1685.219h10v30h-10zM1178.5 2887.797h10v30h-10zM1307 560.109h10V680.64h-10zM1307 958.836h10v121.398h-10zM1307 1140.5h10v121.398h-10zM1307 1783.289h10v120.531h-10zM1307 2252.281h10v121.398h-10zM1421.5 709.773h10v135.664h-10zM1421.5 1932.953h10v135.664h-10zM1749.5 589.242h10v62.266h-10zM1749.5 738.906h10v77.398h-10zM1749.5 987.969h10v30h-10zM1749.5 1169.633h10v30h-10zM1749.5 1812.422h10v62.266h-10zM1749.5 1962.086h10v77.398h-10zM1749.5 2281.414h10v30h-10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M10 139.383h1853v2793.414H10z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M327.5 222.648H884v90.398H327.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M337.5 246.781H874v59.266H337.5zM337.5 327.047H1113v156.664H337.5zM327.5 497.711H1853v2428.086H327.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M337.5 521.844H1826v566.391H337.5zM337.5 1102.234H1843v167.664H337.5z"/>
  <path fill="#FFF" d="M327.5 1723.219H1853v1202.578H327.5z"/>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M337.5 1745.023H1826v454.992H337.5zM337.5 2214.016H1843v167.664H337.5z"/>
  <path stroke="#a80036" stroke-dasharray="5,5" d="M107 122.383v2827.414M427.5 122.383v2827.414M1051 122.383v2827.414M1183 122.383v2827.414M1312 122.383v2827.414M1426 122.383v2827.414M1754.5 122.383v2827.414"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M24 83.086h166v30.297H24z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M20 87.086h166v30.297H20z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="27" y="107.081">
    topic-transfer-position
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M24 2948.797h166v30.297H24z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M20 2952.797h166v30.297H20z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="27" y="2972.792">
    topic-transfer-position
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="347.5" y="119.081">
    Position Event Handler
  </text>
  <circle cx="428" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M424 78.086l6-5-2 5 2 5-6-5z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="347.5" y="2961.792">
    Position Event Handler
  </text>
  <circle cx="428" cy="2981.094" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path fill="#A80036" stroke="#a80036" d="M424 2969.094l6-5-2 5 2 5-6-5z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1003 83.086h96v30.297h-96z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M999 87.086h96v30.297h-96z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1006" y="107.081">
    Event-Topic
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1003 2948.797h96v30.297h-96z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M999 2952.797h96v30.297h-96z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1006" y="2972.792">
    Event-Topic
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1117 83.086h133v30.297h-133z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1113 87.086h133v30.297h-133z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1120" y="107.081">
    Notification-Topic
  </text>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1117 2948.797h133v30.297h-133z"/>
  <path fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="1.5" d="M1113 2952.797h133v30.297h-133z"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="1120" y="2972.792">
    Notification-Topic
  </text>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1264" y="119.081">
    Position DAO
  </text>
  <circle cx="1312" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1300 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1264" y="2961.792">
    Position DAO
  </text>
  <circle cx="1312" cy="2981.094" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1300 2995.094h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1370" y="119.081">
    Participant DAO
  </text>
  <circle cx="1426.5" cy="90.086" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1414.5 104.086h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="1370" y="2961.792">
    Participant DAO
  </text>
  <circle cx="1426.5" cy="2981.094" fill="#FEFECE" filter="url(#a)" stroke="#a80036" stroke-width="2" r="12"/>
  <path stroke="#a80036" stroke-width="2" d="M1414.5 2995.094h24"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1706.5" y="119.081">
    Central Store
  </text>
  <path d="M1736.5 70.086c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1736.5 70.086c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <text font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1706.5" y="2961.792">
    Central Store
  </text>
  <path d="M1736.5 2975.094c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10v-26" fill="#FEFECE" filter="url(#a)" stroke="#000" stroke-width="1.5"/>
  <path d="M1736.5 2975.094c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#000" stroke-width="1.5"/>
  <path fill="#FFF" filter="url(#a)" stroke="#a80036" d="M102 177.648h10v30h-10zM423 132.383h10v2785.414h-10zM1178.5 1685.219h10v30h-10zM1178.5 2887.797h10v30h-10zM1307 560.109h10V680.64h-10zM1307 958.836h10v121.398h-10zM1307 1140.5h10v121.398h-10zM1307 1783.289h10v120.531h-10zM1307 2252.281h10v121.398h-10zM1421.5 709.773h10v135.664h-10zM1421.5 1932.953h10v135.664h-10zM1749.5 589.242h10v62.266h-10zM1749.5 738.906h10v77.398h-10zM1749.5 987.969h10v30h-10zM1749.5 1169.633h10v30h-10zM1749.5 1812.422h10v62.266h-10zM1749.5 1962.086h10v77.398h-10zM1749.5 2281.414h10v30h-10z"/>
  <path d="M10 139.383h240v7l-10 10H10v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M10 139.383h1853v2793.414H10z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="25" y="152.45">
    Position Handler Consume
  </text>
  <path fill="#A80036" stroke="#a80036" d="M123 173.648l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" d="M117 177.648h305"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="129" y="172.583">
    1
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="142" y="172.583">
    Consume Position event message for Payer
  </text>
  <path d="M327.5 222.648h88v7l-10 10h-78v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M327.5 222.648H884v90.398H327.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="342.5" y="235.715">
    break
  </text>
  <path d="M337.5 246.781h152v7l-10 10h-142v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 246.781H874v59.266H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="352.5" y="259.848">
    Validate Event
  </text>
  <path stroke="#a80036" d="M433 285.047h42M475 285.047v13M434 298.047h41"/>
  <path fill="#A80036" stroke="#a80036" d="M444 294.047l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="440" y="279.981">
    2
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="453" y="279.981">
    Validate event - Rule: type == &apos;position&apos; &amp;&amp; action == &apos;prepare&apos;
  </text>
  <path d="M337.5 327.047h232v7l-10 10h-222v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 327.047H1113v156.664H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="352.5" y="340.114">
    Persist Event Information
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1039 386.313l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 390.313h612"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="440" y="385.247">
    3
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="453" y="385.247">
    Publish event information
  </text>
  <path fill="#FFF" filter="url(#a)" stroke="#000" stroke-width="2" d="M344.5 398.313H1102v55.398H344.5z"/>
  <path fill="#EEE" stroke="#000" stroke-width="2" d="M344.5 398.313h66v7l-10 10h-56v-17z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="357.5" y="412.379">
    ref
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="647.75" y="431.379">
    Event Handler Consume
  </text>
  <path d="M327.5 497.71h64v7l-10 10h-54v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M327.5 497.711H1853v2428.086H327.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="342.5" y="510.778">
    alt
  </text>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="300" x="406.5" y="509.921">
    [Calulate &amp; Validate Latest Position (success)]
  </text>
  <path d="M337.5 521.844h325v7l-10 10h-315v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 521.844H1826v566.391H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="280" x="352.5" y="534.911">
    Calculate position and persist change
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1295 556.11l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 560.109h868"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="440" y="555.043">
    4
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="453" y="555.043">
    Request latest position from DB for Payer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 585.242l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1317 589.242h426.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1324" y="584.176">
    5
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="1337" y="584.176">
    Retrieve latest position from DB for Payer
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1702 602.242h104l10 11-10 12h-104l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="1704" y="618.309">
    transferPosition
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1328 647.508l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1322 651.508h431.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1334" y="646.442">
    6
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="1347" y="646.442">
    Retrieve latest position from DB for Payer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 676.64l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 680.641h873"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="675.575">
    7
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="463" y="675.575">
    Return latest position
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1409.5 705.773l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 709.773h982.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="440" y="704.707">
    8
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="453" y="704.707">
    Request position limits for Payer Participant
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 734.906l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1431.5 738.906h312"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1438.5" y="733.84">
    9
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1451.5" y="733.84">
    Request position limits for Payer Participant
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1703 751.906h103l10 19-10 19h-103l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1705" y="767.973">
    participant
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1705" y="783.106">
    participantLimit
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1442.5 812.305l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1436.5 816.305h317"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1448.5" y="811.239">
    10
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1470.5" y="811.239">
    Return position limits
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 841.438l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 845.438h987.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="840.372">
    11
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="472" y="840.372">
    Return position limits
  </text>
  <path stroke="#a80036" d="M433 874.57h42M475 874.57v13M434 887.57h41"/>
  <path fill="#A80036" stroke="#a80036" d="M444 883.57l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="869.504">
    12
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="462" y="869.504">
    Calculate latest position (lpos) for prepare
  </text>
  <path stroke="#a80036" d="M433 916.703h42M475 916.703v13M434 929.703h41"/>
  <path fill="#A80036" stroke="#a80036" d="M444 925.703l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="911.637">
    13
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="577" x="462" y="911.637">
    Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1295 954.836l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 958.836h868"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="953.77">
    14
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="271" x="462" y="953.77">
    Request to persist latest position for Payer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 983.969l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1317 987.969h426.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1324" y="982.903">
    15
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="1346" y="982.903">
    Persist latest position to DB for Payer
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1702 1030.969h104l10 11-10 12h-104l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="1704" y="1047.036">
    transferPosition
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 1076.234l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 1080.234h873"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1075.168">
    16
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="472" y="1075.168">
    Return success
  </text>
  <path d="M337.5 1102.234h628v7l-10 10h-618v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 1102.234H1843v167.664H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="583" x="352.5" y="1115.301">
    Persist Transfer State (with transferState=&apos;RESERVED&apos; on position check pass)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1295 1136.5l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 1140.5h868"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="1135.434">
    17
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="462" y="1135.434">
    Request to persist transfer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 1165.633l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1317 1169.633h426.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1324" y="1164.567">
    18
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1346" y="1164.567">
    Persist transfer state
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1685 1212.633h138l10 11-10 12h-138l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1687" y="1228.7">
    transferStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 1257.898l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 1261.898h873"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1256.832">
    19
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="472" y="1256.832">
    Return success
  </text>
  <path d="M438 1281.898v373h270v-363l-10-10H438" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M698 1281.898v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="444" y="1298.965">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="444" y="1314.098">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="460" y="1329.231">
    id: &lt;transferMessage.transferId&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="460" y="1344.364">
    from: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="460" y="1359.497">
    to: &lt;transferMessage.payeeFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="460" y="1374.629">
    type: application/json
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="460" y="1389.762">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="476" y="1404.895">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="476" y="1420.028">
    payload: &lt;transferMessage&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="460" y="1435.161">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="460" y="1450.293">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="476" y="1465.426">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="492" y="1480.559">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="492" y="1495.692">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="492" y="1510.825">
    type: transfer,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="492" y="1525.957">
    action: prepare,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="492" y="1541.09">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="492" y="1556.223">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="508" y="1571.356">
    status: &quot;success&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="508" y="1586.489">
    code: 0
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="492" y="1601.622">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="476" y="1616.754">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="460" y="1631.887">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="444" y="1647.02">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1166.5 1681.219l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 1685.219h739.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="1680.153">
    20
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="462" y="1680.153">
    Publish Notification event to Payee
  </text>
  <path stroke="#000" stroke-dasharray="2,2" d="M327.5 1724.219H1853"/>
  <text font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="298" x="332.5" y="1734.429">
    [Calculate &amp; Validate Latest Position (failure)]
  </text>
  <path d="M337.5 1745.023h325v7l-10 10h-315v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 1745.023H1826v454.992H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="280" x="352.5" y="1758.09">
    Calculate position and persist change
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1295 1779.29l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 1783.289h868"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="1778.223">
    21
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="462" y="1778.223">
    Request latest position from DB for Payer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 1808.422l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1317 1812.422h426.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1324" y="1807.356">
    22
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="1346" y="1807.356">
    Retrieve latest position from DB for Payer
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1702 1825.422h104l10 11-10 12h-104l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="1704" y="1841.489">
    transferPosition
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1328 1870.688l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1322 1874.688h431.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1334" y="1869.622">
    23
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="1356" y="1869.622">
    Retrieve latest position from DB for Payer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 1899.82l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 1903.82h873"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1898.754">
    24
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="472" y="1898.754">
    Return latest position
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1409.5 1928.953l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 1932.953h982.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="1927.887">
    25
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="462" y="1927.887">
    Request position limits for Payer Participant
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 1958.086l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1431.5 1962.086h312"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1438.5" y="1957.02">
    26
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="1460.5" y="1957.02">
    Request position limits for Payer Participant
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1703 1975.086h103l10 19-10 19h-103l-10-19 10-19z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1705" y="1991.153">
    participant
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1705" y="2006.286">
    participantLimit
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1442.5 2035.484l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M1436.5 2039.484h317"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1448.5" y="2034.418">
    27
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1470.5" y="2034.418">
    Return position limits
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 2064.617l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 2068.617h987.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="2063.551">
    28
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="472" y="2063.551">
    Return position limits
  </text>
  <path stroke="#a80036" d="M433 2097.75h42M475 2097.75v13M434 2110.75h41"/>
  <path fill="#A80036" stroke="#a80036" d="M444 2106.75l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="2092.684">
    29
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="462" y="2092.684">
    Calculate latest position (lpos) for prepare
  </text>
  <path stroke="#a80036" d="M433 2139.883h42M475 2139.883v13M434 2152.883h41"/>
  <path fill="#A80036" stroke="#a80036" d="M444 2148.883l-10 4 10 4-4-4z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="2134.817">
    30
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="577" x="462" y="2134.817">
    Validate Calculated latest position against the net-debit cap (netcap) - Rule: lpos &lt; netcap
  </text>
  <path d="M438 2165.883v25h132v-15l-10-10H438" fill="red" filter="url(#a)" stroke="#a80036"/>
  <path d="M560 2165.883v10h10l-10-10" fill="red" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="444" y="2182.95">
    Validation failure!
  </text>
  <path d="M337.5 2214.016h620v7l-10 10h-610v-17" fill="#EEE" stroke="#000"/>
  <path fill="none" stroke="#000" stroke-width="2" d="M337.5 2214.016H1843v167.664H337.5z"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="575" x="352.5" y="2227.082">
    Persist Transfer State (with transferState=&apos;ABORTED&apos; on position check pass)
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1295 2248.281l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 2252.281h868"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="2247.215">
    31
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="462" y="2247.215">
    Request to persist transfer
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1737.5 2277.414l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M1317 2281.414h426.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1324" y="2276.348">
    32
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1346" y="2276.348">
    Persist transfer state
  </text>
  <path fill="#FFFFE0" filter="url(#a)" stroke="#a80036" d="M1685 2324.414h138l10 11-10 12h-138l-10-12 10-11z"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="1687" y="2340.481">
    transferStateChange
  </text>
  <path fill="#A80036" stroke="#a80036" d="M444 2369.68l-10 4 10 4-4-4z"/>
  <path stroke="#a80036" stroke-dasharray="2,2" d="M438 2373.68h873"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="2368.614">
    33
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="472" y="2368.614">
    Return success
  </text>
  <path d="M438 2393.68v463h408v-453l-10-10H438" fill="#FF0" filter="url(#a)" stroke="#a80036"/>
  <path d="M836 2393.68v10h10l-10-10" fill="#FF0" stroke="#a80036"/>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="444" y="2410.747">
    Message:
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="444" y="2425.879">
    {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="460" y="2441.012">
    id: &lt;transferMessage.transferId&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="460" y="2456.145">
    from: &lt;ledgerName&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="460" y="2471.278">
    to: &lt;transferMessage.payerFsp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="460" y="2486.411">
    type: application/json
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="460" y="2501.544">
    content: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="476" y="2516.676">
    headers: &lt;transferHeaders&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="476" y="2531.809">
    payload: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="492" y="2546.942">
    &quot;errorInformation&quot;: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="508" y="2562.075">
    &quot;errorCode&quot;: 4001,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="508" y="2577.207">
    &quot;errorDescription&quot;: &quot;Payer FSP insufficient liquidity&quot;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="508" y="2592.34">
    &quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="476" y="2607.473">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="460" y="2622.606">
    },
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="460" y="2637.739">
    metadata: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="476" y="2652.872">
    event: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="492" y="2668.004">
    id: &lt;uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="492" y="2683.137">
    responseTo: &lt;previous.uuid&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="492" y="2698.27">
    type: notification,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="492" y="2713.403">
    action: prepare,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="492" y="2728.536">
    createdAt: &lt;timestamp&gt;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="492" y="2743.669">
    state: {
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="508" y="2758.801">
    status: &apos;error&apos;,
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="508" y="2773.934">
    code: &lt;errorInformation.errorCode&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="508" y="2789.067">
    description: &lt;errorInformation.errorDescription&gt;
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="492" y="2804.2">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="476" y="2819.332">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="460" y="2834.465">
    }
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="444" y="2849.598">
    }
  </text>
  <path fill="#A80036" stroke="#a80036" d="M1166.5 2883.797l10 4-10 4 4-4z"/>
  <path stroke="#a80036" d="M433 2887.797h739.5"/>
  <text font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="440" y="2882.731">
    34
  </text>
  <text font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="462" y="2882.731">
    Publish Notification (failure) event for Payer
  </text>
</svg>
