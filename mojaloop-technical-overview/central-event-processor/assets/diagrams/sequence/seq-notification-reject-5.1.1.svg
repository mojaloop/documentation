<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1312px" preserveAspectRatio="none" style="width:1461px;height:1312px;" version="1.1" viewBox="0 0 1461 1312" width="1461px" zoomAndPan="magnify"><defs><filter height="300%" id="fvdf2hiuhqdpy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="294" x="584.75" y="23.5352">5.1.1. Notification Handler for Rejections</text><rect fill="#D3D3D3" height="1266.9512" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="1266.9512" style="stroke: #A80036; stroke-width: 1.0;" width="241" x="280" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="322" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="1266.9512" style="stroke: #A80036; stroke-width: 1.0;" width="414" x="1030.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1187" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="1025.6875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1226" y="323.6387"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1226" y="1036.2207"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="224.707"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="1010.6875" style="stroke: #000000; stroke-width: 2.0;" width="1398" x="52.5" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="137.5527" style="stroke: #000000; stroke-width: 2.0;" width="1019.5" x="274" y="269.707"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="753.2031" style="stroke: #000000; stroke-width: 2.0;" width="1231" x="62.5" y="421.2598"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="827.5" x="274" y="445.5703"/><rect fill="#FFFFFF" height="320.9922" style="stroke: none; stroke-width: 1.0;" width="1231" x="62.5" y="853.4707"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="96.5" x2="96.5" y1="153.7754" y2="1198.4629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="400" x2="400" y1="153.7754" y2="1198.4629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1101.5" x2="1101.5" y1="153.7754" y2="1198.4629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1230.5" x2="1230.5" y1="153.7754" y2="1198.4629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1366.5" x2="1366.5" y1="153.7754" y2="1198.4629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="72.5" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="75.5" y="150.8223">Payer</text><ellipse cx="97" cy="63.7988" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M97,71.7988 L97,98.7988 M84,79.7988 L110,79.7988 M97,98.7988 L84,113.7988 M97,98.7988 L110,113.7988 " fill="none" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="72.5" y="1210.998">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="75.5" y="1227.4863">Payer</text><ellipse cx="97" cy="1240.4395" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M97,1248.4395 L97,1275.4395 M84,1256.4395 L110,1256.4395 M97,1275.4395 L84,1290.4395 M97,1275.4395 L110,1290.4395 " fill="none" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="284" y="150.8223">ML API Notification Event Handler</text><ellipse cx="400.5" cy="121.2871" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="396.5,109.2871,402.5,104.2871,400.5,109.2871,402.5,114.2871,396.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="284" y="1210.998">ML API Notification Event Handler</text><ellipse cx="400.5" cy="1229.9512" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="396.5,1217.9512,402.5,1212.9512,400.5,1217.9512,402.5,1222.9512,396.5,1217.9512" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1034.5" y="150.8223">Central Service API</text><path d="M1081,109.2871 L1081,133.2871 M1081,121.2871 L1098,121.2871 " fill="none" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1110" cy="121.2871" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1034.5" y="1210.998">Central Service API</text><path d="M1081,1217.9512 L1081,1241.9512 M1081,1229.9512 L1098,1229.9512 " fill="none" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1110" cy="1229.9512" fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1182.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1178.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1185.5" y="138.8223">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1182.5" y="1197.4629"/><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1178.5" y="1201.4629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1185.5" y="1221.998">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1297.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1293.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1300.5" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1297.5" y="1197.4629"/><rect fill="#FEFECE" filter="url(#fvdf2hiuhqdpy)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1293.5" y="1201.4629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1300.5" y="1221.998">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="1025.6875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="395.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1226" y="323.6387"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1226" y="1036.2207"/><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1362" y="224.707"/><path d="M52.5,170.7754 L269.5,170.7754 L269.5,177.7754 L259.5,187.7754 L52.5,187.7754 L52.5,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1010.6875" style="stroke: #000000; stroke-width: 2.0;" width="1398" x="52.5" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="67.5" y="184.3438">DFSP Notified of Rejection</text><polygon fill="#A80036" points="1350,220.707,1360,224.707,1350,228.707,1354,224.707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="1356" y1="224.707" y2="224.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="412.5" y="212.3096">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="425.5" y="204.6543">Consume Notification event message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.5" y="219.9648"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="429.5" y="219.9648">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="506.5" y="219.9648">2001</text><path d="M274,269.707 L489,269.707 L489,276.707 L479,286.707 L274,286.707 L274,269.707 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="137.5527" style="stroke: #000000; stroke-width: 2.0;" width="1019.5" x="274" y="269.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="289" y="283.2754">Persist Event Information</text><polygon fill="#A80036" points="1214,319.6387,1224,323.6387,1214,327.6387,1218,323.6387" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="1220" y1="323.6387" y2="323.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="412.5" y="311.2412">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="425.5" y="303.5859">Publish event information</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.5" y="318.8965"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="429.5" y="318.8965">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="506.5" y="318.8965">3201</text><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="107" x="1175.5" y="361.6387"/><polygon fill="#EEEEEE" points="1175.5,361.6387,1239.5,361.6387,1239.5,368.6387,1229.5,378.6387,1175.5,378.6387,1175.5,361.6387" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1188.5" y="376.207">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1187.5" y="395.207">Event Handler</text><path d="M62.5,421.2598 L124.5,421.2598 L124.5,428.2598 L114.5,438.2598 L62.5,438.2598 L62.5,421.2598 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="753.2031" style="stroke: #000000; stroke-width: 2.0;" width="1231" x="62.5" y="421.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="77.5" y="434.8281">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="139.5" y="433.8945">[consume a single messages]</text><path d="M274,445.5703 L416,445.5703 L416,452.5703 L406,462.5703 L274,462.5703 L274,445.5703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="827.5" x="274" y="445.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="289" y="459.1387">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="447.5" y1="484.1914" y2="484.1914"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="447.5" y1="484.1914" y2="497.1914"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="447.5" y1="497.1914" y2="497.1914"/><polygon fill="#A80036" points="416.5,493.1914,406.5,497.1914,416.5,501.1914,412.5,497.1914" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="412.5" y="479.4492">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="664" x="425.5" y="479.4492">Validate event - Rule: type == 'notification' &amp;&amp; [action IN ['reject', 'timeout-received', 'timeout-reserved']]</text><polygon fill="#A80036" points="1089.5,544.8125,1099.5,548.8125,1089.5,552.8125,1093.5,548.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="1095.5" y1="548.8125" y2="548.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="412.5" y="536.415">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="425.5" y="528.7598">Request Participant Callback details</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.5" y="544.0703"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="429.5" y="544.0703">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="506.5" y="544.0703">3201</text><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="886.5" x="281" y="556.8125"/><polygon fill="#EEEEEE" points="281,556.8125,345,556.8125,345,563.8125,335,573.8125,281,573.8125,281,556.8125" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294" y="571.3809">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="627.25" y="590.3809">Get Participant Callback Details</text><polygon fill="#A80036" points="416.5,619.7441,406.5,623.7441,416.5,627.7441,412.5,623.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="410.5" x2="1100.5" y1="623.7441" y2="623.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="422.5" y="619.002">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="435.5" y="619.002">Return Participant Callback details</text><path d="M77,636.7441 L77,799.7441 L386,799.7441 L386,646.7441 L376,636.7441 L77,636.7441 " fill="#FFFF00" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M376,636.7441 L376,646.7441 L386,646.7441 L376,636.7441 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="83" y="654.3125">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="83" y="669.623">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="99" y="684.9336">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="99" y="700.2441">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="99" y="715.5547">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="99" y="730.8652">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="99" y="746.1758">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="115" y="761.4863">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="99" y="776.7969">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="83" y="792.1074">}</text><polygon fill="#A80036" points="108,841.4707,98,845.4707,108,849.4707,104,845.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="102" x2="394.5" y1="845.4707" y2="845.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="114" y="833.0732">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="127" y="825.418">Send Callback Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="131" y="840.7285"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="131" y="840.7285">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="208" y="840.7285">1000, 1001, 3002</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="1293.5" y1="854.4707" y2="854.4707"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="67.5" y="865.1055">[Validate rule type != 'notification' / Error]</text><path d="M410,873.4258 L410,990.4258 L692,990.4258 L692,883.4258 L682,873.4258 L410,873.4258 " fill="#FFFF00" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M682,873.4258 L682,883.4258 L692,883.4258 L682,873.4258 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="416" y="890.9941">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="416" y="906.3047">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="432" y="921.6152">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="448" y="936.9258">"errorCode": &lt;errorCode&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="448" y="952.2363">"errorDescription": &lt;ErrorMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="432" y="967.5469">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="416" y="982.8574">}</text><polygon fill="#A80036" points="1214,1032.2207,1224,1036.2207,1214,1040.2207,1218,1036.2207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="1220" y1="1036.2207" y2="1036.2207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="412.5" y="1023.8232">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="425.5" y="1016.168">Invalid messages retrieved from the Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.5" y="1031.4785"/><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="429.5" y="1031.4785">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="506.5" y="1031.4785">3201</text><rect fill="#FFFFFF" filter="url(#fvdf2hiuhqdpy)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="107" x="1175.5" y="1074.2207"/><polygon fill="#EEEEEE" points="1175.5,1074.2207,1239.5,1074.2207,1239.5,1081.2207,1229.5,1091.2207,1175.5,1091.2207,1175.5,1074.2207" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1188.5" y="1088.7891">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1187.5" y="1107.7891">Event Handler</text><path d="M410,1124.8418 L410,1164.8418 L695,1164.8418 L695,1134.8418 L685,1124.8418 L410,1124.8418 " fill="#ADD8E6" filter="url(#fvdf2hiuhqdpy)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M685,1124.8418 L685,1134.8418 L695,1134.8418 L685,1124.8418 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="416" y="1142.4102">Log ERROR Messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="416" y="1157.7207">Update Event log upon ERROR notification</text><!--
@startuml
title 5.1.1. Notification Handler for Rejections

autonumber



actor "DFSP1\nPayer" as DFSP1
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Event-Topic" as TOPIC_EVENT
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
end box


group DFSP Notified of Rejection
    activate NOTIFY_HANDLER
        NOTIFY_HANDLER -> TOPIC_NOTIFICATIONS: Consume Notification event message \n <color #FF0000><b>Error code:</b> 2001 </color>
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
            group Persist Event Information
                NOTIFY_HANDLER -> TOPIC_EVENT: Publish event information \n <color #FF0000><b>Error code:</b> 3201 </color>
                activate TOPIC_EVENT
	            ref over TOPIC_EVENT :  Event Handler
                deactivate TOPIC_EVENT
            end

    alt consume a single messages
        group Validate Event
            NOTIFY_HANDLER <-> NOTIFY_HANDLER: Validate event - Rule: type == 'notification' && [action IN ['reject', 'timeout-received', 'timeout-reserved']]
        end
        NOTIFY_HANDLER -> CSAPI: Request Participant Callback details \n <color #FF0000><b>Error code:</b> 3201 </color>
        ref over NOTIFY_HANDLER, CSAPI: Get Participant Callback Details
        NOTIFY_HANDLER <- - CSAPI: Return Participant Callback details
        note left of NOTIFY_HANDLER #yellow
            Message:
            {
                id: <ID>,
                from: <transferHeaders.FSPIOP-Source>,
                to: <transferHeaders.FSPIOP-Destination>,
                type: application/json,
                content: {
                    payload: <transferMessage>
                },
            }
        end note
        NOTIFY_HANDLER - -> DFSP1: Send Callback Notification \n <color #FF0000><b>Error code:</b> 1000, 1001, 3002 </color>
    else Validate rule type != 'notification' / Error
        note right of NOTIFY_HANDLER #yellow
            Message:
            {
                "errorInformation": {
                    "errorCode": <errorCode>,
                    "errorDescription": <ErrorMessage>,
                }
            }
        end note
        NOTIFY_HANDLER -> TOPIC_EVENT: Invalid messages retrieved from the Notification Topic \n <color #FF0000><b>Error code:</b> 3201 </color>
        activate TOPIC_EVENT
        deactivate TOPIC_EVENT
        ref over TOPIC_EVENT: Event Handler
        note right of NOTIFY_HANDLER #lightblue
            Log ERROR Messages
            Update Event log upon ERROR notification
        end note
    end
end
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>