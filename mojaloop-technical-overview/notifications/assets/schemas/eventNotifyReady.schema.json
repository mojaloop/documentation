{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "http://mojaloop.io/events/notifications/NotifyReady",
    "type": "object",
    "title": "NotifyReady",
    "description": "Notification Ready event produced by a Callback Handler",
    "default": {},
    "examples": [
        {
            "msgId": "18efb9ea-d29a-42b9-9b30-59e1e7cfe216",
            "msgKey": "861b86e6-c3da-48b3-ba17-896710287d1f",
            "msgName": "NotifyReady",
            "msgType": "Domain",
            "msgTopic": "NotificationEvents",
            "msgPartition": null,
            "msgTimestamp": 1607677081837,
            "aggregateName": "Notifications",
            "aggregateId": "861b86e6-c3da-48b3-ba17-896710287d1f",
            "notifyId": "3920382d-f78c-4023-adf9-0d7a4a2a3a2f",
            "notifyType": "transferFulfiled",
            "transport": {
                "type": "HTTP",
                "method": "GET",
                "contentType": "application/vnd.interoperability.transfers+json;version=1.0",
                "recipient": {
                    "endpoint": "http://fsp.com/parties/{{partyIdType}}/{{partyId}}}?key={{value}}",
                    "params": {
                        "partyIdType": "MSISDN",
                        "partyId": "12345",
                        "value": "ABCD"
                    }
                },
                "options": {
                    "deliveryReport": true,
                    "retry": {
                        "count": 3,
                        "type": "noDelay|exponentialDelay",
                        "condition": "isNetworkError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                    },
                    "expiration": 2000
                }
            },
            "payload": {
                "headers": {
                    "content-type": "application/vnd.interoperability.transfers+json;version=1.0",
                    "date": "2019-05-28T16:34:41.000Z",
                    "fspiop-source": "payeefsp",
                    "fspiop-destination": "payerfsp"
                },
                "body": "data:application/vnd.interoperability.transfers+json;version=1.0;base64,ewogICJmdWxmaWxtZW50IjogIlVObEo5OGhaVFlfZHN3MGNBcXc0aV9VTjN2NHV0dDdDWkZCNHlmTGJWRkEiLAogICJjb21wbGV0ZWRUaW1lc3RhbXAiOiAiMjAxOS0wNS0yOVQyMzoxODozMi44NTZaIiwKICAidHJhbnNmZXJTdGF0ZSI6ICJDT01NSVRURUQiCn0"
            },
            "traceInfo": {
                "traceParent": "00-8e540e87060d56a2d2e0be5d732791e7-d96a5971b7c5cac6-21",
                "traceState": "acmevendor=eyJzcGFuSWQiOiJkOTZhNTk3MWI3YzVjYWM2IiwidGltZUFwaVByZXBhcmUiOiIxNjA3Njc3MDgxNzAwIiwidGltZUFwaUZ1bGZpbCI6IjE2MDc2NzcwODE4MTkifQ==",
                "service": "notification-evt-handler",
                "startTimestamp": 1607677081837,
                "finishTimestamp": 2007677081838
            }
        }
    ],
    "required": [
        "msgId",
        "msgKey",
        "msgName",
        "msgType",
        "msgTopic",
        "msgTimestamp",
        "aggregateName",
        "aggregateId",
        "notifyId",
        "transport",
        "payload",
        "traceInfo"
    ],
    "properties": {
        "msgId": {
            "$id": "#/properties/msgId",
            "type": "string",
            "title": "The msgId schema",
            "description": "Unique identifier for this message. Generated by the NotificationEvtHandler.",
            "default": "",
            "examples": [
                "18efb9ea-d29a-42b9-9b30-59e1e7cfe216"
            ]
        },
        "msgKey": {
            "$id": "#/properties/msgKey",
            "type": "string",
            "title": "The msgKey schema",
            "description": "Mapped from the aggregateId, used by Kafka for Key-partitioning.",
            "default": "",
            "examples": [
                "861b86e6-c3da-48b3-ba17-896710287d1f"
            ]
        },
        "msgName": {
            "$id": "#/properties/msgName",
            "type": "string",
            "title": "The msgName schema",
            "description": "Name of the message.",
            "default": "NotifyReady",
            "examples": [
                "NotifyCmd",
                "NotifyReady",
                "NotifyReport"
            ]
        },
        "msgType": {
            "$id": "#/properties/msgType",
            "type": "string",
            "title": "The msgType schema",
            "description": "Type of message.",
            "default": "",
            "examples": [
                "Command",
                "Domain"
            ]
        },
        "msgTopic": {
            "$id": "#/properties/msgTopic",
            "type": "string",
            "title": "The msgTopic schema",
            "description": "Topic that the message will be published & consumed from.",
            "default": "",
            "examples": [
                "NotificationCommands"
            ]
        },
        "msgPartition": {
            "$id": "#/properties/msgPartition",
            "type": "null",
            "title": "The msgPartition schema",
            "description": "Optional Kafka partition used for publishing the message to the msgTopic.",
            "default": null,
            "examples": [
                null
            ]
        },
        "msgTimestamp": {
            "$id": "#/properties/msgTimestamp",
            "type": "integer",
            "title": "The msgTimestamp schema",
            "description": "Epoch/Unix timestamp of message creation.",
            "default": 0,
            "examples": [
                1607677081837
            ]
        },
        "aggregateName": {
            "$id": "#/properties/aggregateName",
            "type": "string",
            "title": "The aggregateName schema",
            "description": "Aggregate name",
            "default": "",
            "examples": [
                "Notifications"
            ]
        },
        "aggregateId": {
            "$id": "#/properties/aggregateId",
            "type": "string",
            "title": "The aggregateId schema",
            "description": "Aggregate identifier",
            "default": "",
            "examples": [
                "861b86e6-c3da-48b3-ba17-896710287d1f"
            ]
        },
        "notifyId": {
            "$id": "#/properties/notifyId",
            "type": "string",
            "title": "The notifyId schema",
            "description": "Correlation identifier for the event that triggerd this Notification",
            "default": "",
            "examples": [
                "3920382d-f78c-4023-adf9-0d7a4a2a3a2f"
            ]
        },
        "notifyType": {
            "$id": "#/properties/notifyType",
            "type": "string",
            "title": "The notifyType schema",
            "description": "Name of process/event that triggered this this Notification",
            "default": "",
            "examples": [
                "transferPrepared",
                "transferFulfiled",
                "transferAborted",
                "transferTimedout"
            ]
        },
        "transport": {
            "$id": "#/properties/transport",
            "type": "object",
            "title": "The transport schema",
            "description": "Transport specifics for the Notification",
            "default": {},
            "examples": [
                {
                    "type": "HTTP",
                    "method": "GET",
                    "contentType": "application/vnd.interoperability.transfers+json;version=1.0",
                    "recipient": {
                        "endpoint": "http://fsp.com/parties/{{partyIdType}}/{{partyId}}}?key={{value}}",
                        "params": {
                            "partyIdType": "MSISDN",
                            "partyId": "12345",
                            "value": "ABCD"
                        }
                    },
                    "options": {
                        "deliveryReport": true,
                        "retry": {
                            "count": 3,
                            "type": "noDelay|exponentialDelay",
                            "condition": "isNetworkError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                        }
                    }
                }
            ],
            "required": [
                "type",
                "method",
                "contentType",
                "recipient"
            ],
            "properties": {
                "type": {
                    "$id": "#/properties/transport/properties/type",
                    "type": "string",
                    "title": "The type schema",
                    "description": "The transport type.",
                    "default": "",
                    "examples": [
                        "HTTP"
                    ]
                },
                "method": {
                    "$id": "#/properties/transport/properties/method",
                    "type": "string",
                    "title": "The method schema",
                    "description": "The method associated to the transport.",
                    "default": "",
                    "examples": [
                        "GET"
                    ]
                },
                "contentType": {
                    "$id": "#/properties/transport/properties/contentType",
                    "type": "string",
                    "title": "The contentType schema",
                    "description": "The Content Type used to determine the API language and version.",
                    "default": "",
                    "examples": [
                        "application/vnd.interoperability.transfers+json;version=1.0"
                    ]
                },
                "recipient": {
                    "$id": "#/properties/transport/properties/recipient",
                    "type": "object",
                    "title": "The recipient schema",
                    "description": "The Recipient information for the Notification.",
                    "default": {},
                    "examples": [
                        {
                            "endpoint": "http://fsp.com/parties/{{partyIdType}}/{{partyId}}}?key={{value}}",
                            "params": {
                                "partyIdType": "MSISDN",
                                "partyId": "12345",
                                "value": "ABCD"
                            }
                        }
                    ],
                    "required": [
                        "endpoint"
                    ],
                    "properties": {
                        "endpoint": {
                            "$id": "#/properties/transport/properties/recipient/properties/endpoint",
                            "type": "string",
                            "title": "The endpoint schema",
                            "description": "The transport specific endpoint for the Notification delivery.",
                            "default": "",
                            "examples": [
                                "http://fsp.com/parties/{{partyIdType}}/{{partyId}}}?key={{value}}"
                            ]
                        },
                        "params": {
                            "$id": "#/properties/transport/properties/recipient/properties/params",
                            "type": "object",
                            "title": "The params schema",
                            "description": "Optional params that can be used by the Notification Command Handler for routing/processing, or alternatively used to render the endpoint if it is represented as a template.",
                            "default": {},
                            "examples": [
                                {
                                    "partyIdType": "MSISDN",
                                    "partyId": "12345",
                                    "value": "ABCD"
                                }
                            ],
                            "required": [],
                            "additionalProperties": {"type": "string"}
                        }
                    },
                    "additionalProperties": true
                },
                "options": {
                    "$id": "#/properties/transport/properties/options",
                    "type": "object",
                    "title": "The options schema",
                    "description": "The Notification options.",
                    "default": {},
                    "examples": [
                        {
                            "deliveryReport": true,
                            "retry": {
                                "count": 3,
                                "type": "noDelay|exponentialDelay",
                                "condition": "isNetworkError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                            }
                        }
                    ],
                    "required": [
                        "deliveryReport"
                    ],
                    "properties": {
                        "deliveryReport": {
                            "$id": "#/properties/transport/properties/options/properties/deliveryReport",
                            "type": "boolean",
                            "title": "The deliveryReport schema",
                            "description": "Indicates if a delivery report is required.",
                            "default": false,
                            "examples": [
                                true
                            ]
                        },
                        "retry": {
                            "$id": "#/properties/transport/properties/options/properties/retry",
                            "type": "object",
                            "title": "The retry schema",
                            "description": "Retry options.",
                            "default": {},
                            "examples": [
                                {
                                    "count": 3,
                                    "type": "noDelay|exponentialDelay",
                                    "condition": "isNetworkError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                                }
                            ],
                            "required": [
                                "count",
                                "type",
                                "condition"
                            ],
                            "properties": {
                                "count": {
                                    "$id": "#/properties/transport/properties/options/properties/retry/properties/count",
                                    "type": "integer",
                                    "title": "The count schema",
                                    "description": "The number of retry attempts.",
                                    "default": 3,
                                    "examples": [
                                        3
                                    ]
                                },
                                "type": {
                                    "$id": "#/properties/transport/properties/options/properties/retry/properties/type",
                                    "type": "string",
                                    "title": "The type schema",
                                    "description": "The type of retry policy. Ref:  https://developers.google.com/analytics/devguides/reporting/core/v3/errors#backoff",
                                    "default": "exponentialDelay",
                                    "examples": [
                                        "noDelay|exponentialDelay"
                                    ]
                                },
                                "condition": {
                                    "$id": "#/properties/transport/properties/options/properties/retry/properties/condition",
                                    "type": "string",
                                    "title": "The condition schema",
                                    "description": "The condition for retries. By default retries will occur on a network error or a 5xx error on an idempotent request (GET, HEAD, OPTIONS, PUT or DELETE)",
                                    "default": "isNetworkOrIdempotentRequestError",
                                    "examples": [
                                        "isNetworkError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                                    ]
                                }
                            },
                            "additionalProperties": false
                        },
                        "expiration": {
                            "$id": "#/properties/transport/properties/options/properties/expiration",
                            "type": "integer",
                            "title": "The expiration schema",
                            "description": "The relative expiration value. 0 is indicates that there is no expiration.",
                            "default": 0,
                            "examples": [
                                2000
                            ]
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "payload": {
            "$id": "#/properties/payload",
            "type": "object",
            "title": "The payload schema",
            "description": "The payload of the notification which includes a Header (if applicable) and Body.",
            "default": {},
            "examples": [
                {
                    "headers": {
                        "content-type": "application/vnd.interoperability.transfers+json;version=1.0",
                        "date": "2019-05-28T16:34:41.000Z",
                        "fspiop-source": "payerfsp",
                        "fspiop-destination": "payerfsp"
                    },
                    "body": "data:application/vnd.interoperability.transfers+json;version=1.0;base64,ewogICJmdWxmaWxtZW50IjogIlVObEo5OGhaVFlfZHN3MGNBcXc0aV9VTjN2NHV0dDdDWkZCNHlmTGJWRkEiLAogICJjb21wbGV0ZWRUaW1lc3RhbXAiOiAiMjAxOS0wNS0yOVQyMzoxODozMi44NTZaIiwKICAidHJhbnNmZXJTdGF0ZSI6ICJDT01NSVRURUQiCn0"
                }
            ],
            "required": [
                "body"
            ],
            "properties": {
                "headers": {
                    "$id": "#/properties/payload/properties/headers",
                    "type": "object",
                    "title": "The headers schema",
                    "description": "An explanation about the purpose of this instance.",
                    "default": {},
                    "examples": [
                        {
                            "content-type": "application/vnd.interoperability.transfers+json;version=1.0",
                            "date": "2019-05-28T16:34:41.000Z",
                            "fspiop-source": "payerfsp",
                            "fspiop-destination": "payerfsp"
                        }
                    ],
                    "required": [],
                    "additionalProperties": {"type": "string"}
                },
                "body": {
                    "$id": "#/properties/payload/properties/body",
                    "type": "string",
                    "title": "The body schema",
                    "description": "An explanation about the purpose of this instance.",
                    "default": "",
                    "examples": [
                        "data:application/vnd.interoperability.transfers+json;v1ersion=1.0;base64,ewogICJmdWxmaWxtZW50IjogIlVObEo5OGhaVFlfZHN3MGNBcXc0aV9VTjN2NHV0dDdDWkZCNHlmTGJWRkEiLAogICJjb21wbGV0ZWRUaW1lc3RhbXAiOiAiMjAxOS0wNS0yOVQyMzoxODozMi44NTZaIiwKICAidHJhbnNmZXJTdGF0ZSI6ICJDT01NSVRURUQiCn0"
                    ]
                }
            },
            "additionalProperties": false
        },
        "traceInfo": {
            "$id": "#/properties/traceInfo",
            "type": "object",
            "title": "The traceInfo schema",
            "description": "Distributed tracing metadata for the event.",
            "default": {},
            "examples": [
                {
                    "traceParent": "00-8e540e87060d56a2d2e0be5d732791e7-d96a5971b7c5cac6-21",
                    "traceState": "acmevendor=eyJzcGFuSWQiOiJkOTZhNTk3MWI3YzVjYWM2IiwidGltZUFwaVByZXBhcmUiOiIxNjA3Njc3MDgxNzAwIiwidGltZUFwaUZ1bGZpbCI6IjE2MDc2NzcwODE4MTkifQ==",
                    "service": "notification-evt-handler",
                    "startTimestamp": 1607677081837,
                    "finishTimestamp": 2007677081838
                }
            ],
            "required": [
                "traceParent",
                "traceState",
                "service",
                "startTimestamp",
                "finishTimestamp"
            ],
            "properties": {
                "traceParent": {
                    "$id": "#/properties/traceInfo/properties/traceParent",
                    "type": "string",
                    "title": "The traceParent schema",
                    "description": "Identifier for the incoming request in a tracing system. Ref: https://w3c.github.io/trace-context/#traceparent-header",
                    "default": "",
                    "examples": [
                        "00-8e540e87060d56a2d2e0be5d732791e7-d96a5971b7c5cac6-21"
                    ]
                },
                "traceState": {
                    "$id": "#/properties/traceInfo/properties/traceState",
                    "type": "string",
                    "title": "The traceState schema",
                    "description": "Provides additional vendor-specific trace identification information across different distributed tracing systems and is a companion header for the traceparent field. Ref: https://w3c.github.io/trace-context/#tracestate-header",
                    "default": "",
                    "examples": [
                        "acmevendor=eyJzcGFuSWQiOiJkOTZhNTk3MWI3YzVjYWM2IiwidGltZUFwaVByZXBhcmUiOiIxNjA3Njc3MDgxNzAwIiwidGltZUFwaUZ1bGZpbCI6IjE2MDc2NzcwODE4MTkifQ=="
                    ]
                },
                "service": {
                    "$id": "#/properties/traceInfo/properties/service",
                    "type": "string",
                    "title": "The service schema",
                    "description": "The service name of the event producer.",
                    "default": "",
                    "examples": [
                        "notification-evt-handler"
                    ]
                },
                "startTimestamp": {
                    "$id": "#/properties/traceInfo/properties/startTimestamp",
                    "type": "integer",
                    "title": "The startTimestamp schema",
                    "description": "Epoch/Unix timestamp of the trace-span's start.",
                    "default": 0,
                    "examples": [
                        1607677081837
                    ]
                },
                "finishTimestamp": {
                    "$id": "#/properties/traceInfo/properties/finishTimestamp",
                    "type": "integer",
                    "title": "The finishTimestamp schema",
                    "description": "Epoch/Unix timestamp of the trace-span's end.",
                    "default": 0,
                    "examples": [
                        2007677081838
                    ]
                }
            },
            "additionalProperties": false
        }
    },
    "additionalProperties": false
}