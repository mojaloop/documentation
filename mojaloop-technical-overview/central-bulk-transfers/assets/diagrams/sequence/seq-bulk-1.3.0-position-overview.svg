<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1676px" preserveAspectRatio="none" style="width:1185px;height:1676px;" version="1.1" viewBox="0 0 1185 1676" width="1185px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ksepm7jiyxoq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="458" x="364.75" y="23.5352">1.3.0. Position Handler Consume individual transfers from Bulk</text><rect fill="#FFFFE0" height="1630.8613" style="stroke: #A80036; stroke-width: 1.0;" width="1129.5" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="543.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="182.2188"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="663.5215"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="1144.8242"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="1491.5742" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="433" y="112.2871"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="1477.5742" style="stroke: #000000; stroke-width: 2.0;" width="1161.5" x="13" y="119.2871"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="1446.2637" style="stroke: #000000; stroke-width: 2.0;" width="1141.5" x="23" y="143.5977"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="560.5" x="358.5" y="227.2188"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="540.5" x="368.5" y="251.5293"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="347.4609"/><rect fill="#FFFFFF" height="481.3027" style="stroke: none; stroke-width: 1.0;" width="1141.5" x="23" y="627.2559"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="561.5" x="358.5" y="708.5215"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="541.5" x="368.5" y="732.832"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="828.7637"/><rect fill="#FFFFFF" height="481.3027" style="stroke: none; stroke-width: 1.0;" width="1141.5" x="23" y="1108.5586"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="596.5" x="358.5" y="1189.8242"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="576.5" x="368.5" y="1214.1348"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="1310.0664"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="124" x2="124" y1="102.2871" y2="1613.8613"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="437.5" x2="437.5" y1="102.2871" y2="1613.8613"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="944.5" x2="944.5" y1="102.2871" y2="1613.8613"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1080.5" x2="1080.5" y1="102.2871" y2="1613.8613"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="37" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="33" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="40" y="87.334">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="37" y="1612.8613"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="33" y="1616.8613"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="40" y="1637.3965">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="378.5" y="99.334">Position Handler</text><ellipse cx="438" cy="69.7988" fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="434,57.7988,440,52.7988,438,57.7988,440,62.7988,434,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="378.5" y="1626.3965">Position Handler</text><ellipse cx="438" cy="1645.3496" fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="434,1633.3496,440,1628.3496,438,1633.3496,440,1638.3496,434,1633.3496" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="896.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="892.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="899.5" y="87.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="896.5" y="1612.8613"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="892.5" y="1616.8613"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="899.5" y="1637.3965">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1011.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1007.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1014.5" y="87.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1011.5" y="1612.8613"/><rect fill="#FEFECE" filter="url(#f1ksepm7jiyxoq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1007.5" y="1616.8613"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1014.5" y="1637.3965">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="182.2188"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="663.5215"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="119" y="1144.8242"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="1491.5742" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="433" y="112.2871"/><path d="M13,119.2871 L236,119.2871 L236,126.2871 L226,136.2871 L13,136.2871 L13,119.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1477.5742" style="stroke: #000000; stroke-width: 2.0;" width="1161.5" x="13" y="119.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="132.8555">Position Handler Consume</text><path d="M23,143.5977 L85,143.5977 L85,150.5977 L75,160.5977 L23,160.5977 L23,143.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1446.2637" style="stroke: #000000; stroke-width: 2.0;" width="1141.5" x="23" y="143.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="157.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="213" x="100" y="156.2324">[Consume Prepare message for Payer]</text><polygon fill="#A80036" points="140,178.2188,130,182.2188,140,186.2188,136,182.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="432" y1="182.2188" y2="182.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146" y="177.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="159" y="177.4766">Consume Position event message for Payer</text><path d="M358.5,227.2188 L442.5,227.2188 L442.5,234.2188 L432.5,244.2188 L358.5,244.2188 L358.5,227.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="560.5" x="358.5" y="227.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="373.5" y="240.7871">break</text><path d="M368.5,251.5293 L510.5,251.5293 L510.5,258.5293 L500.5,268.5293 L368.5,268.5293 L368.5,251.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="540.5" x="368.5" y="251.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="383.5" y="265.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="485" y1="305.4609" y2="305.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="485" x2="485" y1="305.4609" y2="318.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="444" x2="485" y1="318.4609" y2="318.4609"/><polygon fill="#A80036" points="454,314.4609,444,318.4609,454,322.4609,450,318.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="293.0635">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="434" x="463" y="285.4082">Validate event - Rule: type == 'position' &amp;&amp; action == 'bulk-prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="463" y="300.7188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="547" y="300.7188">2001</text><path d="M368.5,347.4609 L583.5,347.4609 L583.5,354.4609 L573.5,364.4609 L368.5,364.4609 L368.5,347.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="347.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="383.5" y="361.0293">Persist Event Information</text><polygon fill="#A80036" points="933,407.082,943,411.082,933,415.082,937,411.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="939" y1="411.082" y2="411.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="406.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="463" y="406.3398">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="621" x="375.5" y="419.082"/><polygon fill="#EEEEEE" points="375.5,419.082,439.5,419.082,439.5,426.082,429.5,436.082,375.5,436.082,375.5,419.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="433.6504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="613" y="452.6504">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="617" y="467.9609"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="225" x="375.5" y="537.0137"/><polygon fill="#EEEEEE" points="375.5,537.0137,439.5,537.0137,439.5,544.0137,429.5,554.0137,375.5,554.0137,375.5,537.0137" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="551.582">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="381.5" y="570.582">Prepare Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="385.5" y="585.8926"/><polygon fill="#A80036" points="1069,615.2559,1079,619.2559,1069,623.2559,1073,619.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="1075" y1="619.2559" y2="619.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="614.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="463" y="614.5137">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1164.5" y1="628.2559" y2="628.2559"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="28" y="638.8906">[Consume Fulfil message for Payee]</text><polygon fill="#A80036" points="140,659.5215,130,663.5215,140,667.5215,136,663.5215" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="432" y1="663.5215" y2="663.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146" y="658.7793">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="159" y="658.7793">Consume Position event message for Payee</text><path d="M358.5,708.5215 L442.5,708.5215 L442.5,715.5215 L432.5,725.5215 L358.5,725.5215 L358.5,708.5215 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="561.5" x="358.5" y="708.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="373.5" y="722.0898">break</text><path d="M368.5,732.832 L510.5,732.832 L510.5,739.832 L500.5,749.832 L368.5,749.832 L368.5,732.832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="541.5" x="368.5" y="732.832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="383.5" y="746.4004">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="485" y1="786.7637" y2="786.7637"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="485" x2="485" y1="786.7637" y2="799.7637"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="444" x2="485" y1="799.7637" y2="799.7637"/><polygon fill="#A80036" points="454,795.7637,444,799.7637,454,803.7637,450,799.7637" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="774.3662">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="435" x="463" y="766.7109">Validate event - Rule: type == 'position' &amp;&amp; action == 'bulk-commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="463" y="782.0215">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="547" y="782.0215">2001</text><path d="M368.5,828.7637 L583.5,828.7637 L583.5,835.7637 L573.5,845.7637 L368.5,845.7637 L368.5,828.7637 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="828.7637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="383.5" y="842.332">Persist Event Information</text><polygon fill="#A80036" points="933,888.3848,943,892.3848,933,896.3848,937,892.3848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="939" y1="892.3848" y2="892.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="887.6426">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="463" y="887.6426">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="621" x="375.5" y="900.3848"/><polygon fill="#EEEEEE" points="375.5,900.3848,439.5,900.3848,439.5,907.3848,429.5,917.3848,375.5,917.3848,375.5,900.3848" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="914.9531">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="613" y="933.9531">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="617" y="949.2637"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="211" x="375.5" y="1018.3164"/><polygon fill="#EEEEEE" points="375.5,1018.3164,439.5,1018.3164,439.5,1025.3164,429.5,1035.3164,375.5,1035.3164,375.5,1018.3164" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="1032.8848">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="381.5" y="1051.8848">Fulfil Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="385.5" y="1067.1953"/><polygon fill="#A80036" points="1069,1096.5586,1079,1100.5586,1069,1104.5586,1073,1100.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="1075" y1="1100.5586" y2="1100.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="450" y="1095.8164">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="463" y="1095.8164">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1164.5" y1="1109.5586" y2="1109.5586"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="28" y="1120.1934">[Consume Abort message]</text><polygon fill="#A80036" points="140,1140.8242,130,1144.8242,140,1148.8242,136,1144.8242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="134" x2="432" y1="1144.8242" y2="1144.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146" y="1140.082">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="159" y="1140.082">Consume Position event message</text><path d="M358.5,1189.8242 L442.5,1189.8242 L442.5,1196.8242 L432.5,1206.8242 L358.5,1206.8242 L358.5,1189.8242 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="596.5" x="358.5" y="1189.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="373.5" y="1203.3926">break</text><path d="M368.5,1214.1348 L510.5,1214.1348 L510.5,1221.1348 L500.5,1231.1348 L368.5,1231.1348 L368.5,1214.1348 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="576.5" x="368.5" y="1214.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="383.5" y="1227.7031">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="485" y1="1268.0664" y2="1268.0664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="485" x2="485" y1="1268.0664" y2="1281.0664"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="444" x2="485" y1="1281.0664" y2="1281.0664"/><polygon fill="#A80036" points="454,1277.0664,444,1281.0664,454,1285.0664,450,1281.0664" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1255.6689">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="472" y="1248.0137">Validate event - Rule: type == 'position' &amp;&amp; action == 'timeout-reserved'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="472" y="1263.3242">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="556" y="1263.3242">2001</text><path d="M368.5,1310.0664 L583.5,1310.0664 L583.5,1317.0664 L573.5,1327.0664 L368.5,1327.0664 L368.5,1310.0664 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="639" x="368.5" y="1310.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="383.5" y="1323.6348">Persist Event Information</text><polygon fill="#A80036" points="933,1369.6875,943,1373.6875,933,1377.6875,937,1373.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="939" y1="1373.6875" y2="1373.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1368.9453">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="472" y="1368.9453">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="621" x="375.5" y="1381.6875"/><polygon fill="#EEEEEE" points="375.5,1381.6875,439.5,1381.6875,439.5,1388.6875,429.5,1398.6875,375.5,1398.6875,375.5,1381.6875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="1396.2559">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="613" y="1415.2559">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="617" y="1430.5664"/><rect fill="#FFFFFF" filter="url(#f1ksepm7jiyxoq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="214" x="375.5" y="1499.6191"/><polygon fill="#EEEEEE" points="375.5,1499.6191,439.5,1499.6191,439.5,1506.6191,429.5,1516.6191,375.5,1516.6191,375.5,1499.6191" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="388.5" y="1514.1875">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="381.5" y="1533.1875">Abort Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="385.5" y="1548.498"/><polygon fill="#A80036" points="1069,1577.8613,1079,1581.8613,1069,1585.8613,1073,1581.8613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="443" x2="1075" y1="1581.8613" y2="1581.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="450" y="1577.1191">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="472" y="1577.1191">Produce message</text><!--
@startuml
title 1.3.0. Position Handler Consume individual transfers from Bulk

autonumber


collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS


box "Central Service" #LightYellow
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
end box

activate POS_HANDLER
group Position Handler Consume
    alt Consume Prepare message for Payer
        TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume Position event message for Payer
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'bulk-prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS:  Event Handler Consume\n
            |||
        end
        |||
        ref over POS_HANDLER: Prepare Position Handler Consume\n
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Fulfil message for Payee
        TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume Position event message for Payee
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'bulk-commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume\n
            |||
        end
        |||
        ref over POS_HANDLER: Fulfil Position Handler Consume\n
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Abort message
        TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume Position event message
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'timeout-reserved'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume\n
            |||
        end
        |||
        ref over POS_HANDLER: Abort Position Handler Consume\n
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    end

end
deactivate POS_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>