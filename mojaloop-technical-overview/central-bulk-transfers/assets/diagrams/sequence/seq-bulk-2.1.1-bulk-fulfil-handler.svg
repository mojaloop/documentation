<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3912px" preserveAspectRatio="none" style="width:1809px;height:3912px;" version="1.1" viewBox="0 0 1809 3912" width="1809px" zoomAndPan="magnify"><defs><filter height="300%" id="f1opkotki2djz6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="781" y="23.5352">2.1.1. Bulk Fulfil Handler Consume</text><rect fill="#FFFFE0" height="3867.0449" style="stroke: #A80036; stroke-width: 1.0;" width="1639" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="788" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="71.5" y="249.0176"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="3694.7813" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="346" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="830" y="3191.6641"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1197" y="3771.5566"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1023.4023"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1503.9922"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1972.5605"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="2201.7344"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="2460.4844"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="1068.0234"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="1533.3027"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2001.8711"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2231.0449"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2489.7949"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="3680.7813" style="stroke: #000000; stroke-width: 2.0;" width="1785" x="13" y="135.7754"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="294.5" y="293.3281"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="304.5" y="317.6387"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="304.5" y="428.8809"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="304.5" y="600.4336"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="264.5" y="717.6758"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="274.5" y="911.8496"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="284.5" y="1278.5078"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="304.5" y="1302.8184"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="294.5" y="1640.2344"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="304.5" y="1664.5449"/><rect fill="#FFFFFF" height="88.5762" style="stroke: none; stroke-width: 1.0;" width="998.5" x="294.5" y="1749.7871"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="304.5" y="1771.7422"/><rect fill="#FFFFFF" height="75.6211" style="stroke: none; stroke-width: 1.0;" width="998.5" x="294.5" y="1838.3633"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="304.5" y="1847.3633"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1464.5" x="284.5" y="1920.9844"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="294.5" y="2123.4922"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="304.5" y="2147.8027"/><rect fill="#FFFFFF" height="274.0605" style="stroke: none; stroke-width: 1.0;" width="1422.5" x="294.5" y="2369.2871"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="304.5" y="2391.2422"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="988.5" x="294.5" y="2664.3477"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="603.5" x="304.5" y="2746.2793"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="988.5" x="294.5" y="3236.6641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="76" x2="76" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="191" x2="191" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="350.5" x2="350.5" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="835" x2="835" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="959" x2="959" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1070" x2="1070" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1202" x2="1202" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1318" x2="1318" y1="118.7754" y2="3833.5566"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1606" x2="1606" y1="118.7754" y2="3833.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="27" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="23" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="44" y="87.334">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="30" y="103.8223">object-store</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="27" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="23" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="44" y="3857.0918">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="30" y="3873.5801">object-store</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="144" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="140" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="147" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="171.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="144" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="140" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="147" y="3857.0918">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="171.5" y="3873.5801">fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="314.5" y="99.334">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="321" y="115.8223">Handler</text><ellipse cx="351" cy="69.7988" fill="#FEFECE" filter="url(#f1opkotki2djz6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="347,57.7988,353,52.7988,351,57.7988,353,62.7988,347,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="314.5" y="3846.0918">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="321" y="3862.5801">Handler</text><ellipse cx="351" cy="3881.5332" fill="#FEFECE" filter="url(#f1opkotki2djz6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="347,3869.5332,353,3864.5332,351,3869.5332,353,3874.5332,347,3869.5332" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="776" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="772" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="779" y="87.334">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="815.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="776" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="772" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="779" y="3857.0918">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="815.5" y="3873.5801">fulfil</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="912" y="62.7988"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="908" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="915" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="917.5" y="103.8223">processing</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="912" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="908" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="915" y="3857.0918">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="917.5" y="3873.5801">processing</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1024" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1020" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1027" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1024" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1020" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1027" y="3857.0918">topic-event</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1135" y="79.2871"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1131" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1138" y="103.8223">topic-notification</text><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1135" y="3832.5566"/><rect fill="#FEFECE" filter="url(#f1opkotki2djz6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1131" y="3836.5566"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1138" y="3857.0918">topic-notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1283" y="115.8223">Bulk DAO</text><ellipse cx="1318" cy="86.2871" fill="#FEFECE" filter="url(#f1opkotki2djz6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1306" x2="1330" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1283" y="3846.0918">Bulk DAO</text><ellipse cx="1318" cy="3865.0449" fill="#FEFECE" filter="url(#f1opkotki2djz6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1306" x2="1330" y1="3879.0449" y2="3879.0449"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1558" y="115.8223">Central Store</text><path d="M1588,66.2871 C1588,56.2871 1606,56.2871 1606,56.2871 C1606,56.2871 1624,56.2871 1624,66.2871 L1624,92.2871 C1624,102.2871 1606,102.2871 1606,102.2871 C1606,102.2871 1588,102.2871 1588,92.2871 L1588,66.2871 " fill="#FEFECE" filter="url(#f1opkotki2djz6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1588,66.2871 C1588,76.2871 1606,76.2871 1606,76.2871 C1606,76.2871 1624,76.2871 1624,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1558" y="3846.0918">Central Store</text><path d="M1588,3859.0449 C1588,3849.0449 1606,3849.0449 1606,3849.0449 C1606,3849.0449 1624,3849.0449 1624,3859.0449 L1624,3885.0449 C1624,3895.0449 1606,3895.0449 1606,3895.0449 C1606,3895.0449 1588,3895.0449 1588,3885.0449 L1588,3859.0449 " fill="#FEFECE" filter="url(#f1opkotki2djz6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1588,3859.0449 C1588,3869.0449 1606,3869.0449 1606,3869.0449 C1606,3869.0449 1624,3869.0449 1624,3859.0449 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="71.5" y="249.0176"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="186" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="3694.7813" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="346" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="830" y="3191.6641"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1197" y="3771.5566"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1023.4023"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1503.9922"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="1972.5605"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="2201.7344"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1313" y="2460.4844"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="1068.0234"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="1533.3027"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2001.8711"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2231.0449"/><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1601" y="2489.7949"/><path d="M13,135.7754 L249,135.7754 L249,142.7754 L239,152.7754 L13,152.7754 L13,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3680.7813" style="stroke: #000000; stroke-width: 2.0;" width="1785" x="13" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="28" y="149.3438">Bulk Fulfil Handler Consume</text><polygon fill="#A80036" points="207,170.3965,197,174.3965,207,178.3965,203,174.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="201" x2="345" y1="174.3965" y2="174.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="213" y="169.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="226" y="169.6543">Consume message</text><polygon fill="#A80036" points="92.5,245.0176,82.5,249.0176,92.5,253.0176,88.5,249.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="86.5" x2="345" y1="249.0176" y2="249.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="98.5" y="236.6201">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="111.5" y="228.9648">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="111.5" y="244.2754">using reference</text><polygon fill="#A80036" points="334,274.3281,344,278.3281,334,282.3281,338,278.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="76.5" x2="340" y1="278.3281" y2="278.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="83.5" y="273.5859">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="96.5" y="273.5859">Return payload</text><path d="M294.5,293.3281 L378.5,293.3281 L378.5,300.3281 L368.5,310.3281 L294.5,310.3281 L294.5,293.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="294.5" y="293.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="309.5" y="306.8965">break</text><path d="M304.5,317.6387 L446.5,317.6387 L446.5,324.6387 L436.5,334.6387 L304.5,334.6387 L304.5,317.6387 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="304.5" y="317.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="319.5" y="331.207">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="386.8809" y2="386.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="386.8809" y2="399.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="399.8809" y2="399.8809"/><polygon fill="#A80036" points="367,395.8809,357,399.8809,367,403.8809,363,399.8809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="366.8281">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="376" y="351.5176">Validate event - Rule:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="376" y="366.8281">type == 'bulk-fulfil' &amp;&amp; action == 'bulk-commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="376" y="382.1387">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="382.1387">2001</text><path d="M304.5,428.8809 L519.5,428.8809 L519.5,435.8809 L509.5,445.8809 L304.5,445.8809 L304.5,428.8809 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="304.5" y="428.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="319.5" y="442.4492">Persist Event Information</text><polygon fill="#A80036" points="1058.5,488.502,1068.5,492.502,1058.5,496.502,1062.5,492.502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1064.5" y1="492.502" y2="492.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="487.7598">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="376" y="487.7598">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="311.5" y="500.502"/><polygon fill="#EEEEEE" points="311.5,500.502,375.5,500.502,375.5,507.502,365.5,517.502,311.5,517.502,311.5,500.502" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="324.5" y="515.0703">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="640.75" y="534.0703">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="644.75" y="549.3809"/><path d="M304.5,600.4336 L526.5,600.4336 L526.5,607.4336 L516.5,617.4336 L304.5,617.4336 L304.5,600.4336 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="304.5" y="600.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="319.5" y="614.002">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="311.5" y="642.7441"/><polygon fill="#EEEEEE" points="311.5,642.7441,375.5,642.7441,375.5,649.7441,365.5,659.7441,311.5,659.7441,311.5,642.7441" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="324.5" y="657.3125">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="625.75" y="676.3125">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="843.75" y="676.3125">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="625.75" y="691.623">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="709.75" y="691.623">3105/3106</text><path d="M264.5,717.6758 L496.5,717.6758 L496.5,724.6758 L486.5,734.6758 L264.5,734.6758 L264.5,717.6758 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="264.5" y="717.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="279.5" y="731.2441">Validate Bulk Fulfil Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="756.2969" y2="756.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="756.2969" y2="769.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="769.2969" y2="769.2969"/><polygon fill="#A80036" points="367,765.2969,357,769.2969,367,773.2969,363,769.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="751.5547">6</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="376" y="751.5547">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="813.918" y2="813.918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="813.918" y2="826.918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="826.918" y2="826.918"/><polygon fill="#A80036" points="367,822.918,357,826.918,367,830.918,363,826.918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="801.5205">7</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="376" y="793.8652">Verify the message's signature</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="376" y="809.1758">(to be confirmed in future requirement)</text><path d="M361,839.918 L361,894.918 L726,894.918 L726,849.918 L716,839.918 L361,839.918 " fill="#D3D3D3" filter="url(#f1opkotki2djz6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M716,839.918 L716,849.918 L726,849.918 L716,839.918 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="367" y="857.4863">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="367" y="872.7969">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="367" y="888.1074">It may need to be added in future for custom adapters.</text><path d="M274.5,911.8496 L592.5,911.8496 L592.5,918.8496 L582.5,928.8496 L274.5,928.8496 L274.5,911.8496 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="274.5" y="911.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="289.5" y="925.418">Validate Bulk Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="950.4707" y2="950.4707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="950.4707" y2="963.4707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="963.4707" y2="963.4707"/><polygon fill="#A80036" points="367,959.4707,357,963.4707,367,967.4707,363,963.4707" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="945.7285">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="376" y="945.7285">Generate bulkTransferFulfilmentId UUID</text><polygon fill="#A80036" points="1301,1019.4023,1311,1023.4023,1301,1027.4023,1305,1023.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1307" y1="1023.4023" y2="1023.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="363" y="1003.3496">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="376" y="988.0391">Request to retrieve Bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="376" y="1003.3496">fulfilment hashes by bulkTransferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="376" y="1018.6602">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="453" y="1018.6602">2003</text><polygon fill="#A80036" points="1589,1064.0234,1599,1068.0234,1589,1072.0234,1593,1068.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1323" x2="1595" y1="1068.0234" y2="1068.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1330" y="1055.626">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1352" y="1047.9707">Request Bulk transfer fulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1352" y="1063.2813">duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f1opkotki2djz6)" points="1453,1081.0234,1758,1081.0234,1768,1107.0234,1758,1134.0234,1453,1134.0234,1443,1107.0234,1453,1081.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1455" y="1097.5918">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1455" y="1112.9023">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="261" x="1495" y="1112.9023">bulkTransferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="1455" y="1128.2129">WHERE bulkTransferId = request.params.id</text><polygon fill="#A80036" points="1334,1157.2656,1324,1161.2656,1334,1165.2656,1330,1161.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1328" x2="1605" y1="1161.2656" y2="1161.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1340" y="1156.5234">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1362" y="1156.5234">Return existing hashes</text><polygon fill="#A80036" points="367,1186.5762,357,1190.5762,367,1194.5762,363,1190.5762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="361" x2="1317" y1="1190.5762" y2="1190.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="373" y="1185.834">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="395" y="1185.834">Return</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="440" y="1185.834">(list of)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="491" y="1185.834">transfer fulfil message hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="1250.5078" y2="1250.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="1250.5078" y2="1263.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="1263.5078" y2="1263.5078"/><polygon fill="#A80036" points="367,1259.5078,357,1263.5078,367,1267.5078,363,1263.5078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1230.4551">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="385" y="1215.1445">Loop the list of returned hashes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="385" y="1230.4551">and compare each entry with the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="385" y="1245.7656">calculated message hash</text><path d="M284.5,1278.5078 L346.5,1278.5078 L346.5,1285.5078 L336.5,1295.5078 L284.5,1295.5078 L284.5,1278.5078 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="284.5" y="1278.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="299.5" y="1292.0762">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="361.5" y="1291.1426">[Hash matched]</text><path d="M304.5,1302.8184 L519.5,1302.8184 L519.5,1309.8184 L509.5,1319.8184 L304.5,1319.8184 L304.5,1302.8184 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="304.5" y="1302.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="319.5" y="1316.3867">Persist Event Information</text><polygon fill="#A80036" points="1058.5,1362.4395,1068.5,1366.4395,1058.5,1370.4395,1062.5,1366.4395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1064.5" y1="1366.4395" y2="1366.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1361.6973">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="385" y="1361.6973">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="311.5" y="1374.4395"/><polygon fill="#EEEEEE" points="311.5,1374.4395,375.5,1374.4395,375.5,1381.4395,365.5,1391.4395,311.5,1391.4395,311.5,1374.4395" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="324.5" y="1389.0078">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="642.75" y="1408.0078">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="646.75" y="1423.3184"/><polygon fill="#A80036" points="1301,1499.9922,1311,1503.9922,1301,1507.9922,1305,1503.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1307" y1="1503.9922" y2="1503.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1491.5947">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="385" y="1483.9395">Request to retrieve Bulk transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="385" y="1499.25">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="462" y="1499.25">2003</text><polygon fill="#A80036" points="1589,1529.3027,1599,1533.3027,1589,1537.3027,1593,1533.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1323" x2="1595" y1="1533.3027" y2="1533.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1330" y="1528.5605">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1352" y="1528.5605">Request to retrieve Bulk transfer state</text><polygon fill="#FFFFE0" filter="url(#f1opkotki2djz6)" points="1525,1546.3027,1687,1546.3027,1697,1557.3027,1687,1569.3027,1525,1569.3027,1515,1557.3027,1525,1546.3027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1527" y="1562.8711">bulkTransferStateChange</text><polygon fill="#A80036" points="1334,1591.9238,1324,1595.9238,1334,1599.9238,1330,1595.9238" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1328" x2="1605" y1="1595.9238" y2="1595.9238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1340" y="1591.1816">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1362" y="1591.1816">Return Bulk transfer state</text><polygon fill="#A80036" points="367,1621.2344,357,1625.2344,367,1629.2344,363,1625.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="361" x2="1317" y1="1625.2344" y2="1625.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="373" y="1620.4922">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="395" y="1620.4922">Return Bulk transfer state</text><path d="M294.5,1640.2344 L356.5,1640.2344 L356.5,1647.2344 L346.5,1657.2344 L294.5,1657.2344 L294.5,1640.2344 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="294.5" y="1640.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="309.5" y="1653.8027">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="371.5" y="1652.8691">[bulkTransferState IN ['COMPLETED', 'REJECTED']]</text><path d="M304.5,1664.5449 L388.5,1664.5449 L388.5,1671.5449 L378.5,1681.5449 L304.5,1681.5449 L304.5,1664.5449 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="304.5" y="1664.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="319.5" y="1678.1133">break</text><rect fill="#FFFFFF" filter="url(#f1opkotki2djz6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="311.5" y="1681.8555"/><polygon fill="#EEEEEE" points="311.5,1681.8555,375.5,1681.8555,375.5,1688.8555,365.5,1698.8555,311.5,1698.8555,311.5,1681.8555" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="324.5" y="1696.4238">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="672.75" y="1715.4238">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="676.75" y="1730.7344"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="294.5" x2="1293" y1="1750.7871" y2="1750.7871"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="299.5" y="1761.4219">[transferState NOT 'ACCEPTED']</text><path d="M304.5,1771.7422 L388.5,1771.7422 L388.5,1778.7422 L378.5,1788.7422 L304.5,1788.7422 L304.5,1771.7422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="304.5" y="1771.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="319.5" y="1785.3105">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="1810.3633" y2="1810.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="1810.3633" y2="1823.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="1823.3633" y2="1823.3633"/><polygon fill="#A80036" points="367,1819.3633,357,1823.3633,367,1827.3633,363,1823.3633" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1805.6211">19</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="385" y="1805.6211">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="462" y="1805.6211">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="294.5" x2="1293" y1="1839.3633" y2="1839.3633"/><path d="M304.5,1847.3633 L388.5,1847.3633 L388.5,1854.3633 L378.5,1864.3633 L304.5,1864.3633 L304.5,1847.3633 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="304.5" y="1847.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="319.5" y="1860.9316">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="1885.9844" y2="1885.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="1885.9844" y2="1898.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="1898.9844" y2="1898.9844"/><polygon fill="#A80036" points="367,1894.9844,357,1898.9844,367,1902.9844,363,1898.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1881.2422">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="385" y="1881.2422">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="284.5" x2="1749" y1="1921.9844" y2="1921.9844"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="289.5" y="1932.6191">[Hash not matched]</text><polygon fill="#A80036" points="1301,1968.5605,1311,1972.5605,1301,1976.5605,1305,1972.5605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1307" y1="1972.5605" y2="1972.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="1960.1631">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="385" y="1952.5078">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="1967.8184">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="1967.8184">2003</text><polygon fill="#A80036" points="1589,1997.8711,1599,2001.8711,1589,2005.8711,1593,2001.8711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1323" x2="1595" y1="2001.8711" y2="2001.8711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1330" y="1997.1289">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1352" y="1997.1289">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f1opkotki2djz6)" points="1482,2044.8711,1729,2044.8711,1739,2055.8711,1729,2067.8711,1482,2067.8711,1472,2055.8711,1482,2044.8711" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1484" y="2061.4395">bulkTransferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="367,2090.4922,357,2094.4922,367,2098.4922,363,2094.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="361" x2="1317" y1="2094.4922" y2="2094.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="373" y="2089.75">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="395" y="2089.75">Return success</text><path d="M294.5,2123.4922 L356.5,2123.4922 L356.5,2130.4922 L346.5,2140.4922 L294.5,2140.4922 L294.5,2123.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="294.5" y="2123.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="309.5" y="2137.0605">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="371.5" y="2136.127">[Validate Bulk Transfer Fulfil (success)]</text><path d="M304.5,2147.8027 L789.5,2147.8027 L789.5,2154.8027 L779.5,2164.8027 L304.5,2164.8027 L304.5,2147.8027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="304.5" y="2147.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="440" x="319.5" y="2161.3711">Persist Bulk Transfer State (with bulktransferState='PROCESSING')</text><polygon fill="#A80036" points="1301,2197.7344,1311,2201.7344,1301,2205.7344,1305,2201.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1307" y1="2201.7344" y2="2201.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="2189.3369">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="385" y="2181.6816">Request to persist bulk transfer fulfil</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="2196.9922">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="2196.9922">2003</text><polygon fill="#A80036" points="1589,2227.0449,1599,2231.0449,1589,2235.0449,1593,2231.0449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1323" x2="1595" y1="2231.0449" y2="2231.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1330" y="2226.3027">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="1352" y="2226.3027">Persist bulkTransferFulfilment</text><polygon fill="#FFFFE0" filter="url(#f1opkotki2djz6)" points="1525,2274.0449,1687,2274.0449,1697,2300.0449,1687,2327.0449,1525,2327.0449,1515,2300.0449,1525,2274.0449" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1527" y="2290.6133">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1527" y="2305.9238">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1527" y="2321.2344">bulkTransferExtension</text><polygon fill="#A80036" points="367,2350.2871,357,2354.2871,367,2358.2871,363,2354.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="361" x2="1317" y1="2354.2871" y2="2354.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="373" y="2349.5449">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="395" y="2349.5449">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="294.5" x2="1717" y1="2370.2871" y2="2370.2871"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="299.5" y="2380.9219">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M304.5,2391.2422 L838.5,2391.2422 L838.5,2398.2422 L828.5,2408.2422 L304.5,2408.2422 L304.5,2391.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="304.5" y="2391.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="489" x="319.5" y="2404.8105">Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')</text><polygon fill="#A80036" points="1301,2456.4844,1311,2460.4844,1301,2464.4844,1305,2460.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1307" y1="2460.4844" y2="2460.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="2440.4316">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="385" y="2425.1211">Request to persist bulk</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="385" y="2440.4316">transfer fulfil failure</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="2455.7422">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="2455.7422">2003</text><polygon fill="#A80036" points="1589,2485.7949,1599,2489.7949,1589,2493.7949,1593,2489.7949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1323" x2="1595" y1="2489.7949" y2="2489.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1330" y="2485.0527">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1352" y="2485.0527">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f1opkotki2djz6)" points="1525,2532.7949,1687,2532.7949,1697,2566.7949,1687,2601.7949,1525,2601.7949,1515,2566.7949,1525,2532.7949" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1527" y="2549.3633">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1527" y="2564.6738">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1527" y="2579.9844">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1527" y="2595.2949">bulkTransferError</text><polygon fill="#A80036" points="367,2624.3477,357,2628.3477,367,2632.3477,363,2628.3477" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="361" x2="1317" y1="2628.3477" y2="2628.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="373" y="2623.6055">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="395" y="2623.6055">Return success</text><path d="M294.5,2664.3477 L356.5,2664.3477 L356.5,2671.3477 L346.5,2681.3477 L294.5,2681.3477 L294.5,2664.3477 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1145.209" style="stroke: #000000; stroke-width: 2.0;" width="988.5" x="294.5" y="2664.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="309.5" y="2677.916">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="371.5" y="2676.9824">[Validate Bulk Transfer Fulfil (success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="398" y1="2718.2793" y2="2718.2793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="398" x2="398" y1="2718.2793" y2="2731.2793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="398" y1="2731.2793" y2="2731.2793"/><polygon fill="#A80036" points="367,2727.2793,357,2731.2793,367,2735.2793,363,2731.2793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="2705.8818">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="385" y="2698.2266">Break down the bulk into indidivual transfers</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="2713.5371">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="2713.5371">2003</text><path d="M304.5,2746.2793 L378.5,2746.2793 L378.5,2753.2793 L368.5,2763.2793 L304.5,2763.2793 L304.5,2746.2793 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="483.3848" style="stroke: #000000; stroke-width: 2.0;" width="603.5" x="304.5" y="2746.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="319.5" y="2759.8477">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="288" x="393.5" y="2758.9141">[for every individual transfer in the bulk fulfil list]</text><path d="M361,2768.5898 L361,3145.5898 L623,3145.5898 L623,2778.5898 L613,2768.5898 L361,2768.5898 " fill="#FFFF00" filter="url(#f1opkotki2djz6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M613,2768.5898 L613,2778.5898 L623,2778.5898 L613,2768.5898 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="367" y="2786.1582">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="367" y="2801.4688">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="383" y="2816.7793">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="383" y="2832.0898">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="383" y="2847.4004">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="383" y="2862.7109">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="383" y="2878.0215">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="399" y="2893.332">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="399" y="2908.6426">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="383" y="2923.9531">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="383" y="2939.2637">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="399" y="2954.5742">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="415" y="2969.8848">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="415" y="2985.1953">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="415" y="3000.5059">type: bulk-fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="415" y="3015.8164">action: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="415" y="3031.127">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="415" y="3046.4375">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="431" y="3061.748">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="431" y="3077.0586">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="415" y="3092.3691">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="399" y="3107.6797">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="383" y="3122.9902">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="367" y="3138.3008">}</text><polygon fill="#A80036" points="818,3187.6641,828,3191.6641,818,3195.6641,822,3191.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="824" y1="3191.6641" y2="3191.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="3179.2666">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="385" y="3171.6113">Route &amp; Publish Prepare event to the Payer for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="3186.9219">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="3186.9219">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="294.5" x2="1283" y1="3237.6641" y2="3237.6641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="299.5" y="3248.2988">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M361,3256.6191 L361,3725.6191 L968,3725.6191 L968,3266.6191 L958,3256.6191 L361,3256.6191 " fill="#FFFF00" filter="url(#f1opkotki2djz6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M958,3256.6191 L958,3266.6191 L968,3266.6191 L958,3256.6191 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="367" y="3274.1875">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="367" y="3289.498">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="383" y="3304.8086">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="383" y="3320.1191">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="383" y="3335.4297">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="383" y="3350.7402">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="383" y="3366.0508">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="399" y="3381.3613">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="399" y="3396.6719">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="415" y="3411.9824">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="431" y="3427.293">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="431" y="3442.6035">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="431" y="3457.9141">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="399" y="3473.2246">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="383" y="3488.5352">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="383" y="3503.8457">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="399" y="3519.1563">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="415" y="3534.4668">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="415" y="3549.7773">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="415" y="3565.0879">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="415" y="3580.3984">action: bulk-abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="415" y="3595.709">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="415" y="3611.0195">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="431" y="3626.3301">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="431" y="3641.6406">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="431" y="3656.9512">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="415" y="3672.2617">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="399" y="3687.5723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="383" y="3702.8828">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="367" y="3718.1934">}</text><polygon fill="#A80036" points="1185,3767.5566,1195,3771.5566,1185,3775.5566,1189,3771.5566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356" x2="1191" y1="3771.5566" y2="3771.5566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="363" y="3759.1592">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="385" y="3751.5039">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="385" y="3766.8145">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="3766.8145">2003</text><!--
@startuml
title 2.1.1. Bulk Fulfil Handler Consume

autonumber


collections "mongo-\nobject-store" as OBJECT_STORE
collections "topic-bulk-\nfulfil" as TOPIC_BULK_FULFIL
collections "topic-bulk-\nprocessing" as TOPIC_BULK_PROCESSING
control "Bulk Fulfil\nHandler" as BULK_FULF_HANDLER
collections "topic-transfer-\nfulfil" as TOPIC_TRANSFER_FULFIL
collections "topic-event" as TOPIC_EVENTS
collections "topic-notification" as TOPIC_NOTIFICATION
entity "Bulk DAO" as BULK_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant TOPIC_BULK_FULFIL
    participant BULK_FULF_HANDLER
    participant TOPIC_TRANSFER_FULFIL
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant BULK_DAO
    participant DB
end box

activate BULK_FULF_HANDLER
group Bulk Fulfil Handler Consume
    TOPIC_BULK_FULFIL <- BULK_FULF_HANDLER: Consume message
    activate TOPIC_BULK_FULFIL
    deactivate TOPIC_BULK_FULFIL

    BULK_FULF_HANDLER -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_FULF_HANDLER: Return payload
    deactivate OBJECT_STORE

    break
        group Validate Event
            BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Validate event - Rule:\ntype == 'bulk-fulfil' && action == 'bulk-commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume \n
        |||
    end

    group Validate FSPIOP-Signature
        |||
        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 3105/3106</color>
    end

    group Validate Bulk Fulfil Transfer
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Schema validation of the incoming message</color>
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Verify the message's signature</color>\n<color #gray>(to be confirmed in future requirement)</color>
        note right of BULK_FULF_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Bulk Fulfilment Duplicate Check
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Generate bulkTransferFulfilmentId UUID
            BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer\nfulfilment hashes by bulkTransferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate BULK_DAO
            BULK_DAO -> DB: Request Bulk transfer fulfilment\nduplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **bulkTransferFulfilmentDuplicateCheck**
                WHERE bulkTransferId = request.params.id
            end note
            activate DB
            BULK_DAO <- - DB: Return existing hashes
            deactivate DB
            BULK_DAO - -> BULK_FULF_HANDLER: Return <color #red>**(list of)**</color> transfer fulfil message hash(es)
            deactivate BULK_DAO
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Loop the list of returned hashes\nand compare each entry with the\ncalculated message hash

            alt Hash matched
                group Persist Event Information
                    |||
                    BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume\n
                    |||
                end
                BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Request to retrieve Bulk transfer state
                hnote over DB #lightyellow
                    bulkTransferStateChange
                end note
                activate DB
                BULK_DAO <- - DB: Return Bulk transfer state
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return Bulk transfer state
                deactivate BULK_DAO
                alt bulkTransferState IN ['COMPLETED', 'REJECTED']
                    break
                        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Send notification to Participant (Payee)\n
                    end
                else transferState NOT 'ACCEPTED'
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    bulkTransferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
            
        end
        
        alt Validate Bulk Transfer Fulfil (success)
            group Persist Bulk Transfer State (with bulktransferState='PROCESSING')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk transfer fulfil\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist bulkTransferFulfilment
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        else Validate Bulk Transfer Fulfil (failure)
            group Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk\ntransfer fulfil failure\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                    bulkTransferError
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        end

    end
    alt Validate Bulk Transfer Fulfil (success)
        BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Break down the bulk into indidivual transfers\n<color #FF0000><b>Error codes:</b> 2003</color>
        loop for every individual transfer in the bulk fulfil list


            note right of BULK_FULF_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: bulk-fulfil,
                            action: fulfil,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            BULK_FULF_HANDLER -> TOPIC_TRANSFER_FULFIL: Route & Publish Prepare event to the Payer for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_FULFIL
            deactivate TOPIC_TRANSFER_FULFIL
        end
    else Validate Bulk Transfer Fulfil (failure)
        note right of BULK_FULF_HANDLER #yellow
            Message:
            {
                id: <bulkTransferMessage.bulkTransferId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-processing,
                        action: bulk-abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_FULF_HANDLER -> TOPIC_NOTIFICATION: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_NOTIFICATION
        deactivate TOPIC_NOTIFICATION
    end
end
deactivate BULK_FULF_HANDLER
@enduml

PlantUML version 1.2019.06(Fri May 24 22:40:25 IST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>