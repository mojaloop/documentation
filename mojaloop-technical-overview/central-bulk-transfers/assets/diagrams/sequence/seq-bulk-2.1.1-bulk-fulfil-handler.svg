<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3986px" preserveAspectRatio="none" style="width:1888px;height:3986px;" version="1.1" viewBox="0 0 1888 3986" width="1888px" zoomAndPan="magnify"><defs><filter height="300%" id="f12ply0i8jmok6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249" x="820.5" y="23.5352">2.1.1. Bulk Fulfil Handler Consume</text><rect fill="#FFFFE0" height="3940.9766" style="stroke: #A80036; stroke-width: 1.0;" width="1639" x="39" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="808" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="249.0176"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="2800.2109"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="206" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="3768.7129" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="850" y="3265.5957"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1217" y="3845.4883"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1023.4023"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1503.9922"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1972.5605"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="2201.7344"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="2460.4844"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="1068.0234"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="1533.3027"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2001.8711"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2231.0449"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2489.7949"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="3754.7129" style="stroke: #000000; stroke-width: 2.0;" width="1864" x="13" y="135.7754"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="314.5" y="293.3281"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="324.5" y="317.6387"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="324.5" y="428.8809"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="324.5" y="600.4336"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="284.5" y="717.6758"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="294.5" y="911.8496"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="304.5" y="1278.5078"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="324.5" y="1302.8184"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="314.5" y="1640.2344"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="324.5" y="1664.5449"/><rect fill="#FFFFFF" height="88.5762" style="stroke: none; stroke-width: 1.0;" width="998.5" x="314.5" y="1749.7871"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="324.5" y="1771.7422"/><rect fill="#FFFFFF" height="75.6211" style="stroke: none; stroke-width: 1.0;" width="998.5" x="314.5" y="1838.3633"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="324.5" y="1847.3633"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1464.5" x="304.5" y="1920.9844"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="314.5" y="2123.4922"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="324.5" y="2147.8027"/><rect fill="#FFFFFF" height="274.0605" style="stroke: none; stroke-width: 1.0;" width="1422.5" x="314.5" y="2369.2871"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="324.5" y="2391.2422"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="1219.1406" style="stroke: #000000; stroke-width: 2.0;" width="1844" x="23" y="2664.3477"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="557.3164" style="stroke: #000000; stroke-width: 2.0;" width="1824" x="33" y="2746.2793"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="1844" x="23" y="3310.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="96" x2="96" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="211" x2="211" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="370.5" x2="370.5" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="855" x2="855" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="979" x2="979" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1090" x2="1090" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1222" x2="1222" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1338" x2="1338" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1626" x2="1626" y1="118.7754" y2="3907.4883"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1765" x2="1765" y1="118.7754" y2="3907.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47" y="62.7988"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="43" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="64" y="87.334">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="50" y="103.8223">object-store</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="43" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="64" y="3931.0234">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="50" y="3947.5117">object-store</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="164" y="62.7988"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="160" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="167" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="191.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="164" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="160" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="167" y="3931.0234">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="191.5" y="3947.5117">fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="334.5" y="99.334">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="341" y="115.8223">Handler</text><ellipse cx="371" cy="69.7988" fill="#FEFECE" filter="url(#f12ply0i8jmok6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="367,57.7988,373,52.7988,371,57.7988,373,62.7988,367,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="334.5" y="3920.0234">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="341" y="3936.5117">Handler</text><ellipse cx="371" cy="3955.4648" fill="#FEFECE" filter="url(#f12ply0i8jmok6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="367,3943.4648,373,3938.4648,371,3943.4648,373,3948.4648,367,3943.4648" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="796" y="62.7988"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="792" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="799" y="87.334">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="835.5" y="103.8223">fulfil</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="796" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="792" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="799" y="3931.0234">topic-transfer-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="835.5" y="3947.5117">fulfil</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="932" y="62.7988"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="928" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="935" y="87.334">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="937.5" y="103.8223">processing</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="932" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="928" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="935" y="3931.0234">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="937.5" y="3947.5117">processing</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1044" y="79.2871"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1040" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1047" y="103.8223">topic-event</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1044" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1040" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1047" y="3931.0234">topic-event</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1155" y="79.2871"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1151" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1158" y="103.8223">topic-notification</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1155" y="3906.4883"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1151" y="3910.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1158" y="3931.0234">topic-notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1303" y="115.8223">Bulk DAO</text><ellipse cx="1338" cy="86.2871" fill="#FEFECE" filter="url(#f12ply0i8jmok6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1326" x2="1350" y1="100.2871" y2="100.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1303" y="3920.0234">Bulk DAO</text><ellipse cx="1338" cy="3938.9766" fill="#FEFECE" filter="url(#f12ply0i8jmok6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1326" x2="1350" y1="3952.9766" y2="3952.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1578" y="115.8223">Central Store</text><path d="M1608,66.2871 C1608,56.2871 1626,56.2871 1626,56.2871 C1626,56.2871 1644,56.2871 1644,66.2871 L1644,92.2871 C1644,102.2871 1626,102.2871 1626,102.2871 C1626,102.2871 1608,102.2871 1608,92.2871 L1608,66.2871 " fill="#FEFECE" filter="url(#f12ply0i8jmok6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1608,66.2871 C1608,76.2871 1626,76.2871 1626,76.2871 C1626,76.2871 1644,76.2871 1644,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1578" y="3920.0234">Central Store</text><path d="M1608,3932.9766 C1608,3922.9766 1626,3922.9766 1626,3922.9766 C1626,3922.9766 1644,3922.9766 1644,3932.9766 L1644,3958.9766 C1644,3968.9766 1626,3968.9766 1626,3968.9766 C1626,3968.9766 1608,3968.9766 1608,3958.9766 L1608,3932.9766 " fill="#FEFECE" filter="url(#f12ply0i8jmok6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1608,3932.9766 C1608,3942.9766 1626,3942.9766 1626,3942.9766 C1626,3942.9766 1644,3942.9766 1644,3932.9766 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="159" x="1684" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1691" y="103.8223">BULK_PREP_HANDLER</text><rect fill="#FEFECE" filter="url(#f12ply0i8jmok6)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="159" x="1684" y="3906.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1691" y="3927.0234">BULK_PREP_HANDLER</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="249.0176"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="2800.2109"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="206" y="174.3965"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="3768.7129" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366" y="128.7754"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="850" y="3265.5957"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1217" y="3845.4883"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1023.4023"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1503.9922"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="1972.5605"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="2201.7344"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333" y="2460.4844"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="1068.0234"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="1533.3027"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2001.8711"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2231.0449"/><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1621" y="2489.7949"/><path d="M13,135.7754 L249,135.7754 L249,142.7754 L239,152.7754 L13,152.7754 L13,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3754.7129" style="stroke: #000000; stroke-width: 2.0;" width="1864" x="13" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="28" y="149.3438">Bulk Fulfil Handler Consume</text><polygon fill="#A80036" points="227,170.3965,217,174.3965,227,178.3965,223,174.3965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="365" y1="174.3965" y2="174.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="233" y="169.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="246" y="169.6543">Consume message</text><polygon fill="#A80036" points="112.5,245.0176,102.5,249.0176,112.5,253.0176,108.5,249.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="365" y1="249.0176" y2="249.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118.5" y="236.6201">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="131.5" y="228.9648">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="131.5" y="244.2754">using reference</text><polygon fill="#A80036" points="354,274.3281,364,278.3281,354,282.3281,358,278.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="96.5" x2="360" y1="278.3281" y2="278.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="103.5" y="273.5859">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="116.5" y="273.5859">Return payload</text><path d="M314.5,293.3281 L398.5,293.3281 L398.5,300.3281 L388.5,310.3281 L314.5,310.3281 L314.5,293.3281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="413.5" x="314.5" y="293.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="329.5" y="306.8965">break</text><path d="M324.5,317.6387 L466.5,317.6387 L466.5,324.6387 L456.5,334.6387 L324.5,334.6387 L324.5,317.6387 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="393.5" x="324.5" y="317.6387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="339.5" y="331.207">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="386.8809" y2="386.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="386.8809" y2="399.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="399.8809" y2="399.8809"/><polygon fill="#A80036" points="387,395.8809,377,399.8809,387,403.8809,383,399.8809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="366.8281">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="396" y="351.5176">Validate event - Rule:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="396" y="366.8281">type == 'bulk-fulfil' &amp;&amp; action == 'bulk-commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="396" y="382.1387">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="480" y="382.1387">2001</text><path d="M324.5,428.8809 L539.5,428.8809 L539.5,435.8809 L529.5,445.8809 L324.5,445.8809 L324.5,428.8809 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="324.5" y="428.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="339.5" y="442.4492">Persist Event Information</text><polygon fill="#A80036" points="1078.5,488.502,1088.5,492.502,1078.5,496.502,1082.5,492.502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1084.5" y1="492.502" y2="492.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="487.7598">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="396" y="487.7598">Publish event information</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="331.5" y="500.502"/><polygon fill="#EEEEEE" points="331.5,500.502,395.5,500.502,395.5,507.502,385.5,517.502,331.5,517.502,331.5,500.502" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="344.5" y="515.0703">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="660.75" y="534.0703">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="664.75" y="549.3809"/><path d="M324.5,600.4336 L546.5,600.4336 L546.5,607.4336 L536.5,617.4336 L324.5,617.4336 L324.5,600.4336 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="324.5" y="600.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="339.5" y="614.002">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="331.5" y="642.7441"/><polygon fill="#EEEEEE" points="331.5,642.7441,395.5,642.7441,395.5,649.7441,385.5,659.7441,331.5,659.7441,331.5,642.7441" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="344.5" y="657.3125">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="645.75" y="676.3125">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="863.75" y="676.3125">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="645.75" y="691.623">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="729.75" y="691.623">3105/3106</text><path d="M284.5,717.6758 L516.5,717.6758 L516.5,724.6758 L506.5,734.6758 L284.5,734.6758 L284.5,717.6758 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1932.6719" style="stroke: #000000; stroke-width: 2.0;" width="1523.5" x="284.5" y="717.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="299.5" y="731.2441">Validate Bulk Fulfil Transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="756.2969" y2="756.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="756.2969" y2="769.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="769.2969" y2="769.2969"/><polygon fill="#A80036" points="387,765.2969,377,769.2969,387,773.2969,383,769.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="751.5547">6</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="396" y="751.5547">Schema validation of the incoming message</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="813.918" y2="813.918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="813.918" y2="826.918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="826.918" y2="826.918"/><polygon fill="#A80036" points="387,822.918,377,826.918,387,830.918,383,826.918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="801.5205">7</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="396" y="793.8652">Verify the message's signature</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="396" y="809.1758">(to be confirmed in future requirement)</text><path d="M381,839.918 L381,894.918 L746,894.918 L746,849.918 L736,839.918 L381,839.918 " fill="#D3D3D3" filter="url(#f12ply0i8jmok6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M736,839.918 L736,849.918 L746,849.918 L736,839.918 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="387" y="857.4863">The above validation steps are already handled by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="387" y="872.7969">the ML-Adapter for the open source implementation.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="387" y="888.1074">It may need to be added in future for custom adapters.</text><path d="M294.5,911.8496 L612.5,911.8496 L612.5,918.8496 L602.5,928.8496 L294.5,928.8496 L294.5,911.8496 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1197.6426" style="stroke: #000000; stroke-width: 2.0;" width="1503.5" x="294.5" y="911.8496"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="273" x="309.5" y="925.418">Validate Bulk Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="950.4707" y2="950.4707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="950.4707" y2="963.4707"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="963.4707" y2="963.4707"/><polygon fill="#A80036" points="387,959.4707,377,963.4707,387,967.4707,383,963.4707" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="945.7285">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="396" y="945.7285">Generate bulkTransferFulfilmentId UUID</text><polygon fill="#A80036" points="1321,1019.4023,1331,1023.4023,1321,1027.4023,1325,1023.4023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1327" y1="1023.4023" y2="1023.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="383" y="1003.3496">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="396" y="988.0391">Request to retrieve Bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="396" y="1003.3496">fulfilment hashes by bulkTransferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="396" y="1018.6602">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="473" y="1018.6602">2003</text><polygon fill="#A80036" points="1609,1064.0234,1619,1068.0234,1609,1072.0234,1613,1068.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1343" x2="1615" y1="1068.0234" y2="1068.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1350" y="1055.626">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1372" y="1047.9707">Request Bulk transfer fulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1372" y="1063.2813">duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f12ply0i8jmok6)" points="1473,1081.0234,1778,1081.0234,1788,1107.0234,1778,1134.0234,1473,1134.0234,1463,1107.0234,1473,1081.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1475" y="1097.5918">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1475" y="1112.9023">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="261" x="1515" y="1112.9023">bulkTransferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="1475" y="1128.2129">WHERE bulkTransferId = request.params.id</text><polygon fill="#A80036" points="1354,1157.2656,1344,1161.2656,1354,1165.2656,1350,1161.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1348" x2="1625" y1="1161.2656" y2="1161.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1360" y="1156.5234">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1382" y="1156.5234">Return existing hashes</text><polygon fill="#A80036" points="387,1186.5762,377,1190.5762,387,1194.5762,383,1190.5762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="381" x2="1337" y1="1190.5762" y2="1190.5762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="393" y="1185.834">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="415" y="1185.834">Return</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="47" x="460" y="1185.834">(list of)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="511" y="1185.834">transfer fulfil message hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="1250.5078" y2="1250.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="1250.5078" y2="1263.5078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="1263.5078" y2="1263.5078"/><polygon fill="#A80036" points="387,1259.5078,377,1263.5078,387,1267.5078,383,1263.5078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1230.4551">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="405" y="1215.1445">Loop the list of returned hashes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="405" y="1230.4551">and compare each entry with the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="405" y="1245.7656">calculated message hash</text><path d="M304.5,1278.5078 L366.5,1278.5078 L366.5,1285.5078 L356.5,1295.5078 L304.5,1295.5078 L304.5,1278.5078 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="823.9844" style="stroke: #000000; stroke-width: 2.0;" width="1464.5" x="304.5" y="1278.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="319.5" y="1292.0762">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="381.5" y="1291.1426">[Hash matched]</text><path d="M324.5,1302.8184 L539.5,1302.8184 L539.5,1309.8184 L529.5,1319.8184 L324.5,1319.8184 L324.5,1302.8184 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="826.5" x="324.5" y="1302.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="339.5" y="1316.3867">Persist Event Information</text><polygon fill="#A80036" points="1078.5,1362.4395,1088.5,1366.4395,1078.5,1370.4395,1082.5,1366.4395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1084.5" y1="1366.4395" y2="1366.4395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1361.6973">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="405" y="1361.6973">Publish event information</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="808.5" x="331.5" y="1374.4395"/><polygon fill="#EEEEEE" points="331.5,1374.4395,395.5,1374.4395,395.5,1381.4395,385.5,1391.4395,331.5,1391.4395,331.5,1374.4395" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="344.5" y="1389.0078">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="662.75" y="1408.0078">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="666.75" y="1423.3184"/><polygon fill="#A80036" points="1321,1499.9922,1331,1503.9922,1321,1507.9922,1325,1503.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1327" y1="1503.9922" y2="1503.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1491.5947">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="405" y="1483.9395">Request to retrieve Bulk transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="405" y="1499.25">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="482" y="1499.25">2003</text><polygon fill="#A80036" points="1609,1529.3027,1619,1533.3027,1609,1537.3027,1613,1533.3027" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1343" x2="1615" y1="1533.3027" y2="1533.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1350" y="1528.5605">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1372" y="1528.5605">Request to retrieve Bulk transfer state</text><polygon fill="#FFFFE0" filter="url(#f12ply0i8jmok6)" points="1545,1546.3027,1707,1546.3027,1717,1557.3027,1707,1569.3027,1545,1569.3027,1535,1557.3027,1545,1546.3027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1547" y="1562.8711">bulkTransferStateChange</text><polygon fill="#A80036" points="1354,1591.9238,1344,1595.9238,1354,1599.9238,1350,1595.9238" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1348" x2="1625" y1="1595.9238" y2="1595.9238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1360" y="1591.1816">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1382" y="1591.1816">Return Bulk transfer state</text><polygon fill="#A80036" points="387,1621.2344,377,1625.2344,387,1629.2344,383,1625.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="381" x2="1337" y1="1625.2344" y2="1625.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="393" y="1620.4922">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="415" y="1620.4922">Return Bulk transfer state</text><path d="M314.5,1640.2344 L376.5,1640.2344 L376.5,1647.2344 L366.5,1657.2344 L314.5,1657.2344 L314.5,1640.2344 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="273.75" style="stroke: #000000; stroke-width: 2.0;" width="998.5" x="314.5" y="1640.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="329.5" y="1653.8027">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="391.5" y="1652.8691">[bulkTransferState IN ['COMPLETED', 'REJECTED']]</text><path d="M324.5,1664.5449 L408.5,1664.5449 L408.5,1671.5449 L398.5,1681.5449 L324.5,1681.5449 L324.5,1664.5449 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="78.2422" style="stroke: #000000; stroke-width: 2.0;" width="978.5" x="324.5" y="1664.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="339.5" y="1678.1133">break</text><rect fill="#FFFFFF" filter="url(#f12ply0i8jmok6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="960.5" x="331.5" y="1681.8555"/><polygon fill="#EEEEEE" points="331.5,1681.8555,395.5,1681.8555,395.5,1688.8555,385.5,1698.8555,331.5,1698.8555,331.5,1681.8555" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="344.5" y="1696.4238">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="692.75" y="1715.4238">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="696.75" y="1730.7344"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="314.5" x2="1313" y1="1750.7871" y2="1750.7871"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="319.5" y="1761.4219">[transferState NOT 'ACCEPTED']</text><path d="M324.5,1771.7422 L408.5,1771.7422 L408.5,1778.7422 L398.5,1788.7422 L324.5,1788.7422 L324.5,1771.7422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="201.5" x="324.5" y="1771.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="339.5" y="1785.3105">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="1810.3633" y2="1810.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="1810.3633" y2="1823.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="1823.3633" y2="1823.3633"/><polygon fill="#A80036" points="387,1819.3633,377,1823.3633,387,1827.3633,383,1823.3633" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1805.6211">19</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="405" y="1805.6211">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="482" y="1805.6211">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="314.5" x2="1313" y1="1839.3633" y2="1839.3633"/><path d="M324.5,1847.3633 L408.5,1847.3633 L408.5,1854.3633 L398.5,1864.3633 L324.5,1864.3633 L324.5,1847.3633 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="324.5" y="1847.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="339.5" y="1860.9316">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="1885.9844" y2="1885.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="1885.9844" y2="1898.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="1898.9844" y2="1898.9844"/><polygon fill="#A80036" points="387,1894.9844,377,1898.9844,387,1902.9844,383,1898.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1881.2422">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="405" y="1881.2422">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="304.5" x2="1769" y1="1921.9844" y2="1921.9844"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="309.5" y="1932.6191">[Hash not matched]</text><polygon fill="#A80036" points="1321,1968.5605,1331,1972.5605,1321,1976.5605,1325,1972.5605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1327" y1="1972.5605" y2="1972.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="1960.1631">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="405" y="1952.5078">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="1967.8184">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="1967.8184">2003</text><polygon fill="#A80036" points="1609,1997.8711,1619,2001.8711,1609,2005.8711,1613,2001.8711" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1343" x2="1615" y1="2001.8711" y2="2001.8711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1350" y="1997.1289">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1372" y="1997.1289">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f12ply0i8jmok6)" points="1502,2044.8711,1749,2044.8711,1759,2055.8711,1749,2067.8711,1502,2067.8711,1492,2055.8711,1502,2044.8711" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="1504" y="2061.4395">bulkTransferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="387,2090.4922,377,2094.4922,387,2098.4922,383,2094.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="381" x2="1337" y1="2094.4922" y2="2094.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="393" y="2089.75">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="415" y="2089.75">Return success</text><path d="M314.5,2123.4922 L376.5,2123.4922 L376.5,2130.4922 L366.5,2140.4922 L314.5,2140.4922 L314.5,2123.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="314.5" y="2123.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="329.5" y="2137.0605">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="391.5" y="2136.127">[Validate Bulk Transfer Fulfil (success)]</text><path d="M324.5,2147.8027 L809.5,2147.8027 L809.5,2154.8027 L799.5,2164.8027 L324.5,2164.8027 L324.5,2147.8027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="324.5" y="2147.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="440" x="339.5" y="2161.3711">Persist Bulk Transfer State (with bulktransferState='PROCESSING')</text><polygon fill="#A80036" points="1321,2197.7344,1331,2201.7344,1321,2205.7344,1325,2201.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1327" y1="2201.7344" y2="2201.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="2189.3369">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="405" y="2181.6816">Request to persist bulk transfer fulfil</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="2196.9922">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="2196.9922">2003</text><polygon fill="#A80036" points="1609,2227.0449,1619,2231.0449,1609,2235.0449,1613,2231.0449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1343" x2="1615" y1="2231.0449" y2="2231.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1350" y="2226.3027">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="1372" y="2226.3027">Persist bulkTransferFulfilment</text><polygon fill="#FFFFE0" filter="url(#f12ply0i8jmok6)" points="1545,2274.0449,1707,2274.0449,1717,2300.0449,1707,2327.0449,1545,2327.0449,1535,2300.0449,1545,2274.0449" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1547" y="2290.6133">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1547" y="2305.9238">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1547" y="2321.2344">bulkTransferExtension</text><polygon fill="#A80036" points="387,2350.2871,377,2354.2871,387,2358.2871,383,2354.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="381" x2="1337" y1="2354.2871" y2="2354.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="393" y="2349.5449">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="415" y="2349.5449">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="314.5" x2="1737" y1="2370.2871" y2="2370.2871"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="319.5" y="2380.9219">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M324.5,2391.2422 L858.5,2391.2422 L858.5,2398.2422 L848.5,2408.2422 L324.5,2408.2422 L324.5,2391.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="324.5" y="2391.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="489" x="339.5" y="2404.8105">Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')</text><polygon fill="#A80036" points="1321,2456.4844,1331,2460.4844,1321,2464.4844,1325,2460.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1327" y1="2460.4844" y2="2460.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="2440.4316">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="405" y="2425.1211">Request to persist bulk</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="405" y="2440.4316">transfer fulfil failure</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="2455.7422">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="2455.7422">2003</text><polygon fill="#A80036" points="1609,2485.7949,1619,2489.7949,1609,2493.7949,1613,2489.7949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1343" x2="1615" y1="2489.7949" y2="2489.7949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1350" y="2485.0527">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1372" y="2485.0527">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f12ply0i8jmok6)" points="1545,2532.7949,1707,2532.7949,1717,2566.7949,1707,2601.7949,1545,2601.7949,1535,2566.7949,1545,2532.7949" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1547" y="2549.3633">bulkTransferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1547" y="2564.6738">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1547" y="2579.9844">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1547" y="2595.2949">bulkTransferError</text><polygon fill="#A80036" points="387,2624.3477,377,2628.3477,387,2632.3477,383,2628.3477" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="381" x2="1337" y1="2628.3477" y2="2628.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="393" y="2623.6055">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="415" y="2623.6055">Return success</text><path d="M23,2664.3477 L85,2664.3477 L85,2671.3477 L75,2681.3477 L23,2681.3477 L23,2664.3477 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1219.1406" style="stroke: #000000; stroke-width: 2.0;" width="1844" x="23" y="2664.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="2677.916">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="223" x="100" y="2676.9824">[Validate Bulk Transfer Fulfil (success)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="418" y1="2718.2793" y2="2718.2793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="418" x2="418" y1="2718.2793" y2="2731.2793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="377" x2="418" y1="2731.2793" y2="2731.2793"/><polygon fill="#A80036" points="387,2727.2793,377,2731.2793,387,2735.2793,383,2731.2793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="2705.8818">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="405" y="2698.2266">Break down the bulk into indidivual transfers</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="2713.5371">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="2713.5371">2003</text><path d="M33,2746.2793 L107,2746.2793 L107,2753.2793 L97,2763.2793 L33,2763.2793 L33,2746.2793 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="557.3164" style="stroke: #000000; stroke-width: 2.0;" width="1824" x="33" y="2746.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="48" y="2759.8477">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="288" x="122" y="2758.9141">[for every individual transfer in the bulk fulfil list]</text><polygon fill="#A80036" points="112.5,2796.2109,102.5,2800.2109,112.5,2804.2109,108.5,2800.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="1764.5" y1="2800.2109" y2="2800.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="118.5" y="2787.8135">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="140.5" y="2780.1582">Retrieve each individual transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="140.5" y="2795.4688">in the bulk using the reference</text><polygon fill="#A80036" points="1753.5,2825.5215,1763.5,2829.5215,1753.5,2833.5215,1757.5,2829.5215" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="96.5" x2="1759.5" y1="2829.5215" y2="2829.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="103.5" y="2824.7793">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="125.5" y="2824.7793">Return individual transfers as queried</text><path d="M381,2842.5215 L381,3219.5215 L643,3219.5215 L643,2852.5215 L633,2842.5215 L381,2842.5215 " fill="#FFFF00" filter="url(#f12ply0i8jmok6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M633,2842.5215 L633,2852.5215 L643,2852.5215 L633,2842.5215 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="387" y="2860.0898">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="387" y="2875.4004">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="403" y="2890.7109">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="403" y="2906.0215">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="403" y="2921.332">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="403" y="2936.6426">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="403" y="2951.9531">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="419" y="2967.2637">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="419" y="2982.5742">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="403" y="2997.8848">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="403" y="3013.1953">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="419" y="3028.5059">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="435" y="3043.8164">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="435" y="3059.127">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="435" y="3074.4375">type: bulk-fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="435" y="3089.748">action: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="435" y="3105.0586">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="435" y="3120.3691">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="451" y="3135.6797">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="451" y="3150.9902">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="435" y="3166.3008">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="419" y="3181.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="403" y="3196.9219">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="387" y="3212.2324">}</text><polygon fill="#A80036" points="838,3261.5957,848,3265.5957,838,3269.5957,842,3265.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="844" y1="3265.5957" y2="3265.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="3253.1982">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="405" y="3245.543">Route &amp; Publish Prepare event to the Payer for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="3260.8535">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="3260.8535">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1867" y1="3311.5957" y2="3311.5957"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="28" y="3322.2305">[Validate Bulk Transfer Fulfil (failure)]</text><path d="M381,3330.5508 L381,3799.5508 L988,3799.5508 L988,3340.5508 L978,3330.5508 L381,3330.5508 " fill="#FFFF00" filter="url(#f12ply0i8jmok6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M978,3330.5508 L978,3340.5508 L988,3340.5508 L978,3330.5508 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="387" y="3348.1191">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="387" y="3363.4297">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="403" y="3378.7402">id: &lt;bulkTransferMessage.bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="403" y="3394.0508">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="403" y="3409.3613">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="403" y="3424.6719">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="403" y="3439.9824">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="419" y="3455.293">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="419" y="3470.6035">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="435" y="3485.9141">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="451" y="3501.2246">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="451" y="3516.5352">"errorDescription": "&lt;refer to section 35.1.3 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="451" y="3531.8457">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="419" y="3547.1563">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="403" y="3562.4668">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="403" y="3577.7773">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="419" y="3593.0879">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="435" y="3608.3984">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="435" y="3623.709">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="435" y="3639.0195">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="435" y="3654.3301">action: bulk-abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="435" y="3669.6406">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="435" y="3684.9512">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="451" y="3700.2617">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="451" y="3715.5723">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="451" y="3730.8828">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="435" y="3746.1934">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="419" y="3761.5039">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="403" y="3776.8145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="387" y="3792.125">}</text><polygon fill="#A80036" points="1205,3841.4883,1215,3845.4883,1205,3849.4883,1209,3845.4883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="376" x2="1211" y1="3845.4883" y2="3845.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="383" y="3833.0908">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="405" y="3825.4355">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="405" y="3840.7461">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="489" y="3840.7461">2003</text><!--
@startuml
title 2.1.1. Bulk Fulfil Handler Consume

autonumber


collections "mongo-\nobject-store" as OBJECT_STORE
collections "topic-bulk-\nfulfil" as TOPIC_BULK_FULFIL
collections "topic-bulk-\nprocessing" as TOPIC_BULK_PROCESSING
control "Bulk Fulfil\nHandler" as BULK_FULF_HANDLER
collections "topic-transfer-\nfulfil" as TOPIC_TRANSFER_FULFIL
collections "topic-event" as TOPIC_EVENTS
collections "topic-notification" as TOPIC_NOTIFICATION
entity "Bulk DAO" as BULK_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant TOPIC_BULK_FULFIL
    participant BULK_FULF_HANDLER
    participant TOPIC_TRANSFER_FULFIL
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATION
    participant BULK_DAO
    participant DB
end box

activate BULK_FULF_HANDLER
group Bulk Fulfil Handler Consume
    TOPIC_BULK_FULFIL <- BULK_FULF_HANDLER: Consume message
    activate TOPIC_BULK_FULFIL
    deactivate TOPIC_BULK_FULFIL

    BULK_FULF_HANDLER -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_FULF_HANDLER: Return payload
    deactivate OBJECT_STORE

    break
        group Validate Event
            BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Validate event - Rule:\ntype == 'bulk-fulfil' && action == 'bulk-commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume \n
        |||
    end

    group Validate FSPIOP-Signature
        |||
        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 3105/3106</color>
    end

    group Validate Bulk Fulfil Transfer
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Schema validation of the incoming message</color>
        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #gray>Verify the message's signature</color>\n<color #gray>(to be confirmed in future requirement)</color>
        note right of BULK_FULF_HANDLER #lightgrey
            The above validation steps are already handled by
            the ML-Adapter for the open source implementation.
            It may need to be added in future for custom adapters.
        end note
        group Validate Bulk Fulfilment Duplicate Check
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Generate bulkTransferFulfilmentId UUID
            BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer\nfulfilment hashes by bulkTransferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate BULK_DAO
            BULK_DAO -> DB: Request Bulk transfer fulfilment\nduplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **bulkTransferFulfilmentDuplicateCheck**
                WHERE bulkTransferId = request.params.id
            end note
            activate DB
            BULK_DAO <- - DB: Return existing hashes
            deactivate DB
            BULK_DAO - -> BULK_FULF_HANDLER: Return <color #red>**(list of)**</color> transfer fulfil message hash(es)
            deactivate BULK_DAO
            BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Loop the list of returned hashes\nand compare each entry with the\ncalculated message hash

            alt Hash matched
                group Persist Event Information
                    |||
                    BULK_FULF_HANDLER -> TOPIC_EVENTS: Publish event information
                    ref over BULK_FULF_HANDLER, TOPIC_EVENTS:  Event Handler Consume\n
                    |||
                end
                BULK_FULF_HANDLER -> BULK_DAO: Request to retrieve Bulk transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Request to retrieve Bulk transfer state
                hnote over DB #lightyellow
                    bulkTransferStateChange
                end note
                activate DB
                BULK_DAO <- - DB: Return Bulk transfer state
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return Bulk transfer state
                deactivate BULK_DAO
                alt bulkTransferState IN ['COMPLETED', 'REJECTED']
                    break
                        ref over BULK_FULF_HANDLER, TOPIC_NOTIFICATION: Send notification to Participant (Payee)\n
                    end
                else transferState NOT 'ACCEPTED'
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        BULK_FULF_HANDLER <-> BULK_FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    bulkTransferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
            
        end
        
        alt Validate Bulk Transfer Fulfil (success)
            group Persist Bulk Transfer State (with bulktransferState='PROCESSING')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk transfer fulfil\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist bulkTransferFulfilment
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        else Validate Bulk Transfer Fulfil (failure)
            group Persist Bulk Transfer State (with bulkTransferState='INVALID/REJECTED')
                BULK_FULF_HANDLER -> BULK_DAO: Request to persist bulk\ntransfer fulfil failure\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Persist transfer
                hnote over DB #lightyellow
                    bulkTransferFulfilment
                    bulkTransferStateChange
                    bulkTransferExtension
                    bulkTransferError
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_FULF_HANDLER: Return success
                deactivate BULK_DAO
            end
        end

    end
    alt Validate Bulk Transfer Fulfil (success)
        BULK_FULF_HANDLER -> BULK_FULF_HANDLER: Break down the bulk into indidivual transfers\n<color #FF0000><b>Error codes:</b> 2003</color>
        loop for every individual transfer in the bulk fulfil list
            BULK_PREP_HANDLER -> OBJECT_STORE: Retrieve each individual transfer\nin the bulk using the reference
            activate OBJECT_STORE
            OBJECT_STORE - -> BULK_PREP_HANDLER: Return individual transfers as queried
            deactivate OBJECT_STORE

            note right of BULK_FULF_HANDLER #yellow
                Message:
                {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: bulk-fulfil,
                            action: fulfil,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
            BULK_FULF_HANDLER -> TOPIC_TRANSFER_FULFIL: Route & Publish Prepare event to the Payer for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_FULFIL
            deactivate TOPIC_TRANSFER_FULFIL
        end
    else Validate Bulk Transfer Fulfil (failure)
        note right of BULK_FULF_HANDLER #yellow
            Message:
            {
                id: <bulkTransferMessage.bulkTransferId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: application/json
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 35.1.3 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-processing,
                        action: bulk-abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_FULF_HANDLER -> TOPIC_NOTIFICATION: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_NOTIFICATION
        deactivate TOPIC_NOTIFICATION
    end
end
deactivate BULK_FULF_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>