<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="6957px" preserveAspectRatio="none" style="width:1949px;height:6957px;" version="1.1" viewBox="0 0 1949 6957" width="1949px" zoomAndPan="magnify"><defs><filter height="300%" id="f1g5kzaghnfd4b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="701" x="625" y="23.5352">2.2.1. Fulfil Handler Consume (Success) (single message, includes individual transfers from Bulk)</text><rect fill="#FFFFE0" height="6911.8652" style="stroke: #A80036; stroke-width: 1.0;" width="1786" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="871.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="6744.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="890" y="5179.5801"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="890" y="5645.2988"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="2176.7441"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="2796.2813"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="3488.1289"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="6353.1465"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="1680.4043"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="6818.8652"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="711.8086"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="1034.8457"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="3598.7051"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="3803.5684"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4133.2949"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4368.0898"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4605.5742"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="741.1191"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="1064.1563"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="3628.0156"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="3832.8789"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4162.6055"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4397.4004"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4634.8848"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="5736.1641" style="stroke: #000000; stroke-width: 2.0;" width="1925" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="5704.8535" style="stroke: #000000; stroke-width: 2.0;" width="1905" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="450" x="308" y="241.2188"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="430" x="318" y="265.5293"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="731" x="318" y="376.7715"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="498.3242"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="3120.0703" style="stroke: #000000; stroke-width: 2.0;" width="1640" x="278" y="615.5664"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2792.3438" style="stroke: #000000; stroke-width: 2.0;" width="1603" x="288" y="936.293"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2353.7305" style="stroke: #000000; stroke-width: 2.0;" width="1026" x="298" y="1186.3984"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="1011.0352" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="1210.709"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="979.7246" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="1235.0195"/><rect fill="#FFFFFF" height="496.3398" style="stroke: none; stroke-width: 1.0;" width="986" x="318" y="1718.4043"/><rect fill="#FFFFFF" height="619.5371" style="stroke: none; stroke-width: 1.0;" width="1026" x="298" y="2228.7441"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="590.582" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="2250.6992"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="559.2715" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="2275.0098"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="986" x="318" y="2353.252"/><rect fill="#FFFFFF" height="103.8867" style="stroke: none; stroke-width: 1.0;" width="1026" x="298" y="2848.2813"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="318" y="2870.2363"/><rect fill="#FFFFFF" height="587.9609" style="stroke: none; stroke-width: 1.0;" width="1026" x="298" y="2952.168"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="571.9609" style="stroke: #000000; stroke-width: 2.0;" width="896" x="308" y="2961.168"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="540.6504" style="stroke: #000000; stroke-width: 2.0;" width="876" x="318" y="2985.4785"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="876" x="318" y="3045.0996"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1603" x="288" y="3547.1289"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2051.5488" style="stroke: #000000; stroke-width: 2.0;" width="1570" x="298" y="3749.6367"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1545" x="308" y="4055.0527"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="213.7949" style="stroke: #000000; stroke-width: 2.0;" width="1525" x="318" y="4079.3633"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1523" x="318" y="4314.1582"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="1266.8535" style="stroke: #000000; stroke-width: 2.0;" width="1550" x="308" y="4527.332"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1530" x="318" y="4551.6426"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="657" x="318" y="4749.5059"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="657" x="318" y="5217.5801"/><rect fill="#FFFFFF" height="103.8867" style="stroke: none; stroke-width: 1.0;" width="1550" x="308" y="5690.2988"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="382" x="318" y="5712.2539"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1905" x="23" y="5808.1855"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="5883.4512"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="5907.7617"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="986" x="318" y="6391.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="84" x2="84" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="377" x2="377" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="895" x2="895" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1007" x2="1007" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1116" x2="1116" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1244" x2="1244" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1352" x2="1352" y1="116.2871" y2="6880.8652"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1763" x2="1763" y1="116.2871" y2="6880.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="101.334">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="37" y="6879.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="33" y="6883.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="40" y="6904.4004">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="328" y="113.334">Fulfil Handler</text><ellipse cx="377" cy="83.7988" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="373,71.7988,379,66.7988,377,71.7988,379,76.7988,373,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="328" y="6893.4004">Fulfil Handler</text><ellipse cx="377" cy="6912.3535" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="373,6900.3535,379,6895.3535,377,6900.3535,379,6905.3535,373,6900.3535" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="829" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="825" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="870" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="832" y="101.334">transfer-position</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="829" y="6879.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="825" y="6883.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="870" y="6904.4004">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="832" y="6920.8887">transfer-position</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="979" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="975" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="982" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="984.5" y="101.334">event</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="979" y="6879.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="975" y="6883.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="982" y="6904.4004">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="984.5" y="6920.8887">event</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1053" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1049" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1091.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1056" y="101.334">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1053" y="6879.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1049" y="6883.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1091.5" y="6904.4004">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1056" y="6920.8887">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1198" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1194" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1219" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1201" y="101.334">notification</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1198" y="6879.8652"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1194" y="6883.8652"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1219" y="6904.4004">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1201" y="6920.8887">notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1304" y="113.334">Position DAO</text><ellipse cx="1352" cy="83.7988" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1340" x2="1364" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1304" y="6893.4004">Position DAO</text><ellipse cx="1352" cy="6912.3535" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1340" x2="1364" y1="6926.3535" y2="6926.3535"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1715" y="113.334">Central Store</text><path d="M1745,63.7988 C1745,53.7988 1763,53.7988 1763,53.7988 C1763,53.7988 1781,53.7988 1781,63.7988 L1781,89.7988 C1781,99.7988 1763,99.7988 1763,99.7988 C1763,99.7988 1745,99.7988 1745,89.7988 L1745,63.7988 " fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1745,63.7988 C1745,73.7988 1763,73.7988 1763,73.7988 C1763,73.7988 1781,73.7988 1781,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1715" y="6893.4004">Central Store</text><path d="M1745,6906.3535 C1745,6896.3535 1763,6896.3535 1763,6896.3535 C1763,6896.3535 1781,6896.3535 1781,6906.3535 L1781,6932.3535 C1781,6942.3535 1763,6942.3535 1763,6942.3535 C1763,6942.3535 1745,6942.3535 1745,6932.3535 L1745,6906.3535 " fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1745,6906.3535 C1745,6916.3535 1763,6916.3535 1763,6916.3535 C1763,6916.3535 1781,6916.3535 1781,6906.3535 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="79" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="6744.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="372" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="890" y="5179.5801"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="890" y="5645.2988"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="2176.7441"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="2796.2813"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="3488.1289"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1111.5" y="6353.1465"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="1680.4043"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1239" y="6818.8652"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="711.8086"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="1034.8457"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="3598.7051"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="3803.5684"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4133.2949"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4368.0898"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1347" y="4605.5742"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="741.1191"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="1064.1563"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="3628.0156"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="3832.8789"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4162.6055"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4397.4004"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1758" y="4634.8848"/><path d="M13,133.2871 L282,133.2871 L282,140.2871 L272,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5736.1641" style="stroke: #000000; stroke-width: 2.0;" width="1925" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="28" y="146.8555">Fulfil Handler Consume (Success)</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5704.8535" style="stroke: #000000; stroke-width: 2.0;" width="1905" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="100,192.2188,90,196.2188,100,200.2188,96,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="371" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="106" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="119" y="191.4766">Consume Fulfil event message for Payer</text><path d="M308,241.2188 L392,241.2188 L392,248.2188 L382,258.2188 L308,258.2188 L308,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="450" x="308" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="323" y="254.7871">break</text><path d="M318,265.5293 L460,265.5293 L460,272.5293 L450,282.5293 L318,282.5293 L318,265.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="430" x="318" y="265.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="333" y="279.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="334.7715" y2="334.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="334.7715" y2="347.7715"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="347.7715" y2="347.7715"/><polygon fill="#A80036" points="393,343.7715,383,347.7715,393,351.7715,389,347.7715" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="314.7188">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="402" y="299.4082">Validate event - Rule: type IN ['fulfil', 'bulk-fulfil'] &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="402" y="314.7188">action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="402" y="330.0293">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="486" y="330.0293">2001</text><path d="M318,376.7715 L533,376.7715 L533,383.7715 L523,393.7715 L318,393.7715 L318,376.7715 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="731" x="318" y="376.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="333" y="390.3398">Persist Event Information</text><polygon fill="#A80036" points="995,411.3926,1005,415.3926,995,419.3926,999,415.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1001" y1="415.3926" y2="415.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="410.6504">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="402" y="410.6504">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="713" x="325" y="423.3926"/><polygon fill="#EEEEEE" points="325,423.3926,389,423.3926,389,430.3926,379,440.3926,325,440.3926,325,423.3926" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="338" y="437.9609">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="608.5" y="456.9609">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="612.5" y="472.2715"/><path d="M318,498.3242 L540,498.3242 L540,505.3242 L530,515.3242 L318,515.3242 L318,498.3242 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="498.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="333" y="511.8926">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="968" x="325" y="540.6348"/><polygon fill="#EEEEEE" points="325,540.6348,389,540.6348,389,547.6348,379,557.6348,325,557.6348,325,540.6348" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="338" y="555.2031">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="643" y="574.2031">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="861" y="574.2031">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="643" y="589.5137">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="727" y="589.5137">3105/3106</text><path d="M278,615.5664 L625,615.5664 L625,622.5664 L615,632.5664 L278,632.5664 L278,615.5664 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3120.0703" style="stroke: #000000; stroke-width: 2.0;" width="1640" x="278" y="615.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="302" x="293" y="629.1348">Validate Transfer Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="654.1875" y2="654.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="654.1875" y2="667.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="667.1875" y2="667.1875"/><polygon fill="#A80036" points="393,663.1875,383,667.1875,393,671.1875,389,667.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="649.4453">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="402" y="649.4453">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1335,707.8086,1345,711.8086,1335,715.8086,1339,711.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="711.8086" y2="711.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="699.4111">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="402" y="691.7559">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="402" y="707.0664">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="479" y="707.0664">2003</text><polygon fill="#A80036" points="1746,737.1191,1756,741.1191,1746,745.1191,1750,741.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="741.1191" y2="741.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1364" y="736.377">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="1377" y="736.377">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1627,754.1191,1898,754.1191,1908,780.1191,1898,807.1191,1627,807.1191,1617,780.1191,1627,754.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1629" y="770.6875">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1629" y="785.998">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1669" y="785.998">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1629" y="801.3086">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1368,830.3613,1358,834.3613,1368,838.3613,1364,834.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1362" x2="1762" y1="834.3613" y2="834.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1374" y="829.6191">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1387" y="829.6191">Return existing hashes</text><polygon fill="#A80036" points="393,859.6719,383,863.6719,393,867.6719,389,863.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="863.6719" y2="863.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="399" y="858.9297">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="412" y="858.9297">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="908.293" y2="908.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="908.293" y2="921.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="921.293" y2="921.293"/><polygon fill="#A80036" points="393,917.293,383,921.293,393,925.293,389,921.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="389" y="895.8955">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="402" y="888.2402">Loop the list of returned hashes and compare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="402" y="903.5508">each entry with the calculated message hash</text><path d="M288,936.293 L350,936.293 L350,943.293 L340,953.293 L288,953.293 L288,936.293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2792.3438" style="stroke: #000000; stroke-width: 2.0;" width="1603" x="288" y="936.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="303" y="949.8613">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="365" y="948.9277">[Hash matched]</text><polygon fill="#A80036" points="995,986.2246,1005,990.2246,995,994.2246,999,990.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1001" y1="990.2246" y2="990.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="977.8271">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="411" y="970.1719">Publish event information (for duplicate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="411" y="985.4824">(Event Handler Consume)</text><polygon fill="#A80036" points="1335,1030.8457,1345,1034.8457,1335,1038.8457,1339,1034.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="1034.8457" y2="1034.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1022.4482">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="411" y="1014.793">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="1030.1035">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="1030.1035">2003</text><polygon fill="#A80036" points="1746,1060.1563,1756,1064.1563,1746,1068.1563,1750,1064.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="1064.1563" y2="1064.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="1059.4141">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="1386" y="1059.4141">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1697,1077.1563,1828,1077.1563,1838,1096.1563,1828,1115.1563,1697,1115.1563,1687,1096.1563,1697,1077.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1699" y="1093.7246">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1699" y="1109.0352">transferStateChange</text><polygon fill="#A80036" points="1368,1138.0879,1358,1142.0879,1368,1146.0879,1364,1142.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1362" x2="1762" y1="1142.0879" y2="1142.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1374" y="1137.3457">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1396" y="1137.3457">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="393,1167.3984,383,1171.3984,393,1175.3984,389,1171.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="1171.3984" y2="1171.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="1166.6563">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="421" y="1166.6563">Return Transfer Fulfilment and Transfer state</text><path d="M298,1186.3984 L360,1186.3984 L360,1193.3984 L350,1203.3984 L298,1203.3984 L298,1186.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2353.7305" style="stroke: #000000; stroke-width: 2.0;" width="1026" x="298" y="1186.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="313" y="1199.9668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="185" x="375" y="1199.0332">[transferFulfilment.isValid == 0]</text><path d="M308,1210.709 L392,1210.709 L392,1217.709 L382,1227.709 L308,1227.709 L308,1210.709 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1011.0352" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="1210.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="323" y="1224.2773">break</text><path d="M318,1235.0195 L380,1235.0195 L380,1242.0195 L370,1252.0195 L318,1252.0195 L318,1235.0195 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="979.7246" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="1235.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="333" y="1248.5879">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="395" y="1247.6543">[If type == 'fulfil']</text><path d="M387,1257.3301 L387,1634.3301 L696,1634.3301 L696,1267.3301 L686,1257.3301 L387,1257.3301 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,1257.3301 L686,1267.3301 L696,1267.3301 L686,1257.3301 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="1274.8984">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1290.209">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="1305.5195">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="1320.8301">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="1336.1406">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="1351.4512">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="1366.7617">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="1382.0723">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="1397.3828">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="1412.6934">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="1428.0039">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1443.3145">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="1458.625">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="1473.9355">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="441" y="1489.2461">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="441" y="1504.5566">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="1519.8672">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="1535.1777">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="457" y="1550.4883">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="1565.7988">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="1581.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="1596.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1611.7305">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1627.041">}</text><polygon fill="#A80036" points="1227,1676.4043,1237,1680.4043,1227,1684.4043,1231,1680.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1233" y1="1680.4043" y2="1680.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="1668.0068">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="411" y="1660.3516">Publish Notification event for Payee - Modified Request</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="1675.6621">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="1675.6621">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318" x2="1304" y1="1719.4043" y2="1719.4043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="323" y="1730.0391">[If type == 'bulk-fulfil']</text><path d="M387,1738.3594 L387,2115.3594 L696,2115.3594 L696,1748.3594 L686,1738.3594 L387,1738.3594 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,1738.3594 L686,1748.3594 L696,1748.3594 L686,1738.3594 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="1755.9277">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1771.2383">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="1786.5488">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="1801.8594">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="1817.1699">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="1832.4805">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="1847.791">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="1863.1016">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="1878.4121">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="1893.7227">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="1909.0332">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1924.3438">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="1939.6543">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="1954.9648">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="441" y="1970.2754">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="441" y="1985.5859">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="2000.8965">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="2016.207">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="457" y="2031.5176">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="2046.8281">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="2062.1387">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="2077.4492">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="2092.7598">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="2108.0703">}</text><polygon fill="#A80036" points="1099.5,2172.7441,1109.5,2176.7441,1099.5,2180.7441,1103.5,2176.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1105.5" y1="2176.7441" y2="2176.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2156.6914">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="411" y="2141.3809">Publish Notification event for Payee - Modified Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="411" y="2156.6914">3106 to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="2172.002">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="2172.002">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="298" x2="1324" y1="2229.7441" y2="2229.7441"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="303" y="2240.3789">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M308,2250.6992 L392,2250.6992 L392,2257.6992 L382,2267.6992 L308,2267.6992 L308,2250.6992 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="590.582" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="2250.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="323" y="2264.2676">break</text><path d="M318,2275.0098 L380,2275.0098 L380,2282.0098 L370,2292.0098 L318,2292.0098 L318,2275.0098 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="559.2715" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="2275.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="333" y="2288.5781">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="395" y="2287.6445">[If type == 'fulfil']</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="968" x="325" y="2292.3203"/><polygon fill="#EEEEEE" points="325,2292.3203,389,2292.3203,389,2299.3203,379,2309.3203,325,2309.3203,325,2292.3203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="338" y="2306.8887">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="690" y="2325.8887">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="694" y="2341.1992"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318" x2="1304" y1="2354.252" y2="2354.252"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="323" y="2364.8867">[If type == 'bulk-fulfil']</text><path d="M387,2373.207 L387,2750.207 L696,2750.207 L696,2383.207 L686,2373.207 L387,2373.207 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,2373.207 L686,2383.207 L696,2383.207 L686,2373.207 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="2390.7754">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="2406.0859">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="2421.3965">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="2436.707">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="2452.0176">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="2467.3281">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="2482.6387">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="2497.9492">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="2513.2598">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="2528.5703">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="2543.8809">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="2559.1914">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="2574.502">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="2589.8125">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="441" y="2605.123">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="441" y="2620.4336">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="2635.7441">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="2651.0547">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="2666.3652">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="2681.6758">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="2696.9863">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="2712.2969">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="2727.6074">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="2742.918">}</text><polygon fill="#A80036" points="1099.5,2792.2813,1109.5,2796.2813,1099.5,2800.2813,1103.5,2796.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1105.5" y1="2796.2813" y2="2796.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2783.8838">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="411" y="2776.2285">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="2791.5391">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="2791.5391">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="298" x2="1324" y1="2849.2813" y2="2849.2813"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="303" y="2859.916">[transferState NOT 'RESERVED']</text><path d="M318,2870.2363 L402,2870.2363 L402,2877.2363 L392,2887.2363 L318,2887.2363 L318,2870.2363 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="318" y="2870.2363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="333" y="2883.8047">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="2924.168" y2="2924.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="2924.168" y2="2937.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="2937.168" y2="2937.168"/><polygon fill="#A80036" points="393,2933.168,383,2937.168,393,2941.168,389,2937.168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="2911.7705">18</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="411" y="2904.1152">Reference: Failure in validation</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="2919.4258">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="2919.4258">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="298" x2="1324" y1="2953.168" y2="2953.168"/><path d="M308,2961.168 L392,2961.168 L392,2968.168 L382,2978.168 L308,2978.168 L308,2961.168 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="571.9609" style="stroke: #000000; stroke-width: 2.0;" width="896" x="308" y="2961.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="323" y="2974.7363">break</text><path d="M318,2985.4785 L380,2985.4785 L380,2992.4785 L370,3002.4785 L318,3002.4785 L318,2985.4785 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="540.6504" style="stroke: #000000; stroke-width: 2.0;" width="876" x="318" y="2985.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="333" y="2999.0469">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="395" y="2998.1133">[If type == 'fulfil']</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="3024.0996" y2="3024.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="3024.0996" y2="3037.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="3037.0996" y2="3037.0996"/><polygon fill="#A80036" points="393,3033.0996,383,3037.0996,393,3041.0996,389,3037.0996" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3019.3574">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="411" y="3019.3574">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318" x2="1194" y1="3046.0996" y2="3046.0996"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="323" y="3056.7344">[If type == 'bulk-fulfil']</text><path d="M387,3065.0547 L387,3442.0547 L696,3442.0547 L696,3075.0547 L686,3065.0547 L387,3065.0547 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,3065.0547 L686,3075.0547 L696,3075.0547 L686,3065.0547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="3082.623">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3097.9336">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="3113.2441">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="3128.5547">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="3143.8652">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="3159.1758">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="3174.4863">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="3189.7969">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="3205.1074">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="3220.418">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="3235.7285">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="3251.0391">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="3266.3496">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="3281.6602">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="441" y="3296.9707">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="441" y="3312.2813">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="3327.5918">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="3342.9023">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="3358.2129">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="3373.5234">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="3388.834">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="3404.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="3419.4551">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="3434.7656">}</text><polygon fill="#A80036" points="1099.5,3484.1289,1109.5,3488.1289,1099.5,3492.1289,1103.5,3488.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1105.5" y1="3488.1289" y2="3488.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3475.7314">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="411" y="3468.0762">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="3483.3867">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="3483.3867">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="288" x2="1891" y1="3548.1289" y2="3548.1289"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="293" y="3558.7637">[Hash not matched]</text><polygon fill="#A80036" points="1335,3594.7051,1345,3598.7051,1335,3602.7051,1339,3598.7051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="3598.7051" y2="3598.7051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3586.3076">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="411" y="3578.6523">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="3593.9629">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="3593.9629">2003</text><polygon fill="#A80036" points="1746,3624.0156,1756,3628.0156,1746,3632.0156,1750,3628.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="3628.0156" y2="3628.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="3623.2734">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1386" y="3623.2734">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1655,3671.0156,1871,3671.0156,1881,3682.0156,1871,3694.0156,1655,3694.0156,1645,3682.0156,1655,3671.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1657" y="3687.584">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="393,3716.6367,383,3720.6367,393,3724.6367,389,3720.6367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="3720.6367" y2="3720.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="3715.8945">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="3715.8945">Return success</text><path d="M298,3749.6367 L612,3749.6367 L612,3756.6367 L602,3766.6367 L298,3766.6367 L298,3749.6367 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2051.5488" style="stroke: #000000; stroke-width: 2.0;" width="1570" x="298" y="3749.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="269" x="313" y="3763.2051">Validate and persist Transfer Fulfilment</text><polygon fill="#A80036" points="1335,3799.5684,1345,3803.5684,1335,3807.5684,1339,3803.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="3803.5684" y2="3803.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3791.1709">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="411" y="3783.5156">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="3798.8262">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="3798.8262">2003</text><polygon fill="#A80036" points="1746,3828.8789,1756,3832.8789,1746,3836.8789,1750,3832.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="3832.8789" y2="3832.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="3828.1367">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1386" y="3828.1367">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1736,3845.8789,1789,3845.8789,1799,3856.8789,1789,3868.8789,1736,3868.8789,1726,3856.8789,1736,3845.8789" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1738" y="3862.4473">transfer</text><polygon fill="#A80036" points="1368,3891.5,1358,3895.5,1368,3899.5,1364,3895.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1362" x2="1762" y1="3895.5" y2="3895.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1374" y="3890.7578">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1400" y="3890.7578"/><polygon fill="#A80036" points="393,3920.8105,383,3924.8105,393,3928.8105,389,3924.8105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="3924.8105" y2="3924.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="3920.0684">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="421" y="3920.0684">Return transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="3969.4316" y2="3969.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="3969.4316" y2="3982.4316"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="3982.4316" y2="3982.4316"/><polygon fill="#A80036" points="393,3978.4316,383,3982.4316,393,3986.4316,389,3982.4316" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="3957.0342">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="411" y="3949.3789">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="3964.6895">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="3964.6895">2001</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="4027.0527" y2="4027.0527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="4027.0527" y2="4040.0527"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="4040.0527" y2="4040.0527"/><polygon fill="#A80036" points="393,4036.0527,383,4040.0527,393,4044.0527,389,4040.0527" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4014.6553">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="411" y="4007">Validate expirationDate</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="4022.3105">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="4022.3105">3303</text><path d="M308,4055.0527 L375,4055.0527 L375,4062.0527 L365,4072.0527 L308,4072.0527 L308,4055.0527 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1545" x="308" y="4055.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="323" y="4068.6211">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="390" y="4067.6875">[Transfer.ilpCondition validate successful]</text><path d="M318,4079.3633 L605,4079.3633 L605,4086.3633 L595,4096.3633 L318,4096.3633 L318,4079.3633 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="213.7949" style="stroke: #000000; stroke-width: 2.0;" width="1525" x="318" y="4079.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="242" x="333" y="4092.9316">Request current Settlement Window</text><polygon fill="#A80036" points="1335,4129.2949,1345,4133.2949,1335,4137.2949,1339,4133.2949" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="4133.2949" y2="4133.2949"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4120.8975">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="411" y="4113.2422">Request to retrieve current/latest transfer settlement window</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="4128.5527">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="4128.5527">2003</text><polygon fill="#A80036" points="1746,4158.6055,1756,4162.6055,1746,4166.6055,1750,4162.6055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="4162.6055" y2="4162.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="4157.8633">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1386" y="4157.8633">Fetch settlementWindowId</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1703,4175.6055,1823,4175.6055,1833,4186.6055,1823,4198.6055,1703,4198.6055,1693,4186.6055,1703,4175.6055" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1705" y="4192.1738">settlementWindow</text><polygon fill="#A80036" points="1368,4221.2266,1358,4225.2266,1368,4229.2266,1364,4225.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1362" x2="1762" y1="4225.2266" y2="4225.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1374" y="4220.4844">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1400" y="4220.4844"/><polygon fill="#A80036" points="393,4281.1582,383,4285.1582,393,4289.1582,389,4285.1582" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="4285.1582" y2="4285.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="4265.1055">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="421" y="4249.7949">Return settlementWindowId to be appended during transferFulfilment insert</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="421" y="4265.1055">TODO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="462" y="4265.1055">: During settlement design make sure transfers in 'RECEIVED-FULFIL'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="421" y="4280.416">state are updated to the next settlement window</text><path d="M318,4314.1582 L478,4314.1582 L478,4321.1582 L468,4331.1582 L318,4331.1582 L318,4314.1582 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1523" x="318" y="4314.1582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="333" y="4327.7266">Persist fulfilment</text><polygon fill="#A80036" points="1335,4364.0898,1345,4368.0898,1335,4372.0898,1339,4368.0898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="4368.0898" y2="4368.0898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4355.6924">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="411" y="4348.0371">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="4363.3477">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="4363.3477">2003</text><polygon fill="#A80036" points="1746,4393.4004,1756,4397.4004,1746,4401.4004,1750,4397.4004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="4397.4004" y2="4397.4004"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="4392.6582">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1386" y="4392.6582">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1704,4440.4004,1821,4440.4004,1831,4459.4004,1821,4478.4004,1704,4478.4004,1694,4459.4004,1704,4440.4004" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1706" y="4456.9688">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1706" y="4472.2793">transferExtension</text><polygon fill="#A80036" points="393,4501.332,383,4505.332,393,4509.332,389,4505.332" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="4505.332" y2="4505.332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="4500.5898">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="4500.5898">Return success</text><path d="M308,4527.332 L370,4527.332 L370,4534.332 L360,4544.332 L308,4544.332 L308,4527.332 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1266.8535" style="stroke: #000000; stroke-width: 2.0;" width="1550" x="308" y="4527.332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="323" y="4540.9004">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="385" y="4539.9668">[Transfer.ilpCondition validate successful]</text><path d="M318,4551.6426 L774,4551.6426 L774,4558.6426 L764,4568.6426 L318,4568.6426 L318,4551.6426 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1530" x="318" y="4551.6426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="411" x="333" y="4565.2109">Persist Transfer State (with transferState='RECEIVED-FULFIL')</text><polygon fill="#A80036" points="1335,4601.5742,1345,4605.5742,1335,4609.5742,1339,4605.5742" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1341" y1="4605.5742" y2="4605.5742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="4593.1768">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="411" y="4585.5215">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="411" y="4600.832">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="488" y="4600.832">2003</text><polygon fill="#A80036" points="1746,4630.8848,1756,4634.8848,1746,4638.8848,1750,4634.8848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1357" x2="1752" y1="4634.8848" y2="4634.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1364" y="4630.1426">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1386" y="4630.1426">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1697,4677.8848,1828,4677.8848,1838,4688.8848,1828,4700.8848,1697,4700.8848,1687,4688.8848,1697,4677.8848" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1699" y="4694.4531">transferStateChange</text><polygon fill="#A80036" points="393,4723.5059,383,4727.5059,393,4731.5059,389,4727.5059" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387" x2="1351" y1="4727.5059" y2="4727.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="399" y="4722.7637">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="421" y="4722.7637">Return success</text><path d="M318,4749.5059 L380,4749.5059 L380,4756.5059 L370,4766.5059 L318,4766.5059 L318,4749.5059 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="657" x="318" y="4749.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="333" y="4763.0742">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="395" y="4762.1406">[If type == 'fulfil']</text><path d="M387,4771.8164 L387,5148.8164 L696,5148.8164 L696,4781.8164 L686,4771.8164 L387,4771.8164 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,4771.8164 L686,4781.8164 L696,4781.8164 L686,4771.8164 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="4789.3848">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="4804.6953">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="4820.0059">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="4835.3164">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="4850.627">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="4865.9375">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="4881.248">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="4896.5586">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="4911.8691">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="4927.1797">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="4942.4902">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="4957.8008">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="4973.1113">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="4988.4219">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="441" y="5003.7324">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="441" y="5019.043">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="5034.3535">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="5049.6641">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="5064.9746">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="5080.2852">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="5095.5957">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="5110.9063">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="5126.2168">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="5141.5273">}</text><polygon fill="#A80036" points="878,5175.5801,888,5179.5801,878,5183.5801,882,5179.5801" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="884" y1="5179.5801" y2="5179.5801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="5174.8379">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="411" y="5174.8379">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318" x2="975" y1="5218.5801" y2="5218.5801"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="323" y="5229.2148">[If type == 'bulk-fulfil']</text><path d="M387,5237.5352 L387,5614.5352 L696,5614.5352 L696,5247.5352 L686,5237.5352 L387,5237.5352 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,5237.5352 L686,5247.5352 L696,5247.5352 L686,5237.5352 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="5255.1035">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="5270.4141">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="5285.7246">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="5301.0352">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="5316.3457">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="5331.6563">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="5346.9668">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="5362.2773">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="5377.5879">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="5392.8984">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="5408.209">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="5423.5195">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="5438.8301">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="5454.1406">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="441" y="5469.4512">type: bulk-position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="441" y="5484.7617">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="5500.0723">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="5515.3828">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="457" y="5530.6934">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="5546.0039">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="5561.3145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="5576.625">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="5591.9355">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="5607.2461">}</text><polygon fill="#A80036" points="878,5641.2988,888,5645.2988,878,5649.2988,882,5645.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="884" y1="5645.2988" y2="5645.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="5640.5566">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="411" y="5640.5566">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="308" x2="1858" y1="5691.2988" y2="5691.2988"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="224" x="313" y="5701.9336">[Validate Fulfil Transfer not successful]</text><path d="M318,5712.2539 L402,5712.2539 L402,5719.2539 L392,5729.2539 L318,5729.2539 L318,5712.2539 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="382" x="318" y="5712.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="333" y="5725.8223">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="424" y1="5766.1855" y2="5766.1855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="424" y1="5766.1855" y2="5779.1855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="383" x2="424" y1="5779.1855" y2="5779.1855"/><polygon fill="#A80036" points="393,5775.1855,383,5779.1855,393,5783.1855,389,5779.1855" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="5753.7881">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="411" y="5746.1328">Route &amp; Publish Notification event for Payee</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="411" y="5761.4434">Reference: Failure in validation</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1928" y1="5809.1855" y2="5809.1855"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="5819.8203">[Consume Batch Messages]</text><path d="M149,5828.1406 L149,5853.1406 L363,5853.1406 L363,5838.1406 L353,5828.1406 L149,5828.1406 " fill="#ADD8E6" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M353,5828.1406 L353,5838.1406 L363,5838.1406 L353,5828.1406 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="155" y="5845.709">To be delivered by future story</text><path d="M308,5883.4512 L562,5883.4512 L562,5890.4512 L552,5900.4512 L308,5900.4512 L308,5883.4512 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1006" x="308" y="5883.4512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="323" y="5897.0195">Reference: Failure in validation</text><path d="M318,5907.7617 L380,5907.7617 L380,5914.7617 L370,5924.7617 L318,5924.7617 L318,5907.7617 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="986" x="318" y="5907.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="333" y="5921.3301">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="395" y="5920.3965">[If type == 'bulk-fulfil']</text><path d="M387,5930.0723 L387,6307.0723 L696,6307.0723 L696,5940.0723 L686,5930.0723 L387,5930.0723 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,5930.0723 L686,5940.0723 L696,5940.0723 L686,5930.0723 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="5947.6406">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="5962.9512">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="5978.2617">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="5993.5723">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="6008.8828">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="6024.1934">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="6039.5039">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="6054.8145">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="6070.125">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="6085.4355">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="6100.7461">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="6116.0566">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="6131.3672">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="6146.6777">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="441" y="6161.9883">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="441" y="6177.2988">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="6192.6094">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="6207.9199">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="457" y="6223.2305">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="6238.541">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="6253.8516">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="6269.1621">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="6284.4727">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="6299.7832">}</text><polygon fill="#A80036" points="1099.5,6349.1465,1109.5,6353.1465,1099.5,6357.1465,1103.5,6353.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1105.5" y1="6353.1465" y2="6353.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="6340.749">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="411" y="6333.0938">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="411" y="6348.4043">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="495" y="6348.4043">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="318" x2="1304" y1="6392.1465" y2="6392.1465"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="323" y="6402.7813">[If type == 'fulfil']</text><path d="M387,6411.1016 L387,6788.1016 L696,6788.1016 L696,6421.1016 L686,6411.1016 L387,6411.1016 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686,6411.1016 L686,6421.1016 L696,6421.1016 L686,6411.1016 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="393" y="6428.6699">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="6443.9805">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="409" y="6459.291">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="409" y="6474.6016">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="409" y="6489.9121">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="6505.2227">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="409" y="6520.5332">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="425" y="6535.8438">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="425" y="6551.1543">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="409" y="6566.4648">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="409" y="6581.7754">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="6597.0859">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="441" y="6612.3965">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="441" y="6627.707">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="441" y="6643.0176">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="441" y="6658.3281">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="441" y="6673.6387">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="6688.9492">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="457" y="6704.2598">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="457" y="6719.5703">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="441" y="6734.8809">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="425" y="6750.1914">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="6765.502">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="6780.8125">}</text><polygon fill="#A80036" points="1227,6814.8652,1237,6818.8652,1227,6822.8652,1231,6818.8652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="1233" y1="6818.8652" y2="6818.8652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="389" y="6814.123">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="411" y="6814.123">Route &amp; Publish Notification event for Payee</text><!--
@startuml
title 2.2.1. Fulfil Handler Consume (Success) (single message, includes individual transfers from Bulk)

autonumber

collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Handler" as FULF_HANDLER
collections "topic-\nevent" as TOPIC_EVENT
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
entity "Position DAO" as POS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Success)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Fulfil event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type IN ['fulfil', 'bulk-fulfil'] &&\naction == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT: Event Handler Consume\n
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 3105/3106</color>
        end
        group Validate Transfer Fulfilment Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> POS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate POS_DAO
            POS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            POS_DAO <- - DB: Return existing hashes
            deactivate DB
            POS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate POS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare \neach entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TOPIC_EVENT: Publish event information (for duplicate) \n(Event Handler Consume)
                FULF_HANDLER -> POS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                POS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                POS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate POS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        alt If type == 'fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: notification,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for Payee - Modified Request\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_NOTIFICATIONS
                            deactivate TOPIC_NOTIFICATIONS
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee - Modified Request \n3106 to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        alt If type == 'fulfil'
                            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee)\n
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color Magenta><b>Reference: Failure in validation</b></color>\n<color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        alt If type == 'fulfil'
                            FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                end
            else Hash not matched
                FULF_HANDLER -> POS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                POS_DAO - -> FULF_HANDLER: Return success
                deactivate POS_DAO
            end
        end
        group Validate and persist Transfer Fulfilment
            FULF_HANDLER -> POS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate POS_DAO
            POS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> POS_DAO
            deactivate DB
            FULF_HANDLER <- - POS_DAO: Return transfer
            deactivate POS_DAO
            FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>
            FULF_HANDLER -> FULF_HANDLER: Validate expirationDate\n<color #FF0000><b>Error code:</b> 3303</color>

            opt Transfer.ilpCondition validate successful
                group Request current Settlement Window
                    FULF_HANDLER -> POS_DAO: Request to retrieve current/latest transfer settlement window\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Fetch settlementWindowId
                    activate DB
                    hnote over DB #lightyellow
                        settlementWindow
                    end note
                    DB - -> POS_DAO
                    deactivate DB
                    FULF_HANDLER <- - POS_DAO: Return settlementWindowId to be appended during transferFulfilment insert\n**TODO**: During settlement design make sure transfers in 'RECEIVED-FULFIL'\nstate are updated to the next settlement window
                    deactivate POS_DAO
                end
            end

            group Persist fulfilment
                FULF_HANDLER -> POS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    transferFulfilment
                    transferExtension
                end note
                FULF_HANDLER <- - POS_DAO: Return success
                deactivate POS_DAO
            end

            alt Transfer.ilpCondition validate successful
                group Persist Transfer State (with transferState='RECEIVED-FULFIL')
                    FULF_HANDLER -> POS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    POS_DAO - -> FULF_HANDLER: Return success
                    deactivate POS_DAO
                end

                alt If type == 'fulfil'
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: commit,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "success",
                                        code: 0
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payee
                    activate TOPIC_TRANSFER_POSITION
                    deactivate TOPIC_TRANSFER_POSITION
                else If type == 'bulk-fulfil'
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: bulk-position,
                                    action: commit,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "success",
                                        code: 0
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payee
                    activate TOPIC_TRANSFER_POSITION
                    deactivate TOPIC_TRANSFER_POSITION
                end
            else Validate Fulfil Transfer not successful
                break
                    FULF_HANDLER -> FULF_HANDLER: Route & Publish Notification event for Payee\n<color Magenta><b>Reference: Failure in validation</b></color>
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end

group Reference: Failure in validation
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-processing,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end

deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.4
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>