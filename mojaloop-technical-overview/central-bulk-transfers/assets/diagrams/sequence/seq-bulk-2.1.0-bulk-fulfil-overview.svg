<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3126px" preserveAspectRatio="none" style="width:2961px;height:3126px;" version="1.1" viewBox="0 0 2961 3126" width="2961px" zoomAndPan="magnify"><defs><filter height="300%" id="flowdkp1yxmv6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="411" x="1276.25" y="23.5352">2.1.0. DFSP2 sends a Bulk Fulfil Success Transfer request</text><rect fill="#D3D3D3" height="3080.6133" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="3080.6133" style="stroke: #A80036; stroke-width: 1.0;" width="407.5" x="314.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="439.75" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="3080.6133" style="stroke: #A80036; stroke-width: 1.0;" width="1946.5" x="988" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1910.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="836.9746" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368.5" y="692.7129"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="641.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="794.9551"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="1603.6191"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2338.6035"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2511.4668"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2786.2617"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="1382.8242"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2839.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1495.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1974.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2303.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2632.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2824.3496" style="stroke: #000000; stroke-width: 2.0;" width="2927.5" x="23" y="170.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1486.5" x="1454" y="1708.8613"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="1486.5" x="1454" y="1770.793"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="606.5" x="1939.5" y="1944.3008"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="606.5" x="1939.5" y="1990.9219"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2907.5" x="33" y="2555.7773"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2848.5" x="92" y="2830.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="373.5" x2="373.5" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="646" x2="646" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1045" x2="1045" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1176" x2="1176" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1298" x2="1298" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1500" x2="1500" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1810.5" x2="1810.5" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1979.5" x2="1979.5" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2139.5" x2="2139.5" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2308" x2="2308" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2468" x2="2468" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2637" x2="2637" y1="153.7754" y2="3012.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2880.5" x2="2880.5" y1="153.7754" y2="3012.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="3024.6602">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="3041.1484">Payer</text><ellipse cx="67.5" cy="3054.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,3062.1016 L67.5,3089.1016 M54.5,3070.1016 L80.5,3070.1016 M67.5,3089.1016 L54.5,3104.1016 M67.5,3089.1016 L80.5,3104.1016 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="3024.6602">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="3041.1484">Payee</text><ellipse cx="126.5" cy="3054.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,3062.1016 L126.5,3089.1016 M113.5,3070.1016 L139.5,3070.1016 M126.5,3089.1016 L113.5,3104.1016 M126.5,3089.1016 L139.5,3104.1016 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="318.5" y="150.8223">ML API Adapter</text><path d="M353,109.2871 L353,133.2871 M353,121.2871 L370,121.2871 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="382" cy="121.2871" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="318.5" y="3024.6602">ML API Adapter</text><path d="M353,3031.6133 L353,3055.6133 M353,3043.6133 L370,3043.6133 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="382" cy="3043.6133" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="619" y="134.334">ML API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="575" y="150.8223">Notification Handler</text><ellipse cx="646.5" cy="104.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="642.5,92.7988,648.5,87.7988,646.5,92.7988,648.5,97.7988,642.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="619" y="3024.6602">ML API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="575" y="3041.1484">Notification Handler</text><ellipse cx="646.5" cy="3060.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="642.5,3048.1016,648.5,3043.1016,646.5,3048.1016,648.5,3053.1016,642.5,3048.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="996" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="992" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="1013" y="122.334">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="999" y="138.8223">object-store</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="996" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="992" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="1013" y="3035.6602">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="999" y="3052.1484">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1109" y="150.8223">Central Service API</text><path d="M1155.5,109.2871 L1155.5,133.2871 M1155.5,121.2871 L1172.5,121.2871 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1184.5" cy="121.2871" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1109" y="3024.6602">Central Service API</text><path d="M1155.5,3031.6133 L1155.5,3055.6133 M1155.5,3043.6133 L1172.5,3043.6133 " fill="none" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1184.5" cy="3043.6133" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="1257" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="1253" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1273.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1260" y="138.8223">bulk-fulfil</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="1257" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="1253" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1273.5" y="3035.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="1260" y="3052.1484">bulk-fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="1464" y="134.334">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1470.5" y="150.8223">Handler</text><ellipse cx="1500.5" cy="104.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1496.5,92.7988,1502.5,87.7988,1500.5,92.7988,1502.5,97.7988,1496.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="1464" y="3024.6602">Bulk Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1470.5" y="3041.1484">Handler</text><ellipse cx="1500.5" cy="3060.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1496.5,3048.1016,1502.5,3043.1016,1500.5,3048.1016,1502.5,3053.1016,1496.5,3048.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="1782.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="1778.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1785.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="1791" y="138.8223">fulfil</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="1782.5" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="1778.5" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1785.5" y="3035.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="1791" y="3052.1484">fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1957.5" y="134.334">Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1949.5" y="150.8223">Handler</text><ellipse cx="1979.5" cy="104.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1975.5,92.7988,1981.5,87.7988,1979.5,92.7988,1981.5,97.7988,1975.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="1957.5" y="3024.6602">Fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1949.5" y="3041.1484">Handler</text><ellipse cx="1979.5" cy="3060.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1975.5,3048.1016,1981.5,3043.1016,1979.5,3048.1016,1981.5,3053.1016,1975.5,3048.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2073.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2069.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2114.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2076.5" y="138.8223">transfer-position</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2073.5" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2069.5" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2114.5" y="3035.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2076.5" y="3052.1484">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="2276" y="134.334">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2278.5" y="150.8223">Handler</text><ellipse cx="2308.5" cy="104.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2304.5,92.7988,2310.5,87.7988,2308.5,92.7988,2310.5,97.7988,2304.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="2276" y="3024.6602">Position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2278.5" y="3041.1484">Handler</text><ellipse cx="2308.5" cy="3060.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2304.5,3048.1016,2310.5,3043.1016,2308.5,3048.1016,2310.5,3053.1016,2304.5,3048.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2405" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2401" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2443.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2408" y="138.8223">bulk-processing</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2405" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2401" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2443.5" y="3035.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2408" y="3052.1484">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2581" y="134.334">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2607.5" y="150.8223">Handler</text><ellipse cx="2637.5" cy="104.7988" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2633.5,92.7988,2639.5,87.7988,2637.5,92.7988,2639.5,97.7988,2633.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2581" y="3024.6602">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2607.5" y="3041.1484">Handler</text><ellipse cx="2637.5" cy="3060.1016" fill="#FEFECE" filter="url(#flowdkp1yxmv6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2633.5,3048.1016,2639.5,3043.1016,2637.5,3048.1016,2639.5,3053.1016,2633.5,3048.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="2834.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="2830.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2855.5" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="2837.5" y="138.8223">notification</text><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="2834.5" y="3011.125"/><rect fill="#FEFECE" filter="url(#flowdkp1yxmv6)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="2830.5" y="3015.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2855.5" y="3035.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="2837.5" y="3052.1484">notification</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="836.9746" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="368.5" y="692.7129"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="641.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="794.9551"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="1603.6191"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2338.6035"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2511.4668"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1040.5" y="2786.2617"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1293.5" y="1382.8242"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2839.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1495.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1974.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2303.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="2838.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2632.5" y="163.7754"/><path d="M23,170.7754 L471,170.7754 L471,177.7754 L461,187.7754 L23,187.7754 L23,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2824.3496" style="stroke: #000000; stroke-width: 2.0;" width="2927.5" x="23" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="403" x="38" y="184.3438">DFSP2 sends a Bulk Fulfil Success Transfer request to DFSP1</text><path d="M131,193.0859 L131,662.0859 L472,662.0859 L472,203.0859 L462,193.0859 L131,193.0859 " fill="#FFFF00" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M462,193.0859 L462,203.0859 L472,203.0859 L462,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="137" y="210.6543">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="153" y="225.9648">Content-Length: &lt;int&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="153" y="241.2754">Content-Type: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="153" y="256.5859">Date: &lt;date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="153" y="271.8965">FSPIOP-Source: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="153" y="287.207">FSPIOP-Destination: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="153" y="302.5176">FSPIOP-Encryption: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="153" y="317.8281">FSPIOP-Signature: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="153" y="333.1387">FSPIOP-URI: &lt;uri&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="153" y="348.4492">FSPIOP-HTTP-Method: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="363.7598">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="141" y="379.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="137" y="394.3809">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="409.6914">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="153" y="425.002">bulkTransferState: &lt;bulkTransferState&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="153" y="440.3125">completedTimestamp: &lt;completedTimeStamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="153" y="455.623">individualTransferResults:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="153" y="470.9336">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="169" y="486.2441">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="185" y="501.5547">transferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="185" y="516.8652">fulfilment: &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="185" y="532.1758">extensionList: { extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="201" y="547.4863">{ key: &lt;string&gt;, value: &lt;string&gt; }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="185" y="562.7969">] }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="169" y="578.1074">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="153" y="593.418">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="153" y="608.7285">extensionList: { extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="169" y="624.0391">{ key: &lt;string&gt;, value: &lt;string&gt; }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="153" y="639.3496">] }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="137" y="654.6602">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="366.5" x2="356.5" y1="692.7129" y2="688.7129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="366.5" x2="356.5" y1="692.7129" y2="696.7129"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="367.5" y1="692.7129" y2="692.7129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="133.5" y="687.9707">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="146.5" y="687.9707">PUT - /bulkTransfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="378.5" x2="420.5" y1="737.334" y2="737.334"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420.5" x2="420.5" y1="737.334" y2="750.334"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="379.5" x2="420.5" y1="750.334" y2="750.334"/><polygon fill="#A80036" points="389.5,746.334,379.5,750.334,389.5,754.334,385.5,750.334" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="385.5" y="724.9365">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="398.5" y="717.2813">Validate incoming message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="398.5" y="732.5918">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="482.5" y="732.5918">3000-3002, 3100-3107</text><polygon fill="#A80036" points="1028.5,790.9551,1038.5,794.9551,1028.5,798.9551,1032.5,794.9551" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="378.5" x2="1034.5" y1="794.9551" y2="794.9551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="385.5" y="782.5576">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="398.5" y="774.9023">Persist incoming bulk message to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="398.5" y="790.2129">object store:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="481.5" y="790.2129">MLOS.individualTransferFulfils</text><polygon fill="#A80036" points="389.5,820.2656,379.5,824.2656,389.5,828.2656,385.5,824.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="383.5" x2="1044.5" y1="824.2656" y2="824.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="395.5" y="819.5234">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="317" x="408.5" y="819.5234">Return messageId reference to the stored object(s)</text><path d="M383,837.2656 L383,1336.2656 L687,1336.2656 L687,847.2656 L677,837.2656 L383,837.2656 " fill="#FFFF00" filter="url(#flowdkp1yxmv6)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M677,837.2656 L677,847.2656 L687,847.2656 L677,837.2656 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="389" y="854.834">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="389" y="870.1445">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="405" y="885.4551">id: &lt;messageId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="405" y="900.7656">from: &lt;payeeFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="405" y="916.0762">to: &lt;payerFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="405" y="931.3867">type: "application/json",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="405" y="946.6973">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="421" y="962.0078">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="421" y="977.3184">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="437" y="992.6289">bulkTransferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="437" y="1007.9395">bulkTransferState: "COMPLETED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="437" y="1023.25">completedTimestamp: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="437" y="1038.5605">extensionList: { extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="453" y="1053.8711">{ key: &lt;string&gt;, value: &lt;string&gt; }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="437" y="1069.1816">] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="437" y="1084.4922">count: &lt;int&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="437" y="1099.8027">hash: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="421" y="1115.1133">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="405" y="1130.4238">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="405" y="1145.7344">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="421" y="1161.0449">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="437" y="1176.3555">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="437" y="1191.666">type: "bulk-fulfil",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="437" y="1206.9766">action: "bulk-commit",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="437" y="1222.2871">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="437" y="1237.5977">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="453" y="1252.9082">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="453" y="1268.2188">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="437" y="1283.5293">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="421" y="1298.8398">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="405" y="1314.1504">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="389" y="1329.4609">}</text><polygon fill="#A80036" points="1281.5,1378.8242,1291.5,1382.8242,1281.5,1386.8242,1285.5,1382.8242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="378.5" x2="1287.5" y1="1382.8242" y2="1382.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="385.5" y="1370.4268">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="398.5" y="1362.7715">Route &amp; Publish Bulk Fulfil event for Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="398.5" y="1378.082">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="475.5" y="1378.082">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1303.5" x2="1345.5" y1="1442.7559" y2="1442.7559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1345.5" x2="1345.5" y1="1442.7559" y2="1455.7559"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1304.5" x2="1345.5" y1="1455.7559" y2="1455.7559"/><polygon fill="#A80036" points="1314.5,1451.7559,1304.5,1455.7559,1314.5,1459.7559,1310.5,1455.7559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1310.5" y="1422.7031">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="1323.5" y="1407.3926">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1323.5" y="1422.7031">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1323.5" y="1438.0137">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1400.5" y="1438.0137">2003</text><polygon fill="#A80036" points="389.5,1496.377,379.5,1500.377,389.5,1504.377,385.5,1500.377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="383.5" x2="1297.5" y1="1500.377" y2="1500.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="395.5" y="1487.9795">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="408.5" y="1480.3242">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="408.5" y="1495.6348">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1529.6875" y2="1525.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126.5" x2="136.5" y1="1529.6875" y2="1533.6875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="126.5" x2="372.5" y1="1529.6875" y2="1529.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="143.5" y="1524.9453">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="156.5" y="1524.9453">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1309.5,1554.998,1299.5,1558.998,1309.5,1562.998,1305.5,1558.998" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1303.5" x2="1494.5" y1="1558.998" y2="1558.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1315.5" y="1554.2559">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1328.5" y="1554.2559">Consume message</text><polygon fill="#A80036" points="1061.5,1599.6191,1051.5,1603.6191,1061.5,1607.6191,1057.5,1603.6191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1055.5" x2="1494.5" y1="1603.6191" y2="1603.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1067.5" y="1591.2217">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="1089.5" y="1583.5664">Retrieve individual transfers by key:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="283" x="1089.5" y="1598.877">MLOS.individualTransferFulfils.messageId</text><polygon fill="#A80036" points="1483.5,1628.9297,1493.5,1632.9297,1483.5,1636.9297,1487.5,1632.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1045.5" x2="1489.5" y1="1632.9297" y2="1632.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1052.5" y="1628.1875">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="1074.5" y="1628.1875">Stream bulk's individual transfers</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="591.5" x="1250" y="1640.9297"/><polygon fill="#EEEEEE" points="1250,1640.9297,1314,1640.9297,1314,1647.9297,1304,1657.9297,1250,1657.9297,1250,1640.9297" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1263" y="1655.498">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1449.25" y="1674.498">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1453.25" y="1689.8086"/><path d="M1454,1708.8613 L1516,1708.8613 L1516,1715.8613 L1506,1725.8613 L1454,1725.8613 L1454,1708.8613 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1486.5" x="1454" y="1708.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1469" y="1722.4297">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1531" y="1721.4961">[Success]</text><polygon fill="#A80036" points="1798.5,1758.793,1808.5,1762.793,1798.5,1766.793,1802.5,1762.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1505.5" x2="1804.5" y1="1762.793" y2="1762.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1512.5" y="1750.3955">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1534.5" y="1742.7402">Produce (stream) single transfer message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1534.5" y="1758.0508">for each individual transfer [loop]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1454" x2="2940.5" y1="1771.793" y2="1771.793"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1459" y="1782.4277">[Failure]</text><polygon fill="#A80036" points="2868.5,1803.0586,2878.5,1807.0586,2868.5,1811.0586,2872.5,1807.0586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1505.5" x2="2874.5" y1="1807.0586" y2="1807.0586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1512.5" y="1802.3164">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1534.5" y="1802.3164">Produce single message for the entire bulk</text><polygon fill="#A80036" points="1821.5,1864.3691,1811.5,1868.3691,1821.5,1872.3691,1817.5,1868.3691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1815.5" x2="1973.5" y1="1868.3691" y2="1868.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1827.5" y="1863.627">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1849.5" y="1863.627">Consume message</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="433" x="1775.5" y="1876.3691"/><polygon fill="#EEEEEE" points="1775.5,1876.3691,1839.5,1876.3691,1839.5,1883.3691,1829.5,1893.3691,1775.5,1893.3691,1775.5,1876.3691" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1788.5" y="1890.9375">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1889" y="1909.9375">Fulfil Handler Consume (Success)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1893" y="1925.248"/><path d="M1939.5,1944.3008 L2001.5,1944.3008 L2001.5,1951.3008 L1991.5,1961.3008 L1939.5,1961.3008 L1939.5,1944.3008 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="606.5" x="1939.5" y="1944.3008"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1954.5" y="1957.8691">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="2016.5" y="1956.9355">[Success]</text><polygon fill="#A80036" points="2127.5,1978.9219,2137.5,1982.9219,2127.5,1986.9219,2131.5,1982.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1984.5" x2="2133.5" y1="1982.9219" y2="1982.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1991.5" y="1978.1797">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2013.5" y="1978.1797">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1939.5" x2="2546" y1="1991.9219" y2="1991.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1944.5" y="2002.5566">[Failure]</text><polygon fill="#A80036" points="2456.5,2023.1875,2466.5,2027.1875,2456.5,2031.1875,2460.5,2027.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1984.5" x2="2462.5" y1="2027.1875" y2="2027.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1991.5" y="2022.4453">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2013.5" y="2022.4453">Produce message</text><polygon fill="#A80036" points="2150.5,2084.498,2140.5,2088.498,2150.5,2092.498,2146.5,2088.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2144.5" x2="2302.5" y1="2088.498" y2="2088.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2156.5" y="2083.7559">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2178.5" y="2083.7559">Consume message</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="468.5" x="2066.5" y="2096.498"/><polygon fill="#EEEEEE" points="2066.5,2096.498,2130.5,2096.498,2130.5,2103.498,2120.5,2113.498,2066.5,2113.498,2066.5,2096.498" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2079.5" y="2111.0664">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="2188.25" y="2130.0664">Position Handler Consume (Success)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2192.25" y="2145.377"/><polygon fill="#A80036" points="2456.5,2174.7402,2466.5,2178.7402,2456.5,2182.7402,2460.5,2178.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2313.5" x2="2462.5" y1="2178.7402" y2="2178.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2320.5" y="2173.998">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2342.5" y="2173.998">Produce message</text><polygon fill="#A80036" points="2479.5,2229.0508,2469.5,2233.0508,2479.5,2237.0508,2475.5,2233.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2473.5" x2="2631.5" y1="2233.0508" y2="2233.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2485.5" y="2228.3086">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2507.5" y="2228.3086">Consume message</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="531.5" x="2398" y="2241.0508"/><polygon fill="#EEEEEE" points="2398,2241.0508,2462,2241.0508,2462,2248.0508,2452,2258.0508,2398,2258.0508,2398,2241.0508" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2411" y="2255.6191">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="2527.25" y="2274.6191">Bulk Processing Handler Consume (Success)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2531.25" y="2289.9297"/><polygon fill="#A80036" points="1061.5,2334.6035,1051.5,2338.6035,1061.5,2342.6035,1057.5,2338.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1055.5" x2="2631.5" y1="2338.6035" y2="2338.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1067.5" y="2326.2061">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1089.5" y="2318.5508">Persist bulk message by destination to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1089.5" y="2333.8613">object store:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="1172.5" y="2333.8613">MLOS.bulkTransferResults</text><polygon fill="#A80036" points="2620.5,2379.2246,2630.5,2383.2246,2620.5,2387.2246,2624.5,2383.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1045.5" x2="2626.5" y1="2383.2246" y2="2383.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1052.5" y="2370.8271">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1074.5" y="2363.1719">Return the reference to the stored</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="1074.5" y="2378.4824">notification object(s):</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1213.5" y="2378.4824">messageId</text><polygon fill="#A80036" points="2868.5,2408.5352,2878.5,2412.5352,2868.5,2416.5352,2872.5,2412.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2642.5" x2="2874.5" y1="2412.5352" y2="2412.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2649.5" y="2407.793">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="2671.5" y="2407.793">Send Bulk Commit notification</text><polygon fill="#A80036" points="2868.5,2462.8457,2878.5,2466.8457,2868.5,2470.8457,2872.5,2466.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="2874.5" y1="2466.8457" y2="2466.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="658.5" y="2462.1035">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="680.5" y="2462.1035">Consume message</text><polygon fill="#A80036" points="1028.5,2507.4668,1038.5,2511.4668,1028.5,2515.4668,1032.5,2511.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="1034.5" y1="2511.4668" y2="2511.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="658.5" y="2499.0693">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="680.5" y="2491.4141">Retrieve bulk notification(s) by reference &amp; destination:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="348" x="680.5" y="2506.7246">MLOS.bulkTransferResults.messageId + destination</text><polygon fill="#A80036" points="662.5,2536.7773,652.5,2540.7773,662.5,2544.7773,658.5,2540.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="656.5" x2="1044.5" y1="2540.7773" y2="2540.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="668.5" y="2536.0352">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="690.5" y="2536.0352">Return notification payload</text><path d="M33,2555.7773 L100,2555.7773 L100,2562.7773 L90,2572.7773 L33,2572.7773 L33,2555.7773 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2907.5" x="33" y="2555.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="2569.3457">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="115" y="2568.4121">[action == 'bulk-commit']</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2889.5" x="40" y="2598.0879"/><polygon fill="#EEEEEE" points="40,2598.0879,104,2598.0879,104,2605.0879,94,2615.0879,40,2615.0879,40,2598.0879" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="2612.6563">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1366.75" y="2631.6563">Send notification to Participant (Payer)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1370.75" y="2646.9668"/><polygon fill="#A80036" points="78.5,2676.3301,68.5,2680.3301,78.5,2684.3301,74.5,2680.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="640.5" y1="2680.3301" y2="2680.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="84.5" y="2675.5879">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="106.5" y="2675.5879">Send callback notification</text><polygon fill="#A80036" points="2868.5,2737.6406,2878.5,2741.6406,2868.5,2745.6406,2872.5,2741.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="2874.5" y1="2741.6406" y2="2741.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="658.5" y="2736.8984">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="680.5" y="2736.8984">Consume message</text><polygon fill="#A80036" points="1028.5,2782.2617,1038.5,2786.2617,1028.5,2790.2617,1032.5,2786.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="651.5" x2="1034.5" y1="2786.2617" y2="2786.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="658.5" y="2773.8643">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="680.5" y="2766.209">Retrieve bulk notification(s) by reference &amp; destination:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="348" x="680.5" y="2781.5195">MLOS.bulkTransferResults.messageId + destination</text><polygon fill="#A80036" points="662.5,2811.5723,652.5,2815.5723,662.5,2819.5723,658.5,2815.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="656.5" x2="1044.5" y1="2815.5723" y2="2815.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="668.5" y="2810.8301">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="690.5" y="2810.8301">Return notification payload</text><path d="M92,2830.5723 L159,2830.5723 L159,2837.5723 L149,2847.5723 L92,2847.5723 L92,2830.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="132.5527" style="stroke: #000000; stroke-width: 2.0;" width="2848.5" x="92" y="2830.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="107" y="2844.1406">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="174" y="2843.207">[action == 'bulk-commit']</text><rect fill="#FFFFFF" filter="url(#flowdkp1yxmv6)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2830.5" x="99" y="2872.8828"/><polygon fill="#EEEEEE" points="99,2872.8828,163,2872.8828,163,2879.8828,153,2889.8828,99,2889.8828,99,2872.8828" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2887.4512">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1395.25" y="2906.4512">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1399.25" y="2921.7617"/><polygon fill="#A80036" points="137.5,2951.125,127.5,2955.125,137.5,2959.125,133.5,2955.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="640.5" y1="2955.125" y2="2955.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2950.3828">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="165.5" y="2950.3828">Send callback notification</text><!--
@startuml
title 2.1.0. DFSP2 sends a Bulk Fulfil Success Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API \nNotification Handler" as NOTIFY_HANDLER
collections "mongo-\nobject-store" as OBJECT_STORE
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-fulfil" as TOPIC_BULK_FULFIL
control "Bulk Fulfil\nHandler" as BULK_FULFIL_HANDLER
collections "topic-\nfulfil" as TOPIC_FULFIL
control "Fulfil \nHandler" as FULF_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position \nHandler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant CSAPI
    participant TOPIC_BULK_FULFIL
    participant BULK_FULFIL_HANDLER
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_FULFIL_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP2 sends a Bulk Fulfil Success Transfer request to DFSP1
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <int>,
            Content-Type: <string>,
            Date: <date>,
            FSPIOP-Source: <string>,
            FSPIOP-Destination: <string>,
            FSPIOP-Encryption: <string>,
            FSPIOP-Signature: <string>,
            FSPIOP-URI: <uri>,
            FSPIOP-HTTP-Method: <string>
        }

        Payload - bulkTransferMessage:
        {
            bulkTransferState: <bulkTransferState>,
            completedTimestamp: <completedTimeStamp>,
            individualTransferResults: 
            [
                {
                    transferId: <uuid>, 
                    fulfilment: <ilpCondition>,
                    extensionList: { extension: [ 
                        { key: <string>, value: <string> }
                    ] }
                }
            ],
            extensionList: { extension: [ 
                { key: <string>, value: <string> }
            ] }
        }
    end note
    DFSP2 ->> MLAPI: PUT - /bulkTransfers/<ID>
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    MLAPI -> OBJECT_STORE: Persist incoming bulk message to\nobject store: **MLOS.individualTransferFulfils**
    activate OBJECT_STORE
    OBJECT_STORE - -> MLAPI: Return messageId reference to the stored object(s)
    deactivate OBJECT_STORE
    note right of MLAPI #yellow
        Message:
        {
            id: <messageId>,
            from: <payeeFspName>,
            to: <payerFspName>,
            type: "application/json",
            content: {
                headers: <bulkTransferHeaders>,
                payload: {
                    bulkTransferId: <uuid>,
                    bulkTransferState: "COMPLETED",
                    completedTimestamp: <timestamp>,
                    extensionList: { extension: [ 
                        { key: <string>, value: <string> } 
                    ] },
                    count: <int>,
                    hash: <string>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: "bulk-fulfil",
                    action: "bulk-commit",
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_FULFIL: Route & Publish Bulk Fulfil event for Payee\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_FULFIL
    TOPIC_BULK_FULFIL <-> TOPIC_BULK_FULFIL: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_FULFIL - -> MLAPI: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_FULFIL
    MLAPI - ->> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_BULK_FULFIL <- BULK_FULFIL_HANDLER: Consume message
    BULK_FULFIL_HANDLER -> OBJECT_STORE: Retrieve individual transfers by key:\n**MLOS.individualTransferFulfils.messageId**
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_FULFIL_HANDLER: Stream bulk's individual transfers
    deactivate OBJECT_STORE
    ref over  TOPIC_BULK_FULFIL, TOPIC_FULFIL:  Bulk Prepare Handler Consume \n
    alt Success
        BULK_FULFIL_HANDLER -> TOPIC_FULFIL: Produce (stream) single transfer message\nfor each individual transfer [loop]
    else Failure
        BULK_FULFIL_HANDLER - -> TOPIC_NOTIFICATIONS: Produce single message for the entire bulk
    end
    |||
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_TRANSFER_POSITION: Fulfil Handler Consume (Success)\n
    alt Success
        FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        FULF_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_BULK_PROCESSING: Position Handler Consume (Success)\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, TOPIC_NOTIFICATIONS: Bulk Processing Handler Consume (Success)\n
    BULK_PROC_HANDLER -> OBJECT_STORE:  Persist bulk message by destination to the\nobject store: **MLOS.bulkTransferResults**
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PROC_HANDLER: Return the reference to the stored \nnotification object(s): **messageId**
    deactivate OBJECT_STORE
    BULK_PROC_HANDLER -> TOPIC_NOTIFICATIONS: Send Bulk Commit notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER -> OBJECT_STORE: Retrieve bulk notification(s) by reference & destination:\n**MLOS.bulkTransferResults.messageId + destination**
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return notification payload
    deactivate OBJECT_STORE
    opt action == 'bulk-commit'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer)\n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER -> OBJECT_STORE: Retrieve bulk notification(s) by reference & destination:\n**MLOS.bulkTransferResults.messageId + destination**
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return notification payload
    deactivate OBJECT_STORE
    opt action == 'bulk-commit'
        |||
        ref over DFSP2, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee)\n
        NOTIFY_HANDLER -> DFSP2: Send callback notification
    end
    |||
end
deactivate POS_HANDLER
activate BULK_FULFIL_HANDLER
deactivate FULF_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>