<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="6094px" preserveAspectRatio="none" style="width:1649px;height:6094px;" version="1.1" viewBox="0 0 1649 6094" width="1649px" zoomAndPan="magnify"><defs><filter height="300%" id="fliqrzwmbjbfe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="698" x="476.5" y="23.5352">2.3.2. Abort Position Handler Consume (single message, includes individual transfers from Bulk)</text><rect fill="#FFFFE0" height="6048.9922" style="stroke: #A80036; stroke-width: 1.0;" width="1372.5" x="49" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="684.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="5881.7051" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="2182.2969"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="3276.2031"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="4245.2617"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="5376.0996"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="1609.4043"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="3757.2324"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="5948.9922"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="211.5293"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="517.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="532.2559"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="2295.2285"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="183.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="2600.6445"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="4358.1934"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="183.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="4632.9883"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="240.8398"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="585.877"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="720.1191"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="828.0508"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="2324.5391"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="2654.2656"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="4387.5039"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="4686.6094"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="5867.7051" style="stroke: #000000; stroke-width: 2.0;" width="1625" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="2069.6992" style="stroke: #000000; stroke-width: 2.0;" width="1595" x="33" y="157.5977"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="622.1426" style="stroke: #000000; stroke-width: 2.0;" width="1575" x="43" y="436.0137"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="474.5898" style="stroke: #000000; stroke-width: 2.0;" width="746.5" x="861.5" y="547.2559"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="1148.1406" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="1072.1563"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="828.5" x="43" y="1647.4043"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="2048.9648" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="23" y="2241.2969"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="288.1055" style="stroke: #000000; stroke-width: 2.0;" width="1441" x="43" y="2504.4023"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="140.5527" style="stroke: #000000; stroke-width: 2.0;" width="612.5" x="861.5" y="2615.6445"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="1476.7539" style="stroke: #000000; stroke-width: 2.0;" width="848.5" x="33" y="2806.5078"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="964.4141" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="2830.8184"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="828.5" x="43" y="3314.2031"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="848.5" x="33" y="3802.2324"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="1689.7305" style="stroke: #000000; stroke-width: 2.0;" width="1461" x="33" y="4304.2617"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="288.1055" style="stroke: #000000; stroke-width: 2.0;" width="1441" x="43" y="4536.7461"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="140.5527" style="stroke: #000000; stroke-width: 2.0;" width="612.5" x="861.5" y="4647.9883"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="1148.1406" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="4838.8516"/><rect fill="#FFFFFF" height="572.8926" style="stroke: none; stroke-width: 1.0;" width="828.5" x="43" y="5414.0996"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="112" x2="112" y1="116.2871" y2="6017.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="666.5" x2="666.5" y1="116.2871" y2="6017.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="793.5" x2="793.5" y1="116.2871" y2="6017.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="919.5" x2="919.5" y1="116.2871" y2="6017.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1369.5" x2="1369.5" y1="116.2871" y2="6017.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="53" y="113.334">Position Handler</text><ellipse cx="112.5" cy="83.7988" fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="108.5,71.7988,114.5,66.7988,112.5,71.7988,114.5,76.7988,108.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="53" y="6030.5273">Position Handler</text><ellipse cx="112.5" cy="6049.4805" fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="108.5,6037.4805,114.5,6032.4805,112.5,6037.4805,114.5,6042.4805,108.5,6037.4805" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="620.5" y="60.3105"/><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="616.5" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="641.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="623.5" y="101.334">notification</text><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="620.5" y="6016.9922"/><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="616.5" y="6020.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="641.5" y="6041.5273">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="623.5" y="6058.0156">notification</text><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="730.5" y="60.3105"/><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="726.5" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="769" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="733.5" y="101.334">bulk-processing</text><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="730.5" y="6016.9922"/><rect fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="726.5" y="6020.9922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="769" y="6041.5273">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="733.5" y="6058.0156">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="871.5" y="113.334">Position DAO</text><ellipse cx="919.5" cy="83.7988" fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="907.5" x2="931.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="871.5" y="6030.5273">Position DAO</text><ellipse cx="919.5" cy="6049.4805" fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="907.5" x2="931.5" y1="6063.4805" y2="6063.4805"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1321.5" y="113.334">Central Store</text><path d="M1351.5,63.7988 C1351.5,53.7988 1369.5,53.7988 1369.5,53.7988 C1369.5,53.7988 1387.5,53.7988 1387.5,63.7988 L1387.5,89.7988 C1387.5,99.7988 1369.5,99.7988 1369.5,99.7988 C1369.5,99.7988 1351.5,99.7988 1351.5,89.7988 L1351.5,63.7988 " fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1351.5,63.7988 C1351.5,73.7988 1369.5,73.7988 1369.5,73.7988 C1369.5,73.7988 1387.5,73.7988 1387.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1321.5" y="6030.5273">Central Store</text><path d="M1351.5,6043.4805 C1351.5,6033.4805 1369.5,6033.4805 1369.5,6033.4805 C1369.5,6033.4805 1387.5,6033.4805 1387.5,6043.4805 L1387.5,6069.4805 C1387.5,6079.4805 1369.5,6079.4805 1369.5,6079.4805 C1369.5,6079.4805 1351.5,6079.4805 1351.5,6069.4805 L1351.5,6043.4805 " fill="#FEFECE" filter="url(#fliqrzwmbjbfe)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1351.5,6043.4805 C1351.5,6053.4805 1369.5,6053.4805 1369.5,6053.4805 C1369.5,6053.4805 1387.5,6053.4805 1387.5,6043.4805 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="5881.7051" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="2182.2969"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="3276.2031"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="4245.2617"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="5376.0996"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="1609.4043"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="3757.2324"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="5948.9922"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="211.5293"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="517.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="532.2559"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="2295.2285"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="183.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="2600.6445"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="4358.1934"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="183.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="914.5" y="4632.9883"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="240.8398"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="585.877"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="720.1191"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="828.0508"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="2324.5391"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="2654.2656"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="4387.5039"/><rect fill="#FFFFFF" filter="url(#fliqrzwmbjbfe)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1364.5" y="4686.6094"/><path d="M13,133.2871 L278,133.2871 L278,140.2871 L268,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5867.7051" style="stroke: #000000; stroke-width: 2.0;" width="1625" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="28" y="146.8555">Abort Position Handler Consume</text><path d="M33,157.5977 L100,157.5977 L100,164.5977 L90,174.5977 L33,174.5977 L33,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2069.6992" style="stroke: #000000; stroke-width: 2.0;" width="1595" x="33" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="171.166">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="386" x="115" y="170.2324">[type IN ['position','bulk-position'] &amp;&amp; action == 'timeout-reserved']</text><polygon fill="#A80036" points="902.5,207.5293,912.5,211.5293,902.5,215.5293,906.5,211.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="211.5293" y2="211.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="199.1318">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="137.5" y="191.4766">Request current state of transfer from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="137.5" y="206.7871">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="214.5" y="206.7871">2003</text><polygon fill="#A80036" points="1352.5,236.8398,1362.5,240.8398,1352.5,244.8398,1356.5,240.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="240.8398" y2="240.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="931.5" y="236.0977">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="944.5" y="236.0977">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1304,253.8398,1435,253.8398,1445,272.8398,1435,291.8398,1304,291.8398,1294,272.8398,1304,253.8398" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1306" y="270.4082">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1306" y="285.7188">transferParticipant</text><polygon fill="#A80036" points="935.5,314.7715,925.5,318.7715,935.5,322.7715,931.5,318.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1368.5" y1="318.7715" y2="318.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="941.5" y="314.0293">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="954.5" y="314.0293">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,344.082,118.5,348.082,128.5,352.082,124.5,348.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="348.082" y2="348.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.5" y="343.3398">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="147.5" y="343.3398">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="408.0137" y2="408.0137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="408.0137" y2="421.0137"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="421.0137" y2="421.0137"/><polygon fill="#A80036" points="128.5,417.0137,118.5,421.0137,128.5,425.0137,124.5,421.0137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="387.9609">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="137.5" y="372.6504">Validate current state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="137.5" y="387.9609">(transferStateChange.transferStateId == 'RESERVED_TIMEOUT')</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="137.5" y="403.2715">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="214.5" y="403.2715">2001</text><path d="M43,436.0137 L373,436.0137 L373,443.0137 L363,453.0137 L43,453.0137 L43,436.0137 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="622.1426" style="stroke: #000000; stroke-width: 2.0;" width="1575" x="43" y="436.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="58" y="449.582">Persist Position change and Transfer state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="474.6348" y2="474.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="474.6348" y2="487.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="487.6348" y2="487.6348"/><polygon fill="#A80036" points="128.5,483.6348,118.5,487.6348,128.5,491.6348,124.5,487.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="469.8926">6</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="137.5" y="469.8926">transferStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="241.5" y="469.8926">= 'EXPIRED_RESERVED'</text><polygon fill="#A80036" points="902.5,528.2559,912.5,532.2559,902.5,536.2559,906.5,532.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="532.2559" y2="532.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.5" y="519.8584">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="137.5" y="512.2031">Request to persist latest position and state to DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="137.5" y="527.5137">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="214.5" y="527.5137">2003</text><path d="M861.5,547.2559 L1153.5,547.2559 L1153.5,554.2559 L1143.5,564.2559 L861.5,564.2559 L861.5,547.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="474.5898" style="stroke: #000000; stroke-width: 2.0;" width="746.5" x="861.5" y="547.2559"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="876.5" y="560.8242">DB TRANSACTION IMPLEMENTATION</text><polygon fill="#A80036" points="1352.5,581.877,1362.5,585.877,1352.5,589.877,1356.5,585.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="585.877" y2="585.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="931.5" y="581.1348">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="944.5" y="581.1348">Select participantPosition.value FOR UPDATE for payerCurrencyId</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1308,598.877,1431,598.877,1441,609.877,1431,621.877,1308,621.877,1298,609.877,1308,598.877" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1310" y="615.4453">participantPosition</text><polygon fill="#A80036" points="935.5,644.498,925.5,648.498,935.5,652.498,931.5,648.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1368.5" y1="648.498" y2="648.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="941.5" y="643.7559">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="954.5" y="643.7559">Return participantPosition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="966.5" y1="677.8086" y2="677.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="966.5" x2="966.5" y1="677.8086" y2="690.8086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="925.5" x2="966.5" y1="690.8086" y2="690.8086"/><polygon fill="#A80036" points="935.5,686.8086,925.5,690.8086,935.5,694.8086,931.5,690.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="673.0664">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="953.5" y="673.0664">latestPosition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="1047.5" y="673.0664">= participantPosition - payload.amount.amount</text><polygon fill="#A80036" points="1352.5,716.1191,1362.5,720.1191,1352.5,724.1191,1356.5,720.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="720.1191" y2="720.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="715.377">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="953.5" y="715.377">Persist latestPosition to DB for Payer</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1277,763.1191,1462,763.1191,1472,782.1191,1462,801.1191,1277,801.1191,1267,782.1191,1277,763.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1279" y="779.6875">UPDATE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="1333" y="779.6875">participantPosition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="1279" y="794.998">SET value = latestPosition</text><polygon fill="#A80036" points="1352.5,824.0508,1362.5,828.0508,1352.5,832.0508,1356.5,828.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="828.0508" y2="828.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="823.3086">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="953.5" y="823.3086">Persist participant position change and state change</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1151,871.0508,1588,871.0508,1598,943.0508,1588,1016.0508,1151,1016.0508,1141,943.0508,1151,871.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="1153" y="887.6191">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="1201" y="887.6191">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1344" y="887.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="1153" y="902.9297">VALUES (transferStateId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1157" y="918.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="1153" y="933.5508">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="1201" y="933.5508">participantPositionChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="1153" y="948.8613">SET participantPositionId = participantPosition.participantPositionId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="1153" y="964.1719">transferStateChangeId = transferStateChange.transferStateChangeId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1153" y="979.4824">value = latestPosition,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="1153" y="994.793">reservedValue = participantPosition.reservedValue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1153" y="1010.1035">createdDate = new Date()</text><polygon fill="#A80036" points="128.5,1046.1563,118.5,1050.1563,128.5,1054.1563,124.5,1050.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="1050.1563" y2="1050.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="1045.4141">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="1045.4141">Return success</text><path d="M43,1072.1563 L105,1072.1563 L105,1079.1563 L95,1089.1563 L43,1089.1563 L43,1072.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1148.1406" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="1072.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="58" y="1085.7246">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="120" y="1084.791">[If type == 'bulk-position']</text><path d="M122,1094.4668 L122,1563.4668 L522,1563.4668 L522,1104.4668 L512,1094.4668 L122,1094.4668 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,1094.4668 L512,1104.4668 L522,1104.4668 L512,1094.4668 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="1112.0352">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="1127.3457">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="1142.6563">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="1157.9668">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="1173.2773">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="1188.5879">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="1203.8984">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="1219.209">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="1234.5195">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="1249.8301">"errorCode": 3300,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="192" y="1265.1406">"errorDescription": "Transfer expired",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="1280.4512">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="1295.7617">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="1311.0723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="1326.3828">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="1341.6934">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="1357.0039">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="1372.3145">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="1387.625">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="176" y="1402.9355">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="1418.2461">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="1433.5566">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="1448.8672">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="1464.1777">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="1479.4883">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="1494.7988">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="1510.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="1525.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="1540.7305">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="1556.041">}</text><polygon fill="#A80036" points="777,1605.4043,787,1609.4043,777,1613.4043,781,1609.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="783" y1="1609.4043" y2="1609.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="1597.0068">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="366" x="146.5" y="1589.3516">Publish Transfer event to Bulk Processing Topic (for Payer)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="146.5" y="1604.6621">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="230.5" y="1604.6621">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="871.5" y1="1648.4043" y2="1648.4043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="48" y="1659.0391">[If type == 'position']</text><path d="M122,1667.3594 L122,2136.3594 L522,2136.3594 L522,1677.3594 L512,1667.3594 L122,1667.3594 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,1667.3594 L512,1677.3594 L522,1677.3594 L512,1667.3594 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="1684.9277">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="1700.2383">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="1715.5488">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="1730.8594">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="1746.1699">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="1761.4805">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="1776.791">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="1792.1016">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="1807.4121">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="1822.7227">"errorCode": 3300,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="192" y="1838.0332">"errorDescription": "Transfer expired",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="1853.3438">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="1868.6543">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="1883.9648">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="1899.2754">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="1914.5859">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="1929.8965">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="1945.207">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="1960.5176">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="1975.8281">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="1991.1387">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="2006.4492">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="2021.7598">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="2037.0703">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="2052.3809">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="2067.6914">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="2083.002">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="2098.3125">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="2113.623">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="2128.9336">}</text><polygon fill="#A80036" points="649.5,2178.2969,659.5,2182.2969,649.5,2186.2969,653.5,2182.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="655.5" y1="2182.2969" y2="2182.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2169.8994">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="2162.2441">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="2177.5547">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="2177.5547">2003</text><path d="M23,2241.2969 L90,2241.2969 L90,2248.2969 L80,2258.2969 L23,2258.2969 L23,2241.2969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2048.9648" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="23" y="2241.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="38" y="2254.8652">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="371" x="105" y="2253.9316">[type IN ['position','bulk-position'] &amp;&amp; (action IN ['reject', 'abort'])]</text><polygon fill="#A80036" points="902.5,2291.2285,912.5,2295.2285,902.5,2299.2285,906.5,2295.2285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="2295.2285" y2="2295.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2282.8311">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="2275.1758">Request current state of transfer from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="2290.4863">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="2290.4863">2003</text><polygon fill="#A80036" points="1352.5,2320.5391,1362.5,2324.5391,1352.5,2328.5391,1356.5,2324.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="2324.5391" y2="2324.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="2319.7969">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="953.5" y="2319.7969">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1304,2337.5391,1435,2337.5391,1445,2348.5391,1435,2360.5391,1304,2360.5391,1294,2348.5391,1304,2337.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1306" y="2354.1074">transferStateChange</text><polygon fill="#A80036" points="935.5,2383.1602,925.5,2387.1602,935.5,2391.1602,931.5,2387.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1368.5" y1="2387.1602" y2="2387.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="941.5" y="2382.418">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="963.5" y="2382.418">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,2412.4707,118.5,2416.4707,128.5,2420.4707,124.5,2416.4707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="2416.4707" y2="2416.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="2411.7285">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="2411.7285">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="2476.4023" y2="2476.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="2476.4023" y2="2489.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="2489.4023" y2="2489.4023"/><polygon fill="#A80036" points="128.5,2485.4023,118.5,2489.4023,128.5,2493.4023,124.5,2489.4023" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2456.3496">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="146.5" y="2441.0391">Validate current state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="146.5" y="2456.3496">(transferStateChange.transferStateId IN ['RECEIVED_REJECT', 'RECEIVED_ERROR'])</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="2471.6602">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="2471.6602">2001</text><path d="M43,2504.4023 L373,2504.4023 L373,2511.4023 L363,2521.4023 L43,2521.4023 L43,2504.4023 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="288.1055" style="stroke: #000000; stroke-width: 2.0;" width="1441" x="43" y="2504.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="58" y="2517.9707">Persist Position change and Transfer state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="2543.0234" y2="2543.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="2543.0234" y2="2556.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="2556.0234" y2="2556.0234"/><polygon fill="#A80036" points="128.5,2552.0234,118.5,2556.0234,128.5,2560.0234,124.5,2556.0234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2538.2813">21</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="146.5" y="2538.2813">transferStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="250.5" y="2538.2813">= (action == 'reject' ? 'ABORTED_REJECTED' : 'ABORTED_ERROR' )</text><polygon fill="#A80036" points="902.5,2596.6445,912.5,2600.6445,902.5,2604.6445,906.5,2600.6445" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="2600.6445" y2="2600.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="2588.2471">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="146.5" y="2580.5918">Request to persist latest position and state to DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="2595.9023">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="2595.9023">2003</text><path d="M861.5,2615.6445 L1255.5,2615.6445 L1255.5,2622.6445 L1245.5,2632.6445 L861.5,2632.6445 L861.5,2615.6445 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="140.5527" style="stroke: #000000; stroke-width: 2.0;" width="612.5" x="861.5" y="2615.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="876.5" y="2629.2129">Refer to</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="933.5" y="2629.2129">DB TRANSACTION IMPLEMENTATION</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="1184.5" y="2629.2129">above</text><polygon fill="#A80036" points="1352.5,2650.2656,1362.5,2654.2656,1352.5,2658.2656,1356.5,2654.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="2654.2656" y2="2654.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="2649.5234">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="953.5" y="2649.5234">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1284,2697.2656,1454,2697.2656,1464,2723.2656,1454,2750.2656,1284,2750.2656,1274,2723.2656,1284,2697.2656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1286" y="2713.834">participantPosition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1286" y="2729.1445">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1286" y="2744.4551">participantPositionChange</text><polygon fill="#A80036" points="128.5,2780.5078,118.5,2784.5078,128.5,2788.5078,124.5,2784.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="2784.5078" y2="2784.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="2779.7656">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="2779.7656">Return success</text><path d="M33,2806.5078 L95,2806.5078 L95,2813.5078 L85,2823.5078 L33,2823.5078 L33,2806.5078 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1476.7539" style="stroke: #000000; stroke-width: 2.0;" width="848.5" x="33" y="2806.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="2820.0762">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="110" y="2819.1426">[If action == 'reject']</text><path d="M43,2830.8184 L105,2830.8184 L105,2837.8184 L95,2847.8184 L43,2847.8184 L43,2830.8184 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="964.4141" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="2830.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="58" y="2844.3867">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="120" y="2843.4531">[If type == 'position']</text><path d="M122,2853.1289 L122,3230.1289 L406,3230.1289 L406,2863.1289 L396,2853.1289 L122,2853.1289 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M396,2853.1289 L396,2863.1289 L406,2863.1289 L396,2853.1289 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="2870.6973">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="2886.0078">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="2901.3184">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="2916.6289">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="2931.9395">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="2947.25">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="2962.5605">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="160" y="2977.8711">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="2993.1816">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="3008.4922">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="3023.8027">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="3039.1133">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="3054.4238">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="3069.7344">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="176" y="3085.0449">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="3100.3555">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="3115.666">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="192" y="3130.9766">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="192" y="3146.2871">code: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="192" y="3161.5977">description: "action successful"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="3176.9082">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="3192.2188">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="3207.5293">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="3222.8398">}</text><polygon fill="#A80036" points="649.5,3272.2031,659.5,3276.2031,649.5,3280.2031,653.5,3276.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="655.5" y1="3276.2031" y2="3276.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3263.8057">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="3256.1504">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="3271.4609">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="3271.4609">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="871.5" y1="3315.2031" y2="3315.2031"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="48" y="3325.8379">[If type == 'bulk-position']</text><path d="M122,3334.1582 L122,3711.1582 L406,3711.1582 L406,3344.1582 L396,3334.1582 L122,3334.1582 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M396,3334.1582 L396,3344.1582 L406,3344.1582 L396,3334.1582 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="3351.7266">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="3367.0371">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="3382.3477">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="3397.6582">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="3412.9688">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="3428.2793">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="3443.5898">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="160" y="3458.9004">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="3474.2109">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="3489.5215">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="3504.832">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="3520.1426">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="3535.4531">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="176" y="3550.7637">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="176" y="3566.0742">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="3581.3848">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="3596.6953">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="192" y="3612.0059">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="192" y="3627.3164">code: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="192" y="3642.627">description: "action successful"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="3657.9375">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="3673.248">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="3688.5586">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="3703.8691">}</text><polygon fill="#A80036" points="777,3753.2324,787,3757.2324,777,3761.2324,781,3757.2324" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="783" y1="3757.2324" y2="3757.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="3744.835">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="3737.1797">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="3752.4902">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="3752.4902">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="881.5" y1="3803.2324" y2="3803.2324"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="38" y="3813.8672">[action == 'abort']</text><path d="M122,3822.1875 L122,4199.1875 L570,4199.1875 L570,3832.1875 L560,3822.1875 L122,3822.1875 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M560,3822.1875 L560,3832.1875 L570,3832.1875 L560,3822.1875 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="3839.7559">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="3855.0664">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="3870.377">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="3885.6875">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="3900.998">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="3916.3086">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="3931.6191">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="160" y="3946.9297">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="3962.2402">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="3977.5508">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="3992.8613">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="4008.1719">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="4023.4824">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="4038.793">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="4054.1035">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="4069.4141">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="4084.7246">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="4100.0352">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="192" y="4115.3457">code: &lt;payload.errorInformation.errorCode || 5000&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="192" y="4130.6563">description: &lt;payload.errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="4145.9668">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="4161.2773">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="4176.5879">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="4191.8984">}</text><polygon fill="#A80036" points="649.5,4241.2617,659.5,4245.2617,649.5,4249.2617,653.5,4245.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="655.5" y1="4245.2617" y2="4245.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4232.8643">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="4225.209">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="4240.5195">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="4240.5195">2003</text><path d="M33,4304.2617 L100,4304.2617 L100,4311.2617 L90,4321.2617 L33,4321.2617 L33,4304.2617 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1689.7305" style="stroke: #000000; stroke-width: 2.0;" width="1461" x="33" y="4304.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="48" y="4317.8301">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="544" x="115" y="4316.8965">[type IN ['position','bulk-position'] &amp;&amp; action == 'fail' (Unable to currently trigger this scenario)]</text><polygon fill="#A80036" points="902.5,4354.1934,912.5,4358.1934,902.5,4362.1934,906.5,4358.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="4358.1934" y2="4358.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4345.7959">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="146.5" y="4338.1406">Request current state of transfer from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="4353.4512">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="4353.4512">2003</text><polygon fill="#A80036" points="1352.5,4383.5039,1362.5,4387.5039,1352.5,4391.5039,1356.5,4387.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="4387.5039" y2="4387.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="4382.7617">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="953.5" y="4382.7617">Retrieve current state of transfer from DB</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1304,4400.5039,1435,4400.5039,1445,4411.5039,1435,4423.5039,1304,4423.5039,1294,4411.5039,1304,4400.5039" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1306" y="4417.0723">transferStateChange</text><polygon fill="#A80036" points="935.5,4446.125,925.5,4450.125,935.5,4454.125,931.5,4450.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="929.5" x2="1368.5" y1="4450.125" y2="4450.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="941.5" y="4445.3828">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="963.5" y="4445.3828">Return current state of transfer from DB</text><polygon fill="#A80036" points="128.5,4475.4355,118.5,4479.4355,128.5,4483.4355,124.5,4479.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="4479.4355" y2="4479.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4474.6934">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="156.5" y="4474.6934">Return current state of transfer from DB</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="4508.7461" y2="4508.7461"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="4508.7461" y2="4521.7461"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="4521.7461" y2="4521.7461"/><polygon fill="#A80036" points="128.5,4517.7461,118.5,4521.7461,128.5,4525.7461,124.5,4521.7461" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4504.0039">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="146.5" y="4504.0039">Validate current state (transferStateChange.transferStateId == 'FAILED')</text><path d="M43,4536.7461 L373,4536.7461 L373,4543.7461 L363,4553.7461 L43,4553.7461 L43,4536.7461 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="288.1055" style="stroke: #000000; stroke-width: 2.0;" width="1441" x="43" y="4536.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="58" y="4550.3145">Persist Position change and Transfer state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="159.5" y1="4575.3672" y2="4575.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.5" x2="159.5" y1="4575.3672" y2="4588.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.5" x2="159.5" y1="4588.3672" y2="4588.3672"/><polygon fill="#A80036" points="128.5,4584.3672,118.5,4588.3672,128.5,4592.3672,124.5,4588.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4570.625">33</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="146.5" y="4570.625">transferStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="250.5" y="4570.625">= 'FAILED'</text><polygon fill="#A80036" points="902.5,4628.9883,912.5,4632.9883,902.5,4636.9883,906.5,4632.9883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="908.5" y1="4632.9883" y2="4632.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="4620.5908">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="146.5" y="4612.9355">Request to persist latest position and state to DB</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="4628.2461">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="4628.2461">2003</text><path d="M861.5,4647.9883 L1255.5,4647.9883 L1255.5,4654.9883 L1245.5,4664.9883 L861.5,4664.9883 L861.5,4647.9883 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="140.5527" style="stroke: #000000; stroke-width: 2.0;" width="612.5" x="861.5" y="4647.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="876.5" y="4661.5566">Refer to</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247" x="933.5" y="4661.5566">DB TRANSACTION IMPLEMENTATION</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="1184.5" y="4661.5566">above</text><polygon fill="#A80036" points="1352.5,4682.6094,1362.5,4686.6094,1352.5,4690.6094,1356.5,4686.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="924.5" x2="1358.5" y1="4686.6094" y2="4686.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="931.5" y="4681.8672">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="953.5" y="4681.8672">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fliqrzwmbjbfe)" points="1284,4729.6094,1454,4729.6094,1464,4755.6094,1454,4782.6094,1284,4782.6094,1274,4755.6094,1284,4729.6094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1286" y="4746.1777">participantPosition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1286" y="4761.4883">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1286" y="4776.7988">participantPositionChange</text><polygon fill="#A80036" points="128.5,4812.8516,118.5,4816.8516,128.5,4820.8516,124.5,4816.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="918.5" y1="4816.8516" y2="4816.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="134.5" y="4812.1094">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="156.5" y="4812.1094">Return success</text><path d="M43,4838.8516 L105,4838.8516 L105,4845.8516 L95,4855.8516 L43,4855.8516 L43,4838.8516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1148.1406" style="stroke: #000000; stroke-width: 2.0;" width="828.5" x="43" y="4838.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="58" y="4852.4199">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="120" y="4851.4863">[If type =='position']</text><path d="M122,4861.1621 L122,5330.1621 L522,5330.1621 L522,4871.1621 L512,4861.1621 L122,4861.1621 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,4861.1621 L512,4871.1621 L522,4871.1621 L512,4861.1621 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="4878.7305">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="4894.041">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="4909.3516">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="4924.6621">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="4939.9727">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="4955.2832">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="4970.5938">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="4985.9043">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="5001.2148">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="5016.5254">"errorCode": 3100,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="192" y="5031.8359">"errorDescription": "Transfer failed",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="5047.1465">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5062.457">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5077.7676">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="5093.0781">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="5108.3887">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="5123.6992">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="5139.0098">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="5154.3203">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="176" y="5169.6309">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="5184.9414">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="5200.252">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="5215.5625">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="5230.873">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="5246.1836">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="5261.4941">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5276.8047">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5292.1152">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="5307.4258">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="5322.7363">}</text><polygon fill="#A80036" points="649.5,5372.0996,659.5,5376.0996,649.5,5380.0996,653.5,5376.0996" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="655.5" y1="5376.0996" y2="5376.0996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5363.7021">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="5356.0469">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="5371.3574">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="5371.3574">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="871.5" y1="5415.0996" y2="5415.0996"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="48" y="5425.7344">[If type =='bulk-position']</text><path d="M122,5434.0547 L122,5903.0547 L522,5903.0547 L522,5444.0547 L512,5434.0547 L122,5434.0547 " fill="#FFFF00" filter="url(#fliqrzwmbjbfe)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,5434.0547 L512,5444.0547 L522,5444.0547 L512,5434.0547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128" y="5451.623">Message: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="144" y="5466.9336">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="144" y="5482.2441">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="144" y="5497.5547">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="144" y="5512.8652">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="144" y="5528.1758">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="160" y="5543.4863">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="160" y="5558.7969">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="176" y="5574.1074">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="192" y="5589.418">"errorCode": 3100,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="192" y="5604.7285">"errorDescription": "Transfer failed",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="192" y="5620.0391">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5635.3496">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5650.6602">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="144" y="5665.9707">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="144" y="5681.2813">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="160" y="5696.5918">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="176" y="5711.9023">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="176" y="5727.2129">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="176" y="5742.5234">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="176" y="5757.834">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="176" y="5773.1445">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="176" y="5788.4551">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="192" y="5803.7656">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="192" y="5819.0762">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="192" y="5834.3867">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="176" y="5849.6973">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="160" y="5865.0078">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="144" y="5880.3184">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="128" y="5895.6289">}</text><polygon fill="#A80036" points="777,5944.9922,787,5948.9922,777,5952.9922,781,5948.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="783" y1="5948.9922" y2="5948.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="124.5" y="5936.5947">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="146.5" y="5928.9395">Publish Notification event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="146.5" y="5944.25">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="223.5" y="5944.25">2003</text><!--
@startuml
title 2.3.2. Abort Position Handler Consume (single message, includes individual transfers from Bulk)

autonumber


control "Position Handler" as POS_HANDLER
entity "Position DAO" as POS_DAO
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
database "Central Store" as DB

box "Central Service" #LightYellow
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
    participant TOPIC_BULK_PROCESSING
    participant POS_DAO
    participant DB
end box

activate POS_HANDLER
group Abort Position Handler Consume
    opt type IN ['position','bulk-position'] && action == 'timeout-reserved'
        POS_HANDLER -> POS_DAO: Request current state of transfer from DB\n<color #FF0000><b>Error code:</b> 2003</color>
        activate POS_DAO
        POS_DAO -> DB: Retrieve current state of transfer from DB
        activate DB
        hnote over DB #lightyellow
            transferStateChange
            transferParticipant
        end note
        DB - -> POS_DAO: Return current state of transfer from DB
        deactivate DB
        POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
        deactivate POS_DAO
        POS_HANDLER <-> POS_HANDLER: Validate current state \n(transferStateChange.transferStateId == 'RESERVED_TIMEOUT')\n<color #FF0000><b>Error code:</b> 2001</color>

        group Persist Position change and Transfer state
            POS_HANDLER -> POS_HANDLER: **transferStateId** = 'EXPIRED_RESERVED'
            POS_HANDLER -> POS_DAO: Request to persist latest position and state to DB\n<color #FF0000><b>Error code:</b> 2003</color>
            group <color #blue>DB TRANSACTION IMPLEMENTATION</color>
                activate POS_DAO
                POS_DAO -> DB: Select participantPosition.value FOR UPDATE for payerCurrencyId
                activate DB
                hnote over DB #lightyellow
                    participantPosition
                end note
                DB - -> POS_DAO: Return participantPosition
                deactivate DB
                POS_DAO <-> POS_DAO: **latestPosition** = participantPosition - payload.amount.amount
                POS_DAO->DB: Persist latestPosition to DB for Payer
                hnote over DB #lightyellow
                    UPDATE **participantPosition**
                    SET value = latestPosition
                end note
                activate DB
                deactivate DB
                POS_DAO -> DB: Persist participant position change and state change
                hnote over DB #lightyellow
                        INSERT **transferStateChange** 
                        VALUES (transferStateId)

                        INSERT **participantPositionChange**
                        SET participantPositionId = participantPosition.participantPositionId,
                        transferStateChangeId = transferStateChange.transferStateChangeId,
                        value = latestPosition,
                        reservedValue = participantPosition.reservedValue
                        createdDate = new Date()
                end note
                activate DB
                deactivate DB
            end
            POS_DAO - -> POS_HANDLER: Return success
            deactivate POS_DAO
        end
        alt If type == 'bulk-position'
            note right of POS_HANDLER #yellow
            Message: {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": 3300,
                            "errorDescription": "Transfer expired",
                            "extensionList": <transferMessage.extensionList>
                        }
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: bulk-processing,
                        action: abort,
                        createdAt: <timestamp>,
                        state: {
                            status: 'error',
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
            end note
            POS_HANDLER -> TOPIC_BULK_PROCESSING: Publish Transfer event to Bulk Processing Topic (for Payer) \n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_BULK_PROCESSING
            deactivate TOPIC_BULK_PROCESSING
        else If type == 'position'
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 3300,
                                "errorDescription": "Transfer expired",
                                "extensionList": <transferMessage.extensionList>
                            }
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
    end
    opt type IN ['position','bulk-position'] && (action IN ['reject', 'abort'])
        POS_HANDLER -> POS_DAO: Request current state of transfer from DB\n<color #FF0000><b>Error code:</b> 2003</color>
        activate POS_DAO
        POS_DAO -> DB: Retrieve current state of transfer from DB
        activate DB
        hnote over DB #lightyellow
            transferStateChange
        end note
        DB - -> POS_DAO: Return current state of transfer from DB
        deactivate DB
        POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
        deactivate POS_DAO
        POS_HANDLER <-> POS_HANDLER: Validate current state \n(transferStateChange.transferStateId IN ['RECEIVED_REJECT', 'RECEIVED_ERROR'])\n<color #FF0000><b>Error code:</b> 2001</color>

        group Persist Position change and Transfer state
            POS_HANDLER -> POS_HANDLER: **transferStateId** = (action == 'reject' ? 'ABORTED_REJECTED' : 'ABORTED_ERROR' )
            POS_HANDLER -> POS_DAO: Request to persist latest position and state to DB\n<color #FF0000><b>Error code:</b> 2003</color>
            group Refer to <color #blue>DB TRANSACTION IMPLEMENTATION</color> above
                activate POS_DAO
                POS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    participantPosition
                    transferStateChange
                    participantPositionChange
                end note
            end
            POS_DAO - -> POS_HANDLER: Return success
            deactivate POS_DAO
        end
        alt If action == 'reject'
            alt If type == 'position'
                note right of POS_HANDLER #yellow
                    Message: {
                        id: <transferMessage.transferId>
                        from: <transferMessage.payerFsp>,
                        to: <transferMessage.payeeFsp>,
                        type: application/json
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: notification,
                                action: reject,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0,
                                    description: "action successful"
                                }
                            }
                        }
                    }
                end note
                POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TOPIC_NOTIFICATIONS
                deactivate TOPIC_NOTIFICATIONS
            else If type == 'bulk-position'
                note right of POS_HANDLER #yellow
                    Message: {
                        id: <transferMessage.transferId>
                        from: <transferMessage.payerFsp>,
                        to: <transferMessage.payeeFsp>,
                        type: application/json
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: bulk-processing,
                                action: reject,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0,
                                    description: "action successful"
                                }
                            }
                        }
                    }
                end note
                POS_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TOPIC_BULK_PROCESSING
                deactivate TOPIC_BULK_PROCESSING
            end
        else action == 'abort'
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <payload.errorInformation.errorCode || 5000>
                                description: <payload.errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        end
    end

    opt type IN ['position','bulk-position'] && action == 'fail' (Unable to currently trigger this scenario)
        POS_HANDLER -> POS_DAO: Request current state of transfer from DB\n<color #FF0000><b>Error code:</b> 2003</color>
        activate POS_DAO
        POS_DAO -> DB: Retrieve current state of transfer from DB
        activate DB
        hnote over DB #lightyellow
            transferStateChange
        end note
        DB - -> POS_DAO: Return current state of transfer from DB
        deactivate DB
        POS_DAO - -> POS_HANDLER: Return current state of transfer from DB
        deactivate POS_DAO
        POS_HANDLER <-> POS_HANDLER: Validate current state (transferStateChange.transferStateId == 'FAILED')

        group Persist Position change and Transfer state
            POS_HANDLER -> POS_HANDLER: **transferStateId** = 'FAILED'
            POS_HANDLER -> POS_DAO: Request to persist latest position and state to DB\n<color #FF0000><b>Error code:</b> 2003</color>
            group Refer to <color #blue>DB TRANSACTION IMPLEMENTATION</color> above
                activate POS_DAO
                POS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    participantPosition
                    transferStateChange
                    participantPositionChange
                end note
            end
            POS_DAO - -> POS_HANDLER: Return success
            deactivate POS_DAO
        end
        alt If type =='position'
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 3100,
                                "errorDescription": "Transfer failed",
                                "extensionList": <transferMessage.extensionList>
                            }
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: notification,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        else If type =='bulk-position'
            note right of POS_HANDLER #yellow
                Message: {
                    id: <transferMessage.transferId>
                    from: <transferMessage.payerFsp>,
                    to: <transferMessage.payeeFsp>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: {
                            "errorInformation": {
                                "errorCode": 3100,
                                "errorDescription": "Transfer failed",
                                "extensionList": <transferMessage.extensionList>
                            }
                        }
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: bulk-processing,
                            action: abort,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            POS_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TOPIC_BULK_PROCESSING
            deactivate TOPIC_BULK_PROCESSING
        end
    end
end
deactivate POS_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>