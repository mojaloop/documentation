<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="9427px" preserveAspectRatio="none" style="width:1804px;height:9427px;" version="1.1" viewBox="0 0 1804 9427" width="1804px" zoomAndPan="magnify"><defs><filter height="300%" id="f1astixi91bswf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="738" x="534" y="23.5352">2.2.2. Fulfil Handler Consume (Reject/Abort) (single message, includes individual transfers from Bulk)</text><rect fill="#FFFFE0" height="9381.5957" style="stroke: #A80036; stroke-width: 1.0;" width="1640.5" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="798.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="60" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="9214.3086" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="353" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="6849.3594"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="7315.0781"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="8822.877"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="9288.5957"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="2162.7441"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="2782.2813"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="3474.1289"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="5870.2559"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="7843.7734"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="1666.4043"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="6335.9746"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="8309.4922"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="696.498"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="990.2246"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="3584.7051"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="3789.5684"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4061.6738"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4347.4238"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="4764.998" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4576.5977"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="4359.3613" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1356.5" y="4982.2344"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="741.1191"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="1034.8457"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="3614.0156"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="3818.8789"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4090.9844"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4376.7344"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4605.9082"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="5011.5449"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="5253.2734" style="stroke: #000000; stroke-width: 2.0;" width="1780" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="5221.9629" style="stroke: #000000; stroke-width: 2.0;" width="1760" x="23" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="619" x="289" y="241.2188"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="599" x="299" y="265.5293"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="753" x="299" y="361.4609"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="483.0137"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="3121.3809" style="stroke: #000000; stroke-width: 2.0;" width="1514" x="259" y="600.2559"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="2778.3438" style="stroke: #000000; stroke-width: 2.0;" width="1476" x="269" y="936.293"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="2353.7305" style="stroke: #000000; stroke-width: 2.0;" width="1048" x="279" y="1172.3984"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="1011.0352" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="1196.709"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="979.7246" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="1221.0195"/><rect fill="#FFFFFF" height="496.3398" style="stroke: none; stroke-width: 1.0;" width="1008" x="299" y="1704.4043"/><rect fill="#FFFFFF" height="619.5371" style="stroke: none; stroke-width: 1.0;" width="1048" x="279" y="2214.7441"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="590.582" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="2236.6992"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="559.2715" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="2261.0098"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="1008" x="299" y="2339.252"/><rect fill="#FFFFFF" height="103.8867" style="stroke: none; stroke-width: 1.0;" width="1048" x="279" y="2834.2813"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="299" y="2856.2363"/><rect fill="#FFFFFF" height="587.9609" style="stroke: none; stroke-width: 1.0;" width="1048" x="279" y="2938.168"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="571.9609" style="stroke: #000000; stroke-width: 2.0;" width="918" x="289" y="2947.168"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="540.6504" style="stroke: #000000; stroke-width: 2.0;" width="898" x="299" y="2971.4785"/><rect fill="#FFFFFF" height="481.0293" style="stroke: none; stroke-width: 1.0;" width="898" x="299" y="3031.0996"/><rect fill="#FFFFFF" height="181.5078" style="stroke: none; stroke-width: 1.0;" width="1476" x="269" y="3533.1289"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="1582.6582" style="stroke: #000000; stroke-width: 2.0;" width="1444" x="279" y="3735.6367"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="558.5449" style="stroke: #000000; stroke-width: 2.0;" width="1417" x="289" y="3925.8105"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1397" x="299" y="4007.7422"/><rect fill="#FFFFFF" height="270.4395" style="stroke: none; stroke-width: 1.0;" width="1417" x="289" y="4213.916"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1396" x="299" y="4293.4922"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="376.6816" style="stroke: #000000; stroke-width: 2.0;" width="1424" x="289" y="4498.3555"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1404" x="299" y="4522.666"/><rect fill="#FFFFFF" height="103.8867" style="stroke: none; stroke-width: 1.0;" width="1424" x="289" y="4771.1504"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="299" y="4793.1055"/><rect fill="#FFFFFF" height="436.2578" style="stroke: none; stroke-width: 1.0;" width="1444" x="279" y="4882.0371"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="407.3027" style="stroke: #000000; stroke-width: 2.0;" width="1424" x="289" y="4903.9922"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1404" x="299" y="4928.3027"/><rect fill="#FFFFFF" height="103.8867" style="stroke: none; stroke-width: 1.0;" width="1424" x="289" y="5207.4082"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="498" x="299" y="5229.3633"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1760" x="23" y="5325.2949"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="5400.5605"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="5424.8711"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="1008" x="299" y="5908.2559"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="965.1035" style="stroke: #000000; stroke-width: 2.0;" width="699" x="289" y="6394.9746"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="679" x="299" y="6419.2852"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="679" x="299" y="6887.3594"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="7374.0781"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="7398.3887"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="1008" x="299" y="7881.7734"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="965.1035" style="stroke: #000000; stroke-width: 2.0;" width="699" x="289" y="8368.4922"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="679" x="299" y="8392.8027"/><rect fill="#FFFFFF" height="465.7188" style="stroke: none; stroke-width: 1.0;" width="679" x="299" y="8860.877"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="358" x2="358" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="898" x2="898" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1010" x2="1010" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1119" x2="1119" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1247" x2="1247" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1356" x2="1356" y1="116.2871" y2="9350.5957"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1617.5" x2="1617.5" y1="116.2871" y2="9350.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="37" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="33" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="40" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="45.5" y="101.334">fulfil</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="37" y="9349.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="33" y="9353.5957"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="40" y="9374.1309">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="45.5" y="9390.6191">fulfil</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="309" y="113.334">Fulfil Handler</text><ellipse cx="358" cy="83.7988" fill="#FEFECE" filter="url(#f1astixi91bswf)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="354,71.7988,360,66.7988,358,71.7988,360,76.7988,354,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="309" y="9363.1309">Fulfil Handler</text><ellipse cx="358" cy="9382.084" fill="#FEFECE" filter="url(#f1astixi91bswf)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="354,9370.084,360,9365.084,358,9370.084,360,9375.084,354,9370.084" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="832" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="828" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="873" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="835" y="101.334">transfer-position</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="832" y="9349.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="828" y="9353.5957"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="873" y="9374.1309">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="835" y="9390.6191">transfer-position</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="982" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="978" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="985" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="987.5" y="101.334">event</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="982" y="9349.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="978" y="9353.5957"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="985" y="9374.1309">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="987.5" y="9390.6191">event</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1056" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1052" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1094.5" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1059" y="101.334">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1056" y="9349.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1052" y="9353.5957"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1094.5" y="9374.1309">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1059" y="9390.6191">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1201" y="60.3105"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1197" y="64.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1222" y="84.8457">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1204" y="101.334">notification</text><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1201" y="9349.5957"/><rect fill="#FEFECE" filter="url(#f1astixi91bswf)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1197" y="9353.5957"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1222" y="9374.1309">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1204" y="9390.6191">notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1307" y="113.334">Transfer DAO</text><ellipse cx="1356.5" cy="83.7988" fill="#FEFECE" filter="url(#f1astixi91bswf)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1344.5" x2="1368.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1307" y="9363.1309">Transfer DAO</text><ellipse cx="1356.5" cy="9382.084" fill="#FEFECE" filter="url(#f1astixi91bswf)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1344.5" x2="1368.5" y1="9396.084" y2="9396.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1569.5" y="113.334">Central Store</text><path d="M1599.5,63.7988 C1599.5,53.7988 1617.5,53.7988 1617.5,53.7988 C1617.5,53.7988 1635.5,53.7988 1635.5,63.7988 L1635.5,89.7988 C1635.5,99.7988 1617.5,99.7988 1617.5,99.7988 C1617.5,99.7988 1599.5,99.7988 1599.5,89.7988 L1599.5,63.7988 " fill="#FEFECE" filter="url(#f1astixi91bswf)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1599.5,63.7988 C1599.5,73.7988 1617.5,73.7988 1617.5,73.7988 C1617.5,73.7988 1635.5,73.7988 1635.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1569.5" y="9363.1309">Central Store</text><path d="M1599.5,9376.084 C1599.5,9366.084 1617.5,9366.084 1617.5,9366.084 C1617.5,9366.084 1635.5,9366.084 1635.5,9376.084 L1635.5,9402.084 C1635.5,9412.084 1617.5,9412.084 1617.5,9412.084 C1617.5,9412.084 1599.5,9412.084 1599.5,9402.084 L1599.5,9376.084 " fill="#FEFECE" filter="url(#f1astixi91bswf)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1599.5,9376.084 C1599.5,9386.084 1617.5,9386.084 1617.5,9386.084 C1617.5,9386.084 1635.5,9386.084 1635.5,9376.084 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="60" y="196.2188"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="9214.3086" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="353" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="6849.3594"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="7315.0781"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="8822.877"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="893" y="9288.5957"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="2162.7441"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="2782.2813"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="3474.1289"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="5870.2559"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1114.5" y="7843.7734"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="1666.4043"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="6335.9746"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1242" y="8309.4922"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="696.498"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="167.1738" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="990.2246"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="3584.7051"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="3789.5684"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4061.6738"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4347.4238"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="4764.998" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1351.5" y="4576.5977"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="4359.3613" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1356.5" y="4982.2344"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="741.1191"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="1034.8457"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="3614.0156"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="3818.8789"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4090.9844"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4376.7344"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="4605.9082"/><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1612.5" y="5011.5449"/><path d="M13,133.2871 L276,133.2871 L276,140.2871 L266,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5253.2734" style="stroke: #000000; stroke-width: 2.0;" width="1780" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="28" y="146.8555">Fulfil Handler Consume (Failure)</text><path d="M23,157.5977 L85,157.5977 L85,164.5977 L75,174.5977 L23,174.5977 L23,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5221.9629" style="stroke: #000000; stroke-width: 2.0;" width="1760" x="23" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="171.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="100" y="170.2324">[Consume Single Message]</text><polygon fill="#A80036" points="81,192.2188,71,196.2188,81,200.2188,77,196.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75" x2="352" y1="196.2188" y2="196.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="87" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="100" y="191.4766">Consume Fulfil event message for Payer</text><path d="M289,241.2188 L373,241.2188 L373,248.2188 L363,258.2188 L289,258.2188 L289,241.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="619" x="289" y="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="304" y="254.7871">break</text><path d="M299,265.5293 L441,265.5293 L441,272.5293 L431,282.5293 L299,282.5293 L299,265.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="599" x="299" y="265.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="314" y="279.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="319.4609" y2="319.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="319.4609" y2="332.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="332.4609" y2="332.4609"/><polygon fill="#A80036" points="374,328.4609,364,332.4609,374,336.4609,370,332.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="370" y="307.0635">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="503" x="383" y="299.4082">Validate event - Rule: type IN ['fulfil','bulk-fulfil'] &amp;&amp; ( action IN ['reject','abort'] )</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="383" y="314.7188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="467" y="314.7188">2001</text><path d="M299,361.4609 L514,361.4609 L514,368.4609 L504,378.4609 L299,378.4609 L299,361.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="107.5527" style="stroke: #000000; stroke-width: 2.0;" width="753" x="299" y="361.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="314" y="375.0293">Persist Event Information</text><polygon fill="#A80036" points="998,396.082,1008,400.082,998,404.082,1002,400.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1004" y1="400.082" y2="400.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="370" y="395.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="383" y="395.3398">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="735" x="306" y="408.082"/><polygon fill="#EEEEEE" points="306,408.082,370,408.082,370,415.082,360,425.082,306,425.082,306,408.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="319" y="422.6504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="600.5" y="441.6504">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="604.5" y="456.9609"/><path d="M299,483.0137 L521,483.0137 L521,490.0137 L511,500.0137 L299,500.0137 L299,483.0137 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.2422" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="483.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="314" y="496.582">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="990" x="306" y="525.3242"/><polygon fill="#EEEEEE" points="306,525.3242,370,525.3242,370,532.3242,360,542.3242,306,542.3242,306,525.3242" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="319" y="539.8926">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="635" y="558.8926">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="853" y="558.8926">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="635" y="574.2031">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="719" y="574.2031">2001</text><path d="M259,600.2559 L571,600.2559 L571,607.2559 L561,617.2559 L259,617.2559 L259,600.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3121.3809" style="stroke: #000000; stroke-width: 2.0;" width="1514" x="259" y="600.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="267" x="274" y="613.8242">Validate Transfer Fulfil Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="638.877" y2="638.877"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="638.877" y2="651.877"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="651.877" y2="651.877"/><polygon fill="#A80036" points="374,647.877,364,651.877,374,655.877,370,651.877" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="370" y="634.1348">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="383" y="634.1348">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1339.5,692.498,1349.5,696.498,1339.5,700.498,1343.5,696.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="696.498" y2="696.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="370" y="684.1006">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="383" y="676.4453">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="383" y="691.7559">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="460" y="691.7559">2003</text><polygon fill="#A80036" points="1600.5,737.1191,1610.5,741.1191,1600.5,745.1191,1604.5,741.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="741.1191" y2="741.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1368.5" y="728.7217">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1381.5" y="721.0664">Request Transfer fulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1381.5" y="736.377">duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1482,754.1191,1753,754.1191,1763,780.1191,1753,807.1191,1482,807.1191,1472,780.1191,1482,754.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1484" y="770.6875">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="1484" y="785.998">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="1524" y="785.998">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1484" y="801.3086">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1372.5,830.3613,1362.5,834.3613,1372.5,838.3613,1368.5,834.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1366.5" x2="1616.5" y1="834.3613" y2="834.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1378.5" y="829.6191">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1391.5" y="829.6191">Return existing hashes</text><polygon fill="#A80036" points="374,859.6719,364,863.6719,374,867.6719,370,863.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="863.6719" y2="863.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="380" y="858.9297">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="393" y="858.9297">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="908.293" y2="908.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="908.293" y2="921.293"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="921.293" y2="921.293"/><polygon fill="#A80036" points="374,917.293,364,921.293,374,925.293,370,921.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="370" y="895.8955">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="383" y="888.2402">Loop the list of returned hashes &amp; compare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="383" y="903.5508">each entry with the calculated message hash</text><path d="M269,936.293 L331,936.293 L331,943.293 L321,953.293 L269,953.293 L269,936.293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2778.3438" style="stroke: #000000; stroke-width: 2.0;" width="1476" x="269" y="936.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="284" y="949.8613">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="346" y="948.9277">[Hash matched]</text><polygon fill="#A80036" points="1339.5,986.2246,1349.5,990.2246,1339.5,994.2246,1343.5,990.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="990.2246" y2="990.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="977.8271">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="392" y="970.1719">Request to retrieve Transfer Fulfilment &amp; Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="985.4824">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="985.4824">2003</text><polygon fill="#A80036" points="1600.5,1030.8457,1610.5,1034.8457,1600.5,1038.8457,1604.5,1034.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="1034.8457" y2="1034.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="1022.4482">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1390.5" y="1014.793">Request to retrieve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1390.5" y="1030.1035">transferFulfilment &amp; transferState</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1552,1047.8457,1683,1047.8457,1693,1066.8457,1683,1085.8457,1552,1085.8457,1542,1066.8457,1552,1047.8457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1554" y="1064.4141">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1554" y="1079.7246">transferStateChange</text><polygon fill="#A80036" points="1372.5,1124.0879,1362.5,1128.0879,1372.5,1132.0879,1368.5,1128.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1366.5" x2="1616.5" y1="1128.0879" y2="1128.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1378.5" y="1115.6904">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="1400.5" y="1108.0352">Return transferFulfilment &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1400.5" y="1123.3457">transferState</text><polygon fill="#A80036" points="374,1153.3984,364,1157.3984,374,1161.3984,370,1157.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="1157.3984" y2="1157.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="1152.6563">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="402" y="1152.6563">Return Transfer Fulfilment &amp; Transfer state</text><path d="M279,1172.3984 L341,1172.3984 L341,1179.3984 L331,1189.3984 L279,1189.3984 L279,1172.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2353.7305" style="stroke: #000000; stroke-width: 2.0;" width="1048" x="279" y="1172.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="294" y="1185.9668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="185" x="356" y="1185.0332">[transferFulfilment.isValid == 0]</text><path d="M289,1196.709 L373,1196.709 L373,1203.709 L363,1213.709 L289,1213.709 L289,1196.709 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1011.0352" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="1196.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="304" y="1210.2773">break</text><path d="M299,1221.0195 L361,1221.0195 L361,1228.0195 L351,1238.0195 L299,1238.0195 L299,1221.0195 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="979.7246" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="1221.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="1234.5879">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="376" y="1233.6543">[If type == 'fulfil']</text><path d="M368,1243.3301 L368,1620.3301 L677,1620.3301 L677,1253.3301 L667,1243.3301 L368,1243.3301 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,1243.3301 L667,1253.3301 L677,1253.3301 L667,1243.3301 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="1260.8984">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="1276.209">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="1291.5195">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="1306.8301">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="1322.1406">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="1337.4512">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="1352.7617">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="1368.0723">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="1383.3828">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="1398.6934">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="1414.0039">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="1429.3145">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="1444.625">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="1459.9355">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="422" y="1475.2461">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="422" y="1490.5566">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="1505.8672">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="1521.1777">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="1536.4883">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="1551.7988">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="1567.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="1582.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="1597.7305">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="1613.041">}</text><polygon fill="#A80036" points="1230,1662.4043,1240,1666.4043,1230,1670.4043,1234,1666.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1236" y1="1666.4043" y2="1666.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="1654.0068">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="392" y="1646.3516">Publish Notification event for Payee - Modified Request</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="1661.6621">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="1661.6621">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="1307" y1="1705.4043" y2="1705.4043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="304" y="1716.0391">[If type == 'bulk-fulfil']</text><path d="M368,1724.3594 L368,2101.3594 L677,2101.3594 L677,1734.3594 L667,1724.3594 L368,1724.3594 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,1724.3594 L667,1734.3594 L677,1734.3594 L667,1724.3594 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="1741.9277">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="1757.2383">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="1772.5488">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="1787.8594">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="1803.1699">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="1818.4805">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="1833.791">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="1849.1016">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="1864.4121">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="1879.7227">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="1895.0332">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="1910.3438">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="1925.6543">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="1940.9648">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="422" y="1956.2754">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="422" y="1971.5859">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="1986.8965">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="2002.207">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="2017.5176">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="2032.8281">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="2048.1387">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="2063.4492">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2078.7598">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="2094.0703">}</text><polygon fill="#A80036" points="1102.5,2158.7441,1112.5,2162.7441,1102.5,2166.7441,1106.5,2162.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1108.5" y1="2162.7441" y2="2162.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="2142.6914">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="392" y="2127.3809">Publish Notification event for Payee - Modified Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="392" y="2142.6914">3106 to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="2158.002">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="2158.002">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1327" y1="2215.7441" y2="2215.7441"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="284" y="2226.3789">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M289,2236.6992 L373,2236.6992 L373,2243.6992 L363,2253.6992 L289,2253.6992 L289,2236.6992 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="590.582" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="2236.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="304" y="2250.2676">break</text><path d="M299,2261.0098 L361,2261.0098 L361,2268.0098 L351,2278.0098 L299,2278.0098 L299,2261.0098 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="559.2715" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="2261.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="2274.5781">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="376" y="2273.6445">[If type == 'fulfil']</text><rect fill="#FFFFFF" filter="url(#f1astixi91bswf)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="990" x="306" y="2278.3203"/><polygon fill="#EEEEEE" points="306,2278.3203,370,2278.3203,370,2285.3203,360,2295.3203,306,2295.3203,306,2278.3203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="319" y="2292.8887">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="682" y="2311.8887">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="686" y="2327.1992"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="1307" y1="2340.252" y2="2340.252"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="304" y="2350.8867">[If type == 'bulk-fulfil']</text><path d="M368,2359.207 L368,2736.207 L677,2736.207 L677,2369.207 L667,2359.207 L368,2359.207 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,2359.207 L667,2369.207 L677,2369.207 L667,2359.207 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="2376.7754">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="2392.0859">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="2407.3965">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="2422.707">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="2438.0176">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="2453.3281">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="2468.6387">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="2483.9492">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="2499.2598">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="2514.5703">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="2529.8809">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="2545.1914">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="2560.502">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="2575.8125">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="422" y="2591.123">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="422" y="2606.4336">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="2621.7441">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="2637.0547">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="2652.3652">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="2667.6758">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="2682.9863">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="2698.2969">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="2713.6074">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="2728.918">}</text><polygon fill="#A80036" points="1102.5,2778.2813,1112.5,2782.2813,1102.5,2786.2813,1106.5,2782.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1108.5" y1="2782.2813" y2="2782.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="2769.8838">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="392" y="2762.2285">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="2777.5391">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="2777.5391">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1327" y1="2835.2813" y2="2835.2813"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="284" y="2845.916">[transferState NOT 'RESERVED']</text><path d="M299,2856.2363 L383,2856.2363 L383,2863.2363 L373,2873.2363 L299,2873.2363 L299,2856.2363 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="299" y="2856.2363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="314" y="2869.8047">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="2910.168" y2="2910.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="2910.168" y2="2923.168"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="2923.168" y2="2923.168"/><polygon fill="#A80036" points="374,2919.168,364,2923.168,374,2927.168,370,2923.168" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="2897.7705">17</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="392" y="2890.1152">Reference: Failure in validation</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="2905.4258">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="2905.4258">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1327" y1="2939.168" y2="2939.168"/><path d="M289,2947.168 L373,2947.168 L373,2954.168 L363,2964.168 L289,2964.168 L289,2947.168 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="571.9609" style="stroke: #000000; stroke-width: 2.0;" width="918" x="289" y="2947.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="304" y="2960.7363">break</text><path d="M299,2971.4785 L361,2971.4785 L361,2978.4785 L351,2988.4785 L299,2988.4785 L299,2971.4785 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="540.6504" style="stroke: #000000; stroke-width: 2.0;" width="898" x="299" y="2971.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="2985.0469">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="376" y="2984.1133">[If type == 'fulfil']</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="3010.0996" y2="3010.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="3010.0996" y2="3023.0996"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="3023.0996" y2="3023.0996"/><polygon fill="#A80036" points="374,3019.0996,364,3023.0996,374,3027.0996,370,3023.0996" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="3005.3574">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="392" y="3005.3574">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="1197" y1="3032.0996" y2="3032.0996"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="304" y="3042.7344">[If type == 'bulk-fulfil']</text><path d="M368,3051.0547 L368,3428.0547 L677,3428.0547 L677,3061.0547 L667,3051.0547 L368,3051.0547 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,3051.0547 L667,3061.0547 L677,3061.0547 L667,3051.0547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="3068.623">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="3083.9336">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="3099.2441">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="3114.5547">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="3129.8652">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="3145.1758">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="3160.4863">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="3175.7969">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="3191.1074">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="3206.418">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="3221.7285">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="3237.0391">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="3252.3496">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="3267.6602">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="422" y="3282.9707">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="422" y="3298.2813">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="3313.5918">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="3328.9023">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="3344.2129">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="3359.5234">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="3374.834">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="3390.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="3405.4551">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="3420.7656">}</text><polygon fill="#A80036" points="1102.5,3470.1289,1112.5,3474.1289,1102.5,3478.1289,1106.5,3474.1289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1108.5" y1="3474.1289" y2="3474.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="3461.7314">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="383" x="392" y="3454.0762">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="3469.3867">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="3469.3867">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="1745" y1="3534.1289" y2="3534.1289"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="274" y="3544.7637">[Hash not matched]</text><polygon fill="#A80036" points="1339.5,3580.7051,1349.5,3584.7051,1339.5,3588.7051,1343.5,3584.7051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="3584.7051" y2="3584.7051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="3572.3076">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="392" y="3564.6523">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="3579.9629">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="3579.9629">2003</text><polygon fill="#A80036" points="1600.5,3610.0156,1610.5,3614.0156,1600.5,3618.0156,1604.5,3614.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="3614.0156" y2="3614.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="3609.2734">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1390.5" y="3609.2734">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1509,3657.0156,1725,3657.0156,1735,3668.0156,1725,3680.0156,1509,3680.0156,1499,3668.0156,1509,3657.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1511" y="3673.584">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="374,3702.6367,364,3706.6367,374,3710.6367,370,3706.6367" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="3706.6367" y2="3706.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="3701.8945">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="402" y="3701.8945">Return success</text><path d="M279,3735.6367 L341,3735.6367 L341,3742.6367 L331,3752.6367 L279,3752.6367 L279,3735.6367 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1582.6582" style="stroke: #000000; stroke-width: 2.0;" width="1444" x="279" y="3735.6367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="294" y="3749.2051">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287" x="356" y="3748.2715">[action=='reject' call made on PUT /transfers/{ID}]</text><polygon fill="#A80036" points="1339.5,3785.5684,1349.5,3789.5684,1339.5,3793.5684,1343.5,3789.5684" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="3789.5684" y2="3789.5684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="3777.1709">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="392" y="3769.5156">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="3784.8262">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="3784.8262">2003</text><polygon fill="#A80036" points="1600.5,3814.8789,1610.5,3818.8789,1600.5,3822.8789,1604.5,3818.8789" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="3818.8789" y2="3818.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="3814.1367">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1390.5" y="3814.1367">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1591,3831.8789,1644,3831.8789,1654,3842.8789,1644,3854.8789,1591,3854.8789,1581,3842.8789,1591,3831.8789" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1593" y="3848.4473">transfer</text><polygon fill="#A80036" points="1372.5,3877.5,1362.5,3881.5,1372.5,3885.5,1368.5,3881.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1366.5" x2="1616.5" y1="3881.5" y2="3881.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1378.5" y="3876.7578">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1404.5" y="3876.7578"/><polygon fill="#A80036" points="374,3906.8105,364,3910.8105,374,3914.8105,370,3910.8105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="3910.8105" y2="3910.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="3906.0684">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="402" y="3906.0684">Return transfer</text><path d="M289,3925.8105 L351,3925.8105 L351,3932.8105 L341,3942.8105 L289,3942.8105 L289,3925.8105 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="558.5449" style="stroke: #000000; stroke-width: 2.0;" width="1417" x="289" y="3925.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="304" y="3939.3789">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="313" x="366" y="3938.4453">[Fulfilment present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="3979.7422" y2="3979.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="3979.7422" y2="3992.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="3992.7422" y2="3992.7422"/><polygon fill="#A80036" points="374,3988.7422,364,3992.7422,374,3996.7422,370,3992.7422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="3967.3447">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="392" y="3959.6895">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="3975">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="3975">2001</text><path d="M299,4007.7422 L459,4007.7422 L459,4014.7422 L449,4024.7422 L299,4024.7422 L299,4007.7422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1397" x="299" y="4007.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="314" y="4021.3105">Persist fulfilment</text><polygon fill="#A80036" points="1339.5,4057.6738,1349.5,4061.6738,1339.5,4065.6738,1343.5,4061.6738" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="4061.6738" y2="4061.6738"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4049.2764">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="392" y="4041.6211">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="4056.9316">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="4056.9316">2003</text><polygon fill="#A80036" points="1600.5,4086.9844,1610.5,4090.9844,1600.5,4094.9844,1604.5,4090.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="4090.9844" y2="4090.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="4086.2422">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1390.5" y="4086.2422">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1559,4133.9844,1676,4133.9844,1686,4152.9844,1676,4171.9844,1559,4171.9844,1549,4152.9844,1559,4133.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1561" y="4150.5527">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1561" y="4165.8633">transferExtension</text><polygon fill="#A80036" points="374,4194.916,364,4198.916,374,4202.916,370,4198.916" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="4198.916" y2="4198.916"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="4194.1738">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="402" y="4194.1738">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="289" x2="1706" y1="4214.916" y2="4214.916"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="342" x="294" y="4225.5508">[Fulfilment NOT present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="4265.4922" y2="4265.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="4265.4922" y2="4278.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="4278.4922" y2="4278.4922"/><polygon fill="#A80036" points="374,4274.4922,364,4278.4922,374,4282.4922,370,4278.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4253.0947">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="362" x="392" y="4245.4395">Validate that transfer fulfilment message to Abort is valid</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="4260.75">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="4260.75">2001</text><path d="M299,4293.4922 L466,4293.4922 L466,4300.4922 L456,4310.4922 L299,4310.4922 L299,4293.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1396" x="299" y="4293.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="314" y="4307.0605">Persist extensions</text><polygon fill="#A80036" points="1339.5,4343.4238,1349.5,4347.4238,1339.5,4351.4238,1343.5,4347.4238" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="4347.4238" y2="4347.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4335.0264">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="392" y="4327.3711">Persist extensionList elements</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="4342.6816">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="4342.6816">2003</text><polygon fill="#A80036" points="1600.5,4372.7344,1610.5,4376.7344,1600.5,4380.7344,1604.5,4376.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="4376.7344" y2="4376.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="4371.9922">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1390.5" y="4371.9922">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1560,4419.7344,1675,4419.7344,1685,4430.7344,1675,4442.7344,1560,4442.7344,1550,4430.7344,1560,4419.7344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1562" y="4436.3027">transferExtension</text><polygon fill="#A80036" points="374,4465.3555,364,4469.3555,374,4473.3555,370,4469.3555" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="4469.3555" y2="4469.3555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="4464.6133">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="402" y="4464.6133">Return success</text><path d="M289,4498.3555 L351,4498.3555 L351,4505.3555 L341,4515.3555 L289,4515.3555 L289,4498.3555 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.6816" style="stroke: #000000; stroke-width: 2.0;" width="1424" x="289" y="4498.3555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="304" y="4511.9238">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="429" x="366" y="4510.9902">[Transfer.ilpCondition validate successful OR generic validation successful]</text><path d="M299,4522.666 L758,4522.666 L758,4529.666 L748,4539.666 L299,4539.666 L299,4522.666 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="183.8633" style="stroke: #000000; stroke-width: 2.0;" width="1404" x="299" y="4522.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="414" x="314" y="4536.2344">Persist Transfer State (with transferState='RECEIVED_REJECT')</text><polygon fill="#A80036" points="1339.5,4572.5977,1349.5,4576.5977,1339.5,4580.5977,1343.5,4576.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1345.5" y1="4576.5977" y2="4576.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4564.2002">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="392" y="4556.5449">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="4571.8555">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="4571.8555">2003</text><polygon fill="#A80036" points="1600.5,4601.9082,1610.5,4605.9082,1600.5,4609.9082,1604.5,4605.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1361.5" x2="1606.5" y1="4605.9082" y2="4605.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1368.5" y="4601.166">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1390.5" y="4601.166">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1552,4648.9082,1683,4648.9082,1693,4659.9082,1683,4671.9082,1552,4671.9082,1542,4659.9082,1552,4648.9082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1554" y="4665.4766">transferStateChange</text><polygon fill="#A80036" points="374,4694.5293,364,4698.5293,374,4702.5293,370,4698.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1350.5" y1="4698.5293" y2="4698.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="4693.7871">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="402" y="4693.7871">Return success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="4750.1504" y2="4750.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="4750.1504" y2="4763.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="4763.1504" y2="4763.1504"/><polygon fill="#A80036" points="374,4759.1504,364,4763.1504,374,4767.1504,370,4763.1504" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4737.7529">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="392" y="4730.0977">Route &amp; Publish Position event for Payer</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="334" x="392" y="4745.4082">Reference: Publish Position Reject event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="289" x2="1713" y1="4772.1504" y2="4772.1504"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="382" x="294" y="4782.7852">[Validate Fulfil Transfer not successful or Generic validation failed]</text><path d="M299,4793.1055 L383,4793.1055 L383,4800.1055 L373,4810.1055 L299,4810.1055 L299,4793.1055 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="314" x="299" y="4793.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="314" y="4806.6738">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="4847.0371" y2="4847.0371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="4847.0371" y2="4860.0371"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="4860.0371" y2="4860.0371"/><polygon fill="#A80036" points="374,4856.0371,364,4860.0371,374,4864.0371,370,4860.0371" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4834.6396">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="392" y="4826.9844">Publish event for Payee</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="392" y="4842.2949">Reference: Failure in validation</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="279" x2="1723" y1="4883.0371" y2="4883.0371"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="284" y="4893.6719">[action=='abort' Error callback]</text><path d="M289,4903.9922 L351,4903.9922 L351,4910.9922 L341,4920.9922 L289,4920.9922 L289,4903.9922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="407.3027" style="stroke: #000000; stroke-width: 2.0;" width="1424" x="289" y="4903.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="304" y="4917.5605">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="366" y="4916.627">[Validation successful]</text><path d="M299,4928.3027 L756,4928.3027 L756,4935.3027 L746,4945.3027 L299,4945.3027 L299,4928.3027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1404" x="299" y="4928.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="412" x="314" y="4941.8711">Persist Transfer State (with transferState='RECEIVED_ERROR')</text><polygon fill="#A80036" points="1344.5,4978.2344,1354.5,4982.2344,1344.5,4986.2344,1348.5,4982.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1350.5" y1="4982.2344" y2="4982.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="4969.8369">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="392" y="4962.1816">Request to persist transfer state &amp; Error</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="392" y="4977.4922">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="469" y="4977.4922">2003</text><polygon fill="#A80036" points="1600.5,5007.5449,1610.5,5011.5449,1600.5,5015.5449,1604.5,5011.5449" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1366.5" x2="1606.5" y1="5011.5449" y2="5011.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1373.5" y="5006.8027">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="1395.5" y="5006.8027">Persist transfer state &amp; Error</text><polygon fill="#FFFFE0" filter="url(#f1astixi91bswf)" points="1552,5054.5449,1683,5054.5449,1693,5080.5449,1683,5107.5449,1552,5107.5449,1542,5080.5449,1552,5054.5449" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1554" y="5071.1133">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1554" y="5086.4238">transferError</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="1554" y="5101.7344">transferExtension</text><polygon fill="#A80036" points="374,5130.7871,364,5134.7871,374,5138.7871,370,5134.7871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="368" x2="1355.5" y1="5134.7871" y2="5134.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="380" y="5130.0449">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="402" y="5130.0449">Return success</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="5186.4082" y2="5186.4082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="5186.4082" y2="5199.4082"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="5199.4082" y2="5199.4082"/><polygon fill="#A80036" points="374,5195.4082,364,5199.4082,374,5203.4082,370,5199.4082" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="5174.0107">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="392" y="5166.3555">Error callback validated</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="381" x="392" y="5181.666">Reference: Produce message for validated error callback</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="289" x2="1713" y1="5208.4082" y2="5208.4082"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="274" x="294" y="5219.043">[Validate Transfer Error Message not successful]</text><path d="M299,5229.3633 L383,5229.3633 L383,5236.3633 L373,5246.3633 L299,5246.3633 L299,5229.3633 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="498" x="299" y="5229.3633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="314" y="5242.9316">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="405" y1="5283.2949" y2="5283.2949"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405" x2="405" y1="5283.2949" y2="5296.2949"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="405" y1="5296.2949" y2="5296.2949"/><polygon fill="#A80036" points="374,5292.2949,364,5296.2949,374,5300.2949,370,5296.2949" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="5270.8975">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="392" y="5263.2422">Notifications for failures</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="393" x="392" y="5278.5527">Reference: Validate Transfer Error Message not successful</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1783" y1="5326.2949" y2="5326.2949"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="28" y="5336.9297">[Consume Batch Messages]</text><path d="M130,5345.25 L130,5370.25 L344,5370.25 L344,5355.25 L334,5345.25 L130,5345.25 " fill="#ADD8E6" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M334,5345.25 L334,5355.25 L344,5355.25 L334,5345.25 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="136" y="5362.8184">To be delivered by future story</text><path d="M289,5400.5605 L727,5400.5605 L727,5407.5605 L717,5417.5605 L289,5417.5605 L289,5400.5605 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="5400.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="393" x="304" y="5414.1289">Reference: Validate Transfer Error Message not successful</text><path d="M299,5424.8711 L361,5424.8711 L361,5431.8711 L351,5441.8711 L299,5441.8711 L299,5424.8711 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="5424.8711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="5438.4395">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="376" y="5437.5059">[If type == 'bulk-fulfil']</text><path d="M368,5447.1816 L368,5824.1816 L677,5824.1816 L677,5457.1816 L667,5447.1816 L368,5447.1816 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,5447.1816 L667,5457.1816 L677,5457.1816 L667,5447.1816 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="5464.75">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="5480.0605">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="5495.3711">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="5510.6816">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="5525.9922">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="5541.3027">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="5556.6133">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="5571.9238">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="5587.2344">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="5602.5449">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="5617.8555">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="5633.166">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="5648.4766">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="5663.7871">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="422" y="5679.0977">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="422" y="5694.4082">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="5709.7188">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="5725.0293">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="5740.3398">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="5755.6504">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="5770.9609">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="5786.2715">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="5801.582">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="5816.8926">}</text><polygon fill="#A80036" points="1102.5,5866.2559,1112.5,5870.2559,1102.5,5874.2559,1106.5,5870.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1108.5" y1="5870.2559" y2="5870.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="5857.8584">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="392" y="5850.2031">Publish Processing event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="5865.5137">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="5865.5137">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="1307" y1="5909.2559" y2="5909.2559"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="304" y="5919.8906">[If type == 'fulfil']</text><path d="M368,5928.2109 L368,6305.2109 L677,6305.2109 L677,5938.2109 L667,5928.2109 L368,5928.2109 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,5928.2109 L667,5938.2109 L677,5938.2109 L667,5928.2109 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="5945.7793">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="5961.0898">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="5976.4004">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="5991.7109">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="6007.0215">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="6022.332">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="6037.6426">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="6052.9531">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="6068.2637">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="6083.5742">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="6098.8848">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="6114.1953">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="6129.5059">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="6144.8164">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="422" y="6160.127">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="422" y="6175.4375">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="6190.748">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="6206.0586">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="6221.3691">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="6236.6797">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="6251.9902">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="6267.3008">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="6282.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="6297.9219">}</text><polygon fill="#A80036" points="1230,6331.9746,1240,6335.9746,1230,6339.9746,1234,6335.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1236" y1="6335.9746" y2="6335.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="6331.2324">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="392" y="6331.2324">Route &amp; Publish Notification event for Payee</text><path d="M289,6394.9746 L715,6394.9746 L715,6401.9746 L705,6411.9746 L289,6411.9746 L289,6394.9746 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="965.1035" style="stroke: #000000; stroke-width: 2.0;" width="699" x="289" y="6394.9746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="381" x="304" y="6408.543">Reference: Produce message for validated error callback</text><path d="M299,6419.2852 L361,6419.2852 L361,6426.2852 L351,6436.2852 L299,6436.2852 L299,6419.2852 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="679" x="299" y="6419.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="6432.8535">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="376" y="6431.9199">[If type == 'bulk-fulfil']</text><path d="M368,6441.5957 L368,6818.5957 L677,6818.5957 L677,6451.5957 L667,6441.5957 L368,6441.5957 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,6441.5957 L667,6451.5957 L677,6451.5957 L667,6441.5957 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="6459.1641">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="6474.4746">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="6489.7852">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="6505.0957">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="6520.4063">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="6535.7168">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="6551.0273">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="6566.3379">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="6581.6484">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="6596.959">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="6612.2695">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="6627.5801">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="6642.8906">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="6658.2012">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="422" y="6673.5117">type: bulk-position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="422" y="6688.8223">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="6704.1328">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="6719.4434">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="6734.7539">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="6750.0645">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="6765.375">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="6780.6855">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="6795.9961">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="6811.3066">}</text><polygon fill="#A80036" points="881,6845.3594,891,6849.3594,881,6853.3594,885,6849.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="887" y1="6849.3594" y2="6849.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="6844.6172">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="392" y="6844.6172">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="978" y1="6888.3594" y2="6888.3594"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="304" y="6898.9941">[If type == 'fulfil']</text><path d="M368,6907.3145 L368,7284.3145 L677,7284.3145 L677,6917.3145 L667,6907.3145 L368,6907.3145 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,6907.3145 L667,6917.3145 L677,6917.3145 L667,6907.3145 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="6924.8828">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="6940.1934">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="6955.5039">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="6970.8145">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="6986.125">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="7001.4355">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="7016.7461">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="7032.0566">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="7047.3672">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="7062.6777">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="7077.9883">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="7093.2988">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="7108.6094">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="7123.9199">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="422" y="7139.2305">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="422" y="7154.541">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="7169.8516">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="7185.1621">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="7200.4727">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="7215.7832">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="7231.0938">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="7246.4043">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="7261.7148">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="7277.0254">}</text><polygon fill="#A80036" points="881,7311.0781,891,7315.0781,881,7319.0781,885,7315.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="887" y1="7315.0781" y2="7315.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="7310.3359">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="392" y="7310.3359">Route &amp; Publish Position event for Payer</text><path d="M289,7374.0781 L543,7374.0781 L543,7381.0781 L533,7391.0781 L289,7391.0781 L289,7374.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="980.4141" style="stroke: #000000; stroke-width: 2.0;" width="1028" x="289" y="7374.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="304" y="7387.6465">Reference: Failure in validation</text><path d="M299,7398.3887 L361,7398.3887 L361,7405.3887 L351,7415.3887 L299,7415.3887 L299,7398.3887 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="949.1035" style="stroke: #000000; stroke-width: 2.0;" width="1008" x="299" y="7398.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="7411.957">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="376" y="7411.0234">[If type == 'bulk-fulfil']</text><path d="M368,7420.6992 L368,7797.6992 L677,7797.6992 L677,7430.6992 L667,7420.6992 L368,7420.6992 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,7420.6992 L667,7430.6992 L677,7430.6992 L667,7420.6992 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="7438.2676">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="7453.5781">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="7468.8887">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="7484.1992">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="7499.5098">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="7514.8203">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="7530.1309">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="7545.4414">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="7560.752">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="7576.0625">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="7591.373">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="7606.6836">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="7621.9941">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="7637.3047">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="422" y="7652.6152">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="422" y="7667.9258">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="7683.2363">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="7698.5469">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="7713.8574">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="7729.168">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="7744.4785">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="7759.7891">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="7775.0996">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="7790.4102">}</text><polygon fill="#A80036" points="1102.5,7839.7734,1112.5,7843.7734,1102.5,7847.7734,1106.5,7843.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1108.5" y1="7843.7734" y2="7843.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="7831.376">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="392" y="7823.7207">Publish processing event to the Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="392" y="7839.0313">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="476" y="7839.0313">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="1307" y1="7882.7734" y2="7882.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="304" y="7893.4082">[If type == 'fulfil']</text><path d="M368,7901.7285 L368,8278.7285 L677,8278.7285 L677,7911.7285 L667,7901.7285 L368,7901.7285 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,7901.7285 L667,7911.7285 L677,7911.7285 L667,7901.7285 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="7919.2969">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="7934.6074">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="7949.918">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="7965.2285">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="7980.5391">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="7995.8496">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="8011.1602">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="8026.4707">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="8041.7813">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="8057.0918">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="8072.4023">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="8087.7129">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="8103.0234">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="8118.334">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="422" y="8133.6445">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="422" y="8148.9551">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="8164.2656">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="8179.5762">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="438" y="8194.8867">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="8210.1973">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="8225.5078">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="8240.8184">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="8256.1289">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="8271.4395">}</text><polygon fill="#A80036" points="1230,8305.4922,1240,8309.4922,1230,8313.4922,1234,8309.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="1236" y1="8309.4922" y2="8309.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="8304.75">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="392" y="8304.75">Route &amp; Publish Notification event for Payee</text><path d="M289,8368.4922 L668,8368.4922 L668,8375.4922 L658,8385.4922 L289,8385.4922 L289,8368.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="965.1035" style="stroke: #000000; stroke-width: 2.0;" width="699" x="289" y="8368.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="334" x="304" y="8382.0605">Reference: Publish Position Reject event for Payer</text><path d="M299,8392.8027 L361,8392.8027 L361,8399.8027 L351,8409.8027 L299,8409.8027 L299,8392.8027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="933.793" style="stroke: #000000; stroke-width: 2.0;" width="679" x="299" y="8392.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="8406.3711">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="376" y="8405.4375">[If type == 'bulk-fulfil']</text><path d="M368,8415.1133 L368,8792.1133 L677,8792.1133 L677,8425.1133 L667,8415.1133 L368,8415.1133 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,8415.1133 L667,8425.1133 L677,8425.1133 L667,8415.1133 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="8432.6816">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="8447.9922">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="8463.3027">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="8478.6133">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="8493.9238">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="8509.2344">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="8524.5449">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="8539.8555">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="8555.166">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="8570.4766">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="8585.7871">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="8601.0977">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="8616.4082">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="8631.7188">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="422" y="8647.0293">type: bulk-position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="422" y="8662.3398">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="8677.6504">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="8692.9609">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="8708.2715">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="8723.582">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="8738.8926">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="8754.2031">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="8769.5137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="8784.8242">}</text><polygon fill="#A80036" points="881,8818.877,891,8822.877,881,8826.877,885,8822.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="887" y1="8822.877" y2="8822.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="8818.1348">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="392" y="8818.1348">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="299" x2="978" y1="8861.877" y2="8861.877"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="304" y="8872.5117">[If type == 'fulfil']</text><path d="M368,8880.832 L368,9257.832 L677,9257.832 L677,8890.832 L667,8880.832 L368,8880.832 " fill="#FFFF00" filter="url(#f1astixi91bswf)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M667,8880.832 L667,8890.832 L677,8890.832 L667,8880.832 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="374" y="8898.4004">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="8913.7109">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="390" y="8929.0215">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="390" y="8944.332">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="390" y="8959.6426">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="390" y="8974.9531">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="390" y="8990.2637">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="406" y="9005.5742">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="406" y="9020.8848">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="390" y="9036.1953">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="390" y="9051.5059">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="406" y="9066.8164">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="422" y="9082.127">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="422" y="9097.4375">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="422" y="9112.748">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="422" y="9128.0586">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="422" y="9143.3691">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="422" y="9158.6797">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="438" y="9173.9902">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="438" y="9189.3008">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="422" y="9204.6113">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="406" y="9219.9219">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="390" y="9235.2324">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="9250.543">}</text><polygon fill="#A80036" points="881,9284.5957,891,9288.5957,881,9292.5957,885,9288.5957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="887" y1="9288.5957" y2="9288.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="370" y="9283.8535">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="392" y="9283.8535">Route &amp; Publish Position event for Payer</text><!--
@startuml
title 2.2.2. Fulfil Handler Consume (Reject/Abort) (single message, includes individual transfers from Bulk)

autonumber

collections "topic-\nfulfil" as TOPIC_FULFIL
control "Fulfil Handler" as FULF_HANDLER
collections "topic-\nevent" as TOPIC_EVENT
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Failure)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Fulfil event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type IN ['fulfil','bulk-fulfil'] && ( action IN ['reject','abort'] )\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT:  Event Handler Consume\n
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 2001</color>
        end
        group Validate Transfer Fulfil Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> TRANS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer fulfilment \nduplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            TRANS_DAO <- - DB: Return existing hashes
            deactivate DB
            TRANS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate TRANS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes & compare \neach entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TRANS_DAO: Request to retrieve Transfer Fulfilment & Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Request to retrieve \ntransferFulfilment & transferState
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                TRANS_DAO <- - DB: Return transferFulfilment & \ntransferState
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment & Transfer state
                deactivate TRANS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        alt If type == 'fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: notification,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for Payee - Modified Request\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_NOTIFICATIONS
                            deactivate TOPIC_NOTIFICATIONS
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee - Modified Request \n3106 to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        alt If type == 'fulfil'
                            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee)\n
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color Magenta><b>Reference: Failure in validation</b></color>\n<color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        alt If type == 'fulfil'
                            FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                end
            else Hash not matched
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end
        alt action=='reject' call made on PUT /transfers/{ID}
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> TRANS_DAO
            deactivate DB
            FULF_HANDLER <- - TRANS_DAO: Return transfer
            deactivate TRANS_DAO

            alt Fulfilment present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>

                group Persist fulfilment
                    FULF_HANDLER -> TRANS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferFulfilment
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            else Fulfilment NOT present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that transfer fulfilment message to Abort is valid\n<color #FF0000><b>Error code:</b> 2001</color>
                group Persist extensions
                    FULF_HANDLER -> TRANS_DAO: Persist extensionList elements\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            end

            alt Transfer.ilpCondition validate successful OR generic validation successful
                group Persist Transfer State (with transferState='RECEIVED_REJECT')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                FULF_HANDLER -> FULF_HANDLER: Route & Publish Position event for Payer\n<color Magenta><b>Reference: Publish Position Reject event for Payer</b></color>

            else Validate Fulfil Transfer not successful or Generic validation failed
                break
                    FULF_HANDLER -> FULF_HANDLER: Publish event for Payee\n<color Magenta><b>Reference: Failure in validation</b></color>
                end
            end
        else action=='abort' Error callback
            alt Validation successful
                group Persist Transfer State (with transferState='RECEIVED_ERROR')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state & Error\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state & Error
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                        transferError
                        transferExtension
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                FULF_HANDLER -> FULF_HANDLER: Error callback validated\n<color Magenta><b>Reference: Produce message for validated error callback</b></color>

            else Validate Transfer Error Message not successful
                break
                    FULF_HANDLER -> FULF_HANDLER: Notifications for failures\n<color Magenta><b>Reference: Validate Transfer Error Message not successful</b></color>
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end

group Reference: Validate Transfer Error Message not successful
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-processing,
                    action: abort,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Processing event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: fulfil,
                    action: abort,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end

group Reference: Produce message for validated error callback
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-position,
                    action: abort,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: position,
                    action: abort,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    end
end

group Reference: Failure in validation
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-processing,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish processing event to the Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: fulfil,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end

group Reference: Publish Position Reject event for Payer
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-position,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: position,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
        activate TOPIC_TRANSFER_POSITION
        deactivate TOPIC_TRANSFER_POSITION
    end
end

deactivate FULF_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>