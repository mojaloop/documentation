<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2884px" preserveAspectRatio="none" style="width:2944px;height:2884px;" version="1.1" viewBox="0 0 2944 2884" width="2944px" zoomAndPan="magnify"><defs><filter height="300%" id="fucka8nfoqrlu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1254.75" y="23.5352">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="2839.0605" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2839.0605" style="stroke: #A80036; stroke-width: 1.0;" width="415" x="281.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="406" y="47.0566">Bulk API Adapter Service</text><rect fill="#FFFFE0" height="2839.0605" style="stroke: #A80036; stroke-width: 1.0;" width="1957.5" x="960" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1888.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="852.9746" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="815.1973"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="941.75"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="2428.1563"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="2601.0195"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1277" y="1521.3086"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1479" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1958" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2287" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2616" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2582.7969" style="stroke: #000000; stroke-width: 2.0;" width="2900.5" x="33" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="91.2422" style="stroke: #000000; stroke-width: 2.0;" width="805.5" x="275.5" y="887.8184"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1495.5" x="1428" y="1798.4141"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="1495.5" x="1428" y="1860.3457"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1894.5" y="2033.8535"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="635" x="1894.5" y="2080.4746"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="618.5" x2="618.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1017" x2="1017" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1148" x2="1148" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1282" x2="1282" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1484" x2="1484" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1794" x2="1794" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1962.5" x2="1962.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2123" x2="2123" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2291.5" x2="2291.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2451.5" x2="2451.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2620.5" x2="2620.5" y1="153.7754" y2="2770.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2859.5" x2="2859.5" y1="153.7754" y2="2770.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2783.1074">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2799.5957">Payer</text><ellipse cx="67.5" cy="2812.5488" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2820.5488 L67.5,2847.5488 M54.5,2828.5488 L80.5,2828.5488 M67.5,2847.5488 L54.5,2862.5488 M67.5,2847.5488 L80.5,2862.5488 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2783.1074">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2799.5957">Payee</text><ellipse cx="126.5" cy="2812.5488" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2820.5488 L126.5,2847.5488 M113.5,2828.5488 L139.5,2828.5488 M126.5,2847.5488 L113.5,2862.5488 M126.5,2847.5488 L139.5,2862.5488 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="285.5" y="150.8223">Bulk API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="285.5" y="2783.1074">Bulk API Adapter</text><path d="M325,2790.0605 L325,2814.0605 M325,2802.0605 L342,2802.0605 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2802.0605" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="544.5" y="134.334">Bulk API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="150.8223">Handler</text><ellipse cx="618.5" cy="104.7988" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,92.7988,620.5,87.7988,618.5,92.7988,620.5,97.7988,614.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="544.5" y="2783.1074">Bulk API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="2799.5957">Handler</text><ellipse cx="618.5" cy="2818.5488" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,2806.5488,620.5,2801.5488,618.5,2806.5488,620.5,2811.5488,614.5,2806.5488" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="968" y="81.3105"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="964" y="85.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="977" y="105.8457">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="971" y="122.334">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="988" y="138.8223">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="993" y="138.8223">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="1034" y="138.8223">)</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="968" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="964" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="977" y="2794.1074">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="971" y="2810.5957">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="988" y="2827.084">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="993" y="2827.084">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="1034" y="2827.084">)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1081" y="150.8223">Central Service API</text><path d="M1127.5,109.2871 L1127.5,133.2871 M1127.5,121.2871 L1144.5,121.2871 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1156.5" cy="121.2871" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1081" y="2783.1074">Central Service API</text><path d="M1127.5,2790.0605 L1127.5,2814.0605 M1127.5,2802.0605 L1144.5,2802.0605 " fill="none" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1156.5" cy="2802.0605" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1229" y="97.7988"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1225" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1257" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1232" y="138.8223">bulk-prepare</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1229" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1225" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1257" y="2794.1074">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1232" y="2810.5957">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1438" y="134.334">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1454" y="150.8223">Handler</text><ellipse cx="1484" cy="104.7988" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1480,92.7988,1486,87.7988,1484,92.7988,1486,97.7988,1480,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1438" y="2783.1074">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1454" y="2799.5957">Handler</text><ellipse cx="1484" cy="2818.5488" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1480,2806.5488,1486,2801.5488,1484,2806.5488,1486,2811.5488,1480,2806.5488" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1729" y="97.7988"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1725" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1769" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1732" y="138.8223">transfer-prepare</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1729" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1725" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1769" y="2794.1074">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1732" y="2810.5957">transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1904.5" y="150.8223">Prepare Handler</text><ellipse cx="1963" cy="121.2871" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1959,109.2871,1965,104.2871,1963,109.2871,1965,114.2871,1959,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1904.5" y="2783.1074">Prepare Handler</text><ellipse cx="1963" cy="2802.0605" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1959,2790.0605,1965,2785.0605,1963,2790.0605,1965,2795.0605,1959,2790.0605" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2057" y="97.7988"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2053" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2098" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2060" y="138.8223">transfer-position</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2057" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="2053" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2098" y="2794.1074">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="2060" y="2810.5957">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2232.5" y="150.8223">Position Handler</text><ellipse cx="2292" cy="121.2871" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2288,109.2871,2294,104.2871,2292,109.2871,2294,114.2871,2288,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2232.5" y="2783.1074">Position Handler</text><ellipse cx="2292" cy="2802.0605" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2288,2790.0605,2294,2785.0605,2292,2790.0605,2294,2795.0605,2288,2790.0605" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2388.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2384.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2427" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2391.5" y="138.8223">bulk-processing</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2388.5" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2384.5" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2427" y="2794.1074">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2391.5" y="2810.5957">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2564.5" y="134.334">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2591" y="150.8223">Handler</text><ellipse cx="2621" cy="104.7988" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2617,92.7988,2623,87.7988,2621,92.7988,2623,97.7988,2617,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2564.5" y="2783.1074">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2591" y="2799.5957">Handler</text><ellipse cx="2621" cy="2818.5488" fill="#FEFECE" filter="url(#fucka8nfoqrlu)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2617,2806.5488,2623,2801.5488,2621,2806.5488,2623,2811.5488,2617,2806.5488" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2810.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2806.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2835" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2813.5" y="138.8223">notifications</text><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2810.5" y="2769.5723"/><rect fill="#FEFECE" filter="url(#fucka8nfoqrlu)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2806.5" y="2773.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2835" y="2794.1074">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2813.5" y="2810.5957">notifications</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="852.9746" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="815.1973"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="941.75"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="2428.1563"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1012.5" y="2601.0195"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1277" y="1521.3086"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1479" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1958" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2287" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="2596.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2616" y="163.7754"/><path d="M33,170.7754 L445,170.7754 L445,177.7754 L435,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2582.7969" style="stroke: #000000; stroke-width: 2.0;" width="2900.5" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="48" y="184.3438">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,784.0859 L366,784.0859 L366,203.0859 L356,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M356,193.0859 L356,203.0859 L366,203.0859 L356,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="78" y="210.6543">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="94" y="225.9648">Content-Length: &lt;int&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="94" y="241.2754">Content-Type: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="94" y="256.5859">Date: &lt;date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="94" y="271.8965">FSPIOP-Source: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="94" y="287.207">FSPIOP-Destination: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="94" y="302.5176">FSPIOP-Encryption: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="94" y="317.8281">FSPIOP-Signature: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="94" y="333.1387">FSPIOP-URI: &lt;uri&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="94" y="348.4492">FSPIOP-HTTP-Method: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="363.7598">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="379.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="78" y="394.3809">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="409.6914">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="94" y="425.002">bulkTransferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="94" y="440.3125">bulkQuoteId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="94" y="455.623">payeeFsp: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="94" y="470.9336">payerFsp: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="94" y="486.2441">individualTransfers: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="501.5547">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="126" y="516.8652">transferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="126" y="532.1758">transferAmount:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="547.4863">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="142" y="562.7969">currency: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="142" y="578.1074">amount: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="126" y="593.418">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="126" y="608.7285">ilpPacket: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="126" y="624.0391">condition: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="126" y="639.3496">extensionList: { extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="142" y="654.6602">{ key: &lt;string&gt;, value: &lt;string&gt; }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="126" y="669.9707">] }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="685.2813">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="700.5918">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="94" y="715.9023">extensionList: { extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="110" y="731.2129">{ key: &lt;string&gt;, value: &lt;string&gt; }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="94" y="746.5234">] },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="94" y="761.834">expiration: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="777.1445">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="815.1973" y2="811.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="815.1973" y2="819.1973"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="815.1973" y2="815.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="810.4551">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="87.5" y="810.4551">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="859.8184" y2="859.8184"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="859.8184" y2="872.8184"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="872.8184" y2="872.8184"/><polygon fill="#A80036" points="361.5,868.8184,351.5,872.8184,361.5,876.8184,357.5,872.8184" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="847.4209">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="370.5" y="839.7656">Validate incoming message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="855.0762">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="855.0762">3000-3002, 3100-3107</text><path d="M275.5,887.8184 L349.5,887.8184 L349.5,894.8184 L339.5,904.8184 L275.5,904.8184 L275.5,887.8184 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="91.2422" style="stroke: #000000; stroke-width: 2.0;" width="805.5" x="275.5" y="887.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="290.5" y="901.3867">loop</text><polygon fill="#A80036" points="1000.5,937.75,1010.5,941.75,1000.5,945.75,1004.5,941.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1006.5" y1="941.75" y2="941.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="929.3525">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="370.5" y="921.6973">Persist individual transfers in the bulk to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="370.5" y="937.0078">object store:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="453.5" y="937.0078">MLOS.individualTransfers</text><polygon fill="#A80036" points="361.5,967.0605,351.5,971.0605,361.5,975.0605,357.5,971.0605" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1016.5" y1="971.0605" y2="971.0605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="966.3184">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="317" x="380.5" y="966.3184">Return messageId reference to the stored object(s)</text><path d="M355,991.0605 L355,1460.0605 L620,1460.0605 L620,1001.0605 L610,991.0605 L355,991.0605 " fill="#FFFF00" filter="url(#fucka8nfoqrlu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M610,991.0605 L610,1001.0605 L620,1001.0605 L610,991.0605 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1008.6289">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1023.9395">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="377" y="1039.25">id: &lt;messageId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="1054.5605">to: &lt;payeeFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="377" y="1069.8711">from: &lt;payerFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="377" y="1085.1816">type: "application/json"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="1100.4922">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="393" y="1115.8027">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="393" y="1131.1133">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="409" y="1146.4238">bulkTransferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="409" y="1161.7344">bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="409" y="1177.0449">payerFsp: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="409" y="1192.3555">payeeFsp: &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="409" y="1207.666">expiration: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="409" y="1222.9766">hash: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1238.2871">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1253.5977">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="1268.9082">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1284.2188">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1299.5293">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="409" y="1314.8398">type: "bulk-prepare",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="409" y="1330.1504">action: "bulk-prepare",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1345.4609">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1360.7715">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1376.082">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1391.3926">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1406.7031">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1422.0137">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1437.3242">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1452.6348">}</text><polygon fill="#A80036" points="1265,1517.3086,1275,1521.3086,1265,1525.3086,1269,1521.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1271" y1="1521.3086" y2="1521.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1501.2559">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="370.5" y="1485.9453">Route &amp; Publish Bulk Prepare event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="370.5" y="1501.2559">for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1516.5664">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1516.5664">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1329" y1="1581.2402" y2="1581.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1329" x2="1329" y1="1581.2402" y2="1594.2402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1288" x2="1329" y1="1594.2402" y2="1594.2402"/><polygon fill="#A80036" points="1298,1590.2402,1288,1594.2402,1298,1598.2402,1294,1594.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1294" y="1561.1875">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="1307" y="1545.877">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1307" y="1561.1875">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1307" y="1576.498">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1384" y="1576.498">2003</text><polygon fill="#A80036" points="361.5,1634.8613,351.5,1638.8613,361.5,1642.8613,357.5,1638.8613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1281" y1="1638.8613" y2="1638.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1626.4639">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="380.5" y="1618.8086">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="380.5" y="1634.1191">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1668.1719" y2="1664.1719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1668.1719" y2="1672.1719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1668.1719" y2="1668.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1663.4297">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1663.4297">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1293,1718.4824,1283,1722.4824,1293,1726.4824,1289,1722.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1478" y1="1722.4824" y2="1722.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1299" y="1717.7402">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1312" y="1717.7402">Consume message</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="640" x="1222" y="1730.4824"/><polygon fill="#EEEEEE" points="1222,1730.4824,1286,1730.4824,1286,1737.4824,1276,1747.4824,1222,1747.4824,1222,1730.4824" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1235" y="1745.0508">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1445.5" y="1764.0508">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1449.5" y="1779.3613"/><path d="M1428,1798.4141 L1490,1798.4141 L1490,1805.4141 L1480,1815.4141 L1428,1815.4141 L1428,1798.4141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1495.5" x="1428" y="1798.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1443" y="1811.9824">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1505" y="1811.0488">[Success]</text><polygon fill="#A80036" points="1782,1848.3457,1792,1852.3457,1782,1856.3457,1786,1852.3457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1489" x2="1788" y1="1852.3457" y2="1852.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1496" y="1839.9482">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1518" y="1832.293">Produce (stream) single transfer message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1518" y="1847.6035">for each individual transfer [loop]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1428" x2="2923.5" y1="1861.3457" y2="1861.3457"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1433" y="1871.9805">[Failure]</text><polygon fill="#A80036" points="2848,1892.6113,2858,1896.6113,2848,1900.6113,2852,1896.6113" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1489" x2="2854" y1="1896.6113" y2="1896.6113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1496" y="1891.8691">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="1518" y="1891.8691">Produce single message for the entire bulk</text><polygon fill="#A80036" points="1805,1953.9219,1795,1957.9219,1805,1961.9219,1801,1957.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1799" x2="1957" y1="1957.9219" y2="1957.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1811" y="1953.1797">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1833" y="1953.1797">Consume message</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="470" x="1722" y="1965.9219"/><polygon fill="#EEEEEE" points="1722,1965.9219,1786,1965.9219,1786,1972.9219,1776,1982.9219,1722,1982.9219,1722,1965.9219" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1735" y="1980.4902">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1878" y="1999.4902">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1882" y="2014.8008"/><path d="M1894.5,2033.8535 L1956.5,2033.8535 L1956.5,2040.8535 L1946.5,2050.8535 L1894.5,2050.8535 L1894.5,2033.8535 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1894.5" y="2033.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1909.5" y="2047.4219">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1971.5" y="2046.4883">[Success]</text><polygon fill="#A80036" points="2111,2068.4746,2121,2072.4746,2111,2076.4746,2115,2072.4746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1968" x2="2117" y1="2072.4746" y2="2072.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1975" y="2067.7324">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1997" y="2067.7324">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1894.5" x2="2529.5" y1="2081.4746" y2="2081.4746"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1899.5" y="2092.1094">[Failure]</text><polygon fill="#A80036" points="2440,2112.7402,2450,2116.7402,2440,2120.7402,2444,2116.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1968" x2="2446" y1="2116.7402" y2="2116.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1975" y="2111.998">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1997" y="2111.998">Produce message</text><polygon fill="#A80036" points="2134,2174.0508,2124,2178.0508,2134,2182.0508,2130,2178.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2128" x2="2286" y1="2178.0508" y2="2178.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2140" y="2173.3086">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2162" y="2173.3086">Consume message</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="468.5" x="2050" y="2186.0508"/><polygon fill="#EEEEEE" points="2050,2186.0508,2114,2186.0508,2114,2193.0508,2104,2203.0508,2050,2203.0508,2050,2186.0508" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2063" y="2200.6191">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="2202.75" y="2219.6191">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2206.75" y="2234.9297"/><polygon fill="#A80036" points="2440,2264.293,2450,2268.293,2440,2272.293,2444,2268.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2297" x2="2446" y1="2268.293" y2="2268.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2304" y="2263.5508">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2326" y="2263.5508">Produce message</text><polygon fill="#A80036" points="2463,2318.6035,2453,2322.6035,2463,2326.6035,2459,2322.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2457" x2="2615" y1="2322.6035" y2="2322.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2469" y="2317.8613">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2491" y="2317.8613">Consume message</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="531" x="2381.5" y="2330.6035"/><polygon fill="#EEEEEE" points="2381.5,2330.6035,2445.5,2330.6035,2445.5,2337.6035,2435.5,2347.6035,2381.5,2347.6035,2381.5,2330.6035" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2394.5" y="2345.1719">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="2541.5" y="2364.1719">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2545.5" y="2379.4824"/><polygon fill="#A80036" points="1033.5,2424.1563,1023.5,2428.1563,1033.5,2432.1563,1029.5,2428.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1027.5" x2="2615" y1="2428.1563" y2="2428.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1039.5" y="2415.7588">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="1061.5" y="2408.1035">Persist bulk message by destination to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1061.5" y="2423.4141">object store:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="1144.5" y="2423.4141">MLOS.bulkTransferResults</text><polygon fill="#A80036" points="2604,2468.7773,2614,2472.7773,2604,2476.7773,2608,2472.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1017.5" x2="2610" y1="2472.7773" y2="2472.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1024.5" y="2460.3799">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1046.5" y="2452.7246">Return the reference to the stored</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="1046.5" y="2468.0352">notification object(s):</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1185.5" y="2468.0352">messageId</text><polygon fill="#A80036" points="2848,2498.0879,2858,2502.0879,2848,2506.0879,2852,2502.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2626" x2="2854" y1="2502.0879" y2="2502.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2633" y="2497.3457">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="2655" y="2497.3457">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2848,2552.3984,2858,2556.3984,2848,2560.3984,2852,2556.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="2854" y1="2556.3984" y2="2556.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2551.6563">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="652.5" y="2551.6563">Consume message</text><polygon fill="#A80036" points="1000.5,2597.0195,1010.5,2601.0195,1000.5,2605.0195,1004.5,2601.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="1006.5" y1="2601.0195" y2="2601.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2588.6221">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="652.5" y="2580.9668">Retrieve bulk notification(s) by reference &amp; destination:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="348" x="652.5" y="2596.2773">MLOS.bulkTransferResults.messageId + destination</text><polygon fill="#A80036" points="634.5,2626.3301,624.5,2630.3301,634.5,2634.3301,630.5,2630.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="628.5" x2="1016.5" y1="2630.3301" y2="2630.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="640.5" y="2625.5879">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="662.5" y="2625.5879">Return notification(s) payload</text><rect fill="#FFFFFF" filter="url(#fucka8nfoqrlu)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2813.5" x="99" y="2638.3301"/><polygon fill="#EEEEEE" points="99,2638.3301,163,2638.3301,163,2645.3301,153,2655.3301,99,2655.3301,99,2638.3301" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2652.8984">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1386.75" y="2671.8984">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1390.75" y="2687.209"/><polygon fill="#A80036" points="137.5,2716.5723,127.5,2720.5723,137.5,2724.5723,133.5,2720.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="612.5" y1="2720.5723" y2="2720.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2715.8301">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="165.5" y="2715.8301">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "Bulk API Adapter" as BULK_API
control "Bulk API Notification \nHandler" as NOTIFY_HANDLER
collections "mojaloop-\nobject-store\n(**MLOS**)" as OBJECT_STORE
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare\nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotifications" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "Bulk API Adapter Service" #LightBlue
	participant BULK_API
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <int>,
            Content-Type: <string>,
            Date: <date>,
            FSPIOP-Source: <string>,
            FSPIOP-Destination: <string>,
            FSPIOP-Encryption: <string>,
            FSPIOP-Signature: <string>,
            FSPIOP-URI: <uri>,
            FSPIOP-HTTP-Method: <string>
        }

        Payload - bulkTransferMessage:
        {
            bulkTransferId: <uuid>,
            bulkQuoteId: <uuid>, 
            payeeFsp: <string>,
            payerFsp: <string>,
            individualTransfers: [
                {
                    transferId: <uuid>, 
                    transferAmount: 
                    { 
                        currency: <string>, 
                        amount: <string> 
                    }, 
                    ilpPacket: <string>,
                    condition: <string>,
                    extensionList: { extension: [ 
                        { key: <string>, value: <string> }
                    ] }
                }
            ],
            extensionList: { extension: [ 
                { key: <string>, value: <string> }
            ] },
            expiration: <string>
        }
    end note
    DFSP1 ->> BULK_API: POST - /bulkTransfers
    activate BULK_API
    BULK_API -> BULK_API: Validate incoming message\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    loop
        BULK_API -> OBJECT_STORE: Persist individual transfers in the bulk to\nobject store: **MLOS.individualTransfers**
        activate OBJECT_STORE
        OBJECT_STORE - -> BULK_API: Return messageId reference to the stored object(s)
        deactivate OBJECT_STORE
    end
    note right of BULK_API #yellow
        Message:
        {
            id: <messageId>
            to: <payeeFspName>,
            from: <payerFspName>,
            type: "application/json"
            content: {
                headers: <bulkTransferHeaders>,
                payload: {
                    bulkTransferId: <uuid>,
                    bulkQuoteId": <uuid>,
                    payerFsp: <string>,
                    payeeFsp: <string>,
                    expiration: <timestamp>,
                    hash: <string>
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: "bulk-prepare",
                    action: "bulk-prepare",
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    BULK_API -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event \nfor Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> BULK_API: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_PREPARE
    BULK_API - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate BULK_API
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE:  Bulk Prepare Handler Consume \n
    alt Success
        BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce (stream) single transfer message\nfor each individual transfer [loop]
    else Failure
        BULK_PREP_HANDLER - -> TOPIC_NOTIFICATIONS: Produce single message for the entire bulk
    end
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION:  Prepare Handler Consume\n
    alt Success
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        PREP_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING: Position Handler Consume\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS: Bulk Processing Handler Consume\n
    BULK_PROC_HANDLER -> OBJECT_STORE: Persist bulk message by destination to the\nobject store: **MLOS.bulkTransferResults**
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PROC_HANDLER: Return the reference to the stored \nnotification object(s): **messageId**
    deactivate OBJECT_STORE
    BULK_PROC_HANDLER -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER -> OBJECT_STORE: Retrieve bulk notification(s) by reference & destination:\n**MLOS.bulkTransferResults.messageId + destination**
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return notification(s) payload
    deactivate OBJECT_STORE
    ref over DFSP2, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>