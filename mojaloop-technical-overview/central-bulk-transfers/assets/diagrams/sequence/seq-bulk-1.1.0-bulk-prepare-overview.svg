<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2973px" preserveAspectRatio="none" style="width:2581px;height:2973px;" version="1.1" viewBox="0 0 2581 2973" width="2581px" zoomAndPan="magnify"><defs><filter height="300%" id="fq9kkml3pd9hc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1073.25" y="23.5352">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="2927.6133" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="2927.6133" style="stroke: #A80036; stroke-width: 1.0;" width="405" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="410.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="2927.6133" style="stroke: #A80036; stroke-width: 1.0;" width="1807.5" x="747" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1600.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="714.4902" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1116.4766"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1827.6563"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2532.0195"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2689.5723"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="1581.8613"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1266" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1595" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1924" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2253" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2671.3496" style="stroke: #000000; stroke-width: 2.0;" width="2537.5" x="33" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="1345.5" x="1215" y="1932.8984"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="1345.5" x="1215" y="1979.5195"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1531.5" y="2153.0273"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="635" x="1531.5" y="2199.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="618.5" x2="618.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="804" x2="804" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="935" x2="935" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1069" x2="1069" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1271" x2="1271" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1431" x2="1431" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1599.5" x2="1599.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1760" x2="1760" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1928.5" x2="1928.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2088.5" x2="2088.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2257.5" x2="2257.5" y1="153.7754" y2="2859.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2496.5" x2="2496.5" y1="153.7754" y2="2859.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2871.6602">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2888.1484">Payer</text><ellipse cx="67.5" cy="2901.1016" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,2909.1016 L67.5,2936.1016 M54.5,2917.1016 L80.5,2917.1016 M67.5,2936.1016 L54.5,2951.1016 M67.5,2936.1016 L80.5,2951.1016 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2871.6602">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2888.1484">Payee</text><ellipse cx="126.5" cy="2901.1016" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,2909.1016 L126.5,2936.1016 M113.5,2917.1016 L139.5,2917.1016 M126.5,2936.1016 L113.5,2951.1016 M126.5,2936.1016 L139.5,2951.1016 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2871.6602">ML API Adapter</text><path d="M325,2878.6133 L325,2902.6133 M325,2890.6133 L342,2890.6133 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2890.6133" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="134.334">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="150.8223">Handler</text><ellipse cx="618.5" cy="104.7988" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,92.7988,620.5,87.7988,618.5,92.7988,620.5,97.7988,614.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="2871.6602">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="2888.1484">Handler</text><ellipse cx="618.5" cy="2907.1016" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,2895.1016,620.5,2890.1016,618.5,2895.1016,620.5,2900.1016,614.5,2895.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="755" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="751" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="772" y="122.334">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="758" y="138.8223">object-store</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="755" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="751" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="772" y="2882.6602">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="758" y="2899.1484">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="868" y="150.8223">Central Service API</text><path d="M914.5,109.2871 L914.5,133.2871 M914.5,121.2871 L931.5,121.2871 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="943.5" cy="121.2871" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="868" y="2871.6602">Central Service API</text><path d="M914.5,2878.6133 L914.5,2902.6133 M914.5,2890.6133 L931.5,2890.6133 " fill="none" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="943.5" cy="2890.6133" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1016" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1012" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1044" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1019" y="138.8223">bulk-prepare</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1016" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1012" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1044" y="2882.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1019" y="2899.1484">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1225" y="134.334">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1241" y="150.8223">Handler</text><ellipse cx="1271" cy="104.7988" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1267,92.7988,1273,87.7988,1271,92.7988,1273,97.7988,1267,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1225" y="2871.6602">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1241" y="2888.1484">Handler</text><ellipse cx="1271" cy="2907.1016" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1267,2895.1016,1273,2890.1016,1271,2895.1016,1273,2900.1016,1267,2895.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1366" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1362" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1406" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1369" y="138.8223">transfer-prepare</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1366" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1362" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1406" y="2882.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1369" y="2899.1484">transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1541.5" y="150.8223">Prepare Handler</text><ellipse cx="1600" cy="121.2871" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1596,109.2871,1602,104.2871,1600,109.2871,1602,114.2871,1596,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1541.5" y="2871.6602">Prepare Handler</text><ellipse cx="1600" cy="2890.6133" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1596,2878.6133,1602,2873.6133,1600,2878.6133,1602,2883.6133,1596,2878.6133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1694" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1690" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1735" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1697" y="138.8223">transfer-position</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1694" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1690" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1735" y="2882.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1697" y="2899.1484">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1869.5" y="150.8223">Position Handler</text><ellipse cx="1929" cy="121.2871" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1925,109.2871,1931,104.2871,1929,109.2871,1931,114.2871,1925,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1869.5" y="2871.6602">Position Handler</text><ellipse cx="1929" cy="2890.6133" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1925,2878.6133,1931,2873.6133,1929,2878.6133,1931,2883.6133,1925,2878.6133" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2025.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2021.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2064" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2028.5" y="138.8223">bulk-processing</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2025.5" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2021.5" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2064" y="2882.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2028.5" y="2899.1484">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2201.5" y="134.334">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2228" y="150.8223">Handler</text><ellipse cx="2258" cy="104.7988" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2254,92.7988,2260,87.7988,2258,92.7988,2260,97.7988,2254,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2201.5" y="2871.6602">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2228" y="2888.1484">Handler</text><ellipse cx="2258" cy="2907.1016" fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2254,2895.1016,2260,2890.1016,2258,2895.1016,2260,2900.1016,2254,2895.1016" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2447.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2443.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2472" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2450.5" y="138.8223">notifications</text><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2447.5" y="2858.125"/><rect fill="#FEFECE" filter="url(#fq9kkml3pd9hc)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2443.5" y="2862.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2472" y="2882.6602">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2450.5" y="2899.1484">notifications</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="714.4902" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1116.4766"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1827.6563"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2532.0195"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2689.5723"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="1581.8613"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1266" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1595" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1924" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="2685.3496" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2253" y="163.7754"/><path d="M33,170.7754 L445,170.7754 L445,177.7754 L435,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2671.3496" style="stroke: #000000; stroke-width: 2.0;" width="2537.5" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="48" y="184.3438">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,983.0859 L413,983.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="78" y="210.6543">Headers - bulkTransferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="78" y="409.6914">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="94" y="440.3125">"bulkTransferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="94" y="455.623">"bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="94" y="470.9336">"payeeFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="94" y="486.2441">"payerFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="94" y="501.5547">"individualTransfers":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="516.8652">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="532.1758">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="126" y="547.4863">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="126" y="562.7969">"transferAmount":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="578.1074">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="142" y="593.418">"currency": &lt;currency&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="142" y="608.7285">"amount": &lt;amount&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="126" y="624.0391">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="126" y="639.3496">"ilpPacket": &lt;ilpPacket&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="126" y="654.6602">"condition": &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="126" y="669.9707">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="685.2813">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="142" y="700.5918">"extension":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="715.9023">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="731.2129">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="174" y="746.5234">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="174" y="761.834">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="777.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="792.4551">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="807.7656">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="823.0762">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="838.3867">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="853.6973">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="869.0078">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="884.3184">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="142" y="899.6289">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="142" y="914.9395">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="930.25">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="945.5605">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="960.8711">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="976.1816">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1010.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1018.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="1014.2344" y2="1014.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="1009.4922">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="87.5" y="1009.4922">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="1058.8555" y2="1058.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="1058.8555" y2="1071.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="1071.8555" y2="1071.8555"/><polygon fill="#A80036" points="361.5,1067.8555,351.5,1071.8555,361.5,1075.8555,357.5,1071.8555" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1046.458">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="370.5" y="1038.8027">Validate incoming message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="1054.1133">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="1054.1133">3000-3002, 3100-3107</text><polygon fill="#A80036" points="787.5,1112.4766,797.5,1116.4766,787.5,1120.4766,791.5,1116.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="350.5" x2="793.5" y1="1116.4766" y2="1116.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1104.0791">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="370.5" y="1096.4238">Persist incoming bulk message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="370.5" y="1111.7344">to object store</text><polygon fill="#A80036" points="361.5,1141.7871,351.5,1145.7871,361.5,1149.7871,357.5,1145.7871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="803.5" y1="1145.7871" y2="1145.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1141.0449">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="380.5" y="1141.0449">Return reference to the stored object</text><path d="M355,1158.7871 L355,1520.7871 L687,1520.7871 L687,1168.7871 L677,1158.7871 L355,1158.7871 " fill="#FFFF00" filter="url(#fq9kkml3pd9hc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M677,1158.7871 L677,1168.7871 L687,1168.7871 L677,1158.7871 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1176.3555">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1191.666">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="377" y="1206.9766">id: &lt;bulkTransferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="377" y="1222.2871">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="377" y="1237.5977">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="1252.9082">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="1268.2188">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="393" y="1283.5293">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="393" y="1298.8398">payload: &lt;bulkTransferMessage_Reference&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1314.1504">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="1329.4609">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1344.7715">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1360.082">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="409" y="1375.3926">type: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="409" y="1390.7031">action: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1406.0137">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1421.3242">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1436.6348">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1451.9453">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1467.2559">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1482.5664">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1497.877">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1513.1875">}</text><polygon fill="#A80036" points="1052,1577.8613,1062,1581.8613,1052,1585.8613,1056,1581.8613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1058" y1="1581.8613" y2="1581.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1561.8086">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="370.5" y="1546.498">Route &amp; Publish Bulk Prepare event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="370.5" y="1561.8086">for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1577.1191">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1577.1191">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1116" y1="1641.793" y2="1641.793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1116" x2="1116" y1="1641.793" y2="1654.793"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1075" x2="1116" y1="1654.793" y2="1654.793"/><polygon fill="#A80036" points="1085,1650.793,1075,1654.793,1085,1658.793,1081,1654.793" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1081" y="1621.7402">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="1094" y="1606.4297">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1094" y="1621.7402">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1094" y="1637.0508">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1171" y="1637.0508">2003</text><polygon fill="#A80036" points="361.5,1695.4141,351.5,1699.4141,361.5,1703.4141,357.5,1699.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1068" y1="1699.4141" y2="1699.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1687.0166">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="380.5" y="1679.3613">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="380.5" y="1694.6719">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1728.7246" y2="1724.7246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1728.7246" y2="1732.7246"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1728.7246" y2="1728.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1723.9824">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1723.9824">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1080,1779.0352,1070,1783.0352,1080,1787.0352,1076,1783.0352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1265" y1="1783.0352" y2="1783.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1086" y="1778.293">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1099" y="1778.293">Consume message</text><polygon fill="#A80036" points="820.5,1823.6563,810.5,1827.6563,820.5,1831.6563,816.5,1827.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="814.5" x2="1265" y1="1827.6563" y2="1827.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="826.5" y="1815.2588">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="848.5" y="1807.6035">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="848.5" y="1822.9141">using reference</text><polygon fill="#A80036" points="1254,1852.9668,1264,1856.9668,1254,1860.9668,1258,1856.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="804.5" x2="1260" y1="1856.9668" y2="1856.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="811.5" y="1852.2246">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="833.5" y="1852.2246">Return payload</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="490" x="1009" y="1864.9668"/><polygon fill="#EEEEEE" points="1009,1864.9668,1073,1864.9668,1073,1871.9668,1063,1881.9668,1009,1881.9668,1009,1864.9668" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1022" y="1879.5352">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1157.5" y="1898.5352">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1161.5" y="1913.8457"/><path d="M1215,1932.8984 L1277,1932.8984 L1277,1939.8984 L1267,1949.8984 L1215,1949.8984 L1215,1932.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="1345.5" x="1215" y="1932.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1230" y="1946.4668">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1292" y="1945.5332">[Success]</text><polygon fill="#A80036" points="1419,1967.5195,1429,1971.5195,1419,1975.5195,1423,1971.5195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1276" x2="1425" y1="1971.5195" y2="1971.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1283" y="1966.7773">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1305" y="1966.7773">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1215" x2="2560.5" y1="1980.5195" y2="1980.5195"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1220" y="1991.1543">[Failure]</text><polygon fill="#A80036" points="2485,2011.7852,2495,2015.7852,2485,2019.7852,2489,2015.7852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1276" x2="2491" y1="2015.7852" y2="2015.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1283" y="2011.043">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1305" y="2011.043">Produce message</text><polygon fill="#A80036" points="1442,2073.0957,1432,2077.0957,1442,2081.0957,1438,2077.0957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1436" x2="1594" y1="2077.0957" y2="2077.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1448" y="2072.3535">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1470" y="2072.3535">Consume message</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="470" x="1359" y="2085.0957"/><polygon fill="#EEEEEE" points="1359,2085.0957,1423,2085.0957,1423,2092.0957,1413,2102.0957,1359,2102.0957,1359,2085.0957" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1372" y="2099.6641">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1515" y="2118.6641">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1519" y="2133.9746"/><path d="M1531.5,2153.0273 L1593.5,2153.0273 L1593.5,2160.0273 L1583.5,2170.0273 L1531.5,2170.0273 L1531.5,2153.0273 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1531.5" y="2153.0273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1546.5" y="2166.5957">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1608.5" y="2165.6621">[Success]</text><polygon fill="#A80036" points="1748,2187.6484,1758,2191.6484,1748,2195.6484,1752,2191.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1605" x2="1754" y1="2191.6484" y2="2191.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1612" y="2186.9063">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1634" y="2186.9063">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1531.5" x2="2166.5" y1="2200.6484" y2="2200.6484"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1536.5" y="2211.2832">[Failure]</text><polygon fill="#A80036" points="2077,2231.9141,2087,2235.9141,2077,2239.9141,2081,2235.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1605" x2="2083" y1="2235.9141" y2="2235.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1612" y="2231.1719">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1634" y="2231.1719">Produce message</text><polygon fill="#A80036" points="1771,2293.2246,1761,2297.2246,1771,2301.2246,1767,2297.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1765" x2="1923" y1="2297.2246" y2="2297.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1777" y="2292.4824">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1799" y="2292.4824">Consume message</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="468.5" x="1687" y="2305.2246"/><polygon fill="#EEEEEE" points="1687,2305.2246,1751,2305.2246,1751,2312.2246,1741,2322.2246,1687,2322.2246,1687,2305.2246" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1700" y="2319.793">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1839.75" y="2338.793">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1843.75" y="2354.1035"/><polygon fill="#A80036" points="2077,2383.4668,2087,2387.4668,2077,2391.4668,2081,2387.4668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1934" x2="2083" y1="2387.4668" y2="2387.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1941" y="2382.7246">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1963" y="2382.7246">Produce message</text><polygon fill="#A80036" points="2100,2437.7773,2090,2441.7773,2100,2445.7773,2096,2441.7773" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2094" x2="2252" y1="2441.7773" y2="2441.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2106" y="2437.0352">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2128" y="2437.0352">Consume message</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="531" x="2018.5" y="2449.7773"/><polygon fill="#EEEEEE" points="2018.5,2449.7773,2082.5,2449.7773,2082.5,2456.7773,2072.5,2466.7773,2018.5,2466.7773,2018.5,2449.7773" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2031.5" y="2464.3457">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="2176.5" y="2483.3457">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2180.5" y="2498.6563"/><polygon fill="#A80036" points="820.5,2528.0195,810.5,2532.0195,820.5,2536.0195,816.5,2532.0195" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="814.5" x2="2252" y1="2532.0195" y2="2532.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="826.5" y="2527.2773">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="848.5" y="2527.2773">Persist bulk message to object store</text><polygon fill="#A80036" points="2241,2557.3301,2251,2561.3301,2241,2565.3301,2245,2561.3301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="804.5" x2="2247" y1="2561.3301" y2="2561.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="811.5" y="2556.5879">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="833.5" y="2556.5879">Return reference to the stored object</text><polygon fill="#A80036" points="2485,2586.6406,2495,2590.6406,2485,2594.6406,2489,2590.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2263" x2="2491" y1="2590.6406" y2="2590.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2270" y="2585.8984">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="2292" y="2585.8984">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2485,2640.9512,2495,2644.9512,2485,2648.9512,2489,2644.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="2491" y1="2644.9512" y2="2644.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2640.209">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="652.5" y="2640.209">Consume message</text><polygon fill="#A80036" points="787.5,2685.5723,797.5,2689.5723,787.5,2693.5723,791.5,2689.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="623.5" x2="793.5" y1="2689.5723" y2="2689.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2677.1748">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="652.5" y="2669.5195">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="652.5" y="2684.8301">using reference</text><polygon fill="#A80036" points="634.5,2714.8828,624.5,2718.8828,634.5,2722.8828,630.5,2718.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="628.5" x2="803.5" y1="2718.8828" y2="2718.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="640.5" y="2714.1406">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="662.5" y="2714.1406">Return payload</text><rect fill="#FFFFFF" filter="url(#fq9kkml3pd9hc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2450.5" x="99" y="2726.8828"/><polygon fill="#EEEEEE" points="99,2726.8828,163,2726.8828,163,2733.8828,153,2743.8828,99,2743.8828,99,2726.8828" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2741.4512">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1205.25" y="2760.4512">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1209.25" y="2775.7617"/><polygon fill="#A80036" points="137.5,2805.125,127.5,2809.125,137.5,2813.125,133.5,2809.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="612.5" y1="2809.125" y2="2809.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2804.3828">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="165.5" y="2804.3828">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification \nHandler" as NOTIFY_HANDLER
collections "mongo-\nobject-store" as OBJECT_STORE
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare\nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotifications" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - bulkTransferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - bulkTransferMessage:
        {
            "bulkTransferId": <uuid>,
            "bulkQuoteId": <uuid>, 
            "payeeFsp": <fspID>,
            "payerFsp": <fspID>,
            "individualTransfers": 
            [
                {
                    "transferId": <uuid>, 
                    "transferAmount": 
                    { 
                        "currency": <currency>, 
                        "amount": <amount> 
                    }, 
                    "ilpPacket": <ilpPacket>,
                    "condition": <ilpCondition>,
                    "extensionList":
                    {
                        "extension":
                        [ 
                            { 
                                “key”: <key>, 
                                “value”: <value> 
                            }
                        ]
                    }
                }
            ],
            "extensionList": {
                "extension": [
                    {
                        “key”: <key>, 
                        “value”: <value> 
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /bulkTransfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    MLAPI - -> OBJECT_STORE: Persist incoming bulk message\nto object store
    activate OBJECT_STORE
    OBJECT_STORE - -> MLAPI: Return reference to the stored object
    deactivate OBJECT_STORE
    note right of MLAPI #yellow
        Message:
        {
            id: <bulkTransferMessage.transferId>
            from: <bulkTransferMessage.payerFsp>,
            to: <bulkTransferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <bulkTransferHeaders>,
                payload: <bulkTransferMessage_Reference>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: bulk-prepare,
                    action: bulk-prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event \nfor Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> MLAPI: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    BULK_PREP_HANDLER - -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PREP_HANDLER: Return payload
    deactivate OBJECT_STORE
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE :  Bulk Prepare Handler Consume \n
    alt Success
        BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce message
    else Failure
        BULK_PREP_HANDLER - -> TOPIC_NOTIFICATIONS: Produce message
    end
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume\n
    alt Success
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        PREP_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING : Position Handler Consume\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS : Bulk Processing Handler Consume \n
    BULK_PROC_HANDLER - -> OBJECT_STORE: Persist bulk message to object store
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PROC_HANDLER: Return reference to the stored object
    deactivate OBJECT_STORE
    BULK_PROC_HANDLER -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER - -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return payload
    deactivate OBJECT_STORE
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2019.06(Fri May 24 22:40:25 IST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>