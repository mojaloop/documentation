<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3080px" preserveAspectRatio="none" style="width:2682px;height:3080px;" version="1.1" viewBox="0 0 2682 3080" width="2682px" zoomAndPan="magnify"><defs><filter height="300%" id="fqlyoynqkvozg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="437" x="1123.75" y="23.5352">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="3034.7871" style="stroke: #A80036; stroke-width: 1.0;" width="186" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="7" y="47.0566">Financial Service Providers</text><rect fill="#ADD8E6" height="3034.7871" style="stroke: #A80036; stroke-width: 1.0;" width="405" x="286.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="410.5" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="3034.7871" style="stroke: #A80036; stroke-width: 1.0;" width="1908.5" x="747" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1650.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="791.043" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1116.4766"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1904.209"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2639.1934"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2796.7461"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="1658.4141"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1266" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1696" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2025" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2354" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2778.5234" style="stroke: #000000; stroke-width: 2.0;" width="2638.5" x="33" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1446.5" x="1215" y="2024.7617"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="1446.5" x="1215" y="2086.6934"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1632.5" y="2260.2012"/><rect fill="#FFFFFF" height="44.2656" style="stroke: none; stroke-width: 1.0;" width="635" x="1632.5" y="2306.8223"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="126" x2="126" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="618.5" x2="618.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="804" x2="804" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="935" x2="935" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1069" x2="1069" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1271" x2="1271" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1532" x2="1532" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1700.5" x2="1700.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1861" x2="1861" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2029.5" x2="2029.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2189.5" x2="2189.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2358.5" x2="2358.5" y1="153.7754" y2="2966.2988"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2597.5" x2="2597.5" y1="153.7754" y2="2966.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="134.334">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="150.8223">Payer</text><ellipse cx="67.5" cy="63.7988" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,71.7988 L67.5,98.7988 M54.5,79.7988 L80.5,79.7988 M67.5,98.7988 L54.5,113.7988 M67.5,98.7988 L80.5,113.7988 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="43" y="2978.834">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="46" y="2995.3223">Payer</text><ellipse cx="67.5" cy="3008.2754" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M67.5,3016.2754 L67.5,3043.2754 M54.5,3024.2754 L80.5,3024.2754 M67.5,3043.2754 L54.5,3058.2754 M67.5,3043.2754 L80.5,3058.2754 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="134.334">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="150.8223">Payee</text><ellipse cx="126.5" cy="63.7988" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,71.7988 L126.5,98.7988 M113.5,79.7988 L139.5,79.7988 M126.5,98.7988 L113.5,113.7988 M126.5,98.7988 L139.5,113.7988 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="102" y="2978.834">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="104" y="2995.3223">Payee</text><ellipse cx="126.5" cy="3008.2754" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M126.5,3016.2754 L126.5,3043.2754 M113.5,3024.2754 L139.5,3024.2754 M126.5,3043.2754 L113.5,3058.2754 M126.5,3043.2754 L139.5,3058.2754 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="150.8223">ML API Adapter</text><path d="M325,109.2871 L325,133.2871 M325,121.2871 L342,121.2871 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="121.2871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="290.5" y="2978.834">ML API Adapter</text><path d="M325,2985.7871 L325,3009.7871 M325,2997.7871 L342,2997.7871 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354" cy="2997.7871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="134.334">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="150.8223">Handler</text><ellipse cx="618.5" cy="104.7988" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,92.7988,620.5,87.7988,618.5,92.7988,620.5,97.7988,614.5,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="549.5" y="2978.834">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="588.5" y="2995.3223">Handler</text><ellipse cx="618.5" cy="3014.2754" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="614.5,3002.2754,620.5,2997.2754,618.5,3002.2754,620.5,3007.2754,614.5,3002.2754" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="755" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="751" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="772" y="122.334">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="758" y="138.8223">object-store</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="755" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="751" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="772" y="2989.834">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="758" y="3006.3223">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="868" y="150.8223">Central Service API</text><path d="M914.5,109.2871 L914.5,133.2871 M914.5,121.2871 L931.5,121.2871 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="943.5" cy="121.2871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="868" y="2978.834">Central Service API</text><path d="M914.5,2985.7871 L914.5,3009.7871 M914.5,2997.7871 L931.5,2997.7871 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="943.5" cy="2997.7871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1016" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1012" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1044" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1019" y="138.8223">bulk-prepare</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1016" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="1012" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1044" y="2989.834">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1019" y="3006.3223">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1225" y="134.334">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1241" y="150.8223">Handler</text><ellipse cx="1271" cy="104.7988" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1267,92.7988,1273,87.7988,1271,92.7988,1273,97.7988,1267,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1225" y="2978.834">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="1241" y="2995.3223">Handler</text><ellipse cx="1271" cy="3014.2754" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1267,3002.2754,1273,2997.2754,1271,3002.2754,1273,3007.2754,1267,3002.2754" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1467" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1463" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1507" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1470" y="138.8223">transfer-prepare</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1467" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="1463" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1507" y="2989.834">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1470" y="3006.3223">transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1642.5" y="150.8223">Prepare Handler</text><ellipse cx="1701" cy="121.2871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1697,109.2871,1703,104.2871,1701,109.2871,1703,114.2871,1697,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1642.5" y="2978.834">Prepare Handler</text><ellipse cx="1701" cy="2997.7871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1697,2985.7871,1703,2980.7871,1701,2985.7871,1703,2990.7871,1697,2985.7871" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1795" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1791" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1836" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1798" y="138.8223">transfer-position</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1795" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="1791" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1836" y="2989.834">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="1798" y="3006.3223">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1970.5" y="150.8223">Position Handler</text><ellipse cx="2030" cy="121.2871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2026,109.2871,2032,104.2871,2030,109.2871,2032,114.2871,2026,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1970.5" y="2978.834">Position Handler</text><ellipse cx="2030" cy="2997.7871" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2026,2985.7871,2032,2980.7871,2030,2985.7871,2032,2990.7871,2026,2985.7871" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2126.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2122.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2165" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2129.5" y="138.8223">bulk-processing</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2126.5" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2122.5" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2165" y="2989.834">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="2129.5" y="3006.3223">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2302.5" y="134.334">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2329" y="150.8223">Handler</text><ellipse cx="2359" cy="104.7988" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2355,92.7988,2361,87.7988,2359,92.7988,2361,97.7988,2355,92.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="2302.5" y="2978.834">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="2329" y="2995.3223">Handler</text><ellipse cx="2359" cy="3014.2754" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2355,3002.2754,2361,2997.2754,2359,3002.2754,2361,3007.2754,2355,3002.2754" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2548.5" y="97.7988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2544.5" y="101.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2573" y="122.334">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2551.5" y="138.8223">notifications</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2548.5" y="2965.2988"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="2544.5" y="2969.2988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="2573" y="2989.834">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="2551.5" y="3006.3223">notifications</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="791.043" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="340.5" y="1014.2344"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="613.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1116.4766"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="1904.209"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2639.1934"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="2796.7461"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="117.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1064" y="1658.4141"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1266" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1696" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2025" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2792.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2354" y="163.7754"/><path d="M33,170.7754 L445,170.7754 L445,177.7754 L435,187.7754 L33,187.7754 L33,170.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2778.5234" style="stroke: #000000; stroke-width: 2.0;" width="2638.5" x="33" y="170.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367" x="48" y="184.3438">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M72,193.0859 L72,983.0859 L413,983.0859 L413,203.0859 L403,193.0859 L72,193.0859 " fill="#FFFF00" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M403,193.0859 L403,203.0859 L413,203.0859 L403,193.0859 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="78" y="210.6543">Headers - bulkTransferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="94" y="225.9648">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="94" y="241.2754">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="94" y="256.5859">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="271.8965">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="94" y="287.207">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="94" y="302.5176">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="94" y="317.8281">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="94" y="333.1387">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="94" y="348.4492">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="94" y="363.7598">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="379.0703">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="82" y="394.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="78" y="409.6914">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="425.002">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="94" y="440.3125">"bulkTransferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="94" y="455.623">"bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="94" y="470.9336">"payeeFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="94" y="486.2441">"payerFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="94" y="501.5547">"individualTransfers":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="516.8652">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="532.1758">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="126" y="547.4863">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="126" y="562.7969">"transferAmount":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="578.1074">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="142" y="593.418">"currency": &lt;currency&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="142" y="608.7285">"amount": &lt;amount&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="126" y="624.0391">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="126" y="639.3496">"ilpPacket": &lt;ilpPacket&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="126" y="654.6602">"condition": &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="126" y="669.9707">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="685.2813">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="142" y="700.5918">"extension":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="715.9023">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="731.2129">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="174" y="746.5234">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="174" y="761.834">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="158" y="777.1445">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="142" y="792.4551">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="807.7656">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="823.0762">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="94" y="838.3867">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="94" y="853.6973">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="110" y="869.0078">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="884.3184">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="142" y="899.6289">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="142" y="914.9395">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="126" y="930.25">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="110" y="945.5605">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="94" y="960.8711">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="976.1816">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1010.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="338.5" x2="328.5" y1="1014.2344" y2="1018.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="339.5" y1="1014.2344" y2="1014.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="74.5" y="1009.4922">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="87.5" y="1009.4922">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="392.5" y1="1058.8555" y2="1058.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="392.5" y1="1058.8555" y2="1071.8555"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="351.5" x2="392.5" y1="1071.8555" y2="1071.8555"/><polygon fill="#A80036" points="361.5,1067.8555,351.5,1071.8555,361.5,1075.8555,357.5,1071.8555" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1046.458">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="370.5" y="1038.8027">Validate incoming message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="370.5" y="1054.1133">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="454.5" y="1054.1133">3000-3002, 3100-3107</text><polygon fill="#A80036" points="787.5,1112.4766,797.5,1116.4766,787.5,1120.4766,791.5,1116.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="793.5" y1="1116.4766" y2="1116.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1104.0791">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="370.5" y="1096.4238">Persist incoming bulk message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="370.5" y="1111.7344">to object store</text><polygon fill="#A80036" points="361.5,1141.7871,351.5,1145.7871,361.5,1149.7871,357.5,1145.7871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="803.5" y1="1145.7871" y2="1145.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1141.0449">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="380.5" y="1141.0449">Return reference to the stored object</text><path d="M355,1158.7871 L355,1596.7871 L850,1596.7871 L850,1168.7871 L840,1158.7871 L355,1158.7871 " fill="#FFFF00" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M840,1158.7871 L840,1168.7871 L850,1168.7871 L840,1158.7871 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1176.3555">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1191.666">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="377" y="1206.9766">id: &lt;bulkTransferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="377" y="1222.2871">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="377" y="1237.5977">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="377" y="1252.9082">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="377" y="1268.2188">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="393" y="1283.5293">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="393" y="1298.8398">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="409" y="1314.1504">objstore: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="441" y="1329.4609">transactionid: &lt;bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="394" x="441" y="1344.7715">referenceid: &lt;bulkTransferMessage_ObjectStoreReference_ID&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1360.082">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1375.3926">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1390.7031">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="377" y="1406.0137">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="393" y="1421.3242">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="409" y="1436.6348">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="409" y="1451.9453">type: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="409" y="1467.2559">action: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="409" y="1482.5664">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="409" y="1497.877">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="425" y="1513.1875">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="425" y="1528.498">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="409" y="1543.8086">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="1559.1191">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="377" y="1574.4297">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="361" y="1589.7402">}</text><polygon fill="#A80036" points="1052,1654.4141,1062,1658.4141,1052,1662.4141,1056,1658.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="350.5" x2="1058" y1="1658.4141" y2="1658.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="357.5" y="1638.3613">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="370.5" y="1623.0508">Route &amp; Publish Bulk Prepare event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="370.5" y="1638.3613">for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="370.5" y="1653.6719">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="447.5" y="1653.6719">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1116" y1="1718.3457" y2="1718.3457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1116" x2="1116" y1="1718.3457" y2="1731.3457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1075" x2="1116" y1="1731.3457" y2="1731.3457"/><polygon fill="#A80036" points="1085,1727.3457,1075,1731.3457,1085,1735.3457,1081,1731.3457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1081" y="1698.293">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="1094" y="1682.9824">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1094" y="1698.293">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1094" y="1713.6035">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1171" y="1713.6035">2003</text><polygon fill="#A80036" points="361.5,1771.9668,351.5,1775.9668,361.5,1779.9668,357.5,1775.9668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="355.5" x2="1068" y1="1775.9668" y2="1775.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="367.5" y="1763.5693">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="380.5" y="1755.9141">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="380.5" y="1771.2246">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1805.2773" y2="1801.2773"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="77.5" y1="1805.2773" y2="1809.2773"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="67.5" x2="344.5" y1="1805.2773" y2="1805.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="84.5" y="1800.5352">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="97.5" y="1800.5352">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1080,1855.5879,1070,1859.5879,1080,1863.5879,1076,1859.5879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1074" x2="1265" y1="1859.5879" y2="1859.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1086" y="1854.8457">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1099" y="1854.8457">Consume message</text><polygon fill="#A80036" points="820.5,1900.209,810.5,1904.209,820.5,1908.209,816.5,1904.209" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="814.5" x2="1265" y1="1904.209" y2="1904.209"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="826.5" y="1891.8115">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="848.5" y="1884.1563">Retrieve bulk payload using reference</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="848.5" y="1899.4668">by streaming individual transfers</text><polygon fill="#A80036" points="1254,1944.8301,1264,1948.8301,1254,1952.8301,1258,1948.8301" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="804.5" x2="1260" y1="1948.8301" y2="1948.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="811.5" y="1936.4326">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="833.5" y="1928.7773">Return individual transfers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="833.5" y="1944.0879">part of the payload</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="591" x="1009" y="1956.8301"/><polygon fill="#EEEEEE" points="1009,1956.8301,1073,1956.8301,1073,1963.8301,1063,1973.8301,1009,1973.8301,1009,1956.8301" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1022" y="1971.3984">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1208" y="1990.3984">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1212" y="2005.709"/><path d="M1215,2024.7617 L1277,2024.7617 L1277,2031.7617 L1267,2041.7617 L1215,2041.7617 L1215,2024.7617 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.1973" style="stroke: #000000; stroke-width: 2.0;" width="1446.5" x="1215" y="2024.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1230" y="2038.3301">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1292" y="2037.3965">[Success]</text><polygon fill="#A80036" points="1520,2074.6934,1530,2078.6934,1520,2082.6934,1524,2078.6934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1276" x2="1526" y1="2078.6934" y2="2078.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1283" y="2066.2959">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="1305" y="2058.6406">Produce single transfer message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1305" y="2073.9512">for each individual transfer [loop]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1215" x2="2661.5" y1="2087.6934" y2="2087.6934"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1220" y="2098.3281">[Failure]</text><polygon fill="#A80036" points="2586,2118.959,2596,2122.959,2586,2126.959,2590,2122.959" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1276" x2="2592" y1="2122.959" y2="2122.959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1283" y="2118.2168">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1305" y="2118.2168">Produce message for the bulk transfer</text><polygon fill="#A80036" points="1543,2180.2695,1533,2184.2695,1543,2188.2695,1539,2184.2695" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1537" x2="1695" y1="2184.2695" y2="2184.2695"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1549" y="2179.5273">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1571" y="2179.5273">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="470" x="1460" y="2192.2695"/><polygon fill="#EEEEEE" points="1460,2192.2695,1524,2192.2695,1524,2199.2695,1514,2209.2695,1460,2209.2695,1460,2192.2695" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1473" y="2206.8379">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1616" y="2225.8379">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1620" y="2241.1484"/><path d="M1632.5,2260.2012 L1694.5,2260.2012 L1694.5,2267.2012 L1684.5,2277.2012 L1632.5,2277.2012 L1632.5,2260.2012 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.8867" style="stroke: #000000; stroke-width: 2.0;" width="635" x="1632.5" y="2260.2012"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="1647.5" y="2273.7695">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="1709.5" y="2272.8359">[Success]</text><polygon fill="#A80036" points="1849,2294.8223,1859,2298.8223,1849,2302.8223,1853,2298.8223" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1855" y1="2298.8223" y2="2298.8223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1713" y="2294.0801">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1735" y="2294.0801">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1632.5" x2="2267.5" y1="2307.8223" y2="2307.8223"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="1637.5" y="2318.457">[Failure]</text><polygon fill="#A80036" points="2178,2339.0879,2188,2343.0879,2178,2347.0879,2182,2343.0879" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1706" x2="2184" y1="2343.0879" y2="2343.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1713" y="2338.3457">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1735" y="2338.3457">Produce message</text><polygon fill="#A80036" points="1872,2400.3984,1862,2404.3984,1872,2408.3984,1868,2404.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1866" x2="2024" y1="2404.3984" y2="2404.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1878" y="2399.6563">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1900" y="2399.6563">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="468.5" x="1788" y="2412.3984"/><polygon fill="#EEEEEE" points="1788,2412.3984,1852,2412.3984,1852,2419.3984,1842,2429.3984,1788,2429.3984,1788,2412.3984" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1801" y="2426.9668">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1940.75" y="2445.9668">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1944.75" y="2461.2773"/><polygon fill="#A80036" points="2178,2490.6406,2188,2494.6406,2178,2498.6406,2182,2494.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2035" x2="2184" y1="2494.6406" y2="2494.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2042" y="2489.8984">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="2064" y="2489.8984">Produce message</text><polygon fill="#A80036" points="2201,2544.9512,2191,2548.9512,2201,2552.9512,2197,2548.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2195" x2="2353" y1="2548.9512" y2="2548.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2207" y="2544.209">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="2229" y="2544.209">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="531" x="2119.5" y="2556.9512"/><polygon fill="#EEEEEE" points="2119.5,2556.9512,2183.5,2556.9512,2183.5,2563.9512,2173.5,2573.9512,2119.5,2573.9512,2119.5,2556.9512" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="2132.5" y="2571.5195">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="2277.5" y="2590.5195">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2281.5" y="2605.8301"/><polygon fill="#A80036" points="820.5,2635.1934,810.5,2639.1934,820.5,2643.1934,816.5,2639.1934" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="814.5" x2="2353" y1="2639.1934" y2="2639.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="826.5" y="2634.4512">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="848.5" y="2634.4512">Persist bulk message to object store</text><polygon fill="#A80036" points="2342,2664.5039,2352,2668.5039,2342,2672.5039,2346,2668.5039" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="804.5" x2="2348" y1="2668.5039" y2="2668.5039"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="811.5" y="2663.7617">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="833.5" y="2663.7617">Return reference to the stored object</text><polygon fill="#A80036" points="2586,2693.8145,2596,2697.8145,2586,2701.8145,2590,2697.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2364" x2="2592" y1="2697.8145" y2="2697.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2371" y="2693.0723">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="2393" y="2693.0723">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2586,2748.125,2596,2752.125,2586,2756.125,2590,2752.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="2592" y1="2752.125" y2="2752.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2747.3828">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="652.5" y="2747.3828">Consume message</text><polygon fill="#A80036" points="787.5,2792.7461,797.5,2796.7461,787.5,2800.7461,791.5,2796.7461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="623.5" x2="793.5" y1="2796.7461" y2="2796.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="630.5" y="2784.3486">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="652.5" y="2776.6934">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="652.5" y="2792.0039">using reference</text><polygon fill="#A80036" points="634.5,2822.0566,624.5,2826.0566,634.5,2830.0566,630.5,2826.0566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="628.5" x2="803.5" y1="2826.0566" y2="2826.0566"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="640.5" y="2821.3145">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="662.5" y="2821.3145">Return payload</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="2551.5" x="99" y="2834.0566"/><polygon fill="#EEEEEE" points="99,2834.0566,163,2834.0566,163,2841.0566,153,2851.0566,99,2851.0566,99,2834.0566" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="112" y="2848.625">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1255.75" y="2867.625">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1259.75" y="2882.9355"/><polygon fill="#A80036" points="137.5,2912.2988,127.5,2916.2988,137.5,2920.2988,133.5,2916.2988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="612.5" y1="2916.2988" y2="2916.2988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="143.5" y="2911.5566">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="165.5" y="2911.5566">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification \nHandler" as NOTIFY_HANDLER
collections "mongo-\nobject-store" as OBJECT_STORE
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare\nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotifications" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - bulkTransferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - bulkTransferMessage:
        {
            "bulkTransferId": <uuid>,
            "bulkQuoteId": <uuid>, 
            "payeeFsp": <fspID>,
            "payerFsp": <fspID>,
            "individualTransfers": 
            [
                {
                    "transferId": <uuid>, 
                    "transferAmount": 
                    { 
                        "currency": <currency>, 
                        "amount": <amount> 
                    }, 
                    "ilpPacket": <ilpPacket>,
                    "condition": <ilpCondition>,
                    "extensionList":
                    {
                        "extension":
                        [ 
                            { 
                                “key”: <key>, 
                                “value”: <value> 
                            }
                        ]
                    }
                }
            ],
            "extensionList": {
                "extension": [
                    {
                        “key”: <key>, 
                        “value”: <value> 
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /bulkTransfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    MLAPI -> OBJECT_STORE: Persist incoming bulk message\nto object store
    activate OBJECT_STORE
    OBJECT_STORE - -> MLAPI: Return reference to the stored object
    deactivate OBJECT_STORE
    note right of MLAPI #yellow
        Message:
        {
            id: <bulkTransferMessage.transferId>
            from: <bulkTransferMessage.payerFsp>,
            to: <bulkTransferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <bulkTransferHeaders>,
                payload: {
                    objstore: {
                            transactionid: <bulkTransferId>
                            referenceid: <bulkTransferMessage_ObjectStoreReference_ID>
                    }
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: bulk-prepare,
                    action: bulk-prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event \nfor Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> MLAPI: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    BULK_PREP_HANDLER -> OBJECT_STORE: Retrieve bulk payload using reference\nby streaming individual transfers
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PREP_HANDLER: Return individual transfers\npart of the payload
    deactivate OBJECT_STORE
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE :  Bulk Prepare Handler Consume \n
    alt Success
        BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce single transfer message\nfor each individual transfer [loop]
    else Failure
        BULK_PREP_HANDLER - -> TOPIC_NOTIFICATIONS: Produce message for the bulk transfer
    end
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume\n
    alt Success
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        PREP_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING : Position Handler Consume\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS : Bulk Processing Handler Consume \n
    BULK_PROC_HANDLER -> OBJECT_STORE: Persist bulk message to object store
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PROC_HANDLER: Return reference to the stored object
    deactivate OBJECT_STORE
    BULK_PROC_HANDLER -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return payload
    deactivate OBJECT_STORE
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>