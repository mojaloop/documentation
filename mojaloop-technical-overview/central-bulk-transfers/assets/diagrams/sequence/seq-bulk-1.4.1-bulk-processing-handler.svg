<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3868px" preserveAspectRatio="none" style="width:1343px;height:3868px;" version="1.1" viewBox="0 0 1343 3868" width="1343px" zoomAndPan="magnify"><defs><filter height="300%" id="fnxz31uur799m" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="289" x="528" y="23.5352">1.4.0. Bulk Processing Handler Consume</text><rect fill="#FFFFE0" height="3823.1797" style="stroke: #A80036; stroke-width: 1.0;" width="1244.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="590.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="181.8848"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="3635.9395" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="229" y="136.2637"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="645" y="3125.3105"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="779.5" y="3651.9375"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="618.543"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2201.7285"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2383.5918"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2674.3418"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2849.8945"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="647.8535"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2261.6602"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2412.9023"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2703.6523"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2879.2051"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="3621.9395" style="stroke: #000000; stroke-width: 2.0;" width="1319" x="13" y="143.2637"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="167.4844" style="stroke: #000000; stroke-width: 2.0;" width="388.5" x="157.5" y="226.8848"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="136.1738" style="stroke: #000000; stroke-width: 2.0;" width="368.5" x="167.5" y="251.1953"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="429" x="167.5" y="408.3691"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="3178.2813" style="stroke: #000000; stroke-width: 2.0;" width="1174.5" x="147.5" y="579.9219"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="1403.3223" style="stroke: #000000; stroke-width: 2.0;" width="539" x="214" y="770.0957"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="1225.5273" style="stroke: #000000; stroke-width: 2.0;" width="519" x="224" y="940.8906"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="396.168" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1035.1328"/><rect fill="#FFFFFF" height="84.8867" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1122.375"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1207.2617"/><rect fill="#FFFFFF" height="115.5078" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1261.5273"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1377.0352"/><rect fill="#FFFFFF" height="185.7734" style="stroke: none; stroke-width: 1.0;" width="519" x="224" y="1438.3008"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="156.8184" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1460.2559"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1562.8086"/><rect fill="#FFFFFF" height="488.0781" style="stroke: none; stroke-width: 1.0;" width="519" x="224" y="1624.0742"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="389.1914" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1715.9609"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1772.582"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1826.8477"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1881.1133"/><rect fill="#FFFFFF" height="115.5078" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="1935.3789"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="499" x="234" y="2050.8867"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="519" x="224" y="2112.1523"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="126.1973" style="stroke: #000000; stroke-width: 2.0;" width="302" x="234" y="2519.834"/><rect fill="#FFFFFF" height="69.5762" style="stroke: none; stroke-width: 1.0;" width="302" x="234" y="2576.4551"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="939.9297" style="stroke: #000000; stroke-width: 2.0;" width="1154.5" x="157.5" y="2811.2734"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="673.1797" style="stroke: #000000; stroke-width: 2.0;" width="698" x="167.5" y="3016.7578"/><rect fill="#FFFFFF" height="54.2656" style="stroke: none; stroke-width: 1.0;" width="1154.5" x="157.5" y="3696.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="74" x2="74" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="233.5" x2="233.5" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="535.5" x2="535.5" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="649.5" x2="649.5" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="784.5" x2="784.5" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="900.5" x2="900.5" y1="126.2637" y2="3782.2031"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1211.5" x2="1211.5" y1="126.2637" y2="3782.2031"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="27" y="70.2871"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="23" y="74.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="30" y="94.8223">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="32.5" y="111.3105">processing</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="27" y="3781.2031"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="23" y="3785.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="30" y="3805.7383">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="32.5" y="3822.2266">processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="177.5" y="106.8223">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="204" y="123.3105">Handler</text><ellipse cx="234" cy="77.2871" fill="#FEFECE" filter="url(#fnxz31uur799m)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="230,65.2871,236,60.2871,234,65.2871,236,70.2871,230,65.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="177.5" y="3794.7383">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="204" y="3811.2266">Handler</text><ellipse cx="234" cy="3830.1797" fill="#FEFECE" filter="url(#fnxz31uur799m)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="230,3818.1797,236,3813.1797,234,3818.1797,236,3823.1797,230,3818.1797" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="489.5" y="86.7754"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="485.5" y="90.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="492.5" y="111.3105">topic-event</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="489.5" y="3781.2031"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="485.5" y="3785.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="492.5" y="3805.7383">topic-event</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="600.5" y="53.7988"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="596.5" y="57.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="609.5" y="78.334">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="603.5" y="94.8223">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="620.5" y="111.3105">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="625.5" y="111.3105">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="666.5" y="111.3105">)</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="600.5" y="3781.2031"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="596.5" y="3785.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="609.5" y="3805.7383">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="603.5" y="3822.2266">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="620.5" y="3838.7148">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="625.5" y="3838.7148">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="666.5" y="3838.7148">)</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="717.5" y="86.7754"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="713.5" y="90.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="720.5" y="111.3105">topic-notification</text><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="717.5" y="3781.2031"/><rect fill="#FEFECE" filter="url(#fnxz31uur799m)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="713.5" y="3785.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="720.5" y="3805.7383">topic-notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="865.5" y="123.3105">Bulk DAO</text><ellipse cx="900.5" cy="93.7754" fill="#FEFECE" filter="url(#fnxz31uur799m)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="888.5" x2="912.5" y1="107.7754" y2="107.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="865.5" y="3794.7383">Bulk DAO</text><ellipse cx="900.5" cy="3813.6914" fill="#FEFECE" filter="url(#fnxz31uur799m)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="888.5" x2="912.5" y1="3827.6914" y2="3827.6914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1163.5" y="123.3105">Central Store</text><path d="M1193.5,73.7754 C1193.5,63.7754 1211.5,63.7754 1211.5,63.7754 C1211.5,63.7754 1229.5,63.7754 1229.5,73.7754 L1229.5,99.7754 C1229.5,109.7754 1211.5,109.7754 1211.5,109.7754 C1211.5,109.7754 1193.5,109.7754 1193.5,99.7754 L1193.5,73.7754 " fill="#FEFECE" filter="url(#fnxz31uur799m)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1193.5,73.7754 C1193.5,83.7754 1211.5,83.7754 1211.5,83.7754 C1211.5,83.7754 1229.5,83.7754 1229.5,73.7754 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1163.5" y="3794.7383">Central Store</text><path d="M1193.5,3807.6914 C1193.5,3797.6914 1211.5,3797.6914 1211.5,3797.6914 C1211.5,3797.6914 1229.5,3797.6914 1229.5,3807.6914 L1229.5,3833.6914 C1229.5,3843.6914 1211.5,3843.6914 1211.5,3843.6914 C1211.5,3843.6914 1193.5,3843.6914 1193.5,3833.6914 L1193.5,3807.6914 " fill="#FEFECE" filter="url(#fnxz31uur799m)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1193.5,3807.6914 C1193.5,3817.6914 1211.5,3817.6914 1211.5,3817.6914 C1211.5,3817.6914 1229.5,3817.6914 1229.5,3807.6914 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="69" y="181.8848"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="3635.9395" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="229" y="136.2637"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="44.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="645" y="3125.3105"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="779.5" y="3651.9375"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="618.543"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2201.7285"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2383.5918"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2674.3418"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="151.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="895.5" y="2849.8945"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="647.8535"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2261.6602"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2412.9023"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2703.6523"/><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="93.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1206.5" y="2879.2051"/><path d="M13,143.2637 L289,143.2637 L289,150.2637 L279,160.2637 L13,160.2637 L13,143.2637 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3621.9395" style="stroke: #000000; stroke-width: 2.0;" width="1319" x="13" y="143.2637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="231" x="28" y="156.832">Bulk Processing Handler Consume</text><polygon fill="#A80036" points="90,177.8848,80,181.8848,90,185.8848,86,181.8848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="228" y1="181.8848" y2="181.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="96" y="177.1426">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="109" y="177.1426">Consume message</text><path d="M157.5,226.8848 L241.5,226.8848 L241.5,233.8848 L231.5,243.8848 L157.5,243.8848 L157.5,226.8848 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="167.4844" style="stroke: #000000; stroke-width: 2.0;" width="388.5" x="157.5" y="226.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="172.5" y="240.4531">break</text><path d="M167.5,251.1953 L309.5,251.1953 L309.5,258.1953 L299.5,268.1953 L167.5,268.1953 L167.5,251.1953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="136.1738" style="stroke: #000000; stroke-width: 2.0;" width="368.5" x="167.5" y="251.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="182.5" y="264.7637">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="281" y1="366.3691" y2="366.3691"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281" x2="281" y1="366.3691" y2="379.3691"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="281" y1="379.3691" y2="379.3691"/><polygon fill="#A80036" points="250,375.3691,240,379.3691,250,383.3691,246,379.3691" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="323.3506">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="259" y="285.0742">Validate event - Rule:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="259" y="300.3848">type == 'bulk-processing' &amp;&amp; action IN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="259" y="315.6953">['prepare-duplicate', 'bulk-prepare',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="259" y="331.0059">'bulk-timeout-received', 'fulfil-duplicate',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="259" y="346.3164">'bulk-commit', 'bulk-timeout-reserved']</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="259" y="361.627">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="343" y="361.627">2001</text><path d="M167.5,408.3691 L382.5,408.3691 L382.5,415.3691 L372.5,425.3691 L167.5,425.3691 L167.5,408.3691 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="429" x="167.5" y="408.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="182.5" y="421.9375">Persist Event Information</text><polygon fill="#A80036" points="524,467.9902,534,471.9902,524,475.9902,528,471.9902" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="530" y1="471.9902" y2="471.9902"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="467.248">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="259" y="467.248">Publish event information</text><rect fill="#FFFFFF" filter="url(#fnxz31uur799m)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="411" x="174.5" y="479.9902"/><polygon fill="#EEEEEE" points="174.5,479.9902,238.5,479.9902,238.5,486.9902,228.5,496.9902,174.5,496.9902,174.5,479.9902" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="187.5" y="494.5586">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="307" y="513.5586">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="311" y="528.8691"/><path d="M147.5,579.9219 L306.5,579.9219 L306.5,586.9219 L296.5,596.9219 L147.5,596.9219 L147.5,579.9219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3178.2813" style="stroke: #000000; stroke-width: 2.0;" width="1174.5" x="147.5" y="579.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="162.5" y="593.4902">Process Message</text><polygon fill="#A80036" points="883.5,614.543,893.5,618.543,883.5,622.543,887.5,618.543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="889.5" y1="618.543" y2="618.543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="613.8008">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="259" y="613.8008">Retrieve current state of Bulk Transfer</text><polygon fill="#A80036" points="1194.5,643.8535,1204.5,647.8535,1194.5,651.8535,1198.5,647.8535" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="905.5" x2="1200.5" y1="647.8535" y2="647.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="912.5" y="643.1113">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="925.5" y="643.1113">Retrieve current state of Bulk Transfer</text><polygon fill="#FFFFE0" filter="url(#fnxz31uur799m)" points="1130,660.8535,1292,660.8535,1302,679.8535,1292,698.8535,1130,698.8535,1120,679.8535,1130,660.8535" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1132" y="677.4219">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1132" y="692.7324">bulkTransferStateChange</text><polygon fill="#A80036" points="916.5,721.7852,906.5,725.7852,916.5,729.7852,912.5,725.7852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="910.5" x2="1210.5" y1="725.7852" y2="725.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="922.5" y="721.043">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="935.5" y="721.043">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="980.5" y="721.043">bulkTransferInfo</text><polygon fill="#A80036" points="250,751.0957,240,755.0957,250,759.0957,246,755.0957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="899.5" y1="755.0957" y2="755.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="256" y="750.3535">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="269" y="750.3535">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="314" y="750.3535">bulkTransferInfo</text><path d="M214,770.0957 L446,770.0957 L446,777.0957 L436,787.0957 L214,787.0957 L214,770.0957 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1403.3223" style="stroke: #000000; stroke-width: 2.0;" width="539" x="214" y="770.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="229" y="783.6641">Validate Bulk Transfer State</text><path d="M244,792.4063 L244,924.4063 L459,924.4063 L459,802.4063 L449,792.4063 L244,792.4063 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M449,792.4063 L449,802.4063 L459,802.4063 L449,792.4063 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="250" y="809.9746">Initialize variables</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="374" y="809.9746">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="250" y="825.2852">let criteriaState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="250" y="840.5957">let incompleteBulkState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="250" y="855.9063">let completedBulkState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="250" y="871.2168">let bulkTransferState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="250" y="886.5273">let processingState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="250" y="901.8379">let errorCode, errorMessage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="250" y="917.1484">let produceNotification = false</text><path d="M224,940.8906 L286,940.8906 L286,947.8906 L276,957.8906 L224,957.8906 L224,940.8906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1225.5273" style="stroke: #000000; stroke-width: 2.0;" width="519" x="224" y="940.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="239" y="954.459">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="420" x="301" y="953.5254">[bulkTransferInfo.bulkTransferState IN ['RECEIVED', 'PENDING_PREPARE']]</text><path d="M244,963.2012 L244,1018.2012 L534,1018.2012 L534,973.2012 L524,963.2012 L244,963.2012 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M524,963.2012 L524,973.2012 L534,973.2012 L524,963.2012 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="250" y="980.7695">criteriaState = 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="250" y="996.0801">incompleteBulkState = 'PENDING_PREPARE'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="250" y="1011.3906">completedBulkState = 'ACCEPTED'</text><path d="M234,1035.1328 L296,1035.1328 L296,1042.1328 L286,1052.1328 L234,1052.1328 L234,1035.1328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="396.168" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1035.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="249" y="1048.7012">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="329" x="311" y="1047.7676">[action == 'prepare-duplicate' AND state.status == 'error']</text><path d="M244,1057.4434 L244,1112.4434 L650,1112.4434 L650,1067.4434 L640,1057.4434 L244,1057.4434 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M640,1057.4434 L640,1067.4434 L650,1067.4434 L640,1057.4434 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="250" y="1075.0117">processingState = 'RECEIVED_DUPLICATE'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="250" y="1090.3223">errorCode = payload.errorInformation.errorCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="250" y="1105.6328">errorDescription = payload.errorInformation.errorDescription</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1123.375" y2="1123.375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="303" x="239" y="1134.0098">[action == 'bulk-prepare' AND state.status == 'error']</text><path d="M244,1142.3301 L244,1197.3301 L650,1197.3301 L650,1152.3301 L640,1142.3301 L244,1142.3301 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M640,1142.3301 L640,1152.3301 L650,1152.3301 L640,1142.3301 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="250" y="1159.8984">processingState = 'RECEIVED_INVALID'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="250" y="1175.209">errorCode = payload.errorInformation.errorCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="250" y="1190.5195">errorDescription = payload.errorInformation.errorDescription</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1208.2617" y2="1208.2617"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="318" x="239" y="1218.8965">[action == 'bulk-prepare' AND state.status == 'success']</text><path d="M244,1227.2168 L244,1252.2168 L455,1252.2168 L455,1237.2168 L445,1227.2168 L244,1227.2168 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M445,1227.2168 L445,1237.2168 L455,1237.2168 L445,1227.2168 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="250" y="1244.7852">processingState = 'ACCEPTED'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1262.5273" y2="1262.5273"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="348" x="239" y="1273.1621">[action IN ['bulk-timeout-received', 'bulk-timeout-reserved']]</text><path d="M244,1281.4824 L244,1367.4824 L650,1367.4824 L650,1291.4824 L640,1281.4824 L244,1281.4824 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M640,1281.4824 L640,1291.4824 L650,1291.4824 L640,1281.4824 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="250" y="1299.0508">incompleteBulkState = 'EXPIRING'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="250" y="1314.3613">completedBulkState = 'COMPLETED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="250" y="1329.6719">processingState = 'EXPIRED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="250" y="1344.9824">errorCode = payload.errorInformation.errorCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="250" y="1360.293">errorDescription = payload.errorInformation.errorDescription</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1378.0352" y2="1378.0352"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="239" y="1388.6699">[all other actions]</text><path d="M244,1396.9902 L244,1421.9902 L719,1421.9902 L719,1406.9902 L709,1396.9902 L244,1396.9902 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M709,1396.9902 L709,1406.9902 L719,1406.9902 L709,1396.9902 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="250" y="1414.5586">throw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="290" y="1414.5586">ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="224" x2="743" y1="1439.3008" y2="1439.3008"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="302" x="229" y="1449.9355">[bulkTransferInfo.bulkTransferState IN ['ACCEPTED']]</text><path d="M234,1460.2559 L296,1460.2559 L296,1467.2559 L286,1477.2559 L234,1477.2559 L234,1460.2559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="156.8184" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1460.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="249" y="1473.8242">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="311" y="1472.8906">[action == 'bulk-timeout-reserved']</text><path d="M244,1482.5664 L244,1553.5664 L489,1553.5664 L489,1492.5664 L479,1482.5664 L244,1482.5664 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M479,1482.5664 L479,1492.5664 L489,1492.5664 L479,1482.5664 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="250" y="1500.1348">criteriaState = 'ACCEPTED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="250" y="1515.4453">incompleteBulkState = 'EXPIRING'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="250" y="1530.7559">completedBulkState = 'COMPLETED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="250" y="1546.0664">processingState = 'EXPIRED'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1563.8086" y2="1563.8086"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="239" y="1574.4434">[all other actions]</text><path d="M244,1582.7637 L244,1607.7637 L719,1607.7637 L719,1592.7637 L709,1582.7637 L244,1582.7637 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M709,1582.7637 L709,1592.7637 L719,1592.7637 L709,1582.7637 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="250" y="1600.332">throw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="290" y="1600.332">ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="224" x2="743" y1="1625.0742" y2="1625.0742"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="483" x="229" y="1635.709">[bulkTransferInfo.bulkTransferState IN ['PROCESSING', 'PENDING_FULFIL', 'EXPIRING']]</text><path d="M244,1644.0293 L244,1699.0293 L522,1699.0293 L522,1654.0293 L512,1644.0293 L244,1644.0293 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,1644.0293 L512,1654.0293 L522,1654.0293 L512,1644.0293 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="250" y="1661.5977">criteriaState = 'PROCESSING'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="250" y="1676.9082">incompleteBulkState = 'PENDING_FULFIL'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="250" y="1692.2188">completedBulkState = 'COMPLETED'</text><path d="M234,1715.9609 L296,1715.9609 L296,1722.9609 L286,1732.9609 L234,1732.9609 L234,1715.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="389.1914" style="stroke: #000000; stroke-width: 2.0;" width="499" x="234" y="1715.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="249" y="1729.5293">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="311" y="1728.5957">[action == 'fulfil-duplicate']</text><path d="M244,1738.2715 L244,1763.2715 L507,1763.2715 L507,1748.2715 L497,1738.2715 L244,1738.2715 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M497,1738.2715 L497,1748.2715 L507,1748.2715 L497,1738.2715 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="250" y="1755.8398">processingState = 'FULFIL_DUPLICATE'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1773.582" y2="1773.582"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="319" x="239" y="1784.2168">[action == 'bulk-commit' AND state.status == 'success']</text><path d="M244,1792.5371 L244,1817.5371 L465,1817.5371 L465,1802.5371 L455,1792.5371 L244,1792.5371 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M455,1792.5371 L455,1802.5371 L465,1802.5371 L455,1792.5371 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="250" y="1810.1055">processingState = 'COMPLETED'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1827.8477" y2="1827.8477"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="275" x="239" y="1838.4824">[action == 'reject' AND state.status == 'success']</text><path d="M244,1846.8027 L244,1871.8027 L449,1871.8027 L449,1856.8027 L439,1846.8027 L244,1846.8027 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M439,1846.8027 L439,1856.8027 L449,1856.8027 L439,1846.8027 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="250" y="1864.3711">processingState = 'REJECTED'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1882.1133" y2="1882.1133"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="316" x="239" y="1892.748">[action IN ['commit', 'abort'] AND state.status == 'error']</text><path d="M244,1901.0684 L244,1926.0684 L489,1926.0684 L489,1911.0684 L479,1901.0684 L244,1901.0684 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M479,1901.0684 L479,1911.0684 L489,1911.0684 L479,1901.0684 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="250" y="1918.6367">processingState = 'FULFIL_INVALID'</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="1936.3789" y2="1936.3789"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="239" y="1947.0137">[action == 'bulk-timeout-reserved']</text><path d="M244,1955.334 L244,2041.334 L650,2041.334 L650,1965.334 L640,1955.334 L244,1955.334 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M640,1955.334 L640,1965.334 L650,1965.334 L640,1955.334 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="250" y="1972.9023">incompleteBulkState = 'EXPIRING'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="250" y="1988.2129">completedBulkState = 'COMPLETED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="250" y="2003.5234">processingState = 'EXPIRED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="250" y="2018.834">errorCode = payload.errorInformation.errorCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="250" y="2034.1445">errorDescription = payload.errorInformation.errorDescription</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="733" y1="2051.8867" y2="2051.8867"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="239" y="2062.5215">[all other actions]</text><path d="M244,2070.8418 L244,2095.8418 L719,2095.8418 L719,2080.8418 L709,2070.8418 L244,2070.8418 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M709,2070.8418 L709,2080.8418 L719,2080.8418 L709,2070.8418 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="250" y="2088.4102">throw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="290" y="2088.4102">ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="224" x2="743" y1="2113.1523" y2="2113.1523"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="393" x="229" y="2123.7871">[all other ['PENDING_INVALID', 'COMPLETED', 'REJECTED', 'INVALID']]</text><path d="M244,2132.1074 L244,2157.1074 L719,2157.1074 L719,2142.1074 L709,2132.1074 L244,2132.1074 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M709,2132.1074 L709,2142.1074 L719,2142.1074 L709,2132.1074 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="250" y="2149.6758">throw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="414" x="290" y="2149.6758">ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)</text><polygon fill="#A80036" points="883.5,2197.7285,893.5,2201.7285,883.5,2205.7285,887.5,2201.7285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="889.5" y1="2201.7285" y2="2201.7285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="246" y="2196.9863">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="259" y="2196.9863">Persist individual transfer processing state</text><polygon fill="#A80036" points="1194.5,2257.6602,1204.5,2261.6602,1194.5,2265.6602,1198.5,2261.6602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="905.5" x2="1200.5" y1="2261.6602" y2="2261.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="912.5" y="2241.6074">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="925.5" y="2226.2969">Persist individual transfer processing state</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="925.5" y="2241.6074">-- store errorCode/errorMessage when</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="925.5" y="2256.918">state.status == 'error'</text><polygon fill="#FFFFE0" filter="url(#fnxz31uur799m)" points="1132,2304.6602,1290,2304.6602,1300,2315.6602,1290,2327.6602,1132,2327.6602,1122,2315.6602,1132,2304.6602" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1134" y="2321.2285">bulkTransferAssociation</text><polygon fill="#A80036" points="250,2350.2813,240,2354.2813,250,2358.2813,246,2354.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="899.5" y1="2354.2813" y2="2354.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2349.5391">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2349.5391">Return success</text><polygon fill="#A80036" points="883.5,2379.5918,893.5,2383.5918,883.5,2387.5918,887.5,2383.5918" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="889.5" y1="2383.5918" y2="2383.5918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2378.8496">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="268" y="2378.8496">Check previously defined completion criteria</text><polygon fill="#A80036" points="1194.5,2408.9023,1204.5,2412.9023,1194.5,2416.9023,1198.5,2412.9023" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="905.5" x2="1200.5" y1="2412.9023" y2="2412.9023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="912.5" y="2408.1602">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="934.5" y="2408.1602">Select EXISTS (LIMIT 1) in criteriaState</text><polygon fill="#FFFFE0" filter="url(#fnxz31uur799m)" points="1132,2425.9023,1290,2425.9023,1300,2436.9023,1290,2448.9023,1132,2448.9023,1122,2436.9023,1132,2425.9023" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1134" y="2442.4707">bulkTransferAssociation</text><polygon fill="#A80036" points="916.5,2471.5234,906.5,2475.5234,916.5,2479.5234,912.5,2475.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="910.5" x2="1210.5" y1="2475.5234" y2="2475.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="922.5" y="2470.7813">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="944.5" y="2470.7813">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="989.5" y="2470.7813">existingIndividualTransfer</text><polygon fill="#A80036" points="250,2500.834,240,2504.834,250,2508.834,246,2504.834" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="899.5" y1="2504.834" y2="2504.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2500.0918">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="278" y="2500.0918">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="323" y="2500.0918">existingIndividualTransfer</text><path d="M234,2519.834 L296,2519.834 L296,2526.834 L286,2536.834 L234,2536.834 L234,2519.834 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="126.1973" style="stroke: #000000; stroke-width: 2.0;" width="302" x="234" y="2519.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="249" y="2533.4023">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="311" y="2532.4688">[individual transfer exists]</text><path d="M244,2542.1445 L244,2567.1445 L522,2567.1445 L522,2552.1445 L512,2542.1445 L244,2542.1445 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M512,2542.1445 L512,2552.1445 L522,2552.1445 L512,2542.1445 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="250" y="2559.7129">bulkTransferState = incompleteBulkState</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="234" x2="536" y1="2577.4551" y2="2577.4551"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="239" y="2588.0898">[no transfer in criteriaState exists]</text><path d="M244,2596.4102 L244,2636.4102 L518,2636.4102 L518,2606.4102 L508,2596.4102 L244,2596.4102 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M508,2596.4102 L508,2606.4102 L518,2606.4102 L508,2596.4102 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="250" y="2613.9785">bulkTransferState = completedBulkState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="250" y="2629.2891">produceNotification = true</text><polygon fill="#A80036" points="883.5,2670.3418,893.5,2674.3418,883.5,2678.3418,887.5,2674.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="889.5" y1="2674.3418" y2="2674.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2669.5996">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="268" y="2669.5996">Persist bulkTransferState from previous step</text><polygon fill="#A80036" points="1194.5,2699.6523,1204.5,2703.6523,1194.5,2707.6523,1198.5,2703.6523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="905.5" x2="1200.5" y1="2703.6523" y2="2703.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="912.5" y="2698.9102">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="934.5" y="2698.9102">Persist bulkTransferState</text><polygon fill="#FFFFE0" filter="url(#fnxz31uur799m)" points="1130,2746.6523,1292,2746.6523,1302,2757.6523,1292,2769.6523,1130,2769.6523,1120,2757.6523,1130,2746.6523" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1132" y="2763.2207">bulkTransferStateChange</text><polygon fill="#A80036" points="250,2792.2734,240,2796.2734,250,2800.2734,246,2796.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="899.5" y1="2796.2734" y2="2796.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2791.5313">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="278" y="2791.5313">Return success</text><path d="M157.5,2811.2734 L219.5,2811.2734 L219.5,2818.2734 L209.5,2828.2734 L157.5,2828.2734 L157.5,2811.2734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="939.9297" style="stroke: #000000; stroke-width: 2.0;" width="1154.5" x="157.5" y="2811.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="172.5" y="2824.8418">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="167" x="234.5" y="2823.9082">[produceNotification == true]</text><polygon fill="#A80036" points="883.5,2845.8945,893.5,2849.8945,883.5,2853.8945,887.5,2849.8945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="889.5" y1="2849.8945" y2="2849.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="2845.1523">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="415" x="268" y="2845.1523">Request to retrieve all bulk transfer and individual transfer results</text><polygon fill="#A80036" points="1194.5,2875.2051,1204.5,2879.2051,1194.5,2883.2051,1198.5,2879.2051" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="905.5" x2="1200.5" y1="2879.2051" y2="2879.2051"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="912.5" y="2874.4629">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="934.5" y="2874.4629">Get bulkTransferResult</text><polygon fill="#FFFFE0" filter="url(#fnxz31uur799m)" points="1130,2892.2051,1292,2892.2051,1302,2918.2051,1292,2945.2051,1130,2945.2051,1120,2918.2051,1130,2892.2051" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1132" y="2908.7734">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1132" y="2924.084">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1132" y="2939.3945">bulkTransferAssociation</text><polygon fill="#A80036" points="916.5,2968.4473,906.5,2972.4473,916.5,2976.4473,912.5,2972.4473" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="910.5" x2="1210.5" y1="2972.4473" y2="2972.4473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="922.5" y="2967.7051">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="944.5" y="2967.7051">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="989.5" y="2967.7051">bulkTransferResult</text><polygon fill="#A80036" points="250,2997.7578,240,3001.7578,250,3005.7578,246,3001.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="899.5" y1="3001.7578" y2="3001.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="2997.0156">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="278" y="2997.0156">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="323" y="2997.0156">bulkTransferResult</text><path d="M167.5,3016.7578 L376.5,3016.7578 L376.5,3023.7578 L366.5,3033.7578 L167.5,3033.7578 L167.5,3016.7578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="673.1797" style="stroke: #000000; stroke-width: 2.0;" width="698" x="167.5" y="3016.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="182.5" y="3030.3262">Send Bulk Notification(s)</text><path d="M244,3039.0684 L244,3079.0684 L523,3079.0684 L523,3049.0684 L513,3039.0684 L244,3039.0684 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M513,3039.0684 L513,3049.0684 L523,3049.0684 L513,3039.0684 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="250" y="3056.6367">Depending on the action decide where to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="250" y="3071.9473">send notification: payer, payee OR both</text><polygon fill="#A80036" points="633,3121.3105,643,3125.3105,633,3129.3105,637,3125.3105" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="639" y1="3125.3105" y2="3125.3105"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="3112.9131">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="268" y="3105.2578">Generate &amp; Persist bulk message to object store:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="268" y="3120.5684">MLOS.bulkTransferResults</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="450" y="3120.5684">by destination</text><polygon fill="#A80036" points="250,3165.9316,240,3169.9316,250,3173.9316,246,3169.9316" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="244" x2="649" y1="3169.9316" y2="3169.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="256" y="3157.5342">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="278" y="3149.8789">Return reference to the stored object(s)</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="254" x="278" y="3165.1895">MLOS.bulkTransferResults.messageId</text><path d="M244,3182.9316 L244,3605.9316 L654,3605.9316 L654,3192.9316 L644,3182.9316 L244,3182.9316 " fill="#FFFF00" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M644,3182.9316 L644,3192.9316 L654,3192.9316 L644,3182.9316 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="250" y="3200.5">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="3215.8105">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="266" y="3231.1211">id: &lt;messageId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="266" y="3246.4316">from: &lt;source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="266" y="3261.7422">to: &lt;destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="266" y="3277.0527">type: "application/json"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="266" y="3292.3633">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="282" y="3307.6738">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="282" y="3322.9844">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="298" y="3338.2949">bulkTransferId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="298" y="3353.6055">bulkTransferState: &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="282" y="3368.916">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="266" y="3384.2266">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="266" y="3399.5371">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="282" y="3414.8477">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="298" y="3430.1582">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="298" y="3445.4688">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="298" y="3460.7793">type: "notification",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="298" y="3476.0898">action: "bulk-[prepare | commit | abort | processing]",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="298" y="3491.4004">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="298" y="3506.7109">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="314" y="3522.0215">status: state.status,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="314" y="3537.332">code: state.code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="298" y="3552.6426">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="282" y="3567.9531">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="266" y="3583.2637">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="250" y="3598.5742">}</text><polygon fill="#A80036" points="767.5,3647.9375,777.5,3651.9375,767.5,3655.9375,771.5,3651.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="773.5" y1="3651.9375" y2="3651.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="246" y="3639.54">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="268" y="3631.8848">Publish Notification event for Payer/Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="268" y="3647.1953">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="352" y="3647.1953">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157.5" x2="1312" y1="3697.9375" y2="3697.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="162.5" y="3708.5723">[produceNotification == false]</text><path d="M244,3716.8926 L244,3741.8926 L457,3741.8926 L457,3726.8926 L447,3716.8926 L244,3716.8926 " fill="#D3D3D3" filter="url(#fnxz31uur799m)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M447,3716.8926 L447,3726.8926 L457,3726.8926 L447,3716.8926 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="250" y="3734.4609">Do nothing (awaitAllTransfers)</text><!--
@startuml
title 1.4.0. Bulk Processing Handler Consume

autonumber



collections "topic-bulk-\nprocessing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-event" as TOPIC_EVENTS
collections "mojaloop-\nobject-store\n(**MLOS**)" as OBJECT_STORE
collections "topic-notification" as TOPIC_NOTIFICATION
entity "Bulk DAO" as BULK_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_EVENTS
    participant OBJECT_STORE
    participant TOPIC_NOTIFICATION
    participant BULK_DAO
    participant DB
end box

activate BULK_PROC_HANDLER
group Bulk Processing Handler Consume
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    activate TOPIC_BULK_PROCESSING
    deactivate TOPIC_BULK_PROCESSING

    break
        group Validate Event
            BULK_PROC_HANDLER <-> BULK_PROC_HANDLER: Validate event - Rule:\ntype == 'bulk-processing' && action IN\n['prepare-duplicate', 'bulk-prepare',\n'bulk-timeout-received', 'fulfil-duplicate',\n'bulk-commit', 'bulk-timeout-reserved']\n<color #red><b>Error codes:</b> 2001</color>
        end
    end

    group Persist Event Information
        |||
        BULK_PROC_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over BULK_PROC_HANDLER, TOPIC_EVENTS:  Event Handler Consume\n
        |||
    end

    group Process Message
        BULK_PROC_HANDLER -> BULK_DAO: Retrieve current state of Bulk Transfer
        activate BULK_DAO
        BULK_DAO -> DB: Retrieve current state of Bulk Transfer
        activate DB
        hnote over DB #lightyellow
            bulkTransfer
            bulkTransferStateChange
        end note
        BULK_DAO <- - DB: Return **bulkTransferInfo**
        deactivate DB
        BULK_PROC_HANDLER <- - BULK_DAO: Return **bulkTransferInfo**
        deactivate BULK_DAO

        group Validate Bulk Transfer State
            note right of BULK_PROC_HANDLER #lightgrey
                **Initialize variables**:
                let criteriaState
                let incompleteBulkState
                let completedBulkState
                let bulkTransferState
                let processingState
                let errorCode, errorMessage
                let produceNotification = false
            end note
            alt bulkTransferInfo.bulkTransferState IN ['RECEIVED', 'PENDING_PREPARE']
                note right of BULK_PROC_HANDLER #lightgrey
                    criteriaState = 'RECEIVED'
                    incompleteBulkState = 'PENDING_PREPARE'
                    completedBulkState = 'ACCEPTED'
                end note
                alt action == 'prepare-duplicate' AND state.status == 'error'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'RECEIVED_DUPLICATE'
                        errorCode = payload.errorInformation.errorCode
                        errorDescription = payload.errorInformation.errorDescription
                    end note
                else action == 'bulk-prepare' AND state.status == 'error'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'RECEIVED_INVALID'
                        errorCode = payload.errorInformation.errorCode
                        errorDescription = payload.errorInformation.errorDescription
                    end note
                else action == 'bulk-prepare' AND state.status == 'success'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'ACCEPTED'
                    end note
                else action IN ['bulk-timeout-received', 'bulk-timeout-reserved']
                    note right of BULK_PROC_HANDLER #lightgrey
                        incompleteBulkState = 'EXPIRING'
                        completedBulkState = 'COMPLETED'
                        processingState = 'EXPIRED'
                        errorCode = payload.errorInformation.errorCode
                        errorDescription = payload.errorInformation.errorDescription
                    end note
                else all other actions
                    note right of BULK_PROC_HANDLER #lightgrey
                        <color #red>throw</color> ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)
                    end note
                end
            else bulkTransferInfo.bulkTransferState IN ['ACCEPTED']
                alt action == 'bulk-timeout-reserved'
                    note right of BULK_PROC_HANDLER #lightgrey
                        criteriaState = 'ACCEPTED'
                        incompleteBulkState = 'EXPIRING'
                        completedBulkState = 'COMPLETED'
                        processingState = 'EXPIRED'
                    end note
                else all other actions
                    note right of BULK_PROC_HANDLER #lightgrey
                        <color #red>throw</color> ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)
                    end note
                end
            else bulkTransferInfo.bulkTransferState IN ['PROCESSING', 'PENDING_FULFIL', 'EXPIRING']
                note right of BULK_PROC_HANDLER #lightgrey
                    criteriaState = 'PROCESSING'
                    incompleteBulkState = 'PENDING_FULFIL'
                    completedBulkState = 'COMPLETED'
                end note
                alt action == 'fulfil-duplicate'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'FULFIL_DUPLICATE'
                    end note
                else action == 'bulk-commit' AND state.status == 'success'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'COMPLETED'
                    end note
                else action == 'reject' AND state.status == 'success'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'REJECTED'
                    end note
                else action IN ['commit', 'abort'] AND state.status == 'error'
                    note right of BULK_PROC_HANDLER #lightgrey
                        processingState = 'FULFIL_INVALID'
                    end note
                else action == 'bulk-timeout-reserved'
                    note right of BULK_PROC_HANDLER #lightgrey
                        incompleteBulkState = 'EXPIRING'
                        completedBulkState = 'COMPLETED'
                        processingState = 'EXPIRED'
                        errorCode = payload.errorInformation.errorCode
                        errorDescription = payload.errorInformation.errorDescription
                    end note
                else all other actions
                    note right of BULK_PROC_HANDLER #lightgrey
                        <color #red>throw</color> ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)
                    end note
                end
            else all other ['PENDING_INVALID', 'COMPLETED', 'REJECTED', 'INVALID']
                note right of BULK_PROC_HANDLER #lightgrey
                    <color #red>throw</color> ErrorHandler.Factory.createFSPIOPError(INTERNAL_SERVER_ERROR)
                end note
            end
        end

        BULK_PROC_HANDLER -> BULK_DAO: Persist individual transfer processing state
        activate BULK_DAO
        BULK_DAO -> DB: Persist individual transfer processing state\n<color #gray>- - store errorCode/errorMessage when</color>\n<color #gray>state.status == 'error'</color>
        activate DB
        hnote over DB #lightyellow
            bulkTransferAssociation
        end note
        deactivate DB
        BULK_PROC_HANDLER <- - BULK_DAO: Return success
        deactivate BULK_DAO

        BULK_PROC_HANDLER -> BULK_DAO: Check previously defined completion criteria
        activate BULK_DAO
        BULK_DAO -> DB: Select EXISTS (LIMIT 1) in criteriaState
        activate DB
        hnote over DB #lightyellow
            bulkTransferAssociation
        end note
        BULK_DAO <- - DB: Return **existingIndividualTransfer**
        deactivate DB
        BULK_PROC_HANDLER <- - BULK_DAO: Return **existingIndividualTransfer**
        deactivate BULK_DAO

        alt individual transfer exists
            note right of BULK_PROC_HANDLER #lightgrey
                bulkTransferState = incompleteBulkState
            end note
        else no transfer in criteriaState exists
            note right of BULK_PROC_HANDLER #lightgrey
                bulkTransferState = completedBulkState
                produceNotification = true
            end note
        end

        BULK_PROC_HANDLER -> BULK_DAO: Persist bulkTransferState from previous step
        activate BULK_DAO
        BULK_DAO -> DB: Persist bulkTransferState
        activate DB
        deactivate DB
        hnote over DB #lightyellow
            bulkTransferStateChange
        end note
        BULK_PROC_HANDLER <- - BULK_DAO: Return success
        deactivate BULK_DAO


        alt produceNotification == true
            BULK_PROC_HANDLER -> BULK_DAO: Request to retrieve all bulk transfer and individual transfer results
            activate BULK_DAO
            BULK_DAO -> DB: Get bulkTransferResult
            activate DB
            hnote over DB #lightyellow
                bulkTransfer
                bulkTransferStateChange
                bulkTransferAssociation
            end note
            BULK_DAO <- - DB: Return **bulkTransferResult**
            deactivate DB
            BULK_PROC_HANDLER <- - BULK_DAO: Return **bulkTransferResult**
            deactivate BULK_DAO

            group Send Bulk Notification(s)
                note right of BULK_PROC_HANDLER #lightgrey
                    Depending on the action decide where to
                    send notification: payer, payee OR both
                end note

                BULK_PROC_HANDLER -> OBJECT_STORE: Generate & Persist bulk message to object store:\n**MLOS.bulkTransferResults** by destination
                activate OBJECT_STORE
                OBJECT_STORE - -> BULK_PROC_HANDLER: Return reference to the stored object(s)\n**MLOS.bulkTransferResults.messageId**
                deactivate OBJECT_STORE
                note right of BULK_PROC_HANDLER #yellow
                    Message:
                    {
                        id: <messageId>
                        from: <source>,
                        to: <destination>,
                        type: "application/json"
                        content: {
                            headers: <bulkTransferHeaders>,
                            payload: {
                                bulkTransferId: <uuid>,
                                bulkTransferState: <string>
                            }
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: "notification",
                                action: "bulk-[prepare | commit | abort | processing]",
                                createdAt: <timestamp>,
                                state: {
                                    status: state.status,
                                    code: state.code
                                }
                            }
                        }
                    }
                end note

                BULK_PROC_HANDLER -> TOPIC_NOTIFICATION: Publish Notification event for Payer/Payee\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TOPIC_NOTIFICATION
                deactivate TOPIC_NOTIFICATION
            end
        else produceNotification == false
            note right of BULK_PROC_HANDLER #lightgrey
                Do nothing (awaitAllTransfers)
            end note
        end
    end
end
deactivate BULK_PROC_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>