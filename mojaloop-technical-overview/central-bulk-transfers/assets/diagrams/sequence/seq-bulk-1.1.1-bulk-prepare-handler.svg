<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4425px" preserveAspectRatio="none" style="width:1932px;height:4425px;" version="1.1" viewBox="0 0 1932 4425" width="1932px" zoomAndPan="magnify"><defs><filter height="300%" id="f142jgccrdi158" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="834.5" y="23.5352">1.1.1. Bulk Prepare Handler Consume</text><rect fill="#FFFFE0" height="4379.5117" style="stroke: #A80036; stroke-width: 1.0;" width="1793.5" x="39" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="885.25" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="83.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="2734.9785"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="212" y="181.8848"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="4192.2715" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="458.5" y="136.2637"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="3483.4688"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1184.5" y="1356.0938"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1295.5" y="4063.3613"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2187.123"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2445.873"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2887.8418"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="4162.293"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1493.5" y="1605.9121"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1493.5" y="1860.707"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="1635.2227"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="1890.0176"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2216.4336"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2475.1836"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2917.1523"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="4191.6035"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="4178.2715" style="stroke: #000000; stroke-width: 2.0;" width="1908" x="13" y="143.2637"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="2415.8516" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="33" y="226.8848"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="338.9688" style="stroke: #000000; stroke-width: 2.0;" width="1433" x="405.5" y="251.1953"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="2031.5723" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="43" y="604.1641"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="17.3105" style="stroke: #000000; stroke-width: 2.0;" width="334" x="53" y="628.4746"/><rect fill="#FFFFFF" height="741.3086" style="stroke: none; stroke-width: 1.0;" width="1858" x="43" y="652.7852"/><rect fill="#FFFFFF" height="1241.6426" style="stroke: none; stroke-width: 1.0;" width="1858" x="43" y="1394.0938"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="653.832" style="stroke: #000000; stroke-width: 2.0;" width="1478.5" x="395.5" y="1416.0488"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1458.5" x="405.5" y="1567.291"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1458.5" x="405.5" y="1822.0859"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1495.5" x="395.5" y="2108.8809"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2133.1914"/><rect fill="#FFFFFF" height="274.0605" style="stroke: none; stroke-width: 1.0;" width="1495.5" x="395.5" y="2354.6758"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2376.6309"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="1657.7988" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="23" y="2656.7363"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="840.4219" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="33" y="2681.0469"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2833.9102"/><rect fill="#FFFFFF" height="786.0664" style="stroke: none; stroke-width: 1.0;" width="1878" x="23" y="3528.4688"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="4108.3613"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="96" x2="96" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="217" x2="217" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="463.5" x2="463.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="949.5" x2="949.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1078.5" x2="1078.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1189.5" x2="1189.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1300.5" x2="1300.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1396.5" x2="1396.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1498.5" x2="1498.5" y1="126.2637" y2="4338.5352"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1780.5" x2="1780.5" y1="126.2637" y2="4338.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47" y="53.7988"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="43" y="57.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="56" y="78.334">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="50" y="94.8223">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="67" y="111.3105">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="72" y="111.3105">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="113" y="111.3105">)</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="47" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="63.4648" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="43" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="56" y="4362.0703">mojaloop-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="50" y="4378.5586">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="67" y="4395.0469">(</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="72" y="4395.0469">MLOS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="113" y="4395.0469">)</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="164" y="70.2871"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="160" y="74.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="192" y="94.8223">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="167" y="111.3105">bulk-prepare</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="164" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="160" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="192" y="4362.0703">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="167" y="4378.5586">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="415.5" y="106.8223">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="433.5" y="123.3105">Handler</text><ellipse cx="463.5" cy="77.2871" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="459.5,65.2871,465.5,60.2871,463.5,65.2871,465.5,70.2871,459.5,65.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="415.5" y="4351.0703">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="433.5" y="4367.5586">Handler</text><ellipse cx="463.5" cy="4386.5117" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="459.5,4374.5117,465.5,4369.5117,463.5,4374.5117,465.5,4379.5117,459.5,4374.5117" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="884.5" y="70.2871"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="880.5" y="74.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="924.5" y="94.8223">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="887.5" y="111.3105">transfer-prepare</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="884.5" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="880.5" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="924.5" y="4362.0703">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="887.5" y="4378.5586">transfer-prepare</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1032.5" y="86.7754"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1028.5" y="90.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1035.5" y="111.3105">topic-event</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1032.5" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1028.5" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1035.5" y="4362.0703">topic-event</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1143.5" y="70.2871"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1139.5" y="74.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1164.5" y="94.8223">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1146.5" y="111.3105">notification</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1143.5" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1139.5" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1164.5" y="4362.0703">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="1146.5" y="4378.5586">notification</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1253.5" y="70.2871"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1249.5" y="74.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1256.5" y="94.8223">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1259" y="111.3105">processing</text><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1253.5" y="4337.5352"/><rect fill="#FEFECE" filter="url(#f142jgccrdi158)" height="46.9766" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="1249.5" y="4341.5352"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1256.5" y="4362.0703">topic-bulk-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1259" y="4378.5586">processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1361.5" y="123.3105">Bulk DAO</text><ellipse cx="1396.5" cy="93.7754" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1384.5" x2="1408.5" y1="107.7754" y2="107.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="1361.5" y="4351.0703">Bulk DAO</text><ellipse cx="1396.5" cy="4370.0234" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1384.5" x2="1408.5" y1="4384.0234" y2="4384.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1441.5" y="123.3105">Participant DAO</text><ellipse cx="1498.5" cy="93.7754" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1486.5" x2="1510.5" y1="107.7754" y2="107.7754"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1441.5" y="4351.0703">Participant DAO</text><ellipse cx="1498.5" cy="4370.0234" fill="#FEFECE" filter="url(#f142jgccrdi158)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1486.5" x2="1510.5" y1="4384.0234" y2="4384.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1732.5" y="123.3105">Central Store</text><path d="M1762.5,73.7754 C1762.5,63.7754 1780.5,63.7754 1780.5,63.7754 C1780.5,63.7754 1798.5,63.7754 1798.5,73.7754 L1798.5,99.7754 C1798.5,109.7754 1780.5,109.7754 1780.5,109.7754 C1780.5,109.7754 1762.5,109.7754 1762.5,99.7754 L1762.5,73.7754 " fill="#FEFECE" filter="url(#f142jgccrdi158)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1762.5,73.7754 C1762.5,83.7754 1780.5,83.7754 1780.5,83.7754 C1780.5,83.7754 1798.5,83.7754 1798.5,73.7754 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1732.5" y="4351.0703">Central Store</text><path d="M1762.5,4364.0234 C1762.5,4354.0234 1780.5,4354.0234 1780.5,4354.0234 C1780.5,4354.0234 1798.5,4354.0234 1798.5,4364.0234 L1798.5,4390.0234 C1798.5,4400.0234 1780.5,4400.0234 1780.5,4400.0234 C1780.5,4400.0234 1762.5,4400.0234 1762.5,4390.0234 L1762.5,4364.0234 " fill="#FEFECE" filter="url(#f142jgccrdi158)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1762.5,4364.0234 C1762.5,4374.0234 1780.5,4374.0234 1780.5,4374.0234 C1780.5,4374.0234 1798.5,4374.0234 1798.5,4364.0234 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="83.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="91.5" y="2734.9785"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="212" y="181.8848"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="4192.2715" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="458.5" y="136.2637"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="944.5" y="3483.4688"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1184.5" y="1356.0938"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1295.5" y="4063.3613"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="152.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2187.123"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="167.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2445.873"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="2887.8418"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="137.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1391.5" y="4162.293"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1493.5" y="1605.9121"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="136.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1493.5" y="1860.707"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="1635.2227"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="77.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="1890.0176"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2216.4336"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2475.1836"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="2917.1523"/><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1775.5" y="4191.6035"/><path d="M13,143.2637 L269,143.2637 L269,150.2637 L259,160.2637 L13,160.2637 L13,143.2637 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4178.2715" style="stroke: #000000; stroke-width: 2.0;" width="1908" x="13" y="143.2637"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="28" y="156.832">Bulk Prepare Handler Consume</text><polygon fill="#A80036" points="233,177.8848,223,181.8848,233,185.8848,229,181.8848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="227" x2="457.5" y1="181.8848" y2="181.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="239" y="177.1426">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="252" y="177.1426">Consume Bulk Prepare message</text><path d="M33,226.8848 L285,226.8848 L285,233.8848 L275,243.8848 L33,243.8848 L33,226.8848 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2415.8516" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="33" y="226.8848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="48" y="240.4531">Validate Bulk Prepare Transfer</text><path d="M405.5,251.1953 L559.5,251.1953 L559.5,258.1953 L549.5,268.1953 L405.5,268.1953 L405.5,251.1953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="338.9688" style="stroke: #000000; stroke-width: 2.0;" width="1433" x="405.5" y="251.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="420.5" y="264.7637">Duplicate Check</text><path d="M473,273.5059 L473,436.5059 L905,436.5059 L905,283.5059 L895,273.5059 L473,273.5059 " fill="#00FFFF" filter="url(#f142jgccrdi158)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M895,273.5059 L895,283.5059 L905,283.5059 L895,273.5059 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="363" x="479" y="291.0742">The Specification doesn't touch on the duplicate handling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="368" x="479" y="306.3848">of bulk transfers, so the current design mostly follows the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="479" y="321.6953">strategy used for individual transfers, except in two places:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="483" y="337.0059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="479" y="352.3164">1. For duplicate requests where hash matches, the current design</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="403" x="479" y="367.627">includes only the status of the bulk &amp; timestamp (if completed),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="479" y="382.9375">but not the individual transfers (for which a GET should be used).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="483" y="398.248"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="479" y="413.5586">2. For duplicate requests where hash matches, but are not in a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="479" y="428.8691">finalized state, only the state of the bulkTransfer is sent.</text><polygon fill="#A80036" points="1768.5,487.9219,1778.5,491.9219,1768.5,495.9219,1772.5,491.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1774.5" y1="491.9219" y2="491.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="487.1797">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="488.5" y="487.1797">Request Duplicate Check</text><rect fill="#FFFFFF" filter="url(#f142jgccrdi158)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="1415" x="412.5" y="499.9219"/><polygon fill="#EEEEEE" points="412.5,499.9219,476.5,499.9219,476.5,506.9219,466.5,516.9219,412.5,516.9219,412.5,499.9219" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="425.5" y="514.4902">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="368" x="938" y="533.4902">Request Duplicate Check (using message.content.payload)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="942" y="548.8008"/><polygon fill="#A80036" points="479.5,578.1641,469.5,582.1641,479.5,586.1641,475.5,582.1641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1779.5" y1="582.1641" y2="582.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="485.5" y="577.4219">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="498.5" y="577.4219">Return { hasDuplicateId: Boolean, hasDuplicateHash: Boolean }</text><path d="M43,604.1641 L105,604.1641 L105,611.1641 L95,621.1641 L43,621.1641 L43,604.1641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2031.5723" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="43" y="604.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="58" y="617.7324">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="329" x="120" y="616.7988">[hasDuplicateId == TRUE &amp;&amp; hasDuplicateHash == TRUE]</text><path d="M53,628.4746 L137,628.4746 L137,635.4746 L127,645.4746 L53,645.4746 L53,628.4746 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="17.3105" style="stroke: #000000; stroke-width: 2.0;" width="334" x="53" y="628.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="68" y="642.043">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="230" x="152" y="641.1094">[Return TRUE &amp; Log ('Not implemented')]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="1901" y1="653.7852" y2="653.7852"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="331" x="48" y="664.4199">[hasDuplicateId == TRUE &amp;&amp; hasDuplicateHash == FALSE]</text><path d="M473,672.7402 L473,1309.7402 L789,1309.7402 L789,682.7402 L779,672.7402 L473,672.7402 " fill="#FFFF00" filter="url(#f142jgccrdi158)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M779,672.7402 L779,682.7402 L789,682.7402 L779,672.7402 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="690.3086">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="495" y="705.6191">id: &lt;messageId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="495" y="720.9297">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="495" y="736.2402">to: &lt;payerFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="495" y="751.5508">type: "application/json",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="495" y="766.8613">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="511" y="782.1719">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="511" y="797.4824">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="527" y="812.793">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="543" y="828.1035">errorCode: "3106",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="231" x="543" y="843.4141">errorDescription: "Modified request",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="543" y="858.7246">extensionList: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="559" y="874.0352">extension: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="575" y="889.3457">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="591" y="904.6563">key: "_cause",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="591" y="919.9668">value: &lt;FSPIOPError&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="575" y="935.2773">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="559" y="950.5879">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="543" y="965.8984">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="527" y="981.209">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="527" y="996.5195">uriParams: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="543" y="1011.8301">id: &lt;bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="527" y="1027.1406">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="511" y="1042.4512">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="495" y="1057.7617">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="495" y="1073.0723">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="511" y="1088.3828">correlationId: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="511" y="1103.6934">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="527" y="1119.0039">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="527" y="1134.3145">type: "notification",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="527" y="1149.625">action: "bulk-prepare",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="527" y="1164.9355">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="527" y="1180.2461">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="543" y="1195.5566">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="543" y="1210.8672">code: "3106",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="543" y="1226.1777">description: "Modified request"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="527" y="1241.4883">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="527" y="1256.7988">responseTo: &lt;uuid&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="511" y="1272.1094">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="495" y="1287.4199">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="1302.7305">}</text><polygon fill="#A80036" points="1172.5,1352.0938,1182.5,1356.0938,1172.5,1360.0938,1176.5,1356.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1178.5" y1="1356.0938" y2="1356.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="1343.6963">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="488.5" y="1336.041">Publish Notification (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="488.5" y="1351.3516">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="572.5" y="1351.3516">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="1901" y1="1395.0938" y2="1395.0938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="48" y="1405.7285">[hasDuplicateId == FALSE]</text><path d="M395.5,1416.0488 L706.5,1416.0488 L706.5,1423.0488 L696.5,1433.0488 L395.5,1433.0488 L395.5,1416.0488 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="653.832" style="stroke: #000000; stroke-width: 2.0;" width="1478.5" x="395.5" y="1416.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="410.5" y="1429.6172">Validate Bulk Transfer Prepare Request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="510.5" y1="1454.6699" y2="1454.6699"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="510.5" x2="510.5" y1="1454.6699" y2="1467.6699"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469.5" x2="510.5" y1="1467.6699" y2="1467.6699"/><polygon fill="#A80036" points="479.5,1463.6699,469.5,1467.6699,479.5,1471.6699,475.5,1467.6699" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="1449.9277">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="488.5" y="1449.9277">FSPIOP Source matches Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="510.5" y1="1496.9805" y2="1496.9805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="510.5" x2="510.5" y1="1496.9805" y2="1509.9805"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469.5" x2="510.5" y1="1509.9805" y2="1509.9805"/><polygon fill="#A80036" points="479.5,1505.9805,469.5,1509.9805,479.5,1513.9805,475.5,1509.9805" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="1492.2383">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="488.5" y="1492.2383">Check expiration</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="510.5" y1="1539.291" y2="1539.291"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="510.5" x2="510.5" y1="1539.291" y2="1552.291"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469.5" x2="510.5" y1="1552.291" y2="1552.291"/><polygon fill="#A80036" points="479.5,1548.291,469.5,1552.291,479.5,1556.291,475.5,1552.291" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="1534.5488">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="488.5" y="1534.5488">Payer and Payee FSP's are different</text><path d="M405.5,1567.291 L547.5,1567.291 L547.5,1574.291 L537.5,1584.291 L405.5,1584.291 L405.5,1567.291 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1458.5" x="405.5" y="1567.291"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="420.5" y="1580.8594">Validate Payer</text><polygon fill="#A80036" points="1481.5,1601.9121,1491.5,1605.9121,1481.5,1609.9121,1485.5,1605.9121" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1487.5" y1="1605.9121" y2="1605.9121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="475.5" y="1601.1699">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="488.5" y="1601.1699">Request to retrieve Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1763.5,1631.2227,1773.5,1635.2227,1763.5,1639.2227,1767.5,1635.2227" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1503.5" x2="1769.5" y1="1635.2227" y2="1635.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1510.5" y="1630.4805">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1523.5" y="1630.4805">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1716,1648.2227,1844,1648.2227,1854,1667.2227,1844,1686.2227,1716,1686.2227,1706,1667.2227,1716,1648.2227" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1718" y="1664.791">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1718" y="1680.1016">participantCurrency</text><polygon fill="#A80036" points="1514.5,1709.1543,1504.5,1713.1543,1514.5,1717.1543,1510.5,1713.1543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1508.5" x2="1779.5" y1="1713.1543" y2="1713.1543"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1520.5" y="1708.4121">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1542.5" y="1708.4121">Return Participant details if it exists</text><polygon fill="#A80036" points="479.5,1738.4648,469.5,1742.4648,479.5,1746.4648,475.5,1742.4648" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1497.5" y1="1742.4648" y2="1742.4648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="1737.7227">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="507.5" y="1737.7227">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="510.5" y1="1787.0859" y2="1787.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="510.5" x2="510.5" y1="1787.0859" y2="1800.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469.5" x2="510.5" y1="1800.0859" y2="1800.0859"/><polygon fill="#A80036" points="479.5,1796.0859,469.5,1800.0859,479.5,1804.0859,475.5,1800.0859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="1774.6885">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="497.5" y="1767.0332">Validate Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="1782.3438">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="1782.3438">3202</text><path d="M405.5,1822.0859 L549.5,1822.0859 L549.5,1829.0859 L539.5,1839.0859 L405.5,1839.0859 L405.5,1822.0859 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="240.7949" style="stroke: #000000; stroke-width: 2.0;" width="1458.5" x="405.5" y="1822.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="420.5" y="1835.6543">Validate Payee</text><polygon fill="#A80036" points="1481.5,1856.707,1491.5,1860.707,1481.5,1864.707,1485.5,1860.707" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1487.5" y1="1860.707" y2="1860.707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="1855.9648">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="497.5" y="1855.9648">Request to retrieve Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1763.5,1886.0176,1773.5,1890.0176,1763.5,1894.0176,1767.5,1890.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1503.5" x2="1769.5" y1="1890.0176" y2="1890.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1510.5" y="1885.2754">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1532.5" y="1885.2754">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1716,1903.0176,1844,1903.0176,1854,1922.0176,1844,1941.0176,1716,1941.0176,1706,1922.0176,1716,1903.0176" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1718" y="1919.5859">participant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1718" y="1934.8965">participantCurrency</text><polygon fill="#A80036" points="1514.5,1963.9492,1504.5,1967.9492,1514.5,1971.9492,1510.5,1967.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1508.5" x2="1779.5" y1="1967.9492" y2="1967.9492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1520.5" y="1963.207">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1542.5" y="1963.207">Return Participant details if it exists</text><polygon fill="#A80036" points="479.5,1993.2598,469.5,1997.2598,479.5,2001.2598,475.5,1997.2598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1497.5" y1="1997.2598" y2="1997.2598"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="1992.5176">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="507.5" y="1992.5176">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="510.5" y1="2041.8809" y2="2041.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="510.5" x2="510.5" y1="2041.8809" y2="2054.8809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="469.5" x2="510.5" y1="2054.8809" y2="2054.8809"/><polygon fill="#A80036" points="479.5,2050.8809,469.5,2054.8809,479.5,2058.8809,475.5,2054.8809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="2029.4834">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="497.5" y="2021.8281">Validate Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="2037.1387">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="2037.1387">3203</text><path d="M395.5,2108.8809 L457.5,2108.8809 L457.5,2115.8809 L447.5,2125.8809 L395.5,2125.8809 L395.5,2108.8809 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="519.8555" style="stroke: #000000; stroke-width: 2.0;" width="1495.5" x="395.5" y="2108.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="410.5" y="2122.4492">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="287" x="472.5" y="2121.5156">[Validate Bulk Transfer Prepare Request  (success)]</text><path d="M405.5,2133.1914 L876.5,2133.1914 L876.5,2140.1914 L866.5,2150.1914 L405.5,2150.1914 L405.5,2133.1914 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="214.4844" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2133.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="426" x="420.5" y="2146.7598">Persist Bulk Transfer State (with bulkTransferState='RECEIVED')</text><polygon fill="#A80036" points="1379.5,2183.123,1389.5,2187.123,1379.5,2191.123,1383.5,2187.123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1385.5" y1="2187.123" y2="2187.123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="2174.7256">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="497.5" y="2167.0703">Request to persist bulk transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="2182.3809">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="2182.3809">2003</text><polygon fill="#A80036" points="1763.5,2212.4336,1773.5,2216.4336,1763.5,2220.4336,1767.5,2216.4336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1401.5" x2="1769.5" y1="2216.4336" y2="2216.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1408.5" y="2211.6914">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1430.5" y="2211.6914">Persist bulkTransfer</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1699,2259.4336,1861,2259.4336,1871,2285.4336,1861,2312.4336,1699,2312.4336,1689,2285.4336,1699,2259.4336" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1701" y="2276.002">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1701" y="2291.3125">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1701" y="2306.623">bulkTransferStateChange</text><polygon fill="#A80036" points="479.5,2335.6758,469.5,2339.6758,479.5,2343.6758,475.5,2339.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1395.5" y1="2339.6758" y2="2339.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="2334.9336">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="507.5" y="2334.9336">Return state</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="395.5" x2="1891" y1="2355.6758" y2="2355.6758"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="400.5" y="2366.3105">[Validate Bulk Transfer Prepare Request (failure)]</text><path d="M405.5,2376.6309 L1255.5,2376.6309 L1255.5,2383.6309 L1245.5,2393.6309 L405.5,2393.6309 L405.5,2376.6309 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="245.1055" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2376.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="805" x="420.5" y="2390.1992">Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)</text><polygon fill="#A80036" points="1379.5,2441.873,1389.5,2445.873,1379.5,2449.873,1383.5,2445.873" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1385.5" y1="2445.873" y2="2445.873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="2425.8203">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="497.5" y="2410.5098">Request to persist bulk transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="497.5" y="2425.8203">(when Payee/Payer/crypto-condition validation fails)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="2441.1309">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="2441.1309">2003</text><polygon fill="#A80036" points="1763.5,2471.1836,1773.5,2475.1836,1763.5,2479.1836,1767.5,2475.1836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1401.5" x2="1769.5" y1="2475.1836" y2="2475.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1408.5" y="2470.4414">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1430.5" y="2470.4414">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1699,2518.1836,1861,2518.1836,1871,2552.1836,1861,2587.1836,1699,2587.1836,1689,2552.1836,1699,2518.1836" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1701" y="2534.752">bulkTransfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1701" y="2550.0625">bulkTransferExtension</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1701" y="2565.373">bulkTransferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1701" y="2580.6836">bulkTransferError</text><polygon fill="#A80036" points="479.5,2609.7363,469.5,2613.7363,479.5,2617.7363,475.5,2613.7363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1395.5" y1="2613.7363" y2="2613.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="2608.9941">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="507.5" y="2608.9941">Return state</text><path d="M23,2656.7363 L85,2656.7363 L85,2663.7363 L75,2673.7363 L23,2673.7363 L23,2656.7363 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1657.7988" style="stroke: #000000; stroke-width: 2.0;" width="1878" x="23" y="2656.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="2670.3047">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="100" y="2669.3711">[Validate Bulk Prepare Transfer (success)]</text><path d="M33,2681.0469 L107,2681.0469 L107,2688.0469 L97,2698.0469 L33,2698.0469 L33,2681.0469 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="840.4219" style="stroke: #000000; stroke-width: 2.0;" width="1858" x="33" y="2681.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="48" y="2694.6152">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="122" y="2693.6816">[for each individual transfer in the bulk]</text><polygon fill="#A80036" points="112.5,2730.9785,102.5,2734.9785,112.5,2738.9785,108.5,2734.9785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="457.5" y1="2734.9785" y2="2734.9785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="118.5" y="2722.5811">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="140.5" y="2714.9258">Retrieve individual transfers from the bulk using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="140.5" y="2730.2363">reference:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="250" x="206.5" y="2730.2363">MLOS.individualTransfers.messageId</text><path d="M106,2747.9785 L106,2787.9785 L555,2787.9785 L555,2757.9785 L545,2747.9785 L106,2747.9785 " fill="#D3D3D3" filter="url(#f142jgccrdi158)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M545,2747.9785 L545,2757.9785 L555,2757.9785 L545,2747.9785 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="112" y="2765.5469">Add elements such as Expiry time, Payer FSP, Payee FSP, etc. to each</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="112" y="2780.8574">transfer to make their format similar to a single transfer</text><polygon fill="#A80036" points="446.5,2814.9102,456.5,2818.9102,446.5,2822.9102,450.5,2818.9102" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="96.5" x2="452.5" y1="2818.9102" y2="2818.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="103.5" y="2814.168">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="125.5" y="2814.168">Stream bulk's individual transfers</text><path d="M405.5,2833.9102 L929.5,2833.9102 L929.5,2840.9102 L919.5,2850.9102 L405.5,2850.9102 L405.5,2833.9102 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="2833.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="479" x="420.5" y="2847.4785">Insert Bulk Transfer Association (with bulkProcessingState='RECEIVED')</text><polygon fill="#A80036" points="1379.5,2883.8418,1389.5,2887.8418,1379.5,2891.8418,1383.5,2887.8418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1385.5" y1="2887.8418" y2="2887.8418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="2875.4443">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="497.5" y="2867.7891">Request to persist bulk transfer association</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="2883.0996">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="2883.0996">2003</text><polygon fill="#A80036" points="1763.5,2913.1523,1773.5,2917.1523,1763.5,2921.1523,1767.5,2917.1523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1401.5" x2="1769.5" y1="2917.1523" y2="2917.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1408.5" y="2912.4102">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1430.5" y="2912.4102">Insert bulkTransferAssociation</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1699,2960.1523,1861,2960.1523,1871,2979.1523,1861,2998.1523,1699,2998.1523,1689,2979.1523,1699,2960.1523" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1701" y="2976.7207">bulkTransferAssociation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1701" y="2992.0313">bulkTransferStateChange</text><polygon fill="#A80036" points="479.5,3021.084,469.5,3025.084,479.5,3029.084,475.5,3025.084" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1395.5" y1="3025.084" y2="3025.084"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="3020.3418">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="507.5" y="3020.3418">Return state</text><path d="M473,3045.084 L473,3437.084 L753,3437.084 L753,3055.084 L743,3045.084 L473,3045.084 " fill="#FFFF00" filter="url(#f142jgccrdi158)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M743,3045.084 L743,3055.084 L753,3055.084 L743,3045.084 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="479" y="3062.6523">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="3077.9629">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="495" y="3093.2734">id: &lt;messageId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="495" y="3108.584">from: &lt;payerFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="495" y="3123.8945">to: &lt;payeeFspName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="495" y="3139.2051">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="495" y="3154.5156">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="511" y="3169.8262">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="511" y="3185.1367">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="495" y="3200.4473">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="495" y="3215.7578">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="511" y="3231.0684">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="527" y="3246.3789">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="527" y="3261.6895">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="527" y="3277">type: "prepare",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="527" y="3292.3105">action: "bulk-prepare",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="527" y="3307.6211">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="527" y="3322.9316">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="543" y="3338.2422">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="543" y="3353.5527">code: 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="543" y="3368.8633">description:"action successful"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="527" y="3384.1738">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="511" y="3399.4844">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="495" y="3414.7949">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="3430.1055">}</text><polygon fill="#A80036" points="932.5,3479.4688,942.5,3483.4688,932.5,3487.4688,936.5,3483.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="938.5" y1="3483.4688" y2="3483.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="3471.0713">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="435" x="497.5" y="3463.416">Route &amp; Publish Prepare event to the Payee for the Individual Transfer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="3478.7266">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="3478.7266">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1901" y1="3529.4688" y2="3529.4688"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="28" y="3540.1035">[Validate Bulk Prepare Transfer (failure)]</text><path d="M473,3548.4238 L473,4017.4238 L1080,4017.4238 L1080,3558.4238 L1070,3548.4238 L473,3548.4238 " fill="#FFFF00" filter="url(#f142jgccrdi158)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1070,3548.4238 L1070,3558.4238 L1080,3558.4238 L1070,3548.4238 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="479" y="3565.9922">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="3581.3027">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="495" y="3596.6133">id: &lt;messageId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="495" y="3611.9238">from: &lt;ledgerName&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="495" y="3627.2344">to: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="495" y="3642.5449">type: "application/json",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="495" y="3657.8555">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="511" y="3673.166">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="511" y="3688.4766">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="527" y="3703.7871">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="543" y="3719.0977">"errorCode": &lt;possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="543" y="3734.4082">"errorDescription": "&lt;refer to section 7.6 for description&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="543" y="3749.7188">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="511" y="3765.0293">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="495" y="3780.3398">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="495" y="3795.6504">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="511" y="3810.9609">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="527" y="3826.2715">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="527" y="3841.582">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="527" y="3856.8926">type: "bulk-processing",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="527" y="3872.2031">action: "bulk-abort",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="527" y="3887.5137">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="527" y="3902.8242">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="543" y="3918.1348">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="543" y="3933.4453">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="543" y="3948.7559">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="527" y="3964.0664">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="511" y="3979.377">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="495" y="3994.6875">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="479" y="4009.998">}</text><polygon fill="#A80036" points="1283.5,4059.3613,1293.5,4063.3613,1283.5,4067.3613,1287.5,4063.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1289.5" y1="4063.3613" y2="4063.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="4050.9639">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="497.5" y="4043.3086">Publish Processing (failure) event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="4058.6191">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="4058.6191">2003</text><path d="M405.5,4108.3613 L919.5,4108.3613 L919.5,4115.3613 L909.5,4125.3613 L405.5,4125.3613 L405.5,4108.3613 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="199.1738" style="stroke: #000000; stroke-width: 2.0;" width="1475.5" x="405.5" y="4108.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="469" x="420.5" y="4121.9297">Insert Bulk Transfer Association (with bulkProcessingState='INVALID')</text><polygon fill="#A80036" points="1379.5,4158.293,1389.5,4162.293,1379.5,4166.293,1383.5,4162.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="1385.5" y1="4162.293" y2="4162.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="475.5" y="4149.8955">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="497.5" y="4142.2402">Request to persist bulk transfer association</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="497.5" y="4157.5508">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="581.5" y="4157.5508">2003</text><polygon fill="#A80036" points="1763.5,4187.6035,1773.5,4191.6035,1763.5,4195.6035,1767.5,4191.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1401.5" x2="1769.5" y1="4191.6035" y2="4191.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1408.5" y="4186.8613">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1430.5" y="4186.8613">Insert bulkTransferAssociation</text><polygon fill="#FFFFE0" filter="url(#f142jgccrdi158)" points="1699,4234.6035,1861,4234.6035,1871,4253.6035,1861,4272.6035,1699,4272.6035,1689,4253.6035,1699,4234.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1701" y="4251.1719">bulkTransferAssociation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1701" y="4266.4824">bulkTransferStateChange</text><polygon fill="#A80036" points="479.5,4295.5352,469.5,4299.5352,479.5,4303.5352,475.5,4299.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="473.5" x2="1395.5" y1="4299.5352" y2="4299.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="485.5" y="4294.793">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="507.5" y="4294.793">Return state</text><!--
@startuml
title 1.1.1. Bulk Prepare Handler Consume

autonumber


collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
collections "mojaloop-\nobject-store\n(**MLOS**)" as OBJECT_STORE
control "Bulk Prepare \nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
collections "topic-event" as TOPIC_EVENTS
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS
collections "topic-bulk-\nprocessing" as TOPIC_BULK_PROCESSING
entity "Bulk DAO" as BULK_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant TOPIC_BULK_PROCESSING
    participant BULK_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate BULK_PREP_HANDLER
group Bulk Prepare Handler Consume
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume Bulk Prepare message
    activate TOPIC_BULK_PREPARE
    deactivate TOPIC_BULK_PREPARE
    group Validate Bulk Prepare Transfer 
        group Duplicate Check
            note right of BULK_PREP_HANDLER #cyan
                The Specification doesn't touch on the duplicate handling
                of bulk transfers, so the current design mostly follows the
                strategy used for individual transfers, except in two places:

                1. For duplicate requests where hash matches, the current design
                includes only the status of the bulk & timestamp (if completed),
                but not the individual transfers (for which a GET should be used).

                2. For duplicate requests where hash matches, but are not in a
                finalized state, only the state of the bulkTransfer is sent.
            end note
            |||
            BULK_PREP_HANDLER -> DB: Request Duplicate Check
            ref over BULK_PREP_HANDLER, DB:  Request Duplicate Check (using message.content.payload)\n
            DB - -> BULK_PREP_HANDLER: Return { hasDuplicateId: Boolean, hasDuplicateHash: Boolean }
        end

        alt hasDuplicateId == TRUE && hasDuplicateHash == TRUE
            break Return TRUE & Log ('Not implemented')
            end
        else hasDuplicateId == TRUE && hasDuplicateHash == FALSE
            note right of BULK_PREP_HANDLER #yellow
                {
                    id: <messageId>,
                    from: <ledgerName>,
                    to: <payerFspName>,
                    type: "application/json",
                    content: {
                        headers: <bulkTransferHeaders>,
                        payload: {
                            errorInformation: {
                                errorCode: "3106",
                                errorDescription: "Modified request",
                                extensionList: {
                                    extension: [
                                        {
                                            key: "_cause",
                                            value: <FSPIOPError>
                                        }
                                    ]
                                }
                            },
                            uriParams: {
                                id: <bulkTransferId>
                            }
                        }
                    },
                    metadata: {
                        correlationId: <uuid>,
                        event: {
                            id: <uuid>,
                            type: "notification",
                            action: "bulk-prepare",
                            createdAt: <timestamp>,
                            state: {
                                status: "error",
                                code: "3106",
                                description: "Modified request"
                            },
                            responseTo: <uuid>
                        }
                    }
                }
            end note
            BULK_PREP_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 3106</color>
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        else hasDuplicateId == FALSE
            group Validate Bulk Transfer Prepare Request
                BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: FSPIOP Source matches Payer
                BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Check expiration
                BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Payer and Payee FSP's are different
                group Validate Payer
                    BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payer Participant details (if it exists)
                    activate PARTICIPANT_DAO
                    PARTICIPANT_DAO -> DB: Request Participant details
                    hnote over DB #lightyellow
                        participant
                        participantCurrency
                    end note
                    activate DB
                    PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                    deactivate DB
                    PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
                    deactivate PARTICIPANT_DAO
                    BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payer\n<color #FF0000><b>Error codes:</b> 3202</color>
                end
                group Validate Payee
                    BULK_PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve Payee Participant details (if it exists)
                    activate PARTICIPANT_DAO
                    PARTICIPANT_DAO -> DB: Request Participant details
                    hnote over DB #lightyellow
                        participant
                        participantCurrency
                    end note
                    activate DB
                    PARTICIPANT_DAO <- - DB: Return Participant details if it exists
                    deactivate DB
                    PARTICIPANT_DAO - -> BULK_PREP_HANDLER: Return Participant details if it exists
                    deactivate PARTICIPANT_DAO
                    BULK_PREP_HANDLER <-> BULK_PREP_HANDLER: Validate Payee\n<color #FF0000><b>Error codes:</b> 3203</color>
                end
            end
            |||
            alt Validate Bulk Transfer Prepare Request  (success)
                group Persist Bulk Transfer State (with bulkTransferState='RECEIVED')
                    BULK_PREP_HANDLER -> BULK_DAO: Request to persist bulk transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
                    activate BULK_DAO
                    BULK_DAO -> DB: Persist bulkTransfer
                    hnote over DB #lightyellow
                        bulkTransfer
                        bulkTransferExtension
                        bulkTransferStateChange
                    end note
                    activate DB
                    deactivate DB
                    BULK_DAO - -> BULK_PREP_HANDLER: Return state
                    deactivate BULK_DAO
                end
            else Validate Bulk Transfer Prepare Request (failure)
                group Persist Bulk Transfer State (with bulkTransferState='INVALID') (Introducing a new status INVALID to mark these entries)
                    BULK_PREP_HANDLER -> BULK_DAO: Request to persist bulk transfer\n(when Payee/Payer/crypto-condition validation fails)\n<color #FF0000><b>Error codes:</b> 2003</color>
                    activate BULK_DAO
                    BULK_DAO -> DB: Persist transfer
                    hnote over DB #lightyellow
                        bulkTransfer
                        bulkTransferExtension
                        bulkTransferStateChange
                        bulkTransferError
                    end note
                    activate DB
                    deactivate DB
                    BULK_DAO - -> BULK_PREP_HANDLER: Return state
                    deactivate BULK_DAO
                end
            end
        end
    end
    alt Validate Bulk Prepare Transfer (success)
        loop for each individual transfer in the bulk
            BULK_PREP_HANDLER -> OBJECT_STORE: Retrieve individual transfers from the bulk using\nreference: **MLOS.individualTransfers.messageId**
            activate OBJECT_STORE
            note right of OBJECT_STORE #lightgrey
                Add elements such as Expiry time, Payer FSP, Payee FSP, etc. to each
                transfer to make their format similar to a single transfer
            end note
            OBJECT_STORE - -> BULK_PREP_HANDLER: Stream bulk's individual transfers
            deactivate OBJECT_STORE

            group Insert Bulk Transfer Association (with bulkProcessingState='RECEIVED')
                BULK_PREP_HANDLER -> BULK_DAO: Request to persist bulk transfer association\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate BULK_DAO
                BULK_DAO -> DB: Insert bulkTransferAssociation
                hnote over DB #lightyellow
                    bulkTransferAssociation
                    bulkTransferStateChange
                end note
                activate DB
                deactivate DB
                BULK_DAO - -> BULK_PREP_HANDLER: Return state
                deactivate BULK_DAO
            end

            note right of BULK_PREP_HANDLER #yellow
                Message:
                {
                    id: <messageId>
                    from: <payerFspName>,
                    to: <payeeFspName>,
                    type: application/json
                    content: {
                        headers: <transferHeaders>,
                        payload: <transferMessage>
                    },
                    metadata: {
                        event: {
                            id: <uuid>,
                            responseTo: <previous.uuid>,
                            type: "prepare",
                            action: "bulk-prepare",
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0,
                                description:"action successful"
                            }
                        }
                    }
                }
            end note
            BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event to the Payee for the Individual Transfer\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate TOPIC_TRANSFER_PREPARE
            deactivate TOPIC_TRANSFER_PREPARE
        end
    else Validate Bulk Prepare Transfer (failure)
        note right of BULK_PREP_HANDLER #yellow
            Message:
            {
                id: <messageId>
                from: <ledgerName>,
                to: <bulkTransferMessage.payerFsp>,
                type: "application/json",
                content: {
                    headers: <bulkTransferHeaders>,
                    payload: {
                        "errorInformation": {
                            "errorCode": <possible codes: [2003, 3100, 3105, 3106, 3202, 3203, 3300, 3301]>
                            "errorDescription": "<refer to section 7.6 for description>",
                            "extensionList": <transferMessage.extensionList>
                    }
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: "bulk-processing",
                        action: "bulk-abort",
                        createdAt: <timestamp>,
                        state: {
                            status: "error",
                            code: <errorInformation.errorCode>
                            description: <errorInformation.errorDescription>
                        }
                    }
                }
            }
        end note
        BULK_PREP_HANDLER -> TOPIC_BULK_PROCESSING: Publish Processing (failure) event for Payer\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
        group Insert Bulk Transfer Association (with bulkProcessingState='INVALID')
            BULK_PREP_HANDLER -> BULK_DAO: Request to persist bulk transfer association\n<color #FF0000><b>Error codes:</b> 2003</color>
            activate BULK_DAO
            BULK_DAO -> DB: Insert bulkTransferAssociation
            hnote over DB #lightyellow
                bulkTransferAssociation
                bulkTransferStateChange
            end note
            activate DB
            deactivate DB
            BULK_DAO - -> BULK_PREP_HANDLER: Return state
            deactivate BULK_DAO
        end

    end
end
deactivate BULK_PREP_HANDLER
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="305px" preserveAspectRatio="none" style="width:536px;height:305px;background:#000000;" version="1.1" viewBox="0 0 536 305" width="536px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="207.5313" style="stroke: #FFFFFF; stroke-width: 1.0;" width="535" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="5" y="16.6016">Welcome to PlantUML!</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="30.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="266" x="5" y="44.8672">If you use this software, you accept its license.</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="99" x="5" y="59">(details by typing</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="108" y="58.7012">license</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="53" x="161" y="59">keyword)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="73.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="264" x="5" y="87.2656">You can start with a simple UML Diagram like:</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="101.3984"/><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="119" x="5" y="115.0684">Bob-&gt;Alice: Hello</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="129.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="14" x="5" y="143.6328">Or</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="157.7656"/><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="91" x="5" y="171.4355">class Example</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="185.8672"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="324" x="5" y="200">You will find more information about PlantUML syntax on</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="117" x="333" y="200">http://plantuml.com</text><image height="71" width="80" x="449" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABHCAMAAACnHDC8AAADAFBMVEX///+BpbvD3u/f7vfPz8+nz+g3ksuZEDkWADr/ujlvsdpTodLCwsOLwOEbg8T//v6pqamZETnLysvT09To5+jqLS4VATj9/f27u7vDw8MTfsK+v7/j4+SOweJprdjL4/KxsbEri8jk8PgXa57c29uUETez1utQoNJ1tNtEmc9cptWBut6ayOW/3O6YEDjY6vUfhcXBwcHs7Ozw9/v83t79uTn7+/vX19ehoaHx8fG2tLXHx8fuVlfrNTYaBjn/vUH5+fmko6WXl5f/+fn95ub+9PT+8PD3qKidmaMxIUrnqDWcFj7n5eX09PTu7u2SkpKfnZ6rq6z0lJTm4tzJrHUfDT339/eFGDn6tjcrEzOvrbBuZ3l4eomSMS7Hz9Smpqasu8SFiYuQETfa2du1m6OOM051J0NWTWL5xse4uLj6zc33r6/4vb7ydHXqLi/72dntTE3tR0ijbn5jW3C+u8NANVQrG0XFubqRVGZza4GQGT2VaS7a0NPJtI6IJj/zszrfqkXXzr/Hw8cgC0LUqltOQ2JsSC5bTGjOpFafSi2+iDGtyt14m7TJhTCPJUSwoIG/qa+ikHiIgpCRHjI9j8KXbnaQH0FLf6FGPlp0cnYyKE2rg49Wj7dFXHmcwtrp6uu+xMjvYWLvW1z97e3sPD3sP0DuUlP709PYzdDPmzqZWWySRVygfHHd1smWkZ+PgnibETqsl260q5fLuppJLC/dpj2HPFLTtHv/ujrTwJy5s6iWjIi0iD3joTTCmU3trjuvZS2zlFvjq0HSyLbYp0qRts10XGxEKC9yPVBQZIOPdlNvMk2NeYNqRlujtcCVrr3j5eY1gK9Qn9GLp7lbeJXRxrCkiZDaozyukoJ+H0B3rc+OYy+iprJkYXdhmr6ee0afs79xq9BikrGKjI3FomEiLFO0ay6nfIm4pZXRjTFuhZSZWm0zcZyJN0KNTk4eebNfdIGGlZ93h5kcED5nOVYyRWbziIk9dJ4kerE5ZYxRUnLG1d7p8PTvY2PtTk/1nZ1ycV/bAAAFfElEQVR42mNgoB7IABFMVDTwlTOVDVyiDiSYqWjgwc93GagJshdRNwzzL8WCKEZqmeemfZp9L5BmoZb7mIwPH2Fg4DelkgtzLpocPsPgxsPwmToudGcyvnzGjSfk0AzqeNn9XPzfCcv/nZi/mzr+dRctcGNYbmsDyijUcCF/nPqvXfy/GTj2UCuCRW0YGExEbfkZqJSwr2kYgqgbqtQycLcBsEAQ7GfIBTuRGoWDwOK3p+59fb4r8jSVDLx7dOnR+2+03v55RLWCwSQbmFlEF1LLywwMz/53rud1enyaioWhM0OGO1VLVwZ+F2qapmIEZ1KjcPBj5gOG4ksIh/JIMWPlPv7ypqQZ11PqGGiox/TtDcefF/fFf6s9p4KBHzku/foNNPAX81t+ga98Xyk2sHNRoNdqsIGMnG87HrC/o9RAxmntyl+5P4AN/HPV+M99SispRt4frP8f/DT9wsYo+F3+/+k/FLuQHWjEZDU2zVvy6s+uPmH6RxUXMv/4G/f+yFtQsv5Daaph5GPj5uJlZWKWhOYTJgYqg1EDB5GBn+nlwpoJ6CrWHkYXKSnBYyBq1hPJYF6Q5nAISSRY236fqOZ1JBHhrNNPbZ5/Q856TH/+M7L+ArsPJeuFuX6uBFL9gWmboSKWLq6guqz87+EDMCtT74AkHVMTP6JkPUbOL+Cc8gdhIH8o4yIoM067AFy41wq6QkXqf9aDrbR5MgkqUvu3DquBcC+XZyzfB2NfvHVz/TuGq8wzemH1RuhjUaVb/I7eRSdhag79jPr2HLeXVzBVIxomLo9vMvT/9y/ZCDPuFNhGQfYC1PB3/L8Dhwt9fN6WfkQovGeodG/nzhfGMBdDqrPfZ0UlbqAY+OBB44UfWFzo6weOCxDgAkWe+k2II+VSTHygroM5yWbHKYbqViQRX4/aN2iRIu4LjwuomVyyQBNXhgPZPbozNqL6slErBL0txy6PamD68ZvIpkERPCUZ1KDq13G7tx5VhO/+8kLkMPxw8dlFuORvGGJYuQYscPV2EaPYU+RO9nHJ2O8JyJnnZ9dCWd9NiDBU/n6PKWMpqqVAbyMc2RPsfwXN37aOaP6eFCEI97Lyd7GP1/4KoxiHqlpdv0cBVcS/uQ7d300710O9LPSH+2eVeE3hdGR/o4C3e5a9eIUiwurEsQNVDTvLw6cQL4MN/HxnnYyZ9GUczd280HeTZqJ0TI6t/PPwJ7JI/OddkIBm+gdrH/Z92ZZpg8W48qjETQwMekgim/9HHWc45bkfIZL79OZ5LA3OkE3XqjagGRcQulwDRBvDRRawJTwB0XZwA/MuHTmOpAWpBRv4Kb8sArmrEW28KAS1GHZ0rb4DYV2FZRXbrieoBWzbIWAYCv1n+sXK9PNGp7spIlEWipbCUqDqB1Cs+DdO3fAOVsyCjeHz2b3uE0oF8I/5yO6gFTADOd5+c639CCkB1t+5uwSuTqxgFQPDjtfVHxDdCFCsAOPiO1qNAioc5r/lmPqP+QsX8yf+m4rsn/a+iX3EUP7s5WZkhS2tW//MWYUs4rk/9+mdU+hxCC2x41o+RMANFPi8alaB3RtoHXDbEmxwv3LDOWiT/5gT2ODiqx+hcWH0SOcAwkBweXjxaEzkArCXBVl+cvzac74DmlkMpd7/ZgEF0vue5xARBQnOC06g4uTvQWhkCCjaifI8QPYypPLZz+cFc6HgC1hkCGg8NH59EiUhffx18wNKIzDgABMj4xu4C2EJ4o1u7TVi6vEXDAwc/BhdATlsFf0ie+eZ6Cp5biielUcR0T7/XxS1lXqYQcP8HFILFFnuwr+9i1C8TDJArpchNTLTfgoNRGvbLPrWeIbazSeZBX+kydbMgnX8UFjvMLkG+q4HABVtKp9tQ9JtAAAAAElFTkSuQmCC" y="6"/><rect fill="#000000" height="97.4414" style="stroke: #000000; stroke-width: 1.0;" width="535" x="0" y="207.5313"/><rect fill="#33FF02" height="21.4883" style="stroke: #33FF02; stroke-width: 1.0;" width="158" x="5" y="212.5313"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="156" x="6" y="227.5313">[From string (line 2) ]</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="10" y="248.0195"/><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="5" y="264.5078">@startuml</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="10" y="280.9961"/><text fill="#FF0000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="10" y="297.4844">Empty description</text><!--
@startuml


@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 PHT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_171-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>